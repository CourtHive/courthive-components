import{_ as Dj}from"./index-e42a72ce.js";const jj="normal",Rg="timed",Rj="final",kf="NOAD",Al="SET",Fj={S:jj,F:Rj};function Wf(t,e){if(typeof t=="object"){if(t.timed&&!isNaN(t.minutes))return qf(t);if(t.bestOf&&t.setFormat)return Vj(t,e)}}function Vl(t){return!isNaN(Number(t))&&Number(t)}function qf(t){let e=`T${t.minutes}`;return t.based&&(e+=t.based),t.modifier&&(e+=`@${t.modifier}`),e}function Vj(t,e){var r;const n=Vl(t.bestOf);if((r=t.setFormat)!=null&&r.timed&&t.simplified&&n===1)return qf(t.setFormat);const o=n&&`${Al}${n}`||"",i=Fg(t.setFormat,e),s=i&&`S:${i}`||"",a=Fg(t.finalSetFormat,e),c=n>1&&a&&i!==a&&`F:${a}`||"";if(o&&i)return[o,s,c].filter(u=>u).join("-")}function Fg(t,e){if(typeof t=="object"&&Object.keys(t).length){if(t.timed)return qf(t);if(t.tiebreakSet)return Vg(t.tiebreakSet);const r=Vl(t.setTo);if(r){const n=t.NoAD&&kf||"",o=Vg(t.tiebreakFormat),i=o&&`/${o}`||"",s=Vl(t.tiebreakAt),a=s&&(s!==r||e)&&`@${s}`||"";if(o!==!1)return`${r}${n}${i}${a}`}}}function Vg(t){if(t){if(typeof t=="object"&&!t.tiebreakTo)return"";if(typeof t=="object"&&Vl(t.tiebreakTo)){let e=`TB${t.tiebreakTo}${t.NoAD?kf:""}`;return t.modifier&&(e+=`@${t.modifier}`),e}else return!1}}function Lr(t){return isNaN(t)?!1:t&&(t&t-1)===0}function Lj(t){if(!Lr(t))return!1;let e=t,r=1;for(;e!==2;)r+=1,e=e/2;return r}function Hf(t){return isNaN(t)?0:t%2&&t+1||t}function Yf(t){return Math.pow(2,Math.round(Math.log(t)/Math.log(2)))}function Pt(t){return!isNaN(parseFloat(t))}function Bj(t){const e=parseInt(t);if(!isNaN(e))return e===0?!1:(e&-e)===1}function ia(t){if(isNaN(t))return!1;for(;!Lr(t);)t++;return t}function Tr(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function lt(t){return Number.isSafeInteger(typeof t=="string"?+t:t)}function xj(t=1,e=3,r=!0){let n=0;for(let o=0;o<e;o++)n+=Math.random()*(t/e);return r&&t>1?Math.round(n):n}function Gj(t,e){e||(e=1);const r=1/e;return Math.round(t*r)/r}function J$(t,e,r,n,o=2){const i=1-Math.random(),s=1-Math.random();let a=Math.sqrt(-2*Math.log(i))*Math.cos(2*Math.PI*s);return a=a/10+.5,a>1||a<0?a=J$(t,e,r):(a=Math.pow(a,r),a*=e-t,a+=t),n&&(a=Gj(a,n)),parseFloat(a.toFixed(o))}function Ir(t){if(typeof t=="string"){const e=t.startsWith("T")&&Rg||t.startsWith(Al)&&Al||"";if(e===Rg){const n={simplified:!0,setFormat:X$(t),bestOf:1};if(n.setFormat)return n}if(e===Al)return kj(t)}}function kj(t){const e=t.split("-"),r=gc(e[0].slice(3)),n=e&&Lg(e[1]),o=e&&Lg(e[2]),i=r&&r<6,s=!e[2]||o,a=n,c={bestOf:r,setFormat:n};if(o&&(c.finalSetFormat=o),i&&a&&s)return c}function Lg(t){if((t==null?void 0:t[1])===":"){const e=t.split(":"),r=Fj[e[0]],n=e[1];if(r&&n){if(n.indexOf("TB")===0){const g=Bg(n);return g===!1?!1:typeof g=="object"?{tiebreakSet:g}:void 0}if(n.indexOf("T")===0)return X$(n);const s=t.match(/^[FS]:(\d+)([A-Za-z]*)/),a=s&&eA(s[2])||!1,c=!(s!=null&&s[2])||a,l=s?gc(s[1]):void 0,u=Z$(n),d=u!==!1,p=d&&u||l,v=Bg(n.split("/")[1]),f=v!==!1,m={setTo:l};return a&&(m.NoAD=!0),v?(m.tiebreakFormat=v,m.tiebreakAt=p):m.noTiebreak=!0,l&&c&&f&&d&&m||!1}}}function Z$(t,e=!0){const r=(t==null?void 0:t.indexOf("@"))>0&&t.split("@");if(r)return(e?gc(r[1]):r[1])||!1}function Bg(t){if(t)if(t.startsWith("TB")){const e=Z$(t,!1),r=t.match(/^TB(\d+)([A-Za-z]*)/),n=r==null?void 0:r[1],o=r&&eA(r[2]),i=!(r!=null&&r[2])||o,s=gc(n);if(s&&i){const a={tiebreakTo:s};return e&&typeof e=="string"&&!lt(e)&&(a.modifier=e),o&&(a.NoAD=!0),a}else return!1}else return!1}function X$(t){var e;const r=t.slice(1),n=r.match(/^(\d+)(@?[A-Za-z]*)/),o=gc(n==null?void 0:n[1]);if(!o)return;const i={timed:!0,minutes:o},s=n==null?void 0:n[2],a=[void 0,"P","G"].includes(s);if(s&&!a){const c=(e=r.match(/^(\d+)(@)([A-Za-z]+)$/))==null?void 0:e[3];return c?(i.modifier=c,i):void 0}return s&&(i.based=n[2]),i}function eA(t){return t&&t.indexOf(kf)>=0}function gc(t){return isNaN(Number(t))?0:Number(t)}function Br(t){if(typeof t!="string")return!1;const e=Ir(t),r=t.match(/-S:(\d+)+\/TB(\d+)@?(\d*)*/),n=r==null?void 0:r[1],o=r==null?void 0:r[2],i=r==null?void 0:r[3],s=t.match(/-F:(\d+)+\/TB(\d+)@?(\d*)*/),a=s==null?void 0:s[1],c=s==null?void 0:s[2],l=s==null?void 0:s[3];return Wf(e,r&&o&&n===i||s&&c&&a===l)===t}const Wj={isValidMatchUpFormat:Br,stringify:Wf,isValid:Br,parse:Ir};function oo(){return"1.4.1"}function Eo(t){if(!t)return;const{tieFormatId:e,tieFormats:r}=t;if(t.tieFormat)return t.tieFormat;if(e&&Array.isArray(r))return r.find(n=>n.tieFormatId===e)}function Va({item:t,drawDefinition:e,structure:r,event:n}){var o,i,s;if(t){if(t.tieFormat)return t.tieFormat;if(t.tieFormatId){if(e.tieFormat)return e.tieFormat;const a=(o=e.tieFormats)==null?void 0:o.find(c=>t.tieFormatId===c.tieFormatId);return a||(n.tieFormat?n.tieFormat:(i=n.tieFormats)==null?void 0:i.find(c=>t.tieFormatId===c.tieFormatId))}if(r.tieFormat)return r.tieFormat;if(r.tieFormatId){const a=(s=e.tieFormats)==null?void 0:s.find(c=>r.tieFormatId===c.tieFormatId);if(a)return a}}}function Zt({drawDefinition:t,structure:e,matchUp:r,event:n}){return{tieFormat:Va({item:r,drawDefinition:t,structure:e,event:n})||Va({item:e,drawDefinition:t,structure:e,event:n})||Eo(t)||Eo(n)}}function Ve(t){return t.filter((e,r,n)=>n.lastIndexOf(e)===r)}function tr(t){return t.map(e=>[Math.random(),e]).sort((e,r)=>e[0]-r[0]).map(e=>e[1])}function fr(t){return t.reduce((e,r)=>(e[r]||(e[r]=0),e[r]++,e),{})}function qj(t){return Hj(fr(t))}function Hj(t){return Object.keys(t).reduce((e,r)=>{const n=t[r];return e[n]?e[n].push(r):e[n]=[r],e},{})}function Yj(t,e,r){return r.indexOf(t)===e}function tA(t){return t.filter(Yj)}function rr(t){return Array.isArray(t)&&t.length?t.splice(Math.floor(Math.random()*t.length),1)[0]:void 0}function pr(t){const e=Math.floor(Math.random()*t.length);return t[e]}function le(t,e){return Array.from({length:e-t},(r,n)=>n+t)}function Pn(t,e){return e.reduce((r,n,o)=>(n===t&&r.push(o),r),[])}function Dt(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(r=>e.indexOf(r)!==-1).filter((r,n,o)=>o.indexOf(r)===n)}function xg(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(r=>!e.includes(r))}function Gt(t,e){return!Array.isArray(t)||!Array.isArray(e)?!1:t.some(r=>e.includes(r))}function jt(t,e){return t.reduce((r,n,o)=>{const i=Math.floor(o/e);return r[i]=[].concat(r[i]||[],n),r},[])}function Kj(t){return t.reduce((e,r)=>{const n=e[e.length-1];return(!n||n[n.length-1]!==r-1)&&e.push([]),e[e.length-1].push(r),e},[])}function zj(t){return t.reduce((e,r)=>!isNaN(parseInt(r))&&e,!0)}function Qj(t){return t.reduce((e,r)=>isNaN(parseInt(r))&&e,!0)}function Gg(t,e,r){return t.reduce((n,o,i)=>{const s=r?!!(Math.floor(i/e)%2):!1,a=i%e,c=s?e-1-a:a;return n[c]||(n[c]=[]),n[c].push(o),n},[])}const B={success:!0},kg={message:"Chronological error; time violation.",code:"ANACHRONISM"},Jj={message:"Cannot remove main structure",code:"ERR_CANNOT_REMOVE_MAIN_STRUCTURE"},Wg={message:"records must be an object with tournamentId keys",code:"ERR_INVALID_TOURNAMENTS"},Fe={message:"Missing tournamentRecords",code:"ERR_MISSING_TOURNAMENTS"},ee={message:"Missing tournamentRecord",code:"ERR_MISSING_TOURNAMENT"},Lu={message:"Invalid tournamentRecord",code:"ERR_INVALID_TOURNAMENT"},so={message:"Missing tournamentId",code:"ERR_MISSING_TOURNAMENT_ID"},Bi={message:"Invalid drawDefinition",code:"ERR_INVALID_DRAWDEF"},pe={message:"Missing drawDefinition",code:"ERR_MISSING_DRAWDEF"},Zj={message:"Existing drawDefinition(s)",code:"ERR_EXISTING_DRAWDEFS"},Cn={message:"drawDefinition not found",code:"ERR_NOT_FOUND_DRAWDEF"},Hi={message:"Invalid structure",code:"ERR_INVALID_STRUCTURE"},rA={message:"Incomplete source structure",code:"ERR_INCOMPLETE_STRUCTURE"},nA={message:"Invalid drawPosition for seedAssignment",code:"ERR_INVALID_SEEDING_POSITION"},Ha={message:"drawPosition already assigned",code:"ERR_EXISTING_POSITION_ASSIGNMENT"},Xj={message:"Schedule not cleared",code:"ERR_UNCHANGED_SCHEDULE_NOT_CLEARED"},eR={message:"drawPosition not cleared",code:"ERR_FAILURE_POSITION_NOT_CLEARED"},oA={message:"Unrecognized drawType",code:"ERR_UNRECOGNIZED_DRAW_TYPE"},Kf={message:"Missing drawPositions",code:"ERR_MISSING_DRAW_POSITIONS"},zf={message:"drawPosition is active",code:"ERR_ACTIVE_DRAW_POSITION"},sa={message:"Invlid drawPosition",code:"ERR_INVALID_DRAW_POSITION"},hc={message:"Missing drawPosition",code:"ERR_MISSING_DRAW_POSITION"},iA={message:"Invalid drawType",code:"ERR_INVALID_DRAW_TYPE"},af={message:"Invalid drawSize",code:"ERR_INVALID_DRAW_SIZE"},Ll={message:"Cannot set drawSize to be less than existing entries",code:"ERR_INVALID_DRAW_SIZE_MISMATCH"},Bu={message:"Missing drawSize",code:"ERR_MISSING_DRAW_SIZE"},Mr={message:"Missing drawId",code:"ERR_MISSING_DRAW_ID"},tR={message:"drawId exists",code:"ERR_EXISTING_DRAW_ID"},rR={message:"participantId cannot be assigned to multiple seedNumbers",code:"INVALID_PARTICIPANT_SEEDING"},nR={message:"seedsCount greater than drawSize",code:"ERR_INVALID_SEED_COUNT"},oR={message:"Missing seedCountThresholds",code:"ERR_MISSING_SEED_COUNT_THRESHOLD"},iR={message:"Invalid action",code:"ERR_INVALID_ACTION"},qg={message:"Invalid assignment",code:"ERR_INVALID_ASSIGNMENT"},sR={message:"Missing seedAssignments",code:"ERR_MISSING_SEED_ASSIGNMENTS"},aR={message:"Invalid seedNumber",code:"ERR_INVALID_SEED_NUMBER"},cR={message:"Invalid seedPosition",code:"ERR_INVALID_SEED_POSITION"},sA={message:"Missing targetLink",code:"ERR_MISSING_LINK_TARGET"},lR={message:"Existing round",code:"ERR_EXISTING_ROUND"},ur={message:"Missing structureId",code:"ERR_MISSING_STRUCTURE_ID"},xr={message:"structure not found",code:"ERR_NOT_FOUND_STRUCTURE"},uR={message:"Missing structures",code:"ERR_MISSING_STRUCTURES"},aa={message:"Missing structure",code:"ERR_MISSING_STRUCTURE"},dR={message:"drawDefinition contains unlinked structures",code:"ERR_MISSING_STRUCTURE_LINKS"},ni={message:"Invalid eventType",code:"ERR_INVALID_EVENT_TYPE"},Re={message:"Missing event / eventId",code:"ERR_MISSING_EVENT_ID"},Pr={message:"Event not found",code:"ERR_NOT_FOUND_EVENT"},pR={message:"Event exists",code:"ERR_EXISTING_EVENT"},fR={message:"Missing entries",code:"ERR_MISSING_ENTRIES"},vR={message:"Invalid entries",code:"ERR_INVALID_ENTRIES"},aA={message:"Missing assignments",code:"ERR_MISSING_ASSIGNMENTS"},cA={message:"Missing stage",code:"ERR_MISSING_STAGE"},Go={message:"Invalid stage",code:"ERR_INVALID_STAGE"},mR={message:"Missing positionAssignments",code:"ERR_MISSING_POSITION_ASSIGNMENTS"},gR={message:"Cannot Assign BYE status if no assignment: { bye: true }",code:"ERR_UNCHANGED_CANNOT_ASSIGN_BYE"},Hg={message:"Unrecognized matchUpStatus",code:"ERR_UNRECOGNIZED_MATCHUP_STATUS"},xu={message:"Unrecognized matchUpFormat",code:"ERR_UNRECOGNIZED_MATCHUP_FORMAT"},np={message:"Incompatible matchUpStatus",code:"ERR_INCOMPATIBLE_MATCHUP_STATUS"},Ya={message:"Invalid matchUpStatus",code:"ERR_INVALID_MATCHUP_STATUS"},Xo={message:"Invalid tieFormat",code:"ERR_INVALID_TIE_FORMAT"},lA={message:"Invalid matchUpFormat",code:"ERR_INVALID_MATCHUP_FORMAT"},Qf={message:"Missing matchUpFormat",code:"ERR_MISSING_MATCHUP_FORMAT"},hR={message:"Missing collectionDefinition",code:"ERR_MISSING_COLLECTION_DEFINITION"},Gu={message:"Missing tieFormat",code:"ERR_MISSING_TIE_FORMAT"},Ut={message:"Missing matchUpId",code:"ERR_MISSING_MATCHUP_ID"},_c={message:"Missing matchUpIds",code:"ERR_MISSING_MATCHUP_IDS"},kr={message:"matchUp not found",code:"ERR_NOT_FOUND_MATCHUP"},ko={message:"Missing matchUps",code:"ERR_MISSING_MATCHUPS"},wr={message:"Missing matchUp",code:"ERR_MISSING_MATCHUP"},Gr={message:"Invalid matchUp",code:"ERR_INVALID_MATCHUP"},uA={message:"Missing policyType",code:"ERR_MISSING_POLICY_TYPE"},ku={message:"Missing policyDefinitions",code:"ERR_MISSING_POLICY_DEFINITIONS"},_R={message:"Missing avoidance policy",code:"ERR_MISSING_POLICY_AVOIDANCE"},dA={message:"Missing policy attributes",code:"ERR_MISSING_POLICY_ATTRIBUTES"},IR={message:"Invalid policyDefinitions",code:"ERR_INVALID_POLICY_DEFINITIONS"},pA={message:"existing policyType",code:"ERR_EXISTING_POLICY_TYPE"},PR={message:"Policy not attached",code:"ERR_FAILURE_POLICY_NOT_ATTACHED"},Jf={message:"Policy not found",code:"ERR_NOT_FOUND_POLICY"},yR={message:"Missing scoring policy / matchUpFormats",code:"ERR_MISSING_POLICY_SCORING_MATCHUP_FORMATS"},fA={message:"Invalid sideNumber",code:"ERR_INVALID_SIDE_NUMBER"},Zf={message:"Missing setObject",code:"ERR_MISSING_SET_ATTRIBUTE"},ca={message:"Missing courtId",code:"ERR_MISSING_COURT_ID"},Se={message:"Missing value",code:"ERR_MISSING_VALUE"},vA={message:"Missing date",code:"ERR_MISSING_DATE"},OR={message:"No valid dates",code:"ERR_NO_VALID_DATES"},cf={message:"Invalid bookings",code:"ERR_INVALID_BOOKINGS"},op={message:"Invalid dateAvailability",code:"ERR_INVALID_DATE_AVAILABILITY"},SR={message:"Missing dateAvailability",code:"ERR_MISSING_DATE_AVAILABILITY"},ar={message:"Invalid Date",code:"ERR_INVALID_DATE"},Rr={message:"Invalid time",code:"ERR_INVALID_TIME"},bR={message:"Invalid tournament dates",code:"ERR_INVALID_DATES_TOURNAMENT"},Yg={message:"Invalid game scores",code:"ERR_INVALID_SCORES_GAME"},TR={message:"Invalid score",code:"ERR_INVALID_SCORE"},mA={message:"Invalid winningSide",code:"ERR_INVALID_WINNING_SIDE"},ER={message:"No participants generated",code:"ERR_NO_PARTICIPANTS_GENERATED"},gA={message:"Cannot modify tieFormat",code:"ERR_UNCHANGED_CANNOT_MODIFY_TIEFORMAT"},wR={message:"Cannot modify participantType",code:"ERR_UNCHANGED_CANNOT_MODIFY_PARTICIPANT_TYPE"},Xf={message:"Cannot remove participants",code:"ERR_UNCHANGED_CANNOT_REMOVE_PARTICIPANTS"},hA={message:"Cannot change winningSide",code:"ERR_UNCHANGED_CANNOT_CHANGE_WINNING_SIDE"},ev={message:"Invalid participant",code:"ERR_INVALID_PARTICIPANT"},ao={message:"Invalid participantId",code:"ERR_INVALID_PARTICIPANT_ID"},Jr={message:"Invalid participantIds",code:"ERR_INVALID_PARTICIPANT_IDS"},NR={message:"Invalid participantRole",code:"ERR_INVALID_PARTICIPANT_ROLE"},bn={message:"Invalid participantType",code:"ERR_INVALID_PARTICIPANT_TYPE"},$R={message:"Missing participantRole",code:"ERR_MISSING_PARTICIPANT_ROLE"},Vs={message:"Missing participant",code:"ERR_MISSING_PARTICIPANT"},Ic={message:"Missing participants",code:"ERR_MISSING_PARTICIPANTS"},It={message:"Missing participantId",code:"ERR_MISSING_PARTICIPANT_ID"},Tt={message:"Participant Not Found",code:"ERR_NOT_FOUND_PARTICIPANT"},AR={message:"participantId exists",code:"ERR_EXISTING_PARTICIPANT_ID"},UR={message:"No participant removed",code:"ERR_UNCHANGED_NO_PARTICIPANT_REMOVED"},co={message:"Missing participantIds",code:"ERR_MISSING_PARTICIPANT_IDS"},CR={message:"Missing participantCount",code:"ERR_MISSING_PARTICIPANT_COUNT"},MR={message:"Participant not checked in",code:"ERR_UNCHANGED_PARTICIPANT_NOT_CHECKED_IN"},_A={message:"Participant already checked in",code:"ERR_UNCHANGED_PARTICIPANT_CHECKED_IN"},DR={message:"Missing person details",code:"ERR_MISSING_PERSON_DETAILS"},la={message:"Existing participant drawPosition assignment",code:"ERR_EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT"},tv={message:"Existing participant",code:"ERR_EXISTING_PARTICIPANT"},IA={message:"participantCount exceeds drawSize",code:"ERR_INVALID_PARTICIPANT_COUNT"},lf={message:"Invalid entry status",code:"ERR_INVALID_ENTRY_STATUS"},PA={message:"Participant Entry Not Found",code:"ERR_NOT_FOUND_PARTICIPANT_ENTRY"},jR={message:"Participant not entered in stage",code:"ERR_UNCHANGED_PARTICIPANT_NOT_ENTERED"},RR={message:"Participant not found in stageSequence",code:"ERR_NOT_FOUND_PARTICIPANT_IN_STAGE"},FR={message:"entryStatus not allowed in stage",code:"ERR_INVALID_ENTRY_STATUS_IN_STAGE"},VR={message:"entryStatus not allowed for event",code:"ERR_INVALID_ENTRY_STATUS_IN_EVENT"},Kg={message:"No stage space available for entryStatus",code:"ERR_UNCHANGED_NO_AVAILABLE_STAGE_SPACE"},LR={message:"Insufficient drawPositions to accommodate qualifiers",code:"ERR_UNCHANGED_NO_DRAW_POSITIONS_FOR_QUALIFIERS"},yA={message:"Insufficient drawPositions to accommodate entries",code:"ERR_INSUFFICIENT_DRAW_POSITIONS"},BR={message:"Missing penaltyType",code:"ERR_MISSING_PENALTY_TYPE"},OA={message:"Missing penaltyId",code:"ERR_MISSING_PENALTY_ID"},Wu={message:"Penalty not found",code:"ERR_NOT_FOUND_PENALTY"},xR={message:"Missing courtsCount/courtNames",code:"ERR_MISSING_COURTS_INFO"},rv={message:"Court not found",code:"ERR_NOT_FOUND_COURT"},GR={message:"Court exists",code:"ERR_EXISTING_COURT"},kR={message:"Venue exists",code:"ERR_EXISTING_VENUE"},oi={message:"Venue not found",code:"ERR_NOT_FOUND_VENUE"},Wo={message:"Missing venueId",code:"ERR_MISSING_VENUE_ID"},WR={message:"Invalid endTime",code:"ERR_INVALID_END_TIME"},SA={message:"Existing endTime",code:"ERR_EXISTING_END_TIME"},qR={message:"Invalid stopTime",code:"ERR_INVALID_STOP_TIME"},HR={message:"Invalid startTime",code:"ERR_INVALID_START_TIME"},YR={message:"Invalid resumeTime",code:"ERR_INVALID_RESUME_TIME"},bA={message:"Invalid timeItem",code:"ERR_INVALID_TIME_ITEMS"},TA={message:"Missing timeItem",code:"ERR_MISSING_TIME_ITEM"},EA={message:"Missing timeItems",code:"ERR_MISSING_TIME_ITEMS"},qu={message:"Missing context",code:"ERR_MISSING_CONTEXT"},KR={message:"Missing schedule",code:"ERR_MISSING_SCHEDULE"},Hu={message:"Invalid scaleItem",code:"ERR_INVALID_SCALE_ITEM"},zR={message:"No scaleItem found",code:"ERR_NOT_FOUND_SCALE_ITEM"},QR={message:"Modifications failed",code:"ERR_FAILURE_MODIFICATIONS"},Pc={message:"No modifications applied",code:"ERR_UNCHANGED_NO_MODIFICATIONS_APPLIED"},JR={message:"Unable to assign court",code:"ERR_UNCHANGED_COURT_NOT_ASSIGNED"},nv={message:"No Candidates",code:"ERR_UNCHANGED_NO_CANDIDATES"},ZR={message:"Invalid configuration",code:"ERR_INVALID_CONFIG"},Xn={message:"Invalid object",code:"ERR_INVALID_OBJECT"},Z={message:"Invalid values",code:"ERR_INVALID_VALUES"},XR={message:"Duplicate value",code:"ERR_DUPLICATE_VALUE"},wA={message:"Team not found",code:"ERR_NOT_FOUND_TEAM"},eF={message:"No valid actions",code:"ERR_NO_VALID_ACTIONS"},ov={message:"No valid attributes",code:"ERR_NO_VALID_ATTRIBUTES"},NA={message:"Value unchanged",code:"ABORT_UNCHANGED"},Ht={message:"Not found",code:"ERR_NOT_FOUND"},$A={message:"Not implemented",code:"ERR_NOT_IMPLEMENTED"},tF={message:"Existing flight",code:"ERR_EXISTING_FLIGHT"},AA={message:"Existing flight profile",code:"ERR_EXISTING_FLIGHT_PROFILE"},rF={message:"Existing outcome",code:"ERR_EXISTING_OUTCOME"},nF={message:"Existing matchUpId",code:"ERR_EXISTING_MATCHUP_ID"},zg={message:"Existing stage",code:"ERR_EXISTING_STAGE"},oF={message:"Existing structure",code:"ERR_EXISTING_STRUCTURE"},UA={message:"Method not found",code:"ERR_NOT_FOUND_METHOD"},iF={message:"Scheduled matchUps",code:"ERR_SCHEDULED_MATCHUPS"};var sF=Object.defineProperty,Qg=Object.getOwnPropertySymbols,aF=Object.prototype.hasOwnProperty,cF=Object.prototype.propertyIsEnumerable,Jg=(t,e,r)=>e in t?sF(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,lF=(t,e)=>{for(var r in e||(e={}))aF.call(e,r)&&Jg(t,r,e[r]);if(Qg)for(var r of Qg(e))cF.call(e,r)&&Jg(t,r,e[r]);return t};const dt={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},modified:!1,notices:[]};var uF={addNotice:OF,callListener:wF,cycleMutationStatus:yF,deleteNotice:TF,deleteNotices:bF,disableNotifications:dF,enableNotifications:pF,getNotices:SF,getTopics:EF,getTournamentId:fF,getTournamentRecord:vF,getTournamentRecords:mF,removeTournamentRecord:IF,setSubscriptions:PF,setTournamentId:hF,setTournamentRecord:gF,setTournamentRecords:_F};function dF(){dt.disableNotifications=!0}function pF(){dt.disableNotifications=!1}function fF(){return dt.tournamentId}function vF(t){return dt.tournamentRecords[t]}function mF(){return dt.tournamentRecords}function gF(t){const e=t==null?void 0:t.tournamentId;return e?(dt.tournamentRecords[e]=t,{success:!0}):{error:Lu}}function hF(t){return dt.tournamentRecords[t]?(dt.tournamentId=t,{success:!0}):{error:ee}}function _F(t){dt.tournamentRecords=t;const e=Object.keys(t);e.length===1?dt.tournamentId=e[0]:e.length||(dt.tournamentId=void 0)}function IF(t){if(typeof t!="string")return{error:Z};if(!dt.tournamentRecords[t])return{error:Ht};delete dt.tournamentRecords[t];const e=Object.keys(dt.tournamentRecords);return e.length===1?dt.tournamentId=e[0]:e.length||(dt.tournamentId=void 0),{success:!0}}function PF({subscriptions:t={}}={}){return typeof t!="object"?{error:Z}:(Object.keys(t).forEach(e=>{dt.subscriptions[e]=t[e]}),lF({},B))}function yF(){const t=dt.modified;return dt.modified=!1,t}function OF({topic:t,payload:e,key:r}){dt.modified=!0,!(typeof t!="string"||typeof e!="object")&&(dt.disableNotifications||!dt.subscriptions[t]||(r&&(dt.notices=dt.notices.filter(n=>!(n.topic===t&&n.key===r))),dt.notices.push({topic:t,payload:e,key:r})))}function SF({topic:t}){const e=dt.notices.filter(r=>r.topic===t).map(r=>r.payload);return e.length&&e}function bF(){dt.notices=[]}function TF({topic:t,key:e}){dt.notices=dt.notices.filter(r=>(!t||r.topic===t)&&r.key!==e)}function EF(){return{topics:Object.keys(dt.subscriptions)}}function wF({topic:t,notices:e}){const r=dt.subscriptions[t];r&&typeof r=="function"&&r(e)}var NF=Object.defineProperty,Zg=Object.getOwnPropertySymbols,$F=Object.prototype.hasOwnProperty,AF=Object.prototype.propertyIsEnumerable,Xg=(t,e,r)=>e in t?NF(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,UF=(t,e)=>{for(var r in e||(e={}))$F.call(e,r)&&Xg(t,r,e[r]);if(Zg)for(var r of Zg(e))AF.call(e,r)&&Xg(t,r,e[r]);return t};const Fr={tournamentFactoryVersion:"0.0.0",timers:{default:{elapsedTime:0}},iterators:{makeDeepCopy:0},deepCopyAttributes:{stringify:[],ignore:[],toJSON:[]},deepCopy:!0};let yr=uF;function Ct(t){return!t||typeof t!="object"?Fr.devContext||!1:typeof Fr.devContext!="object"?!1:Object.keys(t).every(e=>{var r;return((r=Fr.devContext)==null?void 0:r[e])===t[e]})&&Fr.devContext}function Ls(t){Fr.devContext=t}function CF(t){Fr.iterators.makeDeepCopy=t}function MF(){return Fr.iterators.makeDeepCopy}function DF(){yr.disableNotifications()}function ip(){yr.enableNotifications()}function Yi(t,e){typeof t=="boolean"&&(Fr.deepCopy=t),typeof e=="object"&&(Array.isArray(e.ignore)&&(Fr.deepCopyAttributes.ignore=e.ignore),Array.isArray(e.toJSON)&&(Fr.deepCopyAttributes.toJSON=e.toJSON),Array.isArray(e.stringify)&&(Fr.deepCopyAttributes.stringify=e.stringify),e.threshold&&(Fr.deepCopyAttributes.threshold=e.threshold))}function CA(){return UF({enabled:Fr.deepCopy},Fr.deepCopyAttributes)}function Ka(){return yr.cycleMutationStatus()}function Le(t){return yr.addNotice(t)}function jF(t){return yr.getNotices(t)}function MA({key:t,topic:e}){return yr.deleteNotice({key:t,topic:e})}function ii(){return yr.deleteNotices()}function Mn(){return yr.getTopics()}async function eh(t){return yr.callListener(t)}function vn(){return yr.getTournamentId()}function za(t){return yr.getTournamentRecord(t)}function Bl(){return yr.getTournamentRecords()}function DA(t){return yr.setTournamentRecord(t)}function yc(t){return yr.setTournamentRecords(t)}function Qa(t){return yr.setTournamentId(t)}function iv(t){return yr.removeTournamentRecord(t)}function Ki(t){return typeof t=="object"}const RF=t=>e=>Object.keys(t).every(r=>e[r]===t[r]),FF=t=>e=>!t||typeof e!="object"?void 0:Array.isArray(t)&&t.map(r=>({[r]:e[r]}))||typeof t=="object"&&Object.keys(t).map(r=>({[r]:e[r]}))||typeof t=="string"&&VF(e,t);function VF(t,e){const r=e.split(".");for(const n of r)if(t=t==null?void 0:t[n],!t)return;return t}function _e(t,e,r,n){if(typeof t!="object"||t===null)return t;const o=CA();o!=null&&o.enabled||(n=!0);const i=["",void 0,null];e&&i.push(!1);const s=Object.keys(t).filter(a=>!i.includes(t[a])&&(!r||(Array.isArray(t[a])?t[a].length:!0)));return Object.assign({},...s.map(a=>Array.isArray(t[a])?{[a]:n?t[a]:t[a].map(c=>_e(c))}:{[a]:n?t[a]:_e(t[a])}))}function uf(t){return Array.isArray(t)?t.length+t.map(uf).reduce((e,r)=>e+r,0):typeof t=="object"&&t!==null?Object.keys(t).length+Object.keys(t).map(e=>uf(t[e])).reduce((e,r)=>e+r,0):0}function LF(t){if(t===null||typeof t!="object")return;const e=JSON.stringify(t),r=uf(t),n=e.split("").reduce((o,i)=>o+i.charCodeAt(0),0);return[e.length,r,n].map(o=>o.toString(36)).join("")}function Yu(t){if(t===null)return{};const{source:e,template:r}=t||{};if(!r)return e;const n={};return o(e,r,n),n;function o(i,s,a){if(!i||!s)return;const c=Object.keys(i),l=Object.keys(s),u=Object.assign({},...l.filter(v=>v.indexOf("||")).map(v=>v.split("||").map(f=>({[f]:v}))).flat()),d=l.concat(...Object.keys(u)),p=d.includes("*");for(let v=0;v<c.length;v++)if(d.indexOf(c[v])>=0||p){const f=u[c[v]]||c[v],m=s[f]||p,g=i[c[v]];if(typeof m=="object"&&typeof g!="function"&&!Array.isArray(m))if(Array.isArray(g)){const h=g.map(_=>{const I={};if(o(_,m,I)!==!1)return I}).filter(Boolean);a[c[v]]=h}else g&&(a[c[v]]={},o(g,m,a[c[v]]));else{const h=i[c[v]];if(Array.isArray(m)&&!m.includes(h))return!1;(s[c[v]]||p&&s[c[v]]!==!1)&&(a[c[v]]=h)}}}}function jA(t=0){const e=new Date;return e.setHours(e.getHours()+t),e.getTime().toString(36).slice(-6).toUpperCase()}const xl=/^[\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1])$/,RA=/^((0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)([.,][0-9]{3})?$/,Tn=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))([ T](0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/,ti=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))?([ T]?(0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/;function Gl(t){let{scheduledDate:e,scheduledTime:r}=t;if(!e&&r&&(e=Me(r)),!e)return;const n=tt(r);let o=Me(e);return o&&n&&(o+=`T${n}`),o}function BF(t){return typeof t!="object"||Array.isArray(t)?!1:Object.prototype.toString.call(t)==="[object Date]"}function ua(t){const e=typeof t=="string"&&(t==null?void 0:t.split(" "));return t&&(e==null?void 0:e.length)>1&&!["AM","PM"].includes(e[1].toUpperCase())?!1:!!(!t||ti.test(cs(t,!0,!0)))}function Nr(t){return si(t)||xl.test(t)}function xF(t){const e=new Date(t),r=e.getSeconds()+60*e.getMinutes()+60*60*e.getHours();return GF(r,{displaySeconds:!1})}function GF(t,e){const r=parseInt(t,10),n=Math.floor(r/3600),o=Math.floor((r-n*3600)/60),i=r-n*3600-o*60;return(!e||e&&e.displaySeconds?n+":"+o+":"+i:n+":"+o).split(":").map(Wn).join(":")}const sv=t=>{const e=Ja(t)||si(t)?new Date(t):new Date,r=e.getUTCMonth()+1,n=r<10?`0${r}`:`${r}`;return`${e.getUTCFullYear()}-${Wn(n)}-${Wn(e.getUTCDate())}`};function kF(t){const e=Ja(t)||si(t)?new Date(t):new Date;return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())}function yn(t,e="-",r="YMD"){if(!t)return"";typeof t=="string"&&t.indexOf("T")<0&&(t=t+"T00:00");const n=new Date(t);let o=""+(n.getMonth()+1),i=""+n.getDate();const s=n.getFullYear();return o.length<2&&(o="0"+o),i.length<2&&(i="0"+i),r==="DMY"?[i,o,s].join(e):r==="MDY"?[o,i,s].join(e):r==="YDM"?[s,i,o].join(e):r==="DYM"?[i,s,o].join(e):r==="MYD"?[o,s,i].join(e):[s,o,i].join(e)}function kl(t){const e=t?new Date(t):new Date,r=e.getTimezoneOffset();return new Date(e.getTime()-r*60*1e3)}function WF(t){return kl(t).getTime()}function Ja(t){if(typeof t=="boolean")return!1;const e=t instanceof Date&&t||!isNaN(t)&&new Date(t)||!1;return e&&!isNaN(e.valueOf())}function av(t,e){if(!Nr(t)||!Nr(e))return[];const r=Me(t)+"T00:00",n=Me(e)+"T00:00",o=new Date(r),i=new Date(n),s=!(Ja(i)&&Ja(o)&&l(o,i)),a=[];let c=0;if(!s){const u=o;for(;u<=i&&c<300;)c+=1,a.push(new Date(u)),u.setDate(u.getDate()+1)}return a.map(u=>yn(u));function l(u,d){return u<=d}}const qF=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function si(t){return typeof t!="string"?!1:qF.test(t)}function FA(t){if(typeof t!="string")return!1;const r=t.split("Z")[0].split(":"),n=r.every(o=>!isNaN(o));return!(r.length<2||!n||parseInt(r[0])>23||parseInt(r[1])>60)}function je(t){const e=tt(t);if(!e)return 0;const[r,n]=e.split(":").map(o=>parseInt(o));return r*60+n}function HF(t){let e=Math.floor(t/60);const r=t-e*60;return e>23&&(e=e%24),[Wn(e),Wn(r)].join(":")}function Wl(t){return FA(t)?t.split(":").slice(0,2).map(Wn).join(":"):void 0}function tt(t){return si(t)&&t.indexOf("T")>0?Wl(t.split("T").reverse()[0]):Wl(t)}function Me(t){return si(t)||Tn.test(t)?t.split("T")[0]:void 0}function YF(t,e){const r=new Date(t);return r.setDate(r.getDate()+e),Me(r.toISOString())}function ql(t){t=typeof t!="string"?"00:00":t;const e={},r={};return{0:e.time,1:e.ampm}=t.split(" ")||[],{0:r.hours,1:r.minutes}=e.time.split(":")||[],r.ampm=e.ampm,isNaN(r.hours)||isNaN(r.minutes)||r.ampm&&!["AM","PM"].includes(r.ampm.toUpperCase())?{}:r}function KF(t){const e=ql(t);return e.ampm&&e.hours&&(e.ampm.toLowerCase()==="pm"&&parseInt(e.hours)<12&&(e.hours=(e.hours&&parseInt(e.hours)||0)+12),e.ampm.toLowerCase()==="am"&&e.hours==="12"&&(e.hours="00")),`${e.hours||"12"}:${e.minutes||"00"}`.split(":").map(Wn).join(":")}function zF(t){var e;const r=ql(t);if(!(typeof r=="object"&&!Object.keys(r).length))return r.ampm?t:(r.hours>12?(r.hours-=12,r.ampm="PM"):r.hours==="12"?r.ampm="PM":(r.hours==="00"&&(r.hours="12"),r.ampm="AM"),((e=r.hours)==null?void 0:e[0])==="0"&&(r.hours=r.hours.slice(1)),`${r.hours||"12"}:${r.minutes||"00"} ${r.ampm}`)}function cs(t,e,r){const n=Me(t),o=tt(t),i=n?o:t;return t?e&&(n&&r&&t||KF(i))||zF(i):void 0}function VA(t,e){const r=ql(t),n=ql(e);if(parseInt(r.hours)<parseInt(n.hours))return-1;if(parseInt(r.hours)>parseInt(n.hours))return 1;if(r.hours===n.hours){if(parseInt(r.minutes)<parseInt(n.minutes))return-1;if(parseInt(r.minutes)>parseInt(n.minutes))return 1}return 0}function QF(t,e,r,n=!1){let o=new Date(e,0,1+(t-1)*7);const i=n?0:1;return o.setDate(o.getDate()+(i-o.getDay())),yn(o,r)}function JF(t,e,r){const n=new Date(t,0);return yn(new Date(n.setDate(e)),r)}function mt(t,e=void 0){const[r,n]=(t||"00:00").split(":").map(Wn),o=kl(e).setHours(r,n,0,0);return kl(o)}function Oc(t,e,r=!0){const n=new Date(t),i=(new Date(e).getTime()-n.getTime())/1e3/60;return r?Math.abs(Math.round(i)):Math.round(i)}function sr(t,e){const r=tt(t);if(!r)return"00:00";const n=isNaN(e)?0:e;return tt(cv(mt(r),n).toISOString())}function cv(t,e){const r=new Date(t);return new Date(r.getTime()+e*6e4)}function Wn(t){return t.toString()[1]?t:"0"+t}function qn(t,e){const r=new Date(t),n=new Date(e);return r.getFullYear()===n.getFullYear()&&r.getMonth()===n.getMonth()&&r.getDate()===n.getDate()}const ZF={addMinutesToTimeString:sr,convertTime:cs,getIsoDateString:Gl,getUTCdateString:sv,DateHHMM:xF,extractDate:Me,extractTime:tt,formatDate:yn,getDateByWeek:QF,isISODateString:si,isDate:Ja,isTimeString:FA,offsetDate:kl,offsetTime:WF,sameDay:qn,timeStringMinutes:je,timeToDate:mt,timeUTC:kF,validTimeValue:ua,validDateString:xl,timeValidation:ti,dateValidation:Tn};function de(t,e,r,n,o=0){const i=CA(),{stringify:s,toJSON:a,ignore:c,modulate:l}=i||{};if(!(i!=null&&i.enabled)&&!r||typeof t!="object"||typeof t=="function"||t===null||typeof(i==null?void 0:i.threshold)=="number"&&o>=i.threshold)return t;const u=Ct({makeDeepCopy:!0});u&&(CF(o),typeof u=="object"&&(o>(u.iterationThreshold||15)||u.firstIteration&&o===0)&&u.log&&(!u.notInternalUse||u.notInternalUse&&!r)&&console.log({devContext:u,iteration:o,internalUse:r},t));const d=Array.isArray(t)?[]:{},p=Object.keys(t).filter(f=>!r||!c||Array.isArray(c)&&!c.includes(f)||typeof c=="function"&&!c(f)),v=(f,m)=>{d[f]=typeof(m==null?void 0:m.toString)=="function"?m.toString():JSON.stringify(m)};for(const f of p){const m=t[f],g=typeof l=="function"?l(m):void 0;if(g!==void 0)d[f]=g;else if(e&&f==="extensions"&&Array.isArray(m)){const h=LA(m);Object.assign(d,...h)}else n&&f==="extensions"?d[f]=[]:Array.isArray(s)&&s.includes(f)?v(f,m):Array.isArray(a)&&a.includes(f)&&typeof(m==null?void 0:m.toJSON)=="function"?d[f]=m.toJSON():m===null?d[f]=void 0:BF(m)?d[f]=new Date(m).toISOString():d[f]=de(m,e,r,n,o+1)}return d}function LA(t){return t==null?void 0:t.map(e=>{const{name:r,value:n}=e;return r&&n&&{[`_${r}`]:n}}).filter(Boolean)}function Bt(t,e){return t-e}function XF(t,e){if(e&&typeof e!="object")return Z;let{columnTransform:r={}}=e||{};const{includeTransformAccessors:n,includeHeaderRow:o=!0,returnTransformedJSON:i,removeEmptyColumns:s,onlyHeaderRow:a,columnAccessors:c=[],functionMap:l={},columnMap:u={},valuesMap:d={},context:p={},delimiter:v='"',columnJoiner:f=",",rowJoiner:m=`\r
`,keyJoiner:g="."}=e||{};if(!Array.isArray(t)||!Array.isArray(c)||typeof p!="object"||typeof u!="object"||typeof r!="object"||typeof l!="object"||typeof d!="object"||typeof f!="string"||typeof m!="string"||typeof g!="string"||typeof v!="string")return Z;r=Object.assign({},...Object.keys(r).reverse().map(U=>({[U]:Array.isArray(r[U])?r[U]:[typeof r[U]=="string"&&r[U]].filter(Boolean)})));const h=t.filter(Boolean).map(U=>lv(U,g)),_=Object.values(r).flat();n&&c.push(..._);const I=h.reduce((U,A)=>Object.keys(A).every(C=>!U.includes(C)&&U.push(C)||!0)&&U,[]).filter(U=>!(c!=null&&c.length)||c.includes(U)),P=Object.assign({},...Object.keys(r).reverse().map(U=>r[U].map(A=>({[A]:U})).flat()).flat()),S=(U,A)=>e!=null&&e.sortOrder?e.sortOrder.includes(U)&&e.sortOrder.includes(A)&&e.sortOrder.indexOf(U)-e.sortOrder.indexOf(A)||!e.sortOrder.includes(A)&&-1:0,y=I.reduce((U,A)=>{const C=P[A];return C?U.includes(C)||U.push(C):U.push(A),U},[]).sort(S);Object.keys(u).forEach(U=>!y.includes(U)&&y.unshift(U)),Object.keys(r).forEach(U=>!y.includes(U)&&y.unshift(U)),typeof p=="object"&&Object.keys(p).forEach(U=>!y.includes(U)&&y.unshift(U));let O=y.map(U=>u[U]||U);if(a)return[O];const b=U=>`${v}${U}${v}`,E=[],T=U=>Object.values(y.reduce((A,C,M)=>{var D;const V=r[C],R=(V!=null&&V.length?U[V.find(K=>U[K])]:U[C])||(p==null?void 0:p[C])||"",W=((D=d[C])==null?void 0:D[R])||R,x=typeof l[C]=="function"?l[C](W):W;return A[C]=b(x),x&&(E[M]=(E[M]||0)+1),A},{}));let N=h.map(T);const w=s&&[...E].map((U,A)=>!U&&A).filter(Pt).reverse();if(w){const U=A=>A.filter((C,M)=>!w.includes(M));N=N.map(U),O=U(O)}const $=N.map(U=>U.join(f));return i?$.map(U=>{const A=U.split(f);return Object.assign({},...A.map((C,M)=>({[O[M]]:C})))}):o?[O.map(b).join(f),...$].join(m):$.join(m)}function lv(t,e,r=[]){return typeof t=="object"&&Object.keys(t).reduce((n,o)=>typeof t[o]!="object"?(n[r.concat(o).join(e)]=t[o],n):Object.assign(n,lv(t[o],e,r.concat(o))),{})}function eV(t=1){return le(0,t).map(ke)}function ke(){const t=[];for(let i=0;i<256;i++)t[i]=(i<16?"0":"")+i.toString(16);const e=Math.random()*4294967295|0,r=Math.random()*4294967295|0,n=Math.random()*4294967295|0,o=Math.random()*4294967295|0;return t[e&255]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[r&255]+t[r>>8&255]+"-"+t[r>>16&15|64]+t[r>>24&255]+"-"+t[n&63|128]+t[n>>8&255]+"-"+t[n>>16&255]+t[n>>24&255]+t[o&255]+t[o>>8&255]+t[o>>16&255]+t[o>>24&255]}var tV=Object.defineProperty,th=Object.getOwnPropertySymbols,rV=Object.prototype.hasOwnProperty,nV=Object.prototype.propertyIsEnumerable,rh=(t,e,r)=>e in t?tV(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,oV=(t,e)=>{for(var r in e||(e={}))rV.call(e,r)&&rh(t,r,e[r]);if(th)for(var r of th(e))nV.call(e,r)&&rh(t,r,e[r]);return t};function k({context:t,result:e,stack:r,info:n}){return e&&!Array.isArray(e==null?void 0:e.stack)&&(e.stack=[]),e&&Array.isArray(e==null?void 0:e.stack)&&typeof r=="string"&&e.stack.push(r),n&&(e!=null&&e.error)&&(e.error.info=n),e&&typeof t=="object"&&Object.keys(t).length&&Object.assign(e,_e(t)),e&&!(e!=null&&e.error)&&!(e!=null&&e.success)&&Object.assign(e,oV({},B)),e??{success:!0}}function Yt(t){return`${t} must be an array`}const ri="SINGLES",ut="SINGLES",Kr="DOUBLES",ot="DOUBLES",Qr="TEAM",We="TEAM";var iV=Object.defineProperty,nh=Object.getOwnPropertySymbols,sV=Object.prototype.hasOwnProperty,aV=Object.prototype.propertyIsEnumerable,oh=(t,e,r)=>e in t?iV(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,cV=(t,e)=>{for(var r in e||(e={}))sV.call(e,r)&&oh(t,r,e[r]);if(nh)for(var r of nh(e))aV.call(e,r)&&oh(t,r,e[r]);return t};function cr({checkCollectionIds:t=!0,tieFormat:e}={}){var r,n,o,i;const s="validateTieFormat",a=[];if(typeof e!="object")return a.push("tieFormat must be an object"),k({result:{error:Xo,stack:s,context:{tieFormat:e,errors:a}}});if(typeof e.winCriteria!="object")return a.push("tieFormat.winCriteria must be an object"),k({result:{error:Xo,stack:s,context:{tieFormat:e,errors:a}}});if(!Array.isArray(e.collectionDefinitions))return a.push(Yt("tieFormat.collectionDefinitions")),k({result:{error:Xo,stack:s,context:{tieFormat:e,errors:a}}});let c;const l=e.collectionDefinitions.every(m=>{const{setValue:g,scoreValue:h,collectionValue:_}=m;(g||h)&&!_&&(c=!0);const{valid:I,errors:P}=BA({collectionDefinition:m,checkCollectionIds:t});return I?!0:(a.push(...P),!1)}),u=typeof((r=e.winCriteria)==null?void 0:r.valueGoal)=="number"&&((n=e.winCriteria)==null?void 0:n.valueGoal)>0&&!c||((o=e.winCriteria)==null?void 0:o.aggregateValue);if(!(u||(i=e.winCriteria)!=null&&i.aggregateValue))return c?a.push("aggregateValue is required"):a.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),k({result:{context:{tieFormat:e,errors:a,aggregateValueImperative:c},error:Xo,stack:s}});const d=e.collectionDefinitions.map(({collectionId:m})=>m),p=!t||d.length===Ve(d).length,v=l&&u&&p,f={valid:v,errors:a};return v?f:k({result:{context:{tieFormat:e,errors:a},error:Xo,stack:s}})}function BA({checkValueDefinition:t=!0,collectionDefinition:e,checkCollectionIds:r}){const n=[];if(typeof e!="object")return n.push(`collectionDefinition must be an object: ${e}`),{errors:n};const{collectionValueProfile:o,collectionGroupNumber:i,collectionValue:s,collectionId:a,matchUpCount:c,matchUpFormat:l,matchUpValue:u,matchUpType:d,scoreValue:p,setValue:v}=e;if(r&&typeof a!="string")return n.push(`collectionId is not type string: ${a}`),{errors:n};if(typeof c!="number")return n.push(`matchUpCount is not type number: ${c}`),{errors:n};if(![ut,ot].includes(d))return n.push(`matchUpType must be SINGLES or DOUBLES: ${d}`),{errors:n};if(t&&!u&&!s&&!o&&!p&&!v)return n.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfile"),{errors:n};if(u&&typeof u!="number")return n.push(`matchUpValue is not type number: ${u}`),{errors:n};if(s&&typeof s!="number")return n.push(`collectionValue is not type number: ${s}`),{errors:n};if(o){const f=xA({collectionValueProfile:o,matchUpCount:c});if(f.errors)return n.push(...f.errors),{errors:n}}return i&&typeof i!="number"?(n.push(`collectionValue is not type number: ${s}`),{errors:n}):l&&!Wj.isValid(l)?(n.push(`Invalid matchUpFormat: ${l}`),{errors:n}):{valid:!0}}function lV(t){const e=cr({tieFormat:t,checkCollectionIds:!1});if(e.error)return e;for(const r of t.collectionDefinitions)r.collectionId||(r.collectionId=ke());return{tieFormat:t}}function xA({collectionValueProfile:t,matchUpCount:e}){const r=[];if(!Array.isArray(t))return r.push(`collectionValueProfile is not an array: ${t}`),{errors:r};if(t.length!==e)return r.push("collectionValueProfile does not align with matchUpsCount"),{errors:r};for(const o of t){if(typeof o!="object")return r.push(`valueProfile is not type object: ${o}`),{errors:r};const{value:i,collectionPosition:s}=o;if(typeof i!="number"||typeof s!="number"||s>e||s<1)return r.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),{errors:r}}const n=t.map(o=>o.collectionPosition);return n.length!==Ve(n).length?(r.push("collectionPositions are not unique"),{errors:r}):cV({},B)}const gr="ABANDONED",da="AWAITING_RESULT",qe="BYE",_o="CANCELLED",_t="COMPLETED",pa="DEAD_RUBBER",Be="DEFAULTED",Ot="DOUBLE_DEFAULT",gt="DOUBLE_WALKOVER",dn="IN_PROGRESS",Hn="INCOMPLETE",uv="NOT_PLAYED",Xt="RETIRED",hi="SUSPENDED",pt="TO_BE_PLAYED",Ge="WALKOVER",uV=[da,_t,Be,gt,Ot,dn,Hn,Xt,hi,Ge],dV=[gr,da,qe,_o,_t,pa,Be,gt,Ot,dn,Hn,uv,Xt,hi,pt,Ge],pV=[qe,gt,Ot,_t,Be,Xt,Ge],fV=[gr,da,_o,pa,dn,Hn,uv,hi,pt,void 0],Rt=[_o,gr,_t,pa,Be,gt,Ot,Xt,Ge],GA=[gr,_t,Be,gt,Ot,dn,Xt,Ge],vV=[dn,Hn,hi,pt],mV={ABANDONED:gr,AWAITING_RESULT:da,BYE:qe,CANCELLED:_o,COMPLETED:_t,DEAD_RUBBER:pa,DEFAULTED:Be,DOUBLE_WALKOVER:gt,DOUBLE_DEFAULT:Ot,IN_PROGRESS:dn,INCOMPLETE:Hn,NOT_PLAYED:uv,RETIRED:Xt,SUSPENDED:hi,TO_BE_PLAYED:pt,WALKOVER:Ge};function Ds({matchUp:t}){return Rt.includes(t==null?void 0:t.matchUpStatus)||(t==null?void 0:t.winningSide)}const Ku="SET3-S:6/TB7",gV="SET3-S:6NOAD",hV="SET3-S:6/TB7-F:TB10",_V="SET3-S:4/TB7",IV="SET3-S:4/TB5@3",PV="SET1-S:T20",yV="SET1-S:8/TB7",OV="SET1-S:8/TB7@7",SV={FORMAT_STANDARD:Ku,FORMAT_STANDARD_NOAD:gV,FORMAT_ATP_DOUBLES:hV,FORMAT_SHORT_SETS:_V,FORMAT_FAST4:IV,FORMAT_PRO_SET:yV,FORMAT_COLLEGE_PRO_SET:OV,TIMED20:PV};function kA({winningSide:t,matchUpFormat:e=Ku,matchUpStatus:r,tallyPolicy:n,score:o}){const i=[0,0],{sets:s}=o||{},a=t-1,c=Ir(e),l=dv((c==null?void 0:c.bestOf)||1);if(r===Be&&(n!=null&&n.setsCreditForDefaults)||r===Ge&&(n!=null&&n.setsCreditForWalkovers))i[a]=l;else for(const u of s||[]){const{winningSide:d}=u;d&&(i[d-1]+=1)}return r===Xt&&(+i[1-a]===l&&(i[1-a]-=1),n!=null&&n.setsCreditForRetirements&&(i[a]=l)),i}function bV({winningSide:t,matchUpFormat:e=Ku,matchUpStatus:r,tallyPolicy:n,score:o}){var i,s;const{sets:a}=o||{};if(!a)return[0,0];const c=t-1,l=Ir(e),u=(l==null?void 0:l.bestOf)||1,d=dv(u),p=((i=l==null?void 0:l.setFormat)==null?void 0:i.tiebreakAt)||0,v=[[],[]];if(r===Be&&(n!=null&&n.gamesCreditForDefaults)||r===Ge&&(n!=null&&n.gamesCreditForWalkovers)){const f=((s=l==null?void 0:l.setFormat)==null?void 0:s.setTo)||0,m=d*f;v[c].push(m)}else a.forEach((f,m)=>{var g;const _=(f.setNumber||m+1)>d&&(l!=null&&l.finalSetFormat)?"finalSetFormat":"setFormat",I=(g=l==null?void 0:l[_])==null?void 0:g.based;if(ih(I)){const{side1Score:P,side2Score:S}=f;v[0].push(parseInt(P||0)),v[1].push(parseInt(S||0))}});if(r===Xt){const f=a.length>d&&(l!=null&&l.finalSetFormat)?"finalSetFormat":"setFormat",m=l==null?void 0:l[f];if(ih(m.based)){const g=(m==null?void 0:m.setTo)||0,h=P=>{if(!(!l||P===""))return+P===p-1||+P===p?parseInt(p||0)+1:+P<p?g:p},_=kA({winningSide:t,matchUpStatus:r,matchUpFormat:e,sets:a});if(v.map(P=>P[c]<=P[1-c]).reduce((P,S)=>P+S,0)>_[1-c]){const P=v[c].length,S=h(v[1-c][P-1]);S&&(v[c][P-1]=S)}d>v[c].length&&(n!=null&&n.gamesCreditForRetirements)&&v[c].push(g)}}return[v[0].reduce((f,m)=>f+m,0),v[1].reduce((f,m)=>f+m,0)]}function TV({matchUpFormat:t,score:e}){var r;const n=Ir(t),o=(n==null?void 0:n.bestOf)||1,i=dv(o),s=[0,0];return(r=e==null?void 0:e.sets)==null||r.forEach((a,c)=>{var l;const d=(a.setNumber||c+1)>i&&(n!=null&&n.finalSetFormat)?"finalSetFormat":"setFormat",p=(l=n==null?void 0:n[d])==null?void 0:l.based;if(WA(p)){const{side1Score:v,side2Score:f}=a;v&&(s[0]+=parseInt(v||0)),f&&(s[1]+=parseInt(f||0))}else a.side1TiebreakScore&&(s[0]+=parseInt(a.side1TiebreakScore||0)),a.side2TiebreakScore&&(s[1]+=parseInt(a.side2TiebreakScore||0))}),s}function dv(t){return t&&Math.ceil(t/2)||1}function WA(t){return t==="P"}function ih(t){return!WA(t)}function EV({participantResults:t,matchUpFormat:e,tallyPolicy:r,perPlayer:n,totalSets:o}){var i;const s=e&&Ir(e)||{},a=s.bestOf,c=a&&Math.ceil(a/2)||1,l=(i=s.setFormat)==null?void 0:i.setTo;Object.keys(t).forEach(u=>{const d=t[u].setsWon,p=t[u].setsLost,v=r!=null&&r.groupTotalSetsPlayed?o:n*(c||0)||d+p;let f=Math.round(d/v*1e3)/1e3;(f===1/0||isNaN(f))&&(f=v);const m=t[u].tieMatchUpsWon,g=t[u].tieMatchUpsLost,h=m+g;let _=Math.round(m/h*1e3)/1e3;(_===1/0||isNaN(_))&&(_=m);const I=t[u].matchUpsWon,P=t[u].matchUpsLost,S=I+P;let y=Math.round(I/S*1e3)/1e3;(y===1/0||isNaN(y))&&(y=I);const O=t[u].gamesWon||0,b=t[u].gamesLost||0,E=(n||0)*(c||0)*(l||0),T=Math.max(E,O+b);let N=Math.round(O/T*1e3)/1e3;(N===1/0||isNaN(N))&&(N=0);let w=Math.round(t[u].pointsWon/t[u].pointsLost*1e3)/1e3;(w===1/0||isNaN(w))&&(w=0),t[u].setsWon=d,t[u].setsLost=p,t[u].setsPct=f,t[u].tieMatchUpsWon=m,t[u].tieMatchUpsPct=_,t[u].matchUpsPct=y,t[u].gamesWon=O,t[u].gamesLost=b,t[u].gamesPct=N,t[u].pointsPct=w,t[u].result=`${t[u].matchUpsWon}/${t[u].matchUpsLost}`})}function qA({participantIds:t,matchUpFormat:e,tallyPolicy:r,perPlayer:n,matchUps:o}){var i,s,a,c;const l={},u=(r==null?void 0:r.excludeMatchUpStatuses)||[],d=o.filter(f=>(f.tieMatchUps||!u.includes(f.matchUpStatus))&&(!(t!=null&&t.length)||Dt(t,[Cs(f,0),Cs(f,1)]).length===2)),v=d.flatMap(({score:f,tieMatchUps:m})=>{var g;return m?m.filter(({matchUpStatus:h})=>!u.includes(h)).flatMap(({score:h})=>{var _;return((_=h==null?void 0:h.sets)==null?void 0:_.length)||0}):((g=f==null?void 0:f.sets)==null?void 0:g.length)||0}).reduce((f,m)=>f+m,0);for(const f of d){const{matchUpStatus:m,tieMatchUps:g,tieFormat:h,score:_,winningSide:I,sides:P}=f,S=h&&f._disableAutoCalc&&h.collectionDefinitions.every(({scoreValue:b})=>b),y=I&&wV(f),O=I&&NV(f);if(!y||!O)if(Rt.includes(m)){const b=Cs(f,0),E=Cs(f,1);b&&(To(l,b),l[b].matchUpsCancelled+=1),E&&(To(l,E),l[E].matchUpsCancelled+=1)}else if(g!=null&&g.length){n=0;for(const b of g){if(b.winningSide){const E=(i=P.find(({sideNumber:N})=>N===b.winningSide))==null?void 0:i.participantId,T=(s=P.find(({sideNumber:N})=>N===b.winningSide))==null?void 0:s.participantId;E&&T&&(To(l,E),To(l,T),l[E].tieMatchUpsWon+=1,l[T].tieMatchUpsLost+=1,b.matchUpType===ut?(l[E].tieSinglesWon+=1,l[T].tieSinglesLost+=1):b.matchUpType===ot&&(l[E].tieDoublesWon+=1,l[T].tieDoublesLost+=1))}sh({score:b.score,manualGamesOverride:S,participantResults:l,sides:P})}}else sh({manualGamesOverride:S,participantResults:l,score:_,sides:P});else if(To(l,y),To(l,O),g!=null&&g.length){n=0;for(const b of g){const{matchUpType:E}=b,T=E===ot,N=E===ut;b.winningSide&&(b.winningSide===I?(y&&(l[y].tieMatchUpsWon+=1,N&&(l[y].tieSinglesWon+=1),T&&(l[y].tieDoublesWon+=1)),O&&(l[O].tieMatchUpsLost+=1,N&&(l[O].tieSinglesLost+=1),T&&(l[O].tieDoublesLost+=1))):b.winningSide!==I&&(O&&(l[O].tieMatchUpsWon+=1,N&&(l[O].tieSinglesWon+=1),T&&(l[O].tieDoublesWon+=1)),y&&(l[y].tieMatchUpsLost+=1,N&&(l[y].tieSinglesLost+=1),T&&(l[y].tieDoublesLost+=1)))),ah({matchUpFormat:b.matchUpFormat,matchUpStatus:b.matchUpStatus,score:b.score,winningParticipantId:y,losingParticipantId:O,participantResults:l,isTieMatchUp:!0,manualGamesOverride:S,tallyPolicy:r,winningSide:I})}HA({winningParticipantId:y,losingParticipantId:O,participantResults:l,matchUpStatus:m})}else ah({matchUpFormat:f.matchUpFormat||e,winningParticipantId:y,losingParticipantId:O,participantResults:l,manualGamesOverride:S,matchUpStatus:m,tallyPolicy:r,winningSide:I,score:_});if(S){const b=(a=P.find(({sideNumber:w})=>w===1))==null?void 0:a.participantId,E=(c=P.find(({sideNumber:w})=>w===2))==null?void 0:c.participantId;To(l,b),To(l,E);const T=_.sets.reduce((w,$)=>w+$.side1Score,0),N=_.sets.reduce((w,$)=>w+$.side2Score,0);l[b].gamesWon+=T,l[E].gamesWon+=N,l[b].gamesLost+=N,l[E].gamesLost+=T}}return EV({participantResults:l,matchUpFormat:e,tallyPolicy:r,perPlayer:n,totalSets:v}),{participantResults:l}}function wV(t){const e=t.winningSide-1;return Cs(t,e)}function NV(t){const e=1-(t.winningSide-1);return Cs(t,e)}function Cs(t,e){if(!(t!=null&&t.sides))return console.log("no sides:",{matchUp:t}),"foo";const r=t.sides[e];return r?r.participantId:(console.log("No Side",{matchUp:t,index:e}),"foo")}function To(t,e){e&&!t[e]&&(t[e]={allDefaults:0,defaults:0,defeats:[],gamesLost:0,gamesWon:0,matchUpsCancelled:0,matchUpsLost:0,matchUpsWon:0,pointsLost:0,pointsWon:0,retirements:0,setsLost:0,setsWon:0,tieSinglesWon:0,tieSinglesLost:0,tieDoublesWon:0,tieDoublesLost:0,tieMatchUpsLost:0,tieMatchUpsWon:0,victories:[],walkovers:0})}function sh({manualGamesOverride:t,participantResults:e,score:r,sides:n}){const{sets:o}=r||{},i=[[],[]],s=[0,0];for(const c of o||[]){const{winningSide:l,side1Score:u,side2Score:d}=c;l&&(s[l-1]+=1),i[0].push(parseInt(u||0)),i[1].push(parseInt(d||0))}const a=[i[0].reduce((c,l)=>c+l,0),i[1].reduce((c,l)=>c+l,0)];n.forEach((c,l)=>{const{participantId:u}=c;u&&(To(e,u),e[u].setsWon+=s[l],e[u].setsLost+=s[1-l],t||(e[u].gamesWon+=a[l],e[u].gamesLost+=a[1-l]))})}function ah({winningParticipantId:t,losingParticipantId:e,participantResults:r,manualGamesOverride:n,matchUpFormat:o,matchUpStatus:i,isTieMatchUp:s,tallyPolicy:a,winningSide:c,score:l}){const u=c&&c-1,d=1-u;s||HA({winningParticipantId:t,losingParticipantId:e,participantResults:r,matchUpStatus:i});const p=kA({matchUpStatus:i,matchUpFormat:o,tallyPolicy:a,winningSide:c,score:l}),v=bV({matchUpStatus:i,matchUpFormat:o,tallyPolicy:a,winningSide:c,score:l}),f=TV({score:l,matchUpFormat:o,tallyPolicy:a});t&&(r[t].setsWon+=p[u],r[t].setsLost+=p[d],n||(r[t].gamesWon+=v[u],r[t].gamesLost+=v[d]),r[t].pointsWon+=f[u],r[t].pointsLost+=f[d]),e&&(r[e].setsWon+=p[d],r[e].setsLost+=p[u],n||(r[e].gamesWon+=v[d],r[e].gamesLost+=v[u]),r[e].pointsWon+=f[d],r[e].pointsLost+=f[u])}function HA({winningParticipantId:t,losingParticipantId:e,participantResults:r,matchUpStatus:n}){e&&(n===Ge&&(r[e].walkovers+=1),n===Be&&(r[e].defaults+=1),n===Xt&&(r[e].retirements+=1),[Be,Xt,Ge].includes(n)&&(r[e].allDefaults+=1),r[e].matchUpsLost+=1),t&&(r[t].matchUpsWon+=1),e&&t&&(r[e].defeats.push(t),r[t].victories.push(e))}function $V({matchUps:t,order:e,report:r}){const n={};t.forEach(({sides:i})=>{i.forEach(s=>{s.participantId&&s.participant&&(n[s.participantId]=s.participant.participantName)})});const o=[];return Array.isArray(r)&&r.forEach((i,s)=>{var a;if((a=i.excludedDirectives)!=null&&a.length){const c=i.excludedDirectives.map(({attribute:d})=>d).join(", "),l=`${c.length} directives were excluded due to participants limit}`;o.push(l);const u=`Excluded: ${c}`;o.push(u)}else{const c=(v,f)=>parseFloat(i.reversed?v:f)-parseFloat(i.reversed?f:v),l=v=>{Object.keys(v.groups).sort(c).forEach(f=>{const m=v.groups[f].map(h=>n[h]).join(", "),g=`${f} ${v.attribute}: ${m}`;o.push(g)})},u=i.reversed?" in reverse order":"",d=Object.values(i.groups).flat(1/0).length,p=`Step ${s+1}: ${d} particiants were grouped${u} by ${i.attribute}`;if(o.push(p),i.idsFilter){const v=`${i.attribute} was calculated considering ONLY TIED PARTICIPANTS`;o.push(v)}l(i)}o.push("----------------------")}),o.push("Final Order:"),e.forEach(i=>{const{participantId:s,resolved:a}=i,c=i.groupOrder||i.provisionalOrder;o.push(`${c}: ${n[s]} => resolved: ${a}`)}),o.join(`\r
`)}var AV=Object.defineProperty,ch=Object.getOwnPropertySymbols,UV=Object.prototype.hasOwnProperty,CV=Object.prototype.propertyIsEnumerable,lh=(t,e,r)=>e in t?AV(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,MV=(t,e)=>{for(var r in e||(e={}))UV.call(e,r)&&lh(t,r,e[r]);if(ch)for(var r of ch(e))CV.call(e,r)&&lh(t,r,e[r]);return t};const DV=[{attribute:"matchUpsPct",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsPct",idsFilter:!1},{attribute:"gamesPct",idsFilter:!1},{attribute:"pointsPct",idsFilter:!1},{attribute:"matchUpsPct",idsFilter:!0},{attribute:"setsPct",idsFilter:!0},{attribute:"gamesPct",idsFilter:!0},{attribute:"pointsPct",idsFilter:!0}],sp={matchUpsPct:20,tieMatchUpsPct:16,setsPct:12,gamesPct:8,pointsPct:4};function uh(t){const{requireCompletion:e=!0,participantResults:r,subOrderMap:n,tallyPolicy:o}=t,i=[];if(e&&!jV(t))return{};const s=["tieMatchUpsWon","tieSinglesWon","tieDoublesWon","matchUpsWon","pointsWon","gamesWon","setsWon","gamesPct","setsPct","pointsPct","matchUpsPct"].includes(o==null?void 0:o.groupOrderKey)?o.groupOrderKey:"matchUpsWon",a=KA({participantResults:r,attribute:s});i.push({attribute:s,groups:a});const c=Object.keys(a).map(f=>parseFloat(f)).sort((f,m)=>m-f).map(f=>a[f]).map(f=>{const m=YA(MV({participantIds:f},t));return i.push(m.report),m.order}).flat(1/0);let l=1,u;c.forEach((f,m)=>{m&&(f.resolved||u&&!f.resolved)&&(l+=1),u=f.resolved,f.resolved?(f.position=m+1,l=f.position):f.position=l});const d=c.map(({position:f})=>f),p=fr(d);return c.forEach(f=>{const{participantId:m,position:g}=f||{},h=r[m];f.GEMscore=v(h);const _=p[g];(f==null?void 0:f.position)!==void 0&&(_>1&&(f.ties=_,n&&(f.subOrder=n[m])),f.rankOrder=g,f.groupOrder=g+(f.subOrder||1)-1)}),{groupOrder:c,report:i.flat(1/0).filter(Boolean)};function v(f){return(Array.isArray(o==null?void 0:o.GEMscore)?Object.keys(sp).filter(h=>o.GEMscore.includes(h)):Object.keys(sp)).map(h=>(f[h]||0)*Math.pow(10,sp[h].toFixed(3))).reduce((h,_)=>h+_,0)}}function jV({participantResults:t,participantsCount:e}){let n=zA({participantResults:t}).filter(o=>e-1===o.results.matchUpsWon+o.results.matchUpsLost+o.results.matchUpsCancelled);return e===n.length}function RV({disableHeadToHead:t,participantIds:e,matchUpFormat:r,tallyPolicy:n,attribute:o,idsFilter:i,matchUps:s,reversed:a}){const{participantResults:c}=qA({participantIds:i&&e,matchUpFormat:r,tallyPolicy:n,matchUps:s}),l=KA({participantResults:c,participantIds:e,attribute:o}),u=[{attribute:o,reversed:a,groups:l,idsFilter:i}];let d;return Object.keys(l).length>1&&e.length&&(d=Object.keys(l).map(p=>parseFloat(p)).sort((p,v)=>a?p-v:v-p).map(p=>l[p]).map(p=>{const v=YA({participantResults:c,disableHeadToHead:t,participantIds:p,matchUpFormat:r,tallyPolicy:n,matchUps:s});return u.push(v.report),v.order}).flat(1/0)),{order:d,report:u}}function YA({participantResults:t,disableHeadToHead:e,participantIds:r,matchUpFormat:n,tallyPolicy:o,matchUps:i}){if((r==null?void 0:r.length)===1)return{order:[{resolved:!0,participantId:r[0]}]};if((r==null?void 0:r.length)===2&&(!(o!=null&&o.headToHead)||!o.headToHead.disabled&&!e)){const d=FV({participantIds:r,participantResults:t});if(d)return{order:[d],headToHeadWinner:d[0].participantId}}const s=(o==null?void 0:o.tallyDirectives)||DV,a=[],c=[];let l;const u=s.filter(d=>{const p=!(Pt(d.maxParticipants)&&(r==null?void 0:r.length)>d.maxParticipants);return p||a.push(d),p});return a.length&&c.push({excludedDirectives:a,participantIds:r}),u.every(({attribute:d,reversed:p,idsFilter:v,disableHeadToHead:f})=>(l=RV({disableHeadToHead:f,participantIds:r,matchUpFormat:n,tallyPolicy:o,attribute:d,idsFilter:v,matchUps:i,reversed:p}),c.push(l.report),!l.order)),l.order?{order:l.order,report:c}:{order:r==null?void 0:r.map(d=>({participantId:d})),report:c}}function FV({participantIds:t,participantResults:e}){if(t){if(e[t[0]].victories.includes(t[1]))return t.map(r=>({resolved:!0,participantId:r}));if(e[t[1]].victories.includes(t[0]))return t.reverse().map(r=>({resolved:!0,participantId:r}))}}function KA({participantResults:t,participantIds:e,attribute:r}){return zA({participantResults:t,participantIds:e}).reduce((o,i)=>{const{participantId:s,results:a}=i,c=a==null?void 0:a[r];return!isNaN(c)&&s&&(o[c]?o[c].push(s):o[c]=[s]),o},{})}function zA({participantResults:t,participantIds:e}){return e=e||Object.keys(t),e.reduce((r,n,o)=>(r.push({participantId:n,i:o,results:t[n]}),r),[])}const dh="voluntaryConsolation",No="competitiveBands",QA="roundRobinTally",lo="positionActions",zi="matchUpActions",ap="rankingPoints",pv="roundNaming",Sc="participant",Hl="progression",fv="scheduling",VV="avoidance",fa="seeding",va="scoring",Yl="feedIn",LV="draws";function vv({policyDefinitions:t,generateReport:e,matchUpFormat:r,matchUps:n=[],subOrderMap:o,perPlayer:i}){if(!Array.isArray(n))return{error:ko};if(n.reduce((I,{structureId:P})=>I.includes(P)?I:I.concat(P),[]).length!==1)return{error:Z,info:"Maximum one structureId"};const a=n.filter(I=>I&&I.matchUpStatus!==qe),c=a.length&&Ve(a.map(({drawPositions:I})=>I).flat()).length,l=a.filter(I=>Ds({matchUp:I})).length===a.length;l||(i=0);const u=n.every(({matchUpType:I,tieMatchUps:P})=>I===We&&P.every(S=>Ds({matchUp:S}))),d=t==null?void 0:t[QA],p=n.filter(I=>Ds({matchUp:I})||I.matchUpType===We),{participantResults:v}=qA({matchUps:p,matchUpFormat:r,tallyPolicy:d,perPlayer:i});let f,m;const{groupOrder:g,report:h}=uh({matchUps:p,participantResults:v,participantsCount:c,matchUpFormat:r,tallyPolicy:d,subOrderMap:o});if(l&&g)f=h,m=g,g.forEach(I=>{const{participantId:P,groupOrder:S,rankOrder:y,subOrder:O,ties:b,GEMscore:E}=I,T=v[P];Object.assign(T,{groupOrder:S,rankOrder:y,GEMscore:E,subOrder:O,ties:b})});else{const{groupOrder:I,report:P}=uh({requireCompletion:!1,participantResults:v,participantsCount:c,matchUpFormat:r,tallyPolicy:d,subOrderMap:o,matchUps:n});f=P,m=I,I&&I.forEach(S=>{const{participantId:y,groupOrder:O,GEMscore:b}=S,E=v[y];Object.assign(E,{provisionalOrder:O,GEMscore:b})})}const _={completedTieMatchUps:u,participantResults:v,bracketComplete:l,report:f};if((l||u)&&(_.order=m),e||Ct({tally:!0})){const I=$V({matchUps:n,report:f,order:m});Ct({tally:!0})&&console.log(I),_.readableReport=I}return _}function BV({collectionDefinition:t,groupValueNumbers:e,groupValueGroups:r,sideTieValues:n,tieMatchUps:o}){const i=o.filter(_=>_.collectionId===t.collectionId),s=[0,0];let a=[0,0];const c=i.every(_=>Rt.includes(_.matchUpStatus)),{collectionValueProfiles:l,collectionGroupNumber:u,collectionValue:d,matchUpValue:p,winCriteria:v,scoreValue:f,setValue:m}=t,g=u&&e.includes(u),h=[0,0];if(i.forEach(_=>{_.winningSide&&(h[_.winningSide-1]+=1)}),p?i.forEach(_=>{_.winningSide&&(s[_.winningSide-1]+=p)}):m?i.forEach(_=>{var I,P;(P=(I=_.score)==null?void 0:I.sets)==null||P.forEach(S=>{S.winningSide&&(s[S.winningSide-1]+=m)})}):f?i.forEach(_=>{var I,P;(P=(I=_.score)==null?void 0:I.sets)==null||P.forEach(S=>{const{side1TiebreakScore:y=0,side2TiebreakScore:O=0,side1Score:b=0,side2Score:E=0}=S;(S.winningSide||_.winningSide)&&(b||E?(s[0]+=b,s[1]+=E):(y||O)&&S.winningSide&&(s[S.winningSide-1]+=1))})}):Array.isArray(l)&&i.forEach(_=>{if(_.winningSide){const I=_.collectionPosition,P=xV({collectionDefinition:t,collectionPosition:I});s[_.winningSide-1]+=P}}),d){let _;if(v!=null&&v.aggregateValue)c&&((p||m||f)&&s[0]!==s[1]?_=s[0]>s[1]?1:2:h[0]!==h[1]&&(_=h[0]>h[1]?1:2));else if(v!=null&&v.valueGoal)_=s.reduce((I,P,S)=>P>=v.valueGoal?S+1:I,void 0);else{const I=Math.floor(t.matchUpCount/2)+1;_=h.reduce((P,S,y)=>S>=I?y+1:P,void 0)}_&&(g?r[u].values[_-1]+=d:a[_-1]+=d)}else g?(r[u].values[0]+=s[0]||0,r[u].values[1]+=s[1]||0):a=s;g?(r[u].sideWins[0]+=h[0]||0,r[u].sideWins[1]+=h[1]||0,r[u].allGroupMatchUpsCompleted=r[u].allGroupMatchUpsCompleted&&c,r[u].matchUpsCount+=i.length):a.forEach((_,I)=>n[I]+=_)}function xV({collectionDefinition:t,collectionPosition:e}){const r=t.collectionValueProfiles||[],n=r==null?void 0:r.find(o=>o.collectionPosition===e);return n==null?void 0:n.matchUpValue}const Qi="appliedPolicies",Kl="positionActions",JA="context",zu="delegatedOutcome",Zr="disabled",Qu="disableLinks",Bs="disableAutoCalc",zl="drawDeletions",GV="drawProfile",Ql="entryProfile",kV="eventProfile",WV="factory",nn="flightProfile",df="groupingAttribute",En="lineUps",Ji="linkedTournamentsIds",Ju="matchUpHistory",mv="participantRepresentatives",ma="personRequests",ZA="rankingPoints",Dn="roundTarget",Zi="scheduleLimits",wn="scheduleTiming",Mo="schedulingProfile",xs="subOrder",Do="tally",Xi="tieFormatModification",XA={APPLIED_POLICIES:Qi,AUDIT_POSITION_ACTIONS:Kl,CONTEXT:JA,DELEGATED_OUTCOME:zu,DISABLED:Zr,DISABLE_LINKS:Qu,DISABLE_AUTO_CALC:Bs,DRAW_DELETIONS:zl,DRAW_PROFILE:GV,ENTRY_PROFILE:Ql,EVENT_PROFILE:kV,FLIGHT_PROFILE:nn,GROUPING_ATTRIBUTE:df,LINEUPS:En,LINKED_TOURNAMENTS:Ji,MATCHUP_HISTORY:Ju,PARTICIPANT_REPRESENTATIVES:mv,PERSON_REQUESTS:ma,RANKING_POINTS:ZA,ROUND_TARGET:Dn,SCHEDULE_LIMITS:Zi,SCHEDULE_TIMING:wn,SCHEDULING_PROFILE:Mo,SUB_ORDER:xs,TALLY:Do,TIE_FORMAT_MODIFICATIONS:Xi,FACTORY:WV},ph=[zu,Zr,Qu,nn,En,Ju,mv,ma,Dn,Zi,wn,Mo,xs,Do];var qV=Object.defineProperty,fh=Object.getOwnPropertySymbols,HV=Object.prototype.hasOwnProperty,YV=Object.prototype.propertyIsEnumerable,vh=(t,e,r)=>e in t?qV(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,KV=(t,e)=>{for(var r in e||(e={}))HV.call(e,r)&&vh(t,r,e[r]);if(fh)for(var r of fh(e))YV.call(e,r)&&vh(t,r,e[r]);return t};function ct({onlySpecifiedPolicyTypes:t=!1,policyTypes:e=[],tournamentRecord:r,drawDefinition:n,structure:o,event:i}){if(!Array.isArray(e))return{error:uA};const s={};return r&&a(r),i&&a(i),n&&a(n),o&&a(o),KV({appliedPolicies:s},B);function a({extensions:c}){var l;const u=(l=c==null?void 0:c.find(d=>d.name===Qi))==null?void 0:l.value;if(u)for(const d of Object.keys(u))(t?e.includes(d):!e.length||e.includes(d))&&(s[d]=de(u[d],!1,!0))}}function ls({policyTypes:t=[],tournamentRecord:e,drawDefinition:r,structure:n,event:o}){if(!Array.isArray(t))return{error:uA};const{appliedPolicies:i}=ct({tournamentRecord:e,drawDefinition:r,structure:n,event:o}),s={};for(const a of t){const c=i[a];c&&(s[a]=c)}return Object.keys(s).length?{policyDefinitions:s}:{error:Jf}}const eU="WALKOVER",mh="RETIRED",gv="COMPETITIVE",Za="ROUTINE",Xa="DECISIVE",La="winRatio",hv={[No]:{policyName:"Competitive Bands Default",competitiveProfile:{[Xa]:20,[Za]:50}}};function Io({policyDefinitions:t,tournamentRecord:e,contextProfile:r,drawDefinition:n,event:o}){const i={policies:{}};if(!r)return i;const s=ls({tournamentRecord:e,drawDefinition:n,event:o});if(r.withCompetitiveness){const a=(t==null?void 0:t[No])||(s==null?void 0:s[No])||hv[No];i.policies[No]=a}return i}function tU({matchUps:t,matchUpId:e}){return{matchUp:(t||[]).find(n=>n.matchUpId===e)}}function zV({matchUps:t}){const e=t.reduce((n,o)=>!o.collectionPosition||n.includes(o.collectionPosition)?n:n.concat(o.collectionPosition),[]).map(n=>({[n]:t.filter(o=>o.collectionPosition===n)}));return{collectionPositionMatchUps:Object.assign({},...e)}}const QV=(t,e)=>(t||0)+(e||0);function rU(t,e){return isNaN(t)&&eU||t<=e[Xa]&&Xa||t<=e[Za]&&Za||gv}function nU({score:t}){const e=(t==null?void 0:t.sets)||[],r=e.reduce((o,i)=>(o[0]+=i.side1Score||0,o[1]+=i.side2Score||0,o),[0,0]);let n=e.reduce((o,i)=>(o[0]+=i.side1TiebreakScore||0,o[1]+=i.side2TiebreakScore||0,o),[0,0]);return n.reduce(QV)&&(r[n[0]>n[1]?0:1]+=1),{sets:e,games:r,score:t}}function JV(t){const e=Math.min(...t.games),r=Math.max(...t.games);return Math.round(e/r*100)}function oU(t){return t.map(JV).sort().map(e=>e.toFixed(2))}function us({tournamentRecord:t,drawDefinition:e,policyType:r,structure:n,event:o}){if(!t)return{error:ee};const{appliedPolicies:i}=ct({tournamentRecord:t,drawDefinition:e,structure:n,event:o});return i!=null&&i[r]?{policy:i[r]}:{error:Jf}}var ZV=Object.defineProperty,XV=Object.defineProperties,eL=Object.getOwnPropertyDescriptors,gh=Object.getOwnPropertySymbols,tL=Object.prototype.hasOwnProperty,rL=Object.prototype.propertyIsEnumerable,hh=(t,e,r)=>e in t?ZV(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,nL=(t,e)=>{for(var r in e||(e={}))tL.call(e,r)&&hh(t,r,e[r]);if(gh)for(var r of gh(e))rL.call(e,r)&&hh(t,r,e[r]);return t},oL=(t,e)=>XV(t,eL(e));function iU({competitiveProfile:t,tournamentRecord:e,matchUp:r}){if(!r)return{error:wr};const{score:n,winningSide:o}=r;if(!o)return{error:Z};const i=!t&&us({policyType:No,tournamentRecord:e}).policy,s=t||(i==null?void 0:i.competitiveProfile)||hv[No].competitiveProfile,a=nU({score:n}),c=oU([a]),l=rU(c,s);return oL(nL({},B),{competitiveness:l})}function Ba({matchUpAverageTimes:t,matchUpFormat:e}={}){const r=(t==null?void 0:t.map(({matchUpFormatCodes:s})=>s==null?void 0:s.filter(a=>a===e)).flat().filter(Boolean).sort((s,a)=>((s==null?void 0:s.length)||0)-((a==null?void 0:a.length)||0)))||[],o=r.includes(e)?e:r[0],i=t==null?void 0:t.find(({matchUpFormatCodes:s,averageTimes:a})=>(s==null?void 0:s.find(c=>o===c))&&a);return i==null?void 0:i.averageTimes}function xa({matchUpRecoveryTimes:t,averageMinutes:e,matchUpFormat:r}={}){var n;return(n=t==null?void 0:t.find(({matchUpFormatCodes:o,averageTimes:i,recoveryTimes:s})=>{if(i&&e){const{greaterThan:a=0,lessThan:c=360}=i;if(e>a&&e<c)return!0}return(o==null?void 0:o.find(a=>a===r))&&s}))==null?void 0:n.recoveryTimes}function sU({categoryName:t,categoryType:e,timesBlockArray:r}){return r.filter(n=>Array.isArray(n)).map(n=>n.sort((o,i)=>{var s,a;return(((s=i.categoryNames)==null?void 0:s.length)||0)-(((a=o.categoryNames)==null?void 0:a.length)||0)}).find(({categoryTypes:o,categoryNames:i})=>!(i!=null&&i.length)&&!(o!=null&&o.length)||(i==null?void 0:i.includes(t))||(o==null?void 0:o.includes(e)))).find(Boolean)}var iL=Object.defineProperty,sL=Object.defineProperties,aL=Object.getOwnPropertyDescriptors,_h=Object.getOwnPropertySymbols,cL=Object.prototype.hasOwnProperty,lL=Object.prototype.propertyIsEnumerable,Ih=(t,e,r)=>e in t?iL(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,cp=(t,e)=>{for(var r in e||(e={}))cL.call(e,r)&&Ih(t,r,e[r]);if(_h)for(var r of _h(e))lL.call(e,r)&&Ih(t,r,e[r]);return t},lp=(t,e)=>sL(t,aL(e));function uL({tournamentScheduling:t,eventScheduling:e,averageMinutes:r,defaultTiming:n,matchUpFormat:o,categoryName:i,categoryType:s,policy:a}){var c;const l=(e==null?void 0:e.matchUpRecoveryTimes)&&xa(lp(cp({},e),{averageMinutes:r,matchUpFormat:o})),u=(t==null?void 0:t.matchUpRecoveryTimes)&&xa(lp(cp({},t),{averageMinutes:r,matchUpFormat:o})),d=(a==null?void 0:a.matchUpRecoveryTimes)&&xa(lp(cp({},a),{averageMinutes:r,matchUpFormat:o})),p=[l,u,d,(c=a==null?void 0:a.defaultTimes)==null?void 0:c.recoveryTimes,n==null?void 0:n.recoveryTimes];return sU({categoryName:i,categoryType:s,timesBlockArray:p})}var dL=Object.defineProperty,pL=Object.defineProperties,fL=Object.getOwnPropertyDescriptors,Ph=Object.getOwnPropertySymbols,vL=Object.prototype.hasOwnProperty,mL=Object.prototype.propertyIsEnumerable,yh=(t,e,r)=>e in t?dL(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,up=(t,e)=>{for(var r in e||(e={}))vL.call(e,r)&&yh(t,r,e[r]);if(Ph)for(var r of Ph(e))mL.call(e,r)&&yh(t,r,e[r]);return t},dp=(t,e)=>pL(t,fL(e));function gL({matchUpFormat:t,categoryName:e,categoryType:r,defaultTiming:n,tournamentScheduling:o,eventScheduling:i,policy:s}){var a;const c=(i==null?void 0:i.matchUpAverageTimes)&&Ba(dp(up({},i),{matchUpFormat:t})),l=(o==null?void 0:o.matchUpAverageTimes)&&Ba(dp(up({},o),{matchUpFormat:t})),u=(s==null?void 0:s.matchUpAverageTimes)&&Ba(dp(up({},s),{matchUpFormat:t})),d=[c,l,u,(a=s==null?void 0:s.defaultTimes)==null?void 0:a.averageTimes,n==null?void 0:n.averageTimes];return sU({categoryName:e,categoryType:r,timesBlockArray:d})}const ai="RANKING",xi="RATING",es="SCALE",Xr="SEEDING";var hL=Object.defineProperty,Oh=Object.getOwnPropertySymbols,_L=Object.prototype.hasOwnProperty,IL=Object.prototype.propertyIsEnumerable,Sh=(t,e,r)=>e in t?hL(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,bh=(t,e)=>{for(var r in e||(e={}))_L.call(e,r)&&Sh(t,r,e[r]);if(Oh)for(var r of Oh(e))IL.call(e,r)&&Sh(t,r,e[r]);return t};function ga({participant:t}){var e;const r=(e=t.timeItems)==null?void 0:e.filter(({itemType:o})=>(o==null?void 0:o.startsWith(es))&&[ai,xi,Xr].includes(o.split(".")[1])),n={ratings:{},rankings:{},seedings:{}};if(r!=null&&r.length){const o=s=>r.filter(a=>(a==null?void 0:a.itemType)===s).sort((a,c)=>new Date(a.createdAt||void 0)-new Date(c.createdAt||void 0)).pop(),i=Ve(r.map(({itemType:s})=>s));for(const s of i){const a=o(s);if(a){const[,c,l,u]=a.itemType.split("."),d=c===Xr&&"seedings"||c===ai&&"rankings"||"ratings";n[d][l]||(n[d][l]=[]),n[d][l].push({scaleValue:a.itemValue,scaleDate:a.itemDate,scaleName:u})}}}return bh(bh({},B),n)}function uo({tournamentParticipants:t=[],policyDefinitions:e={},contextProfile:r,participantId:n,internalUse:o,personId:i}){const s=t.find(a=>n&&a.participantId===n||i&&a.person&&a.person.personId===i);if(s){const a=e==null?void 0:e[Sc];if(r!=null&&r.withScaleValues){const{ratings:c,rankings:l}=ga({participant:s});s.ratings=c,s.rankings=l}if(a!=null&&a.participant){const c=Yu({template:a.participant,source:s});return de(c,!1,o)}}return de(s,!1,o)}function qo({tournamentRecord:t,participantId:e}){return{participant:(t.participants||[]).reduce((o,i)=>i.participantId===e?i:o,void 0)}}function PL({tournamentRecord:t,policyDefinitions:e,convertExtensions:r,participantId:n,inContext:o,personId:i}){if(!t)return{error:ee};if(typeof n!="string"&&typeof i!="string")return{error:Se};const s=t.participants||[],a=uo({tournamentParticipants:s,policyDefinitions:e,participantId:n,personId:i,inContext:o});return{participant:de(a,r,!0)}}const ec="extensionQueries";function Lt({element:t,name:e}){if(!t||!e)return k({result:{error:Se},stack:ec});if(!Array.isArray(t.extensions))return{info:Ht};const r=t.extensions.find(o=>(o==null?void 0:o.name)===e);return{extension:r,info:r?void 0:Ht}}function hr({tournamentRecord:t,name:e}){return Lt({element:t,name:e})}function Po({event:t,name:e}){return t?Lt({element:t,name:e}):k({result:{error:Re},stack:ec})}function Zu({drawDefinition:t,name:e}){return t?Lt({element:t,name:e}):k({result:{error:pe},stack:ec})}function yL({tournamentRecord:t,participantId:e,name:r}){if(!t)return k({result:{error:ee},stack:ec});if(!e)return k({result:{error:It},stack:ec});const{participant:n}=qo({tournamentRecord:t,participantId:e});return Lt({element:n,name:r})}function bc({tournamentRecord:t,categoryName:e,categoryType:r,event:n}){var o,i,s,a;e=e||((o=n==null?void 0:n.category)==null?void 0:o.categoryName)||((i=n==null?void 0:n.category)==null?void 0:i.ageCategoryCode),r=r||((s=n==null?void 0:n.category)==null?void 0:s.categoryType)||((a=n==null?void 0:n.category)==null?void 0:a.subType);const{policy:c}=us({policyType:fv,tournamentRecord:t,event:n}),{extension:l}=hr({name:wn,tournamentRecord:t}),u=l==null?void 0:l.value,{extension:d}=Po({name:wn,event:n}),p=d==null?void 0:d.value;return{scheduleTiming:{tournamentScheduling:u,eventScheduling:p,categoryName:e,categoryType:r,policy:c}}}const OL="DOUBLES_SINGLES",SL="SINGLES_DOUBLES",en="total",Th="participantConflict",Jo="matchUpConflict",bL="ISSUE_IDS",Ni="CONFLICT",$i="WARNING",Eh="ERROR",wh="ISSUE",pp="STATE";var TL=Object.defineProperty,EL=Object.defineProperties,wL=Object.getOwnPropertyDescriptors,Nh=Object.getOwnPropertySymbols,NL=Object.prototype.hasOwnProperty,$L=Object.prototype.propertyIsEnumerable,$h=(t,e,r)=>e in t?TL(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,aU=(t,e)=>{for(var r in e||(e={}))NL.call(e,r)&&$h(t,r,e[r]);if(Nh)for(var r of Nh(e))$L.call(e,r)&&$h(t,r,e[r]);return t},cU=(t,e)=>EL(t,wL(e));function _v({defaultAverageMinutes:t=90,defaultRecoveryMinutes:e=0,tournamentRecord:r,matchUpFormat:n,categoryName:o,categoryType:i,eventType:s,event:a}){if(!r)return{error:ee};s=s||(a==null?void 0:a.eventType)||ut;const c={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]},{scheduleTiming:l}=bc({tournamentRecord:r,categoryName:o,categoryType:i,event:a}),u=cU(aU({},l),{matchUpFormat:n,categoryType:i,defaultTiming:c});return Xu({eventType:s,timingDetails:u})}function Xu({eventType:t,timingDetails:e}){const r=gL(e),n=Object.keys((r==null?void 0:r.minutes)||{}),o=(r==null?void 0:r.minutes)&&((n==null?void 0:n.includes(t))&&r.minutes[t]||r.minutes.default),i=uL(cU(aU({},e),{averageMinutes:o})),s=Object.keys((i==null?void 0:i.minutes)||{}),a=(i==null?void 0:i.minutes)&&((s==null?void 0:s.includes(t))&&i.minutes[t]||i.minutes.default),c=t===ut?SL:OL,l=(i==null?void 0:i.minutes)&&((s==null?void 0:s.includes(c))&&i.minutes[c]||a);return{averageMinutes:o,recoveryMinutes:a,typeChangeRecoveryMinutes:l}}function on({requiredAttributes:t=["name","value"],extension:e}){if(!e||typeof e!="object"||typeof e.name!="string")return!1;const r=Object.keys(e);return t.filter(n=>r.includes(n)).length===t.length}function ht({event:t,eventId:e}){var r;if(!t)return{error:Re};const{extension:n}=Po({name:nn,event:t}),o=e?de(n==null?void 0:n.value,!1,!0):n==null?void 0:n.value;return e&&((r=t.drawDefinitions)==null||r.forEach(i=>{var s;(s=o==null?void 0:o.flights)==null||s.forEach(a=>{a.drawId===i.drawId&&Object.assign(a,{drawDefinition:i})})})),{flightProfile:o}}var AL=Object.defineProperty,UL=Object.defineProperties,CL=Object.getOwnPropertyDescriptors,Ah=Object.getOwnPropertySymbols,ML=Object.prototype.hasOwnProperty,DL=Object.prototype.propertyIsEnumerable,Uh=(t,e,r)=>e in t?AL(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,jL=(t,e)=>{for(var r in e||(e={}))ML.call(e,r)&&Uh(t,r,e[r]);if(Ah)for(var r of Ah(e))DL.call(e,r)&&Uh(t,r,e[r]);return t},RL=(t,e)=>UL(t,CL(e));function FL({tournamentRecord:t,drawDefinition:e,event:r,context:n}){var o;if(!t)return{error:ee};if(!r)return{error:Re};const i=de(r);n&&Object.assign(i,n);const s=e&&((o=i.drawDefinitions)==null?void 0:o.find(({drawId:a})=>e.drawId===a));return _e({event:i,drawDefinition:s})}function VL({tournamentRecord:t,context:e,inContext:r}){if(!t)return{error:ee};const{tournamentId:n}=t;return{events:(t.events||[]).map(i=>{const s=de(i);return e&&Object.assign(s,e),r&&Object.assign(s,{tournamentId:n}),s})}}function Ft({tournamentRecord:t,eventId:e,drawId:r}){const n="findEvent";if(!t)return k({result:{error:ee},stack:n});const o=(t==null?void 0:t.events)||[];if(r){let i;const s=o.find(a=>{var c;const u=((a==null?void 0:a.drawDefinitions)||[]).find(d=>d.drawId===r);if(u)i=u;else{const{flightProfile:d}=ht({event:a}),p=(c=d==null?void 0:d.flights)==null?void 0:c.find(v=>v.drawId===r);if(p)return{drawId:r,entries:p.drawEntries,drawName:p.drawName}}return u});if(s)return{event:s,drawDefinition:i}}if(e){const i=o.find(s=>s.eventId===e);return i?{event:i}:k({result:{error:Pr},stack:n})}return k({result:{error:Cn},context:{drawId:r,eventId:e},stack:n})}function Ho({tournamentRecord:t,drawId:e}){if(!t)return{error:ee};if(!e)return{error:Mr};const r=(t.events||[]).reduce((n,o)=>{const i=(o.drawDefinitions||[]).reduce((s,a)=>a.drawId===e?a:s,void 0);return i&&i.drawId===e?{event:o,drawDefinition:i}:n},void 0);return r?RL(jL({},r),{SUCCESS:B}):k({result:{error:Cn},stack:"getDrawDefinition"})}var LL=Object.defineProperty,Ch=Object.getOwnPropertySymbols,BL=Object.prototype.hasOwnProperty,xL=Object.prototype.propertyIsEnumerable,Mh=(t,e,r)=>e in t?LL(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,GL=(t,e)=>{for(var r in e||(e={}))BL.call(e,r)&&Mh(t,r,e[r]);if(Ch)for(var r of Ch(e))xL.call(e,r)&&Mh(t,r,e[r]);return t};function et({element:t,extension:e,creationTime:r=!0}={}){const n="addExtension";if(!t)return k({result:{error:Se},stack:n});if(typeof t!="object")return k({result:{error:Z},stack:n});if(!on({extension:e}))return k({result:{error:Z,info:"invalid extension"},stack:n});if(t.extensions||(t.extensions=[]),r){const i=new Date().toISOString();Object.assign(e,{createdAt:i})}const o=t.extensions.find(({name:i})=>i===e.name);return o?o.value=e.value:e.value&&t.extensions.push(e),GL({},B)}const Iv="element required",Pv="missing name";var kL=Object.defineProperty,WL=Object.defineProperties,qL=Object.getOwnPropertyDescriptors,Dh=Object.getOwnPropertySymbols,HL=Object.prototype.hasOwnProperty,YL=Object.prototype.propertyIsEnumerable,jh=(t,e,r)=>e in t?kL(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Rh=(t,e)=>{for(var r in e||(e={}))HL.call(e,r)&&jh(t,r,e[r]);if(Dh)for(var r of Dh(e))YL.call(e,r)&&jh(t,r,e[r]);return t},KL=(t,e)=>WL(t,qL(e));function tn({element:t,name:e}={}){return t?typeof t!="object"?{error:Z}:e?t.extensions?(t.extensions=t.extensions.filter(r=>(r==null?void 0:r.name)!==e),Rh({},B)):KL(Rh({},B),{info:Ht}):{error:Se,info:Pv}:{error:Se,info:Iv}}function _i({creationTime:t=!0,tournamentRecord:e,extension:r}={}){return e?et({element:e,extension:r,creationTime:t}):{error:ee}}function yv({creationTime:t=!0,drawDefinition:e,extension:r}={}){return e?et({element:e,extension:r,creationTime:t}):{error:Cn}}function eo({creationTime:t=!0,extension:e,event:r}={}){return r?et({element:r,extension:e,creationTime:t}):{error:Re}}function zL({creationTime:t=!0,tournamentRecord:e,participantId:r,extension:n}={}){if(!r)return{error:It};const o=(e==null?void 0:e.participants)||[],i=uo({tournamentParticipants:o,participantId:r});return i?et({element:i,extension:n,creationTime:t}):{error:Tt}}function Ov({tournamentRecord:t,name:e}={}){return t?tn({element:t,name:e}):{error:ee}}function QL({drawDefinition:t,name:e}={}){return t?tn({element:t,name:e}):{error:Cn}}function ed({event:t,name:e}={}){return t?tn({element:t,name:e}):{error:Pr}}function JL({tournamentRecord:t,participantId:e,name:r}={}){if(!e)return{error:It};const n=(t==null?void 0:t.participants)||[],o=uo({tournamentParticipants:n,participantId:e});return o?tn({element:o,name:r}):{error:Tt}}var ZL=Object.defineProperty,XL=Object.defineProperties,eB=Object.getOwnPropertyDescriptors,Fh=Object.getOwnPropertySymbols,tB=Object.prototype.hasOwnProperty,rB=Object.prototype.propertyIsEnumerable,Vh=(t,e,r)=>e in t?ZL(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,lU=(t,e)=>{for(var r in e||(e={}))tB.call(e,r)&&Vh(t,r,e[r]);if(Fh)for(var r of Fh(e))rB.call(e,r)&&Vh(t,r,e[r]);return t},nB=(t,e)=>XL(t,eB(e));function Sv({tournamentRecords:t,extension:e}){if(!on({extension:e}))return{error:Z};const r="addExtension";for(const n of Object.values(t)){const o=_i({tournamentRecord:n,extension:e});if(o.error)return k({result:o,stack:r})}return lU({},B)}function td({tournamentRecords:t,name:e}){if(!e)return{error:Se,info:Pv};let r;return Object.keys(t).find(o=>{const i=t[o],{extension:s}=hr({tournamentRecord:i,name:e});return r=s,!!s})?{extension:r}:{error:Ht}}function rd({tournamentRecords:t,name:e}){if(!e)return{error:Se,info:Pv};let r=0;for(const n of Object.keys(t)){const o=t[n],i=Ov({tournamentRecord:o,name:e});if(i.error)return k({result:i,stack:"removeExtension"});i.info!==Ht&&r++}return nB(lU({},B),{removed:r})}function oB({tournamentRecords:t,eventId:e,extension:r}){if(typeof e!="string")return{error:Re};if(!on({extension:r}))return{error:Z};for(const n of Object.values(t)){const{event:o}=Ft({tournamentRecord:n,eventId:e});if(o)return eo({event:o,extension:r})}return{error:Pr}}var iB=Object.defineProperty,Lh=Object.getOwnPropertySymbols,sB=Object.prototype.hasOwnProperty,aB=Object.prototype.propertyIsEnumerable,Bh=(t,e,r)=>e in t?iB(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,uU=(t,e)=>{for(var r in e||(e={}))sB.call(e,r)&&Bh(t,r,e[r]);if(Lh)for(var r of Lh(e))aB.call(e,r)&&Bh(t,r,e[r]);return t};function bv({tournamentRecords:t}){return typeof t!="object"||!Object.keys(t).length?{error:Fe}:{linkedTournamentIds:Object.assign({},...Object.keys(t).map(r=>{var n;const o=t[r],i=o==null?void 0:o.tournamentId,{extension:s}=hr({tournamentRecord:o,name:Ji}),a=(((n=s==null?void 0:s.value)==null?void 0:n.tournamentIds)||[]).filter(c=>c!==i);return{[r]:a}}))}}function cB({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Fe};const e=dU(t);if(e.error)return e;const{tournamentIds:r}=e;return(r==null?void 0:r.length)>1?Sv({tournamentRecords:t,extension:{name:Ji,value:{tournamentIds:r}}}):uU({},B)}function lB({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Fe};const e=rd({name:Ji,tournamentRecords:t});return k({result:e,stack:"unlinkTournaments"})}function uB({tournamentRecords:t,tournamentId:e}){if(typeof t!="object")return{error:Z};if(!e)return{error:so};const r=dU(t);if(r.error)return r;const{tournamentIds:n}=r;if(!n.includes(e))return{error:so};let o;return n.every(i=>{var s;const a=t[i],{extension:c}=hr({tournamentRecord:a,name:Ji});if(!c)return!0;let l=((s=c==null?void 0:c.value)==null?void 0:s.tournamentIds)||[];if(!(l!=null&&l.length)||l.length===1&&l.includes(e)||i===e){const p=Ov({tournamentRecord:a,name:Ji});return p.error&&(o=p.error),p.success}const u=l.filter(p=>p!==e);c.value={tournamentIds:u};const d=_i({tournamentRecord:a,extension:c});return d.error&&(o=d.error),d.success}),o?{error:o}:uU({},B)}function dU(t){return{tournamentIds:Object.keys(t).filter(Boolean)}}function pU({extension:t,dates:e=[]}){if(!t)return!1;if(typeof t.value=="boolean"&&t.value)return!0;if(typeof t.value=="object"&&Array.isArray(t.value.dates))return e.length?!!e.filter(n=>t.value.dates.includes(n)).length:!0}function _r({element:t,name:e}){const r="findExtension";if(!t||!e)return k({result:{error:Se},stack:r});if(!Array.isArray(t.extensions))return k({result:{error:Ht},stack:r});const n=t.extensions.find(o=>(o==null?void 0:o.name)===e);return n?{extension:n}:k({result:{error:Ht},stack:r})}var dB=Object.defineProperty,pB=Object.defineProperties,fB=Object.getOwnPropertyDescriptors,xh=Object.getOwnPropertySymbols,vB=Object.prototype.hasOwnProperty,mB=Object.prototype.propertyIsEnumerable,Gh=(t,e,r)=>e in t?dB(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,gB=(t,e)=>{for(var r in e||(e={}))vB.call(e,r)&&Gh(t,r,e[r]);if(xh)for(var r of xh(e))mB.call(e,r)&&Gh(t,r,e[r]);return t},hB=(t,e)=>pB(t,fB(e));function fU({convertExtensions:t,ignoreDisabled:e,venue:r,court:n}){const o=hB(gB({},de(n,t,!0)),{venueId:r.venueId}),{extension:i}=_r({name:Zr,element:n});if(e&&i){const s=typeof i.value=="object"&&i.value.dates||[],a=i.value===!0?[]:o.dateAvailability.map(c=>{const l=c.date;if(!(!l||s.includes(l)))return c}).filter(Boolean);o.dateAvailability=a}return{inContextCourt:o}}const vU="addDrawDefinition",Tv="addMatchUps",ci="addParticipants",mU="addScaleItems",gU="addVenue",tc="audit",hU="deleteParticipants",_U="deleteVenue",IU="deletedDrawIds",PU="deletedMatchUpIds",yU="modifyDrawDefinition",_B="modifyDrawEntries",IB="modifyEventEntries",OU="modifyMatchUp",kt="modifyParticipants",SU="modifyPositionAssignments",bU="modifySeedAssignments",PB="modifyTournamentDetail",ds="modifyVenue",kh="mutations",yB="publishEvent",OB="publishEventSeeding",SB="publishOrderOfPlay",TU="unPublishEvent",EU="unPublishEventSeeding",wU="unPublishOrderOfPlay",Ev="updateInContextMatchUp";var bB=Object.defineProperty,TB=Object.defineProperties,EB=Object.getOwnPropertyDescriptors,Wh=Object.getOwnPropertySymbols,wB=Object.prototype.hasOwnProperty,NB=Object.prototype.propertyIsEnumerable,qh=(t,e,r)=>e in t?bB(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,$B=(t,e)=>{for(var r in e||(e={}))wB.call(e,r)&&qh(t,r,e[r]);if(Wh)for(var r of Wh(e))NB.call(e,r)&&qh(t,r,e[r]);return t},AB=(t,e)=>TB(t,EB(e));function Tc({tournamentRecord:t,context:e,disableNotice:r,venue:n}){return t?n?(t.venues||(t.venues=[]),n.venueId||(n.venueId=ke()),t.venues.reduce((i,s)=>i||s.venueId===n.venueId,void 0)?{error:kR}:(e&&et({element:n,extension:{value:e,name:JA}}),t.venues.push(n),r||Le({payload:{venue:n,tournamentId:t.tournamentId},topic:gU}),AB($B({},B),{venue:de(n)}))):{error:Se,info:"missing venue"}:{error:ee}}var UB=Object.defineProperty,CB=Object.defineProperties,MB=Object.getOwnPropertyDescriptors,Jl=Object.getOwnPropertySymbols,NU=Object.prototype.hasOwnProperty,$U=Object.prototype.propertyIsEnumerable,Hh=(t,e,r)=>e in t?UB(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Yh=(t,e)=>{for(var r in e||(e={}))NU.call(e,r)&&Hh(t,r,e[r]);if(Jl)for(var r of Jl(e))$U.call(e,r)&&Hh(t,r,e[r]);return t},Kh=(t,e)=>CB(t,MB(e)),DB=(t,e)=>{var r={};for(var n in t)NU.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&Jl)for(var n of Jl(t))e.indexOf(n)<0&&$U.call(t,n)&&(r[n]=t[n]);return r};function wv({convertExtensions:t,tournamentRecord:e,ignoreDisabled:r,dates:n}){if(!e)return{error:ee};const o=de(e.venues||[],t).filter(s=>{if(!r)return s;const{extension:a}=_r({name:Zr,element:s});return!(a!=null&&a.value)&&s}).filter(Boolean),i=o.reduce((s,a)=>{const c=((a==null?void 0:a.courts)||[]).filter(l=>{if(!r&&!(n!=null&&n.length))return l;const{extension:u}=_r({name:Zr,element:l});return pU({extension:u,dates:n})}).filter(Boolean).map(l=>{const{inContextCourt:u}=fU({convertExtensions:t,ignoreDisabled:r,venue:a,court:l});return u});return c.length?s.concat(c):s},[]);return{venues:o,courts:i}}function Yo({tournamentRecords:t,tournamentRecord:e,venueId:r}){if(!e)return{error:ee};if(!r)return{error:Wo};let o=(e.venues||[]).reduce((i,s)=>s.venueId===r?s:i,void 0);if(!o&&t){const s=bv({tournamentRecords:t}).linkedTournamentIds[e.tournamentId];for(const a of s){const c=t[a],l=Yo({tournamentRecord:c,venueId:r});if(l.success)return Tc({tournamentRecord:e,venue:l.venue}),Kh(Yh({},B),{venue:o})}}return o?Kh(Yh({},B),{venue:o}):{error:oi}}function jB(t){var e=t,{convertExtensions:r}=e,n=DB(e,["convertExtensions"]);return de(Yo(n),r,!0)}var RB=Object.defineProperty,FB=Object.defineProperties,VB=Object.getOwnPropertyDescriptors,zh=Object.getOwnPropertySymbols,LB=Object.prototype.hasOwnProperty,BB=Object.prototype.propertyIsEnumerable,Qh=(t,e,r)=>e in t?RB(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Jh=(t,e)=>{for(var r in e||(e={}))LB.call(e,r)&&Qh(t,r,e[r]);if(zh)for(var r of zh(e))BB.call(e,r)&&Qh(t,r,e[r]);return t},Zh=(t,e)=>FB(t,VB(e));function ps({tournamentRecords:t,tournamentRecord:e,courtId:r}){if(!e)return{error:ee};if(!r)return{error:ca};const n="findCourt";let o,i;if((e.venues||[]).forEach(s=>{(s.courts||[]).forEach(a=>{a.courtId===r&&(o=a,i=s)})}),o)return Zh(Jh({},B),{court:o,venue:i});if(t){const a=bv({tournamentRecords:t}).linkedTournamentIds[e.tournamentId];for(const c of a){const l=t[c],u=ps({tournamentRecord:l,courtId:r});if(u.success)return Tc({tournamentRecord:e,venue:u.venue}),Zh(Jh({},B),{court:o,venue:i})}}return k({result:{error:rv},stack:n})}function xB(t){return de(ps(t),!1,!0)}function GB({tournamentRecord:t,venueId:e,venueIds:r}){return t?{courts:(t.venues||[]).filter(o=>e?o.venueId===e:r?r.includes(o.venueId):!e&&!r).map(o=>{const{venueId:i}=o,s=de(o.courts||[]);return s.forEach(a=>Object.assign(a,{venueId:i})),s}).flat()}:{error:ee}}var kB=Object.defineProperty,WB=Object.defineProperties,qB=Object.getOwnPropertyDescriptors,Xh=Object.getOwnPropertySymbols,HB=Object.prototype.hasOwnProperty,YB=Object.prototype.propertyIsEnumerable,e_=(t,e,r)=>e in t?kB(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,KB=(t,e)=>{for(var r in e||(e={}))HB.call(e,r)&&e_(t,r,e[r]);if(Xh)for(var r of Xh(e))YB.call(e,r)&&e_(t,r,e[r]);return t},zB=(t,e)=>WB(t,qB(e));function AU({tournamentRecord:t,courtId:e,internalUse:r}){if(!t)return{error:ee};if(!e)return{error:ca};const n=ps({tournamentRecord:t,courtId:e});if(n.error)return n;const o=(({altitude:i,courtId:s,courtName:a,courtDimensions:c,latitude:l,longitude:u,surfaceCategory:d,surfaceType:p,surfaceDate:v,pace:f,notes:m})=>({altitude:i,courtId:s,courtName:a,courtDimensions:c,latitude:l,longitude:u,surfaceCategory:d,surfaceType:p,surfaceDate:v,pace:f,notes:m}))(n.court);return zB(KB({},B),{courtInfo:de(o,!1,r)})}var QB=Object.defineProperty,JB=Object.defineProperties,ZB=Object.getOwnPropertyDescriptors,t_=Object.getOwnPropertySymbols,XB=Object.prototype.hasOwnProperty,ex=Object.prototype.propertyIsEnumerable,r_=(t,e,r)=>e in t?QB(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,fp=(t,e)=>{for(var r in e||(e={}))XB.call(e,r)&&r_(t,r,e[r]);if(t_)for(var r of t_(e))ex.call(e,r)&&r_(t,r,e[r]);return t},n_=(t,e)=>JB(t,ZB(e));function Zl({tournamentRecord:t,venueId:e}){if(!t)return{error:ee};if(!e)return{error:Wo};const r=Yo({tournamentRecord:t,venueId:e});if(r.error)return r;const o=(r.venue.courts||[]).map(a=>(({courtInfo:c})=>fp({},c))(AU({courtId:a.courtId,internalUse:!0,tournamentRecord:t}))),i=(({venueId:a,venueName:c,venueAbbreviation:l})=>({venueId:a,venueName:c,venueAbbreviation:l}))(r.venue),s=n_(fp({},i),{courtsInfo:o});return n_(fp({},B),{venueData:de(s,!1,!0)})}const pf="CHECK_IN",ff="CHECK_OUT",Ec="SCHEDULE.ASSIGNMENT.VENUE",jo="SCHEDULE.ALLOCATION.COURTS",ts="SCHEDULE.ASSIGNMENT.COURT",UU="SCHEDULE.COURT.ORDER",wc="SCHEDULE.DATE",tx="SCHEDULE.ASSIGN.OFFICIAL",Nc="SCHEDULE.TIME.SCHEDULED",mn="SCHEDULE.TIME.START",$o="SCHEDULE.TIME.STOP",io="SCHEDULE.TIME.RESUME",Ro="SCHEDULE.TIME.END",CU="SCHEDULE.TIME.MODIFIERS",rx="TO_BE_ANNOUNCED",nx="NEXT_AVAILABLE",ox="FOLLOWED_BY",ix="AFTER_REST",sx="RAIN_DELAY",o_=[rx,nx,ox,ix,sx],ax="SCALE",cx="RATING",lx="RANKING",MU="SEEDING",$r="PUBLISH",Nn="PUBLIC",Ar="STATUS";function ul(t){return t.createdAt?new Date(t.createdAt).getTime():0}function Ii({timeItems:t,itemType:e,visibilityThreshold:r}){const n=t.filter(i=>i&&i.itemType===e&&(!r||ul(i)<r)).sort((i,s)=>ul(i)-ul(s)).pop(),o=n&&ul(n);return{itemValue:n==null?void 0:n.itemValue,timeStamp:o}}function vf({visibilityThreshold:t,timeStamp:e,schedule:r,matchUp:n}){const{itemValue:o,timeStamp:i}=Ii({timeItems:(n==null?void 0:n.timeItems)||[],itemType:Nc,visibilityThreshold:t});return!r||i&&e&&i>e?{scheduledTime:o}:r}function li({visibilityThreshold:t,timeStamp:e,schedule:r,matchUp:n}){const{itemValue:o,timeStamp:i}=Ii({timeItems:(n==null?void 0:n.timeItems)||[],itemType:wc,visibilityThreshold:t});return!r||i&&e&&i>e?{scheduledDate:o}:r}function DU({visibilityThreshold:t,timeStamp:e,schedule:r,matchUp:n}){const{itemValue:o,timeStamp:i}=Ii({timeItems:(n==null?void 0:n.timeItems)||[],itemType:jo,visibilityThreshold:t});return!r||i&&e&&i>e?{allocatedCourts:de(o,!1,!0)}:r}function jU({visibilityThreshold:t,timeStamp:e,schedule:r,matchUp:n}){const{itemValue:o,timeStamp:i}=Ii({timeItems:(n==null?void 0:n.timeItems)||[],itemType:ts,visibilityThreshold:t});return!r||i&&e&&i>e?{courtId:o}:r}function RU({visibilityThreshold:t,timeStamp:e,schedule:r,matchUp:n}){const{itemValue:o,timeStamp:i}=Ii({timeItems:(n==null?void 0:n.timeItems)||[],itemType:Ec,visibilityThreshold:t});return!r||i&&e&&i>e?{venueId:o}:r}function Nv({visibilityThreshold:t,timeStamp:e,schedule:r,matchUp:n}){const{itemValue:o,timeStamp:i}=Ii({timeItems:(n==null?void 0:n.timeItems)||[],itemType:CU,visibilityThreshold:t});return!r||i&&e&&i>e?{timeModifiers:o}:r}function Ai(t){if(RA.test(t)){const e=sv();return new Date(`${e}T${t}`)}else return new Date(t)}function FU({matchUp:t}){if(!t)return{error:wr};if(!t.timeItems)return{error:EA};const e=t.timeItems.filter(n=>[mn,$o,io,Ro].includes(n==null?void 0:n.itemType)).sort((n,o)=>Ai(n.itemValue)-Ai(o.itemValue)),r=e.reduce((n,o)=>{var i,s;let a;const c=(i=o==null?void 0:o.itemType)==null?void 0:i.split("."),u=`SCHEDULE.TIME.${((s=o==null?void 0:o.itemType)==null?void 0:s.startsWith("SCHEDULE.TIME"))&&c[2]}`;switch(u){case mn:a=0;break;case Ro:if(n.lastValue&&[mn,io].includes(n.lastType)){const d=Ai(o.itemValue)-Ai(n.lastValue);a=n.milliseconds+d}else a=n.milliseconds;break;case $o:if([mn,"SCHECULE.TIME.RESUME"].includes(n.lastType)){const d=Ai(o.itemValue)-Ai(n.lastValue);a=n.milliseconds+d}else a=n.milliseconds;break;default:a=n.milliseconds;break}return{milliseconds:a,lastType:u,lastValue:o.itemValue}},{milliseconds:0,lastType:void 0,lastValue:void 0});if([mn,io].includes(r.lastType)){const n=new Date-Ai(r.lastValue);r.milliseconds+=n}return{milliseconds:r.milliseconds,time:ux(r.milliseconds),relevantTimeItems:e}}function ux(t){const e=(r,n=2)=>("00"+r).slice(-n);return e(t/36e5|0)+":"+e(t%36e5/6e4|0)+":"+e(t%6e4/1e3|0)}function dx({visibilityThreshold:t,timeStamp:e,schedule:r,matchUp:n}){const{itemValue:o,timeStamp:i}=Ii({timeItems:(n==null?void 0:n.timeItems)||[],itemType:UU,visibilityThreshold:t});return!r||i&&e&&i>e?{courtOrder:o}:r}function px({matchUp:t}){const e=(t==null?void 0:t.timeItems)||[],r=i=>i.createdAt?new Date(i.createdAt).getTime():0,n=e.reduce((i,s)=>{const a=s.itemType===mn&&s;return a&&(!i||r(a)<r(i))?a:i},void 0);return{startTime:n==null?void 0:n.itemValue}}function fx({matchUp:t}){const e=(t==null?void 0:t.timeItems)||[],r=i=>i.createdAt?new Date(i.createdAt).getTime():0,n=e.reduce((i,s)=>{const a=s.itemType===Ro&&s;return a&&(!i||r(a)>r(i))?a:i},void 0);return{endTime:n==null?void 0:n.itemValue}}const Yn="SINGLES",i_="SINGLES",mr="DOUBLES",rc="DOUBLES",yt="TEAM",gn="TEAM";var vx=Object.defineProperty,s_=Object.getOwnPropertySymbols,mx=Object.prototype.hasOwnProperty,gx=Object.prototype.propertyIsEnumerable,a_=(t,e,r)=>e in t?vx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,hx=(t,e)=>{for(var r in e||(e={}))mx.call(e,r)&&a_(t,r,e[r]);if(s_)for(var r of s_(e))gx.call(e,r)&&a_(t,r,e[r]);return t};function $v({scheduleVisibilityFilters:t,afterRecoveryTimes:e,tournamentRecord:r,scheduleTiming:n,matchUpFormat:o,matchUpType:i,matchUp:s,event:a}){var c,l,u,d;if(!s)return{error:wr};if(e&&!s.matchUpType&&!i&&(a||r)&&s.drawId){let b=a==null?void 0:a.drawDefinitions.find(T=>T.drawId===s.drawId);!b&&r&&({drawDefinition:b,event:a}=Ft({tournamentRecord:r,drawId:s.drawId}));const E=s.structureId&&((c=b==null?void 0:b.structures)==null?void 0:c.find(({structureId:T})=>T===s.structureId));i=(E==null?void 0:E.matchUpType)||(b==null?void 0:b.matchUpType)||(a==null?void 0:a.eventType)!==yt&&(a==null?void 0:a.eventType)}const{milliseconds:p,time:v}=FU({matchUp:s}),{startTime:f}=px({matchUp:s}),{endTime:m}=fx({matchUp:s});let g;const{visibilityThreshold:h,eventIds:_,drawIds:I}=t||{};if((!_||_.includes(s.eventId))&&(!I||I.includes(s.drawId))){const b={matchUp:s,visibilityThreshold:h},{allocatedCourts:E}=DU(b),{scheduledTime:T}=vf(b);let{scheduledDate:N}=li(b);const{venueId:w}=RU(b),{courtId:$}=jU(b),{courtOrder:U}=dx(b),{timeModifiers:A}=Nv(b);let C,M,D,V,R;if(n!=null&&n.policy&&T&&e){const H=hx({matchUpFormat:s.matchUpFormat||o},n);({averageMinutes:M=0,recoveryMinutes:D=0,typeChangeRecoveryMinutes:V=0}=Xu({eventType:s.matchUpType||i,timingDetails:H})),(M||D)&&(C=m?sr(tt(m),D):sr(T,M+D)),V&&(R=m?sr(tt(m),V):sr(T,M+V))}!N&&T&&(N=Me(T));const W=Gl({scheduledDate:N,scheduledTime:T}),x={},K=((l=r&&w&&Zl({tournamentRecord:r,venueId:w}))==null?void 0:l.venueData)||{};w&&(x[w]=K);const{venueName:j,venueAbbreviation:L,courtsInfo:F}=K,q=$&&(F==null?void 0:F.find(H=>H.courtId===$)),G=q==null?void 0:q.courtName;for(const H of E||[]){if(!r)break;H.venueId&&!x[H.venueid]&&(x[H.venueId]=(u=Zl({venueId:H.venueId,tournamentRecord:r}))==null?void 0:u.venueData);const Q=x[H.venueId];H.venueName=Q==null?void 0:Q.venueName;const z=(d=Q==null?void 0:Q.courtsInfo)==null?void 0:d.find(Y=>Y.courtId===H.courtId);H.courtName=z==null?void 0:z.courtName}g=_e({typeChangeTimeAfterRecovery:R,timeAfterRecovery:C,scheduledDate:N,scheduledTime:T,isoDateString:W,allocatedCourts:E,timeModifiers:A,venueAbbreviation:L,venueName:j,venueId:w,courtOrder:U,courtName:G,courtId:$,typeChangeRecoveryMinutes:V,recoveryMinutes:D,averageMinutes:M,milliseconds:p,startTime:f,endTime:m,time:v})}else g=_e({time:v,startTime:f,endTime:m,milliseconds:p});const P=Rt.includes(s.matchUpStatus),{scheduledDate:S}=li({matchUp:s}),{scheduledTime:y}=vf({matchUp:s}),O=P&&(Me(m)||Me(S)||Me(y))||void 0;return{schedule:g,endDate:O}}var _x=Object.defineProperty,c_=Object.getOwnPropertySymbols,Ix=Object.prototype.hasOwnProperty,Px=Object.prototype.propertyIsEnumerable,l_=(t,e,r)=>e in t?_x(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,yx=(t,e)=>{for(var r in e||(e={}))Ix.call(e,r)&&l_(t,r,e[r]);if(c_)for(var r of c_(e))Px.call(e,r)&&l_(t,r,e[r]);return t};function Xl({collectionPosition:t,collectionId:e,lineUp:r}){let n=[];const o=[];if(r){const i=a=>a===void 0?-1:a,s=r.map(a=>{const{collectionAssignments:c,participantId:l}=a,u=c==null?void 0:c.find(d=>d.collectionPosition===t&&d.collectionId===e);return u&&yx({participantId:l},u)}).filter(Boolean).sort((a,c)=>i(a.substitutionOrder)-i(c.substitutionOrder));for(const a of s){const{participantId:c,previousParticipantId:l,substitutionOrder:u}=a;n.includes(c)||(l&&o.push({previousParticipantId:l,substitutionOrder:u,participantId:c}),n=n.filter(d=>d!==l),n.push(c))}}return{assignedParticipantIds:n,substitutions:o}}var ha=(t=>(t.Group="GROUP",t.Individual="INDIVIDUAL",t.Pair="PAIR",t.Team="TEAM",t))(ha||{});const $c="SIGN_IN_STATUS",Ce=ha.Individual,dr=ha.Group,we=ha.Pair,Ye=ha.Team,hn=ha.Team,nc="SIGNED_IN",Ox="SIGNED_OUT",ja={TEAM_PARTICIPANT:hn,INDIVIDUAL:Ce,GROUP:dr,TEAM:Ye,PAIR:we};var Sx=Object.defineProperty,u_=Object.getOwnPropertySymbols,bx=Object.prototype.hasOwnProperty,Tx=Object.prototype.propertyIsEnumerable,d_=(t,e,r)=>e in t?Sx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ex=(t,e)=>{for(var r in e||(e={}))bx.call(e,r)&&d_(t,r,e[r]);if(u_)for(var r of u_(e))Tx.call(e,r)&&d_(t,r,e[r]);return t};function $n({tournamentParticipants:t,tournamentRecord:e,participantIds:r}){const n="getPairedParticipant";if(!t&&!e)return{error:ee};if(!Array.isArray(r)||r.length>2)return{error:Jr};if(!r.length)return k({result:{error:co},stack:n});t=t||(e==null?void 0:e.participants)||[];const o=t.filter(a=>a.participantType===we&&Dt(r,a.individualParticipantIds).length===r.length&&a.individualParticipantIds.length===r.length),i=o[0];if(!i)return k({result:{error:Tt},stack:n});const s=de(o.slice(1),!1,!0);return Ex({participant:de(i),duplicatedPairParticipants:s},B)}function Ac({drawDefinition:t,participantId:e}){if(typeof t!="object")return{error:pe};if(typeof e!="string")return{error:It};const{extension:r}=Lt({element:t,name:En});return{lineUp:((r==null?void 0:r.value)||{})[e]}}function wx({tournamentParticipants:t,positionAssignments:e,collectionPosition:r,drawPositions:n=[],drawDefinition:o,participantMap:i,collectionId:s,sideLineUps:a,matchUpType:c}){if(!s||!r)return;const l=(n==null?void 0:n.map(u=>{var d,p,v,f,m,g;const h=(d=e.find(O=>O.drawPosition===u))==null?void 0:d.participantId,_=a==null?void 0:a.find(O=>(O==null?void 0:O.drawPosition)===u),I=(_==null?void 0:_.teamParticipant)||((p=i==null?void 0:i[h])==null?void 0:p.participant)||(t==null?void 0:t.find(({participantId:O})=>O===h)),P=(_==null?void 0:_.lineUp)||((v=Ac({participantId:h,drawDefinition:o}))==null?void 0:v.lineUp),{assignedParticipantIds:S,substitutions:y}=Xl({collectionPosition:r,collectionId:s,lineUp:P});if(c===ot){if((S==null?void 0:S.length)<=2){const O=(m=(f=i==null?void 0:i[S[0]])==null?void 0:f.pairIdMap)==null?void 0:m[S[1]],E=O&&((g=i[O])==null?void 0:g.participant)||$n({participantIds:S,tournamentParticipants:t}).participant,T=E==null?void 0:E.participantId;return{[u]:{participantId:T,teamParticipant:I,substitutions:y}}}else if((S==null?void 0:S.length)>2)return{[u]:{teamParticipant:I,substitutions:y}}}else{const O=S==null?void 0:S[0];return O&&{[u]:{participantId:O,teamParticipant:I,substitutions:y}}}}).filter(Boolean))||{};return Object.assign({},...l)}function lr({matchUps:t=[],interpolate:e}){var r;if(!Array.isArray(t))return{error:Z};const n=t.reduce((p,v)=>!v.roundNumber||p.includes(v.roundNumber)?p:p.concat(parseInt(v.roundNumber)),[]).sort(Bt).map(p=>{const v=t.filter(h=>h.roundNumber===p),m=v.find(({matchUpType:h})=>h===We)?v.filter(({matchUpType:h})=>h===We):v,g=h=>h.sort((_,I)=>Bt(_.roundPosition,I.roundPosition));return{[p]:g(m)}}),o=t.reduce((p,v)=>(p[v.roundNumber]||(p[v.roundNumber]=_e({abbreviatedRoundName:v.abbreviatedRoundName,finishingRound:v.finishingRound,roundName:v.roundName})),p),{}),i=Object.assign({},...n);if(e){const p=Math.max(...Object.keys(i).map(f=>parseInt(f)).filter(f=>!isNaN(f))),v=(r=i[p])==null?void 0:r.length;if(v>1&&Lr(v)){const f=p+1,m=f+v/2;le(f,m).forEach((h,_)=>{i[h]=le(0,v/(2+_*2)).map(()=>({}))})}}let s=0;const a=Object.assign({},...Object.keys(i).map(p=>{var v,f,m;const g=(v=i[p])==null?void 0:v.length,h=(m=(f=i[p])==null?void 0:f.filter(I=>{var P;return!Rt.includes(I.matchUpStatus)&&!((P=I.score)!=null&&P.scoreStringSide1)}))==null?void 0:m.length,_=g&&g===h;return s=Math.max(s,g),{[p]:{matchUpsCount:g,inactiveCount:h,inactiveRound:_}}}));let c=0,l=0;const u=Object.keys(i).map(p=>parseInt(p)).filter(p=>!isNaN(p));return u.forEach(p=>{var v,f,m;const g=i[p].sort((_,I)=>_.roundPosition-I.roundPosition),h=g.map(_=>(_==null?void 0:_.drawPositions)||[]).flat();if(a[p].roundNumber=p,a[p].roundFactor=a[p].matchUpsCount?s/a[p].matchUpsCount:1,a[p].finishingRound=(v=o[p])==null?void 0:v.finishingRound,a[p].roundName=(f=o[p])==null?void 0:f.roundName,a[p].abbreviatedRoundName=(m=o[p])==null?void 0:m.abbreviatedRoundName,a[p].finishingPositionRange=i[p][0].finishingPositionRange,p===1||!a[p-1]){const _=h.sort(Bt),I=jt(_,2);a[p].drawPositions=_,a[p].pairedDrawPositions=I}else{const _=a[p-1],I=_.drawPositions,P=_.matchUpsCount/a[p].matchUpsCount,S=jt(I,P),y=g.map(O=>{const{roundPosition:b}=O,E=[].concat(...O.drawPositions||[],void 0,void 0).slice(0,2);if(!b)return E;const T=(E==null?void 0:E.filter(Boolean))||[];if(!(T!=null&&T.length))return[void 0,void 0];if(p<3&&(T==null?void 0:T.length)===2)return E==null?void 0:E.slice().sort(Bt);const N=Dt(I,T).length!==(T==null?void 0:T.length);if(T!=null&&T.length&&N)return(T==null?void 0:T.length)===1?[T[0],void 0]:E==null?void 0:E.slice().sort(Bt);const w=(b-1)*2;return S.slice(w,w+2).map(U=>T==null?void 0:T.find(A=>U.includes(A)))});a[p].drawPositions=y==null?void 0:y.flat(),a[p].pairedDrawPositions=y}a[p+1]&&a[p+1].matchUpsCount===a[p].matchUpsCount&&(a[p+1].feedRound=!0,a[p+1].feedRoundIndex=l,a[p].preFeedRound=!0,l+=1),a[p]&&!a[p].feedRound&&(a[p].roundIndex=c,c+=1)}),{hasOddMatchUpsCount:!!Object.values(a).find(({matchUpsCount:p})=>!Lr(p)),maxMatchUpsCount:s,roundMatchUps:i,roundNumbers:u,roundProfile:a}}function VU({matchUp:t={}}={}){var e;let r=t.matchUpType;if(!r&&((e=t.sides)!=null&&e.length)){const n=t.sides.find(({participant:s})=>s),o=n==null?void 0:n.participant,i=o==null?void 0:o.participantType;r=i===Ce&&ut||i===we&&ot||i===Ye&&Ye||void 0}return{matchUpType:r}}function zt({drawDefinition:t,structure:e}){const r={},n=[];return((t==null?void 0:t.structures)||[e]).filter(o=>o&&typeof o=="object").forEach(o=>{const{structureId:i,matchUps:s,structures:a}=o,c=Array.isArray(a);if(c)c&&a.forEach(l=>{const{structureName:u}=l,d=l.matchUps;r[l.structureId]={matchUps:d,structureName:u},n.push(...d),d.forEach(p=>{p.tieMatchUps&&n.push(...p.tieMatchUps)}),r[i]||(r[i]={}),r[i].itemStructureIds||(r[i].itemStructureIds=[]),r[i].itemStructureIds.push(l.structureId)});else{const l=s;r[i]={matchUps:l},l.forEach(u=>{n.push(u),u.tieMatchUps&&n.push(...u.tieMatchUps)})}}),{mappedMatchUps:r,drawMatchUps:n}}function ui({mappedMatchUps:t,matchUpsMap:e,structureId:r,inContext:n}){t=(e==null?void 0:e.mappedMatchUps)||t;let o=t[r];const i=((o==null?void 0:o.itemStructureIds)||[]).map(s=>{const{matchUps:a,structureName:c}=t[s];return n?a.map(l=>Object.assign(de(l,!0,!0),{containerStructureId:r,structureId:s,structureName:c})):a}).flat();return((o==null?void 0:o.matchUps)||[]).concat(...i)}function Uc({drawDefinition:t,attributes:e}){let{extension:r}=Zu({name:Ql,drawDefinition:t});const n=(r==null?void 0:r.value)||t.entryProfile||{};return e.forEach(o=>{Object.keys(o).forEach(i=>{n[i]?Object.assign(n[i],o[i]):n[i]=o[i]})}),r={name:Ql,value:n},yv({drawDefinition:t,extension:r}),{entryProfile:n}}function Cc({drawDefinition:t}){let{extension:e}=Zu({name:Ql,drawDefinition:t});return{entryProfile:(e==null?void 0:e.value)||t.entryProfile||{}}}const ue="MAIN",Ie="QUALIFYING",Et="CONSOLATION",Nt="VOLUNTARY_CONSOLATION",it="PLAY_OFF",Av=[ue,Ie,Et,it,Nt],rs={[Ie]:1,[ue]:2,[it]:3,[Et]:3,[Nt]:4},LU="finishingPositions",BU="aggregateEventStructures",xU={[ue]:1,[it]:2,[Et]:3,[Ie]:4,[Nt]:5},Nx={[it]:1,[ue]:2,[Et]:3,[Ie]:4,[Nt]:5},Uv="CLUSTER",$x="SEPARATE",Cv="WATERFALL",nd="ITEM",er="CONTAINER",zr="DRAW",GU="RANDOM",_n="TOP_DOWN",ns="BOTTOM_UP",po="POSITION",fo="WINNER",Kn="LOSER",zn="FIRST_MATCHUP",sn="AD_HOC",_a="FEED_IN",Gs="COMPASS",ks="OLYMPIC",Ax="SINGLE_ELIMINATION",Qn="SINGLE_ELIMINATION",Mc="DOUBLE_ELIMINATION",Ws="FIRST_MATCH_LOSER_CONSOLATION",Dc="FIRST_ROUND_LOSER_CONSOLATION",Pi="LUCKY_DRAW",od="CURTIS_CONSOLATION",Ux="CURTIS_CONSOLATION",Mv="FEED_IN_CHAMPIONSHIP_TO_SF",oc="FEED_IN_CHAMPIONSHIP_TO_SF",Dv="FEED_IN_CHAMPIONSHIP_TO_QF",ic="FEED_IN_CHAMPIONSHIP_TO_QF",jv="FEED_IN_CHAMPIONSHIP_TO_R16",sc="FEED_IN_CHAMPIONSHIP_TO_R16",kU="MODIFIED_FEED_IN_CHAMPIONSHIP",ac="MODIFIED_FEED_IN_CHAMPIONSHIP",jc="FEED_IN_CHAMPIONSHIP",an="ROUND_ROBIN",vo="ROUND_ROBIN_WITH_PLAYOFF",WU="DECIDER",qU="BACKDRAW",Rv={0:{name:"EAST",abbreviation:"E"},"0-1":{name:"WEST",abbreviation:"W"},"0-2":{name:"NORTH",abbreviation:"N"},"0-3":{name:"NORTHEAST",abbreviation:"NE"},"0-1-1":{name:"SOUTH",abbreviation:"S"},"0-1-2":{name:"SOUTHWEST",abbreviation:"SW"},"0-2-1":{name:"NORTHWEST",abbreviation:"NW"},"0-1-1-1":{name:"SOUTHEAST",abbreviation:"SE"}},Fv={0:{name:"EAST",abbreviation:"E"},"0-1":{name:"WEST",abbreviation:"W"},"0-2":{name:"NORTH",abbreviation:"N"},"0-1-1":{name:"SOUTH",abbreviation:"S"}},Ia="WIN_RATIO",di="ROUND_OUTCOME",HU=[Gs,od,ic,sc,oc,jc,Dv,jv,Mv,Ws,Dc,Pi,ac,ks,it,vo],Cx=[sn,Gs,od,Mc,ic,sc,oc,jc,_a,Ws,Dc,Pi,ac,ks,it,an,vo,Qn],Mx={MAIN:ue,QUALIFYING:Ie,CONSOLATION:Et,ITEM:nd,CONTAINER:er,FIRST_MATCHUP:zn,WINNER:fo,LOSER:Kn,AD_HOC:sn,FEED_IN:_a,COMPASS:Gs,PLAY_OFF:it,OLYMPIC:ks,KNOCKOUT:Ax,SINGLE_ELIMINATION:Qn,DOUBLE_ELIMINATION:Mc,CURTIS:od,FICSF:Mv,FICQF:Dv,FICR16:jv,MFIC:kU,VOLUNTARY_CONSOLATION:Nt,FIRST_MATCH_LOSER_CONSOLATION:Ws,FIRST_ROUND_LOSER_CONSOLATION:Dc,MODIFIED_FEED_IN_CHAMPIONSHIP:ac,FEED_IN_CHAMPIONSHIP_TO_R16:sc,FEED_IN_CHAMPIONSHIP_TO_QF:ic,FEED_IN_CHAMPIONSHIP_TO_SF:oc,FEED_IN_CHAMPIONSHIP:jc,LUCKY_DRAW:Pi,ROUND_ROBIN_WITH_PLAYOFF:vo,ROUND_ROBIN:an,DECIDER:WU,BACKDRAW:qU,COMPASS_ATTRIBUTES:Rv,OLYMPIC_ATTRIBUTES:Fv,DRAW:zr,RANDOM:GU,TOP_DOWN:_n,BOTTOM_UP:ns,WATERFALL:Cv,WIN_RATIO:Ia,ROUND_OUTCOME:di,MULTI_STRUCTURE_DRAWS:HU,generatedDrawTypes:Cx,stageOrder:rs,finishOrder:xU,AGGREGATE_EVENT_STRUCTURES:BU,FINISHING_POSITIONS:LU};function yi(t,e,r={}){var n,o;const i=v=>{var f,m;return(m=(f=Lt({element:v,name:Dn}))==null?void 0:f.extension)==null?void 0:m.value},s=r==null?void 0:r.deprioritizeCompleted,a=(r==null?void 0:r.mode)===BU&&Nx,c=(r==null?void 0:r.mode)===LU&&xU,l=c||a||rs,u=v=>(v==null?void 0:v.stage)===ue&&(v==null?void 0:v.stageSequence)===1,d=v=>u(v)?-1:l[v==null?void 0:v.stage],p=v=>v==null?void 0:v.matchUps.every(({matchUpStatus:f})=>Rt.includes(f)?1:-1);return s&&p(t)-p(e)||a&&d(t)-d(e)||(l[t==null?void 0:t.stage]||0)-(l[e==null?void 0:e.stage]||0)||(i(t)||0)-(i(e)||0)||!c&&!a&&(((n=e==null?void 0:e.positionAssignments)==null?void 0:n.length)||1/0)-(((o=t==null?void 0:t.positionAssignments)==null?void 0:o.length)||1/0)||((t==null?void 0:t.stageSequence)||0)-((e==null?void 0:e.stageSequence)||0)||(p_(t)||0)-(p_(e)||0)}function p_(t){return((t==null?void 0:t.matchUps)||[]).reduce((e,r)=>{var n;const o=(((n=r.finishingPositionRange)==null?void 0:n.winner)||[]).reduce((i,s)=>i+s,0);return!e||o<e?o:e},void 0)}function Te({drawDefinition:t,structureId:e}){if(!t)return{error:pe};if(!e)return{error:ur};const{structures:r}=Ur({drawDefinition:t}),n=r.map(s=>s.structures?[].concat(...s.structures,s):s).flat(),o=n.find(s=>s.structureId===e);if(!o)return{error:xr};const i=o.structureType===nd&&n.find(s=>{var a;return(a=s.structures)==null?void 0:a.some(c=>c.structureId===e)});return{structure:o,containingStructure:i}}function Ur({withStageGrouping:t,drawDefinition:e,stageSequences:r,stageSequence:n,roundTarget:o,sortConfig:i,stages:s,stage:a}){var c;const l=!e&&pe||!e.structures&&uR||void 0;if(l)return k({result:{error:l},stack:"getDrawStructure"});const u=m=>{var g,h;const _=(h=(g=Lt({element:m,name:Dn}))==null?void 0:g.extension)==null?void 0:h.value;return!o||o===_},d=(c=e.structures)==null?void 0:c.filter(v).filter(f).filter(u).sort((m,g)=>yi(m,g,i)),p=t&&Object.assign({},...Av.map(m=>{const g=d.filter(h=>h.stage===m);return g.length&&{[m]:g}}).filter(Boolean));return{structures:d,stageStructures:p};function v(m){return!a&&!Array.isArray(s)||a&&m.stage===a||Array.isArray(s)&&s.includes(m.stage)}function f(m){return!n&&!Array.isArray(r)||n&&m.stageSequence===n||Array.isArray(r)&&r.includes(m.stageSequence)}}const rn="ALTERNATE",id="CONFIRMED",Cr="DIRECT_ACCEPTANCE",Rc="FEED_IN",sd="JUNIOR_EXEMPT",Fo="LUCKY_LOSER",ad="ORGANISER_ACCEPTANCE",cd="QUALIFIER",Dx="REGISTERED",ld="SPECIAL_EXEMPT",Wr="UNGROUPED",fs="UNPAIRED",qs="WILDCARD",Vo="WITHDRAWN",vp=[id,Cr,sd,ad,ld],jx=[Rc,Fo,cd],vs=[id,Cr,Rc,sd,ad,ld,qs],Ko=[id,Cr,Rc,sd,Fo,cd,ad,ld,qs],Rx=[rn,id,Cr,Rc,sd,Fo,ad,cd,Dx,ld,Wr,fs,qs,Vo],YU=Ko;function Fc({stage:t,drawDefinition:e}){const{entryProfile:r}=Cc({drawDefinition:e}),n=Object.keys(r).includes(t);if(!n&&Av.includes(t)){const o=[{[t]:{drawSize:void 0,alternates:!0}}];return Uc({drawDefinition:e,attributes:o}),!0}return n}function Fx({stage:t,drawDefinition:e}){var r;const{entryProfile:n}=Cc({drawDefinition:e});return((r=n[t])==null?void 0:r.alternates)||0}function Vx({stage:t,drawDefinition:e}){var r;const{entryProfile:n}=Cc({drawDefinition:e});return((r=n[t])==null?void 0:r.wildcardsCount)||0}function eu({stage:t,drawDefinition:e,entryStatus:r}){return e.entries.reduce((n,o)=>o.entryStage===t&&o.entryStatus===r?n+1:n,0)}function ms({provisionalPositioning:t,drawDefinition:e,stageSequence:r,entryStatuses:n,structureId:o,roundTarget:i,stages:s,stage:a}){var c;const l=((c=e.entries)==null?void 0:c.reduce((u,d)=>{var p,v;const f=(v=(p=Lt({name:Dn,element:d}))==null?void 0:p.extension)==null?void 0:v.value,m=a&&d.entryStage===a||(s==null?void 0:s.length)&&s.includes(d.entryStage),g=!n||n.includes(d.entryStatus),h=d.entryStageSequence||1;return m&&(!r||h===r)&&g&&(!i||!f||i===f)?u.concat(d):u},[]))||[];if(o&&a===it){const{playoffEntries:u,error:d}=Lx({provisionalPositioning:t,drawDefinition:e,structureId:o});return d&&console.log("playoff entries error"),u!=null&&u.length?u:l}return l}function Lx({provisionalPositioning:t,drawDefinition:e,structureId:r}){const n=[],o=(e.links||[]).find(i=>i.linkType===po&&i.target.structureId===r);if(o){const{finishingPositions:i,structureId:s}=o.source,{structure:a}=Te({drawDefinition:e,structureId:s});a.structureType===er&&(a.structures||[]).forEach(l=>{const{positionAssignments:u}=l,{structureId:d}=l,p=d,v=Object.assign({},...u.map(h=>{var _;const{participantId:I}=h,P=(_=Lt({element:h,name:Do}).extension)==null?void 0:_.value;return P?{[I]:P}:void 0}).filter(Boolean)),m=Object.keys(v).reduce((h,_)=>{const I=v[_],P=I.groupOrder||t&&I.provisionalOrder;return h.includes(P)||h.push(P),h},[]).length===Object.keys(v).length,g=Object.keys(v).filter(h=>{const _=v[h],I=_.groupOrder||t&&_.provisionalOrder;return i.includes(I)});(!t||m)&&g.forEach(h=>{const _=v[h],{groupOrder:I,provisionalOrder:P,GEMscore:S}=_,y=I||t&&P,O=i.sort().indexOf(y)+1;n.push({entryStage:it,entryStatus:Rc,placementGroup:O,groupingValue:p,participantId:h,GEMscore:S})})})}return{playoffEntries:n}}function KU({stage:t,drawDefinition:e}){return vs.reduce((r,n)=>(eu({drawDefinition:e,entryStatus:n,stage:t})||0)+r,0)}function Bx({stage:t,drawDefinition:e}){return eu({entryStatus:qs,drawDefinition:e,stage:t})}function cn({provisionalPositioning:t,drawDefinition:e,matchUpsMap:r,structureId:n,structure:o}){var i;let s,a=[];if(o||({structure:o,error:s}=Te({drawDefinition:e,structureId:n})),s||!o)return{seedAssignments:[],error:xr};n||(n=o.structureId);const{stage:c,stageSequence:l}=o,d=c===it&&e&&ms({provisionalPositioning:t,drawDefinition:e,stageSequence:l,matchUpsMap:r,structureId:n,stage:c}),p=d?d.filter(f=>f.placementGroup===1).sort((f,m)=>f.GEMscore<m.GEMscore&&1||f.GEMscore>m.GEMscore&&-1||0).map((f,m)=>{const g=m+1;return{participantId:f.participantId,seedValue:g,seedNumber:g,seedProxy:!0}}):[];p.length?a=p:o.seedAssignments?a=o.seedAssignments:s=sR;const v=o.seedLimit||((i=o==null?void 0:o.positionAssignments)==null?void 0:i.length);return{seedAssignments:a,seedLimit:v,stage:c,stageSequence:l,error:s}}function Vv({drawDefinition:t}){if(typeof t!="object")return{error:Bi};const e={},{structures:r=[],links:n=[]}=t||{},o=r.reduce((s,a)=>{const{stage:c}=a;return s[c]?s[c].push(a):s[c]=[a],s},{});for(const s of Object.keys(o)){const a=o[s].find(({stageSequence:u})=>u===1);if(!a)continue;const{structureId:c}=a;i({aggregator:{},targetRound:0,exitProfiles:e,exitProfile:"0",structureId:c,stage:s})}return{exitProfiles:e};function i({exitProfiles:s,exitProfile:a,structureId:c,targetRound:l,aggregator:u,stage:d}){s[c]||(s[c]=[]),a==="0"&&[Et,it].includes(d)||s[c].push(a);const p=n.filter(v=>v.source.structureId===c&&v.source.roundNumber>=l);for(const v of p){const f=v.source.roundNumber,m=v.target.roundNumber,g=v.target.structureId,h=r.find(I=>I.structureId===g).stage,_=[h,g,m,f].join("|");if(u[_])return;u[_]=!0,i({exitProfile:`${a}-${f}`,structureId:g,exitProfiles:s,targetRound:m,aggregator:u,stage:h})}}}function zU({groupedOrder:t,roundPositionsCount:e}){if(!t||(t==null?void 0:t.length)<=e)return t;const n=jt(t,t.length/e).map(i=>i.reduce((s,a)=>s+a)),o=n.slice().sort(Bt);return n.map(i=>o.indexOf(i)+1)}function Ul(t){if(!Array.isArray(t))return"";const e=t.filter(Pt);return e.length?Ve([Math.min(...e),Math.max(...e)]).join("-"):""}function xx({drawDefinition:t,structureId:e,matchUpsMap:r}){if(!t)return{error:pe};if(!e)return{error:ur};const{structure:n}=Te({drawDefinition:t,structureId:e});if(n.stage!==Et)return{error:Go,info:"Structure is not CONSOLATION stage"};const{links:o}=t,i=(o==null?void 0:o.filter(d=>d.target.structureId===e))||[],s=(i==null?void 0:i.reduce((d,p)=>{const{structureId:v}=p.source;return d.includes(v)?d:d.concat(v)},[]))||[],a=Object.assign({},...s.map(d=>{const p=ui({matchUpsMap:r,structureId:d}),{roundProfile:v}=lr({matchUps:p});return{[d]:v}})),c=ui({matchUpsMap:r,structureId:e}),{roundProfile:l}=lr({matchUps:c}),u={};return i==null||i.forEach(d=>{var p;const{structureId:v,roundNumber:f}=d.source,{feedProfile:m,groupedOrder:g,positionInterleave:h,roundNumber:_}=d.target,I=a[v],P=(p=I[1])==null?void 0:p.drawPositions,S=I[f],y=S==null?void 0:S.matchUpsCount;if(!y)return;const O=y?P.length/y:0,b=P.length/O;let E=P.slice();const T=zU({roundPositionsCount:E.length,groupedOrder:g}),N=(T==null?void 0:T.length)||1;if(N<=b){const A=P.length/N,C=jt(E,A);m===ns&&C.forEach(M=>M.reverse()),E=(T==null?void 0:T.length)&&(T==null?void 0:T.map(M=>C[M-1]).flat())||E}let w=jt(E,O);if(!(T!=null&&T.length)&&m===ns&&w.reverse(),h){const A=le(0,h.interleave).map(()=>{}),C=le(0,h.offset).map(()=>{});w=w.map(D=>[D,...A]),w.unshift(C),w=w.flat(1);const M=w.length-h.offset;w=w.slice(0,M)}u[_]||(u[_]={});const $=l[_],U=$!=null&&$.feedRound?2:1;w.forEach((A,C)=>{const M=1+C*U;u[_][M]||(u[_][M]=Ul(A))})}),{sourceDrawPositionRanges:u}}const Lv=t=>e=>t[e],ud=(t=[])=>t.map($t).filter(Boolean),Jn=(t=[])=>t.map(Ze).filter(Boolean),Ze=(t={})=>Lv(t)("participantId"),Gx=(t={})=>Lv(t)("drawPosition"),$t=(t={})=>Lv(t)("matchUpId");function QU({drawDefinition:t}){if(!t)return{error:pe};const e={};return{allPositionedParticipantIds:(t.structures||[]).map(n=>{const o=n.stage;e[o]||(e[o]=[]);const{positionAssignments:i}=Xe({structure:n}),s=Jn(i);return e[o].push(...s),s}).flat(),stagePositionedParticipantIds:e}}function Xe({drawDefinition:t,structureId:e,structure:r}){let n,o=[];if(!r){if(!t)return{positionAssignments:o,error:pe};if({structure:r,error:n}=Te({drawDefinition:t,structureId:e}),n)return{positionAssignments:o,error:n}}return r.structures?o=[].concat(...r.structures.map(i=>Xe({structure:i}).positionAssignments)):r.positionAssignments?o=r.positionAssignments:n=mR,{positionAssignments:o,error:n}}function St({drawDefinition:t,structureId:e,structure:r}){const{positionAssignments:n}=Xe({drawDefinition:t,structureId:e,structure:r}),o=n.filter(l=>l.participantId||l.bye||l.qualifier),i=n.length===o.length,s=n.filter(l=>!l.participantId&&!l.bye&&!l.qualifier),a=n.filter(l=>!l.participantId&&l.bye),c=n.filter(l=>!l.participantId&&l.qualifier);return{byePositions:a,assignedPositions:o,qualifierPositions:c,unassignedPositions:s,positionAssignments:n,allPositionsAssigned:i}}function kx({drawPositions:t,roundProfile:e,roundNumber:r}){const n=[void 0,void 0];if(Qj(t))return{orderedDrawPositions:n,displayOrder:n};const o=e[r],i=o==null?void 0:o.pairedDrawPositions,s=(i==null?void 0:i.find(c=>Gt(c||[],t.filter(Boolean))))||n,a=o==null?void 0:o.feedRound;if(zj(t)){const c=t.sort(Bt);return{orderedDrawPositions:c.length===2?c:s,displayOrder:a?c:s}}if(a){const l=[t.find(u=>!isNaN(parseInt(u))),void 0];return{orderedDrawPositions:l,displayOrder:l}}return{orderedDrawPositions:s,displayOrder:s}}function Wx({drawDefinition:t,roundProfile:e,structureId:r,matchUpsMap:n}){var o;if(!t)return{error:pe};if(!r)return{error:ur};if(!e){const l=ui({matchUpsMap:n,structureId:r});({roundProfile:e}=lr({matchUps:l}))}const s=(Math.min(...((o=e[1])==null?void 0:o.drawPositions)||[])||1)-1,a=Object.keys(e);return{drawPositionsRanges:Object.assign({},...(a||[]).map(l=>{var u;const{matchUpsCount:d}=e[l],p=((u=e[1])==null?void 0:u.drawPositions)||[],v=jt(p,p.length/d),f=v.map(Ul),m=v.map(P=>P.map(S=>S-s)).map(Ul),g=a.map(P=>{if(P>l)return;const{drawPositions:S}=e[P];return jt(S,S.length/d)}).filter(Boolean),h=le(0,d).map(P=>g.map(S=>S[P]).flat().filter(Boolean).sort(Bt)).map(P=>Ve(P)),_=h.map(P=>Kj(P).map(Ul).join(", ")),I=Object.assign({},...le(0,d).map(P=>({[P+1]:{firstRoundDrawPositionsRange:f[P],firstRoundOffsetDrawPositionsRange:m[P],possibleDrawPositions:h[P],drawPositionsRange:_[P]}})));return{[l]:I}}))}}function Bv({matchUp:t}){let e,r=[],n=[],o=[],i=[];if(t||(e=wr),t&&!t.sides&&(e=Gr),t&&!t.hasContext&&(e=qu),!e){r=t.sides.map(c=>c.participantId);const s=t.sides.filter(c=>c.participantType===Ce).map(c=>c.participantId).filter(Boolean);i=t.sides.map(c=>{var l;return(l=c.participant)==null?void 0:l.individualParticipants}).filter(Boolean).map(c=>c.map(l=>l==null?void 0:l.participantId).filter(Boolean)),n=[].concat(...s,...i.flat()).filter(Boolean),o=Ve(n.concat(r)).filter(Boolean)}return{error:e,sideParticipantIds:r,individualParticipantIds:n,allRelevantParticipantIds:o,nestedIndividualParticipantIds:i}}function Vc({matchUp:t}){if(!t)return{error:wr};if(!t.hasContext)return{error:qu};if(!t.sides||t.sides.filter(Boolean).length!==2)return{error:Gr};const{sideParticipantIds:e,nestedIndividualParticipantIds:r,allRelevantParticipantIds:n}=Bv({matchUp:t}),i=(t.timeItems||[]).filter(l=>[pf,ff].includes(l==null?void 0:l.itemType)).sort((l,u)=>new Date(l.createdAt)-new Date(u.createdAt)),a=i.map(l=>l.itemValue).filter(l=>i.filter(u=>(u==null?void 0:u.itemValue)===l).reverse()[0].itemType===pf);return r==null||r.forEach((l,u)=>{const d=e[u],p=(l==null?void 0:l.length)&&l.reduce((v,f)=>v&&f&&a.includes(f),!0);d&&p&&!a.includes(d)&&a.push(d)}),e.forEach((l,u)=>{a.includes(l)&&(r[u]||[]).forEach(d=>{d&&!a.includes(d)&&a.push(d)})}),{allParticipantsCheckedIn:e.reduce((l,u)=>a.includes(u)&&l,!0),checkedInParticipantIds:a,allRelevantParticipantIds:n}}function qx({hasOddMatchUpsCount:t,drawDefinition:e,roundMatchUps:r,structure:n}){var o,i;if(!n)return!1;r||({hasOddMatchUpsCount:t,roundMatchUps:r}=lr({matchUps:n.matchUps||[]}));const s=!!((o=r==null?void 0:r[1])!=null&&o.find(({drawPositions:c})=>c)),a=!((i=r==null?void 0:r[2])!=null&&i.find(({drawPositions:c})=>c));return t&&!(n!=null&&n.structures)&&s&&a&&!(e!=null&&e.drawType&&e.drawType!==Pi)}function mo({drawDefinition:t,structure:e}){var r;return e?!(e!=null&&e.structures)&&!(t!=null&&t.drawType&&t.drawType!==sn)&&!((r=e==null?void 0:e.matchUps)!=null&&r.find(({roundPosition:n})=>!!n)):!1}const JU={[pv]:{policyName:"Round Naming Default",abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q"},stageConstants:{[ue]:"",[it]:"P",[Ie]:"Q",[Et]:"C"}}};function Hx({roundNamingPolicy:t,structure:e,matchUps:r}){const{hasOddMatchUpsCount:n,roundProfile:o,roundMatchUps:i}=lr({matchUps:r}),{structureAbbreviation:s,stage:a}=e,c=mo({structure:e}),l=qx({hasOddMatchUpsCount:n,roundMatchUps:i,structure:e}),u=e.structures,d={},p=JU[pv],v=(t==null?void 0:t.roundNamingMap)||p.roundNamingMap||{},f=(t==null?void 0:t.abbreviatedRoundNamingMap)||p.abbreviatedRoundNamingMap||{},m=(t==null?void 0:t.affixes)||p.affixes,g=a&&a!==ue&&a[0],h=t==null?void 0:t.stageConstants,_=(h==null?void 0:h[a])||g;return u||c||l?Object.assign(d,...Object.keys(o).map(I=>{const P=`Round ${I}`,S=`R${I}`;return{[I]:{roundName:P,abbreviatedRoundName:S}}})):Object.assign(d,...Object.keys(o).map(I=>{const{matchUpsCount:P,preFeedRound:S}=o[I],y=P*2,O=v[P]||`${m.roundNumber}${y}`,b=S?`-${m.preFeedRound}`:"",E=`${O}${b}`,T=[_,s,E].filter(Boolean).join("-"),w=`${f[P]||`${m.roundNumber}${y}`}${b}`,$=[_,s,w].filter(Boolean).join("-");return{[I]:{abbreviatedRoundName:$,roundName:T}}})),{roundNamingProfile:d,roundProfile:o,roundMatchUps:i}}function Vi(t){const{matchUps:e,isCollectionMatchUp:r,excludeMatchUpStatuses:n,matchUpStatuses:o,hasWinningSide:i,matchUpFormats:s,roundPositions:a,matchUpFormat:c,collectionIds:l,isMatchUpTie:u,roundNumbers:d,matchUpIds:p,roundNames:v,stageSequences:f,scheduledDates:m,scheduledDate:g,participantIds:h,processContext:_,tournamentIds:I,matchUpTypes:P,structureIds:S,readyToScore:y,courtIds:O,eventIds:b,venueIds:E,drawIds:T,stages:N,filterMatchUpIds:w=!0,filterMatchUpTypes:$=!0}=t,U=Array.isArray(h)?h.filter(Boolean):[],A=Array.isArray(o)?o.filter(Boolean):[],C=Array.isArray(n)?n.filter(Boolean):[],M=Array.isArray(N)?N.filter(Boolean):[],D=Array.isArray(f)?f.filter(Boolean):[],V=Array.isArray(l)?l.filter(Boolean):[],R=Array.isArray(v)?v.filter(Boolean):[],W=Array.isArray(d)?d.filter(Boolean):[],x=Array.isArray(a)?a.filter(Boolean):[],K=Array.isArray(p)&&w?p.filter(Boolean):[],j=Array.isArray(P)&&$?P.filter(Boolean):[],L=Array.isArray(O)?O.filter(Boolean):[],F=Array.isArray(E)?E.filter(Boolean):[],q=Array.isArray(s)&&s.filter(Boolean)||typeof c=="string"&&[c]||[],G=Array.isArray(m)&&m.filter(Boolean)||typeof g=="string"&&g.length&&[g]||[],H=Array.isArray(I)?I.filter(Boolean):[],Q=Array.isArray(b)?b.filter(Boolean):[],z=Array.isArray(T)?T.filter(Boolean):[],Y=Array.isArray(S)?S.filter(Boolean):[];return e.filter(J=>{var te;if(y&&J.matchUpType!==Qr&&!J.readyToScore||i&&![1,2].includes(J.winningSide)||u!==void 0&&(u&&!J.tieMatchUps||!u&&J.tieMatchUps)||r!==void 0&&(r&&!J.collectionId||!r&&J.collectionId)||M.length&&!M.includes(J.stage)||D.length&&!D.includes(J.stageSequence)||V.length&&!V.includes(J.collectionId)||R.length&&!R.includes(J.roundName)||W.length&&!d.includes(J.roundNumber)||x.length&&!a.includes(J.roundPosition)||A.length&&!A.includes(J.matchUpStatus)||C.length&&C.includes(J.matchUpStatus)||K.length&&!K.includes(J.matchUpId)||j.length&&!j.includes(J.matchUpType)||q.length&&!q.includes(J.matchUpFormat))return!1;if(G!=null&&G.length){const{scheduledTime:ne}=vf({matchUp:J}),{scheduledDate:oe}=li({matchUp:J}),ve=Me(ne)||oe;if(!G.find(X=>qn(X,ve)))return!1}if(L.length){const{courtId:ne}=jU({matchUp:J}),{allocatedCourts:oe}=DU({matchUp:J}),se=oe==null?void 0:oe.map(({courtId:ve})=>ve);if(!O.filter(Boolean).includes(ne)||se!=null&&se.includes(ne))return!1}if(F.length){const{venueId:ne}=RU({matchUp:J});if(!E.filter(Boolean).includes(ne))return!1}if(_){if(H.length&&!H.includes(J.tournamentId)||Q.length&&!Q.includes(J.eventId)||z.length&&!z.includes(J.drawId)||Y.length&&!Y.includes(J.structureId))return!1;if(U.length){const ne=((te=J.sides)==null?void 0:te.map(({participantId:se})=>se).filter(Boolean))||[];if(!U.some(se=>ne.includes(se)))return!1}}return!0})}function Yx({drawPositionCollectionAssignment:t,positionAssignments:e,displaySideNumber:r,seedAssignments:n,drawPosition:o,isFeedRound:i,sideNumber:s}){var a,c,l,u;const d=e.find(h=>h.drawPosition===o),p=t?(a=t[o])==null?void 0:a.participantId:d==null?void 0:d.participantId,v=d?Kx({displaySideNumber:r,seedAssignments:n,participantId:p,assignment:d,sideNumber:s}):{};i&&(s===1?Object.assign(v,{participantFed:!0}):Object.assign(v,{participantAdvanced:!0}));const f=(c=t==null?void 0:t[o])==null?void 0:c.teamParticipant,m=(l=t==null?void 0:t[o])==null?void 0:l.participant,g=(u=t==null?void 0:t[o])==null?void 0:u.substitutions;return m&&Object.assign(v,{participant:m}),g&&Object.assign(v,{substitutions:g}),f&&Object.assign(v,{teamParticipant:f}),v}function Kx({displaySideNumber:t,seedAssignments:e,participantId:r,assignment:n,sideNumber:o}){const i={drawPosition:n.drawPosition,displaySideNumber:t,sideNumber:o};if(r){const s=zx({seedAssignments:e,participantId:r});Object.assign(i,s,{participantId:r})}else n.bye&&Object.assign(i,{bye:!0});return n.qualifier&&Object.assign(i,{qualifier:!0}),i}function zx({seedAssignments:t,participantId:e}){return t==null?void 0:t.find(r=>!r.seedProxy&&r.participantId===e)}const Hs="ANY",at="MALE",go="MIXED",Li="OTHER",vt="FEMALE",ZU={ANY:Hs,MALE:at,FEMALE:vt,MIXED:go,OTHER:Li};var Qx=Object.defineProperty,Jx=Object.defineProperties,Zx=Object.getOwnPropertyDescriptors,f_=Object.getOwnPropertySymbols,Xx=Object.prototype.hasOwnProperty,eG=Object.prototype.propertyIsEnumerable,v_=(t,e,r)=>e in t?Qx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ss=(t,e)=>{for(var r in e||(e={}))Xx.call(e,r)&&v_(t,r,e[r]);if(f_)for(var r of f_(e))eG.call(e,r)&&v_(t,r,e[r]);return t},dl=(t,e)=>Jx(t,Zx(e));function Ke({scheduleVisibilityFilters:t,tournamentAppliedPolicies:e,provisionalPositioning:r,tournamentParticipants:n,afterRecoveryTimes:o,policyDefinitions:i,tournamentRecord:s,seedAssignments:a,drawDefinition:c,contextFilters:l,contextProfile:u,contextContent:d,matchUpFilters:p,participantMap:v,scheduleTiming:f,exitProfiles:m,context:g={},matchUpsMap:h,structure:_,inContext:I,event:P}){var S,y,O,b,E;let T={},N={};if(n=n||(s==null?void 0:s.participants),!_)return{collectionPositionMatchUps:T,error:aa,roundMatchUps:N,matchUps:[]};const w=Array.isArray(p==null?void 0:p.eventIds)?p.eventIds.filter(Boolean):[],$=Array.isArray(p==null?void 0:p.structureIds)?p.structureIds.filter(Boolean):[],U=Array.isArray(p==null?void 0:p.drawIds)?p.drawIds.filter(Boolean):[],A=!(g!=null&&g.eventId)||!w.length&&!((S=l==null?void 0:l.eventIds)!=null&&S.filter(Boolean).length)||w.includes(g.eventId)||((y=l==null?void 0:l.eventIds)==null?void 0:y.includes(g.eventId)),C=!$.length||$.includes(_.structureId),M=!c||!U.length||U.includes(c.drawId);if(!A||!C||!M)return{collectionPositionMatchUps:T,roundMatchUps:N,matchUps:[]};u&&!d&&(d=Io({tournamentRecord:s,contextProfile:u,drawDefinition:c}));const{appliedPolicies:D}=ct({drawDefinition:c}),V=Object.assign({},e,D,i),R=(O=V==null?void 0:V.scoring)==null?void 0:O.structures,W=(R==null?void 0:R.stage)&&(R==null?void 0:R.stage[_.stage]),x=(W==null?void 0:W.stageSequence)&&W.stageSequence[_.stageSequence],K=((b=V==null?void 0:V.scoring)==null?void 0:b.requireAllPositionsAssigned)||(W==null?void 0:W.requireAllPositionsAssigned)||(x==null?void 0:x.requireAllPositionsAssigned);h||(h=zt({drawDefinition:c,structure:_}));const{positionAssignments:j,allPositionsAssigned:L}=St({structure:_}),F=!K||L,{seedAssignments:q}=cn({provisionalPositioning:r,drawDefinition:c,matchUpsMap:h,structure:_,event:P});a=a||q;const{roundOffset:G,structureId:H,structureName:Q,stage:z,stageSequence:Y}=_,{drawId:J,drawName:te,drawType:ne}=c||{};m=m||c&&Vv({drawDefinition:c}).exitProfiles;const oe=m==null?void 0:m[H],se=(oe==null?void 0:oe.length)&&(oe[0].split("-").map(me=>parseInt(me)).reduce((me,Oe)=>me+Oe)||0),ve=!!_.structures;let X=ui({matchUpsMap:h,structureId:H,inContext:I});const ie=V==null?void 0:V[pv],fe=Hx({roundNamingPolicy:ie,drawDefinition:c,structure:_,matchUps:X}),{roundNamingProfile:Ee,roundProfile:re}=fe;if(N=fe.roundMatchUps,p&&(X=Vi(dl(Ss({matchUps:X},p),{filterMatchUpTypes:!1,filterMatchUpIds:!1}))),I){const{sourceDrawPositionRanges:me}=xx({drawDefinition:c,matchUpsMap:h,structureId:H}),{drawPositionsRanges:Oe}=Wx({drawDefinition:c,roundProfile:re,matchUpsMap:h,structureId:H});X=X.map(Pe=>ae({scheduleVisibilityFilters:t,sourceDrawPositionRanges:me,drawPositionsRanges:Oe,roundNamingProfile:Ee,initialRoundOfPlay:se,appliedPolicies:V,isRoundRobin:ve,roundProfile:re,matchUp:Pe,event:P})),(X==null?void 0:X.filter(Pe=>Array.isArray(Pe.tieMatchUps))).forEach(Pe=>{const $e=Pe.tieMatchUps;X=X.concat(...$e)}),l&&(X=Vi(dl(Ss({processContext:!0},l),{matchUps:X})))}else(X==null?void 0:X.filter(Oe=>Array.isArray(Oe.tieMatchUps))).forEach(Oe=>{const ce=Oe.tieMatchUps;X=X.concat(...ce)});return p&&(X=Vi(dl(Ss({matchUps:X},p),{filterMatchUpTypes:!1,filterMatchUpIds:!1}))),(p!=null&&p.matchUpTypes||p!=null&&p.matchUpIds)&&(X=Vi({matchUpTypes:p.matchUpTypes,matchUpIds:p.matchUpIds,matchUps:X})),(p!=null&&p.matchUpTypes||p!=null&&p.matchUpIds||I)&&({roundMatchUps:N}=lr({matchUps:X})),(E=Zt({drawDefinition:c,structure:_,event:P}))!=null&&E.tieFormat&&({collectionPositionMatchUps:T}=zV({matchUps:X})),{matchUps:X,roundMatchUps:N,roundProfile:re,collectionPositionMatchUps:T};function ae({scheduleVisibilityFilters:me,sourceDrawPositionRanges:Oe,additionalContext:ce={},drawPositionsRanges:Pe,roundNamingProfile:$e,initialRoundOfPlay:ye,tieDrawPositions:Ae,appliedPolicies:be,isCollectionBye:ge,matchUpTieId:Ne,isRoundRobin:Ue,roundProfile:he,sideLineUps:xe,matchUp:De,event:Je}){var rt,He,bt,Qt,Wt,ro,Rn,Qo,Sg,bg,Tg,Eg,wg,Ng,$g;const Xd=(rt=Zt({drawDefinition:c,structure:_,matchUp:De,event:Je}))==null?void 0:rt.tieFormat,Ag=Xd==null?void 0:Xd.collectionDefinitions,Hr=De.collectionId&&(Ag==null?void 0:Ag.find(Jt=>Jt.collectionId===De.collectionId)),al=De.collectionId?Hr==null?void 0:Hr.matchUpFormat:De.matchUpFormat||_.matchUpFormat||(c==null?void 0:c.matchUpFormat)||(Je==null?void 0:Je.matchUpFormat),ep=De.matchUpType||(Hr==null?void 0:Hr.matchUpType)||_.matchUpType||(c==null?void 0:c.matchUpType)||(Je==null?void 0:Je.eventType)!==yt&&(Je==null?void 0:Je.eventType),mj=ge?qe:De.matchUpStatus,{schedule:gj,endDate:hj}=$v({scheduleVisibilityFilters:me,afterRecoveryTimes:o,tournamentRecord:s,scheduleTiming:f,matchUpFormat:al,matchUpType:ep,matchUp:De,event:Je}),Aa=Ae||De.drawPositions,{collectionPosition:_j,collectionId:Ij,roundPosition:tp}=De,fn=De.roundNumber||ce.roundNumber,Pj=wx({tournamentParticipants:n,positionAssignments:j,collectionPosition:_j,drawDefinition:c,participantMap:v,drawPositions:Aa,collectionId:Ij,sideLineUps:xe,matchUpType:ep}),Ug=((He=$e==null?void 0:$e[fn])==null?void 0:He.roundName)||ce.roundName,Cg=((bt=$e==null?void 0:$e[fn])==null?void 0:bt.abbreviatedRoundName)||ce.abbreviatedRoundName,yj=(Qt=he==null?void 0:he[fn])==null?void 0:Qt.feedRound,Oj=(Wt=he==null?void 0:he[fn])==null?void 0:Wt.preFeedRound,Sj=(ro=he==null?void 0:he[fn])==null?void 0:ro.roundFactor,Mg=Pe==null?void 0:Pe[fn],bj=Mg==null?void 0:Mg[tp],Dg=Oe==null?void 0:Oe[fn],Tj=Hr!=null&&Hr.category?Object.assign({},(g==null?void 0:g.category)||{},Hr.category):g==null?void 0:g.category,Ej=((Rn=De.processCodes)==null?void 0:Rn.length)&&De.processCodes||((Qo=Hr==null?void 0:Hr.processCodes)==null?void 0:Qo.length)&&(Hr==null?void 0:Hr.processCodes)||((Sg=_.processCodes)==null?void 0:Sg.length)&&_.processCodes||((bg=c==null?void 0:c.processCodes)==null?void 0:bg.length)&&(c==null?void 0:c.processCodes)||((Tg=Je==null?void 0:Je.processCodes)==null?void 0:Tg.length)&&(Je==null?void 0:Je.processCodes)||(s==null?void 0:s.processCodes),wj=(u==null?void 0:u.withCompetitiveness)&&iU(dl(Ss({},d),{matchUp:De})).competitiveness,Nj=De.finishingPositionRange||ce.finishingPositionRange,cl=Jt=>_e(Jt,void 0,!0),ft=Object.assign({},cl(g),cl({matchUpFormat:De.matchUpType===yt?void 0:al,tieFormat:De.matchUpType!==yt?void 0:Xd,roundOfPlay:z!==Ie&&lt(ye)&&ye+(fn||0),endDate:De.endDate||hj,gender:Hr==null?void 0:Hr.gender,discipline:Je==null?void 0:Je.discipline,category:Tj,finishingPositionRange:Nj,abbreviatedRoundName:Cg,drawPositionsRange:bj,competitiveness:wj,structureName:Q,stageSequence:Y,drawPositions:Aa,matchUpStatus:mj,processCodes:Ej,isRoundRobin:Ue,matchUpTieId:Ne,preFeedRound:Oj,matchUpType:ep,roundFactor:Sj,roundOffset:G,structureId:H,roundNumber:fn,feedRound:yj,roundName:Ug,drawName:te,drawType:ne,schedule:gj,drawId:J,stage:z}),de(cl(De),!0,!0));if(al&&((Eg=De.score)!=null&&Eg.scoreStringSide1)){const Jt=Ir(al),{bestOf:no,finalSetFormat:Or,setFormat:st}=Jt||{};(Or!=null&&Or.tiebreakSet||st!=null&&st.tiebreakSet||st!=null&&st.timed)&&(ft.score.sets=ft.score.sets.sort((qt,or)=>qt.setNumber-or.setNumber).map((qt,or)=>(or+1===no?(Or!=null&&Or.tiebreakSet||Or!=null&&Or.timed)&&(qt.tiebreakSet=!0):(st!=null&&st.tiebreakSet||st!=null&&st.timed)&&(qt.tiebreakSet=!0),qt)))}if(Array.isArray(Aa)){const{orderedDrawPositions:Jt,displayOrder:no}=kx({drawPositions:Aa,roundPosition:tp,roundProfile:he,roundNumber:fn}),Or=(wg=he[fn])==null?void 0:wg.feedRound,st=no[0]!==Jt[0],or=Jt.concat(void 0,void 0).slice(0,2).map((Sr,Yr)=>{var br;const So=Yr+1,rp=st?3-So:So,ll=Yx({drawPositionCollectionAssignment:Pj,positionAssignments:j,displaySideNumber:rp,seedAssignments:a,drawPosition:Sr,isFeedRound:Or,sideNumber:So}),Aj=(br=De.sides)==null?void 0:br.find(Mj=>Mj.sideNumber===So),Uj=(tp-1)*2+Yr+1,Cj=Dg==null?void 0:Dg[Uj];return cl(Ss(Ss({sourceDrawPositionRange:Cj},Aj),ll))});Object.assign(ft,de({sides:or},!0,!0))}if(n&&ft.sides){const Jt=i==null?void 0:i[Sc],no=st=>{var qt;const or=(qt=v==null?void 0:v[st])==null?void 0:qt.participant;return or&&Yu({template:Jt==null?void 0:Jt.participant,source:or})};if(ft.sides.filter(Boolean).forEach(st=>{var qt,or,Sr;if(st.participantId){const Yr=de(no(st.participantId)||uo({policyDefinitions:be,participantId:st.participantId,tournamentParticipants:n,internalUse:!0,contextProfile:u}),void 0,!0);if(Yr){if(c!=null&&c.entries){const br=c.entries.find(So=>So.participantId===st.participantId);br!=null&&br.entryStatus&&(Yr.entryStatus=br.entryStatus),br!=null&&br.entryStage&&(Yr.entryStage=br.entryStage)}Object.assign(st,{participant:Yr})}}if((or=(qt=st==null?void 0:st.participant)==null?void 0:qt.individualParticipantIds)!=null&&or.length&&!((Sr=st.participant.individualParticipants)!=null&&Sr.length)){const Yr=st.participant.individualParticipantIds.map(br=>no(br)||uo({policyDefinitions:be,tournamentParticipants:n,internalUse:!0,contextProfile:u,participantId:br}));Object.assign(st.participant,{individualParticipants:Yr})}}),!ft.matchUpType){const{matchUpType:st}=VU({matchUp:ft});st&&Object.assign(ft,{matchUpType:st})}if((u==null?void 0:u.inferGender)&&(!ft.gender||ft.gender===go)&&((Ng=ft.sides)==null?void 0:Ng.length)===2&&ft.matchUpType!==yt){const st=ft.sides.map(qt=>{var or,Sr,Yr,br;if(ft.matchUpType===ut)return(Sr=(or=qt.participant)==null?void 0:or.person)==null?void 0:Sr.sex;if(((br=(Yr=qt.participant)==null?void 0:Yr.individualParticipants)==null?void 0:br.length)===2){const So=Ve(qt.participant.individualParticipants.map(rp=>{var ll;return(ll=rp.person)==null?void 0:ll.sex})).filter(Boolean);if(So.length===1)return So[0]}});if(st.filter(Boolean).length===2&&Ve(st).length===1){const qt=st[0];ft.inferredGender=qt}}}if(ft.tieMatchUps){const Jt=ft.matchUpStatus===qe,no=($g=ft.sides)==null?void 0:$g.map(({participant:Or,drawPosition:st,sideNumber:qt,lineUp:or})=>{const Sr=(Or==null?void 0:Or.participantType)===yt&&Or;return{teamParticipant:Sr&&_e({participantRoleResponsibilities:Sr.participantRoleResponsibilities,participantOtherName:Sr.participanOthertName,participantName:Sr.participantName,participantId:Sr.participantId,teamId:Sr.teamId}),drawPosition:st,sideNumber:qt,lineUp:or}});ft.tieMatchUps=ft.tieMatchUps.map(Or=>{const st=ft.matchUpId,or={finishingPositionRange:ft.finishingPositionRange,abbreviatedRoundName:Cg,roundNumber:fn,roundName:Ug};return ae({tieDrawPositions:Aa,scheduleVisibilityFilters:me,sourceDrawPositionRanges:Oe,sideLineUps:no,drawPositionsRanges:Pe,initialRoundOfPlay:ye,roundNamingProfile:$e,additionalContext:or,appliedPolicies:be,isCollectionBye:Jt,matchUpTieId:st,isRoundRobin:Ue,roundProfile:he,matchUp:Or,event:Je})})}const jg=ft.sides&&ft.sides.filter(Jt=>Jt==null?void 0:Jt.participantId).length===2,$j=!ft.winningSide;if(Object.assign(ft,{readyToScore:F&&jg&&$j,hasContext:!0}),jg){const{allParticipantsCheckedIn:Jt,checkedInParticipantIds:no}=Vc({matchUp:ft});Object.assign(ft,{allParticipantsCheckedIn:Jt,checkedInParticipantIds:no})}return Array.isArray(u==null?void 0:u.exclude)&&u.exclude.forEach(Jt=>delete ft[Jt]),ft}}function tG(t){return Object.assign(t,{inContext:!0}),{matchUp:de(nt(t).matchUp,!1,!0)}}function nt({tournamentParticipants:t,afterRecoveryTimes:e,contextContent:r,contextProfile:n,drawDefinition:o,matchUpsMap:i,matchUpId:s,inContext:a,context:c,event:l}){if(!o)return{error:pe};if(!s)return{error:Ut};if(typeof s!="string")return{error:Z};const{structures:u=[]}=Ur({drawDefinition:o});n&&!r&&(r=Io({contextProfile:n,drawDefinition:o}));for(const d of u){const{matchUps:p}=Ke({tournamentParticipants:t,afterRecoveryTimes:e,contextContent:r,drawDefinition:o,contextProfile:n,matchUpsMap:i,inContext:a,structure:d,context:c,event:l}),{matchUp:v}=tU({matchUps:p,matchUpId:s});if(v)return{matchUp:v,structure:d}}return{error:kr}}var rG=Object.defineProperty,nG=Object.defineProperties,oG=Object.getOwnPropertyDescriptors,m_=Object.getOwnPropertySymbols,iG=Object.prototype.hasOwnProperty,sG=Object.prototype.propertyIsEnumerable,g_=(t,e,r)=>e in t?rG(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,aG=(t,e)=>{for(var r in e||(e={}))iG.call(e,r)&&g_(t,r,e[r]);if(m_)for(var r of m_(e))sG.call(e,r)&&g_(t,r,e[r]);return t},cG=(t,e)=>nG(t,oG(e));function XU({collectionGroups:t=[]}={}){const e=Object.assign({},...t.filter(n=>(n==null?void 0:n.groupValue)&&(n==null?void 0:n.groupNumber)).map(n=>({[n.groupNumber]:cG(aG({},n),{allGroupMatchUpsCompleted:!0,matchUpsCount:0,sideWins:[0,0],values:[0,0]})}))),r=Object.keys(e).map(n=>parseInt(n));return{groupValueGroups:e,groupValueNumbers:r}}function Lc({sideAdjustments:t=[0,0],separator:e="-",drawDefinition:r,matchUpsMap:n,structure:o,tieFormat:i,matchUp:s,event:a}){var c,l,u;if(!Array.isArray(t)||t.length!==2||isNaN(t.reduce((y,O)=>y+O)))return{error:Z};if(!s)return{error:wr};if(i=((c=Zt({matchUp:s,drawDefinition:r,structure:o,event:a}))==null?void 0:c.tieFormat)||i,!i)return{error:Gu};const d=cr({tieFormat:i});if(d.error)return d;const p=(i==null?void 0:i.collectionDefinitions)||[],v=(s==null?void 0:s.tieMatchUps)||[],f=[0,0],{groupValueGroups:m,groupValueNumbers:g}=XU(i);for(const y of p)BV({collectionDefinition:y,groupValueNumbers:g,groupValueGroups:m,sideTieValues:f,tieMatchUps:v});for(const y of g){const O=m[y];let{allGroupMatchUpsCompleted:b,groupValue:E,matchUpCount:T,sideWins:N,winCriteria:w,values:$}=O,U;if(w!=null&&w.aggregateValue)b&&$[0]!==$[1]&&(U=$[0]>$[1]?1:2);else if(w!=null&&w.valueGoal)U=$.reduce((A,C,M)=>C>=w.valueGoal?M+1:A,void 0);else{const A=Math.floor(T/2)+1;U=N.reduce((C,M,D)=>M>=A?D+1:C,void 0)}U&&(f[U-1]+=E)}const h=f.map((y,O)=>y+t[O]),_={side1Score:h[0],side2Score:h[1]},I=h.join(e),P=h.slice().reverse().join(e);let S;if(i!=null&&i.winCriteria){const{valueGoal:y,aggregateValue:O,tallyDirectives:b}=i.winCriteria;if(y){const E=h.map((T,N)=>({sideNumber:N+1,points:T})).find(({points:T})=>T>=y);S=E==null?void 0:E.sideNumber}else O&&v.every(T=>Rt.includes(T.matchUpStatus)||T.winningSide)&&h[0]!==h[1]&&(S=h[0]>h[1]?1:2);if(!S&&b){const E=s.matchUpId,T=s.hasContext?s:(n==null?void 0:n.matchUpId)||((l=nt({inContext:!0,drawDefinition:r,matchUpId:E}))==null?void 0:l.matchUp);if(T){const{completedTieMatchUps:N,order:w}=vv({matchUps:[T]});if(N&&w.length){const $=w[0].participantId;S=(u=T.sides.find(({participantId:U})=>U===$))==null?void 0:u.sideNumber}}}}return S&&(_.winningSide=S),{scoreStringSide1:I,scoreStringSide2:P,winningSide:S,set:_}}function ln(t){return de(t,!1,!0)}function At({matchUp:t,score:e}={}){var r,n;e=e||(t==null?void 0:t.score);const o=(r=e==null?void 0:e.sets)==null?void 0:r[0],{side1Score:i,side2Score:s,side1TiebreakScore:a,side2TiebreakScore:c,side1PointScore:l,side2PointScore:u}=o||{},d=i||s||a||c||l||u;return!!(((n=e==null?void 0:e.sets)==null?void 0:n.length)>1||d)}function Bc({matchUpStatus:t}){return pV.includes(t)}function lG({matchUpStatus:t}){return GA.includes(t)}function mf({matchUpStatus:t}){return fV.includes(t)}function xv({matchUpStatus:t,winningSide:e,tieMatchUps:r,sides:n,score:o}){var i;const s=n==null?void 0:n.find(({participantId:l})=>l),a=(i=r==null?void 0:r.filter(xv))==null?void 0:i.length;return At({score:o})||a||e&&s||lG({matchUpStatus:t})&&![Be,Ge,dn].includes(t)}var uG=Object.defineProperty,h_=Object.getOwnPropertySymbols,dG=Object.prototype.hasOwnProperty,pG=Object.prototype.propertyIsEnumerable,__=(t,e,r)=>e in t?uG(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,e1=(t,e)=>{for(var r in e||(e={}))dG.call(e,r)&&__(t,r,e[r]);if(h_)for(var r of h_(e))pG.call(e,r)&&__(t,r,e[r]);return t};function Gv({element:t,notes:e}={}){return typeof t!="object"?{error:Z}:e?typeof e!="string"&&!(e!=null&&e.testing)?{error:Z}:(Object.assign(t,{notes:e}),e1({},B)):{error:Se}}function fG({element:t}={}){return typeof t!="object"?{error:Z}:(t.notes&&delete t.notes,e1({},B))}function dd(t,e){var r;if(!t)return;let n=Date.now();n===new Date(t.updatedAt).getTime()&&(n+=1);const o=new Date(n).toISOString(),i=e==null?void 0:e.filter(Boolean);t.updatedAt=o,(r=t.structures)==null||r.filter(Boolean).forEach(s=>{(!(i!=null&&i.length)||i!=null&&i.includes(s.structureId))&&(s.updatedAt=o)})}function pi({drawDefinition:t,tournamentId:e,matchUps:r,eventId:n}){t&&dd(t),Le({payload:{matchUps:r,tournamentId:e,eventId:n},topic:Tv})}function Oi({drawDefinition:t,tournamentId:e,matchUpIds:r,eventId:n,action:o}){t&&dd(t),Le({topic:PU,payload:{tournamentId:e,matchUpIds:r,eventId:n,action:o}});for(const i of r)MA({key:i})}function ze({drawDefinition:t,tournamentId:e,structureId:r,context:n,eventId:o,matchUp:i}){if(!i)return console.log(wr),{error:wr};t&&Qe({structureIds:[r],drawDefinition:t,tournamentId:e,eventId:o}),Le({topic:OU,payload:{matchUp:i,tournamentId:e,context:n},key:i.matchUpId})}function vG({tournamentId:t,inContextMatchUp:e}){if(!e)return{error:wr};Le({topic:Ev,payload:{inContextMatchUp:e,tournamentId:t},key:e.matchUpId})}function xc({tournamentId:t,eventId:e,drawDefinition:r}){if(!r)return console.log(pe),{error:pe};dd(r),Le({payload:{drawDefinition:r,tournamentId:t,eventId:e},topic:vU,key:r.drawId})}function mG({tournamentId:t,eventId:e,drawId:r}){Le({payload:{drawId:r,tournamentId:t,eventId:e},topic:IU,key:r}),MA({key:r})}function Qe({drawDefinition:t,tournamentId:e,structureIds:r,eventId:n}){if(!t)return{error:pe};dd(t,r),Le({payload:{tournamentId:e,eventId:n,drawDefinition:t},topic:yU,key:t.drawId})}function t1({drawDefinition:t,tournamentId:e,structure:r,eventId:n}){if(!t)return{error:pe};if(!r)return{error:aa};const o=r.seedAssignments,i=r.structureId,s=t.drawId;Le({payload:{tournamentId:e,eventId:n,drawId:s,structureId:i,seedAssignments:o},topic:bU,key:t.drawId}),Qe({sructureIds:[i],drawDefinition:t,tournamentId:e,eventId:n})}function Lo({drawDefinition:t,tournamentId:e,structure:r,event:n}){if(!t)return{error:pe};if(!r)return{error:aa};const o=Xe({structure:r}),i=r.structureId,s=t.drawId,a=n==null?void 0:n.eventId;Le({topic:SU,payload:{positionAssignments:o,tournamentId:e,structureId:i,eventId:a,drawId:s},key:i}),Qe({sructureIds:[i],drawDefinition:t,tournamentId:e,eventId:a})}const pd=t=>t==null?void 0:t.participantId;function gG({positionAssignments:t}){const e=(t||[]).filter(pd).map(i=>{const{extension:s}=Lt({element:i,name:xs}),a=parseInt(s==null?void 0:s.value),c=!isNaN(a)&&a;return c&&{participantId:i.participantId,subOrder:c}}).filter(Boolean),r=e.map(({subOrder:i})=>i),n=fr(r);return{subOrderMap:Object.assign({},...e.filter(({subOrder:i})=>n[i]===1).map(({participantId:i,subOrder:s})=>({[i]:s})))}}var hG=Object.defineProperty,_G=Object.defineProperties,IG=Object.getOwnPropertyDescriptors,I_=Object.getOwnPropertySymbols,PG=Object.prototype.hasOwnProperty,yG=Object.prototype.propertyIsEnumerable,P_=(t,e,r)=>e in t?hG(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,OG=(t,e)=>{for(var r in e||(e={}))PG.call(e,r)&&P_(t,r,e[r]);if(I_)for(var r of I_(e))yG.call(e,r)&&P_(t,r,e[r]);return t},SG=(t,e)=>_G(t,IG(e));function r1({positionAssignments:t,tournamentRecord:e,drawDefinition:r,matchUpFormat:n,matchUps:o,event:i}){if(!Array.isArray(o))return{error:Z};if(!t)return{error:Z};const{policyDefinitions:s}=ls({policyTypes:[QA],tournamentRecord:e,drawDefinition:r,event:i}),{subOrderMap:a}=gG({positionAssignments:t}),c=vv({policyDefinitions:s,matchUpFormat:n,subOrderMap:a,matchUps:o});if(c.error)return c;const{participantResults:l,bracketComplete:u,report:d}=c,p=Object.keys(l);return t.forEach(v=>{const{participantId:f}=v;if(p.includes(f)){let m={value:l[f],name:Do};et({element:v,extension:m}),l[f].ties||tn({element:v,name:xs})}else tn({element:v,name:Do}),tn({element:v,name:xs})}),Qe({drawDefinition:r}),SG(OG({},B),{participantResults:l,bracketComplete:u,report:d})}function kv({participantsProfile:t,participants:e=[]}){const r=de(e,t==null?void 0:t.convertExtensions,!0),n=r.filter(s=>s.participantType===Ye),o=r.filter(s=>s.participantType===dr),i=r.filter(s=>s.participantType===we);return r.forEach(s=>{if(s.participantType===Ce){const{participantId:a}=s;s.groupParticipantIds=[],s.teamParticipantIds=[],s.pairParticipantIds=[],s.groups=[],s.teams=[],n.forEach(c=>{((c==null?void 0:c.individualParticipantIds)||[]).forEach(l=>{var u;l===a&&!((u=s.teamParticipantIds)!=null&&u.includes(c.participantId))&&(s.teamParticipantIds.push(c.participantId),s.teams.push({participantRoleResponsibilities:c.participantRoleResponsibilities,participantOtherName:c.participantOtherName,participantName:c.participantName,participantId:c.participantId,teamId:c.teamId}))})}),i.forEach(c=>{((c==null?void 0:c.individualParticipantIds)||[]).forEach(l=>{l===a&&!s.pairParticipantIds.includes(c.participantId)&&s.pairParticipantIds.push(c.participantId)})}),o.forEach(c=>{((c==null?void 0:c.individualParticipantIds)||[]).forEach(l=>{l===a&&!s.groupParticipantIds.includes(c.participantId)&&(s.groupParticipantIds.push(c.participantId),s.groups.push({participantRoleResponsibilities:c.participantRoleResponsibilities,participantOtherName:c.participantOtherName,participantName:c.participantName,participantId:c.participantId}))})})}}),r}function bG({structureMatchUps:t,matchUp:e}){const{roundNumber:r,roundPosition:n}=e,o=t.filter(s=>s.roundNumber===r&&!s.matchUpTieId),i=t.filter(s=>s.roundNumber===r+1&&!s.matchUpTieId);if(i.length){let s;return i.length===o.length?s=i.find(a=>a.roundPosition===n):i.length===o.length/2&&(s=i.find(a=>a.roundPosition===Math.ceil(n/2))),{matchUp:s}}return{message:"no progression found"}}function mp({sourceRoundMatchUpCount:t,inContextDrawMatchUps:e,sourceRoundPosition:r,drawDefinition:n,targetLink:o}){var i;if(!o)return{error:sA};const{target:{structureId:s,feedProfile:a,groupedOrder:c,roundNumber:l,positionInterleave:u}}=o,{structure:d}=Te({drawDefinition:n,structureId:s}),{positionAssignments:p}=Xe({structure:d}),f=(e==null?void 0:e.filter(N=>N.structureId===d.structureId)).filter(N=>N.roundNumber===l&&!N.matchUpTieId),m=f.length,g=le(1,m+1),h=m/t;let _=Math.ceil(h*r),I=1-r%2;if(u!=null&&u.interleave&&h!==.5){const N=u.offset+(r-1)*u.interleave,w=r+N;_=Math.ceil(w/2),I=1-w%2}let P=g,S=g[_-1];const y=zU({groupedOrder:c,roundPositionsCount:g.length}),O=(y==null?void 0:y.length)||1;if(O<=g.length){const N=m/O,w=jt(g,N);a===ns&&w.forEach($=>$.reverse()),P=(y==null?void 0:y.length)&&(y==null?void 0:y.map($=>w[$-1]).flat())||P}a===_n?S=P[_-1]:a===ns?((!(y!=null&&y.length)||O>g.length)&&(_=f.length+1-_),S=P[_-1]):a===GU&&Ct()&&console.log($A,{feedProfile:a});const b=S&&f.reduce((N,w)=>w.roundPosition===S?w:N,void 0);let E;b!=null&&b.feedRound?(I=0,E=Math.min(...(b.drawPositions||[]).filter(Boolean))):E=((i=b==null?void 0:b.drawPositions)==null?void 0:i.length)===2&&(b==null?void 0:b.drawPositions[I]);const T=p.find(({drawPosition:N})=>N===E);if(T){const{extension:N}=Lt({element:T,name:Qu});if(N!=null&&N.value)return{disabledDrawPosition:E}}return{matchUp:b,targetDrawPosition:E,matchUpDrawPositionIndex:I}}function TG({drawDefinition:t,roundNumber:e,structureId:r}){if(!t)return{error:pe};if(!r)return{error:ur};const{links:n}=Gc({drawDefinition:t,structureId:r}),o=n.source.reduce((s,a)=>!a.source.roundNumber||a.source.roundNumber===e?s.concat(a):s,[]),i=n.target.reduce((s,a)=>!a.target.roundNumber||a.target.roundNumber===e?s.concat(a):s,[]);return{links:{source:o,target:i}}}function gp({finishingPositions:t,linkCondition:e,linkType:r,source:n}){var o;const i=n.find(s=>{var a,c;const l=!((a=s.source)!=null&&a.finishingPositions)||!t||Gt(t,(c=s.source)==null?void 0:c.finishingPositions);return e===s.linkCondition&&l&&s.linkType===r});return[fo,Kn].includes(i==null?void 0:i.linkType)&&!((o=i==null?void 0:i.source)!=null&&o.roundNumber)?k({result:{error:Z},stack:"getTargetLink",context:i}):i}function Gc({drawDefinition:t,structureId:e,roundNumber:r}){return t?e?{links:(t.links||[]).filter(Boolean).reduce((i,s)=>{var a,c;return((a=s.source)==null?void 0:a.structureId)===e&&(!r||s.source.roundNumber===r)&&(i.source=i.source.concat(s)),((c=s.target)==null?void 0:c.structureId)===e&&(!r||s.target.roundNumber===r)&&(i.target=i.target.concat(s)),i},{source:[],target:[]})}:{error:ur}:{error:pe}}function nr({inContextDrawMatchUps:t=[],useTargetMatchUpIds:e,inContextMatchUp:r,drawDefinition:n,matchUpId:o}){let i=r;t.length&&!i&&(i=t.find(c=>c.matchUpId===o));const{structure:s}=Te({structureId:i.structureId,drawDefinition:n}),{finishingPosition:a}=s;return a===di?EG({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:n,structure:s,matchUp:i}):wG({drawDefinition:n,matchUp:i,structure:s})}function EG({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:r,structure:n,matchUp:o}){var i,s,a;const{winnerMatchUpId:c,loserMatchUpId:l}=o,{links:u}=TG({roundNumber:o.roundNumber,structureId:n.structureId,drawDefinition:r}),d=u==null?void 0:u.source,p=gp({source:d,linkType:fo}),v=gp({linkCondition:zn,linkType:Kn,source:d});let f=gp({source:d,linkType:Kn});const m=v&&f;f||(f=v);const g=(i=p==null?void 0:p.target)==null?void 0:i.feedProfile,h=(s=f==null?void 0:f.target)==null?void 0:s.feedProfile,_=(a=v==null?void 0:v.target)==null?void 0:a.feedProfile;let I,P,S,y,O,b,E,T,N,w;if(e&&(c||l)&&(E=c&&g!==zr&&t.find(({matchUpId:A})=>A===c),y=l&&h!==zr&&t.find(({matchUpId:A})=>A===l),E||y))return{matchUp:o,targetLinks:{loserTargetLink:f,winnerTargetLink:p},targetMatchUps:{loserMatchUp:y,winnerMatchUp:E}};const{roundPosition:$}=o;w=w||t.filter(A=>A.structureId===n.structureId);const U=w.reduce((A,C)=>C.roundNumber===o.roundNumber&&!C.matchUpTieId?A+1:A,0);return f&&!y&&h!==zr&&({matchUpDrawPositionIndex:b,targetDrawPosition:O,matchUp:y}=mp({targetLink:f,sourceRoundMatchUpCount:U,inContextDrawMatchUps:t,sourceRoundPosition:$,drawDefinition:r})),m&&_!==zr&&({matchUpDrawPositionIndex:S,targetDrawPosition:P,matchUp:I}=mp({targetLink:v,sourceRoundMatchUpCount:U,inContextDrawMatchUps:t,sourceRoundPosition:$,drawDefinition:r})),p&&!E&&g!==zr&&({matchUpDrawPositionIndex:N,targetDrawPosition:T,matchUp:E}=mp({targetLink:p,sourceRoundMatchUpCount:U,inContextDrawMatchUps:t,sourceRoundPosition:$,drawDefinition:r})),E||(w=w||t.filter(A=>A.structureId===n.structureId),{matchUp:E}=bG({structureMatchUps:w,matchUp:o})),_e({matchUp:o,targetLinks:{loserTargetLink:f,winnerTargetLink:p,byeTargetLink:v},targetMatchUps:{byeMatchUp:I,loserMatchUp:y,winnerMatchUp:E,byeTargetDrawPosition:P,loserTargetDrawPosition:O,winnerTargetDrawPosition:T,byeMatchUpDrawPositionIndex:S,loserMatchUpDrawPositionIndex:b,winnerMatchUpDrawPositionIndex:N},targetMatchUpIds:!!(c||l)})}function wG({matchUp:t}){return{matchUp:t,targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0}}}function NG({drawDefinition:t,inContextDrawMatchUps:e}){const r={};return e.forEach(n=>{var o,i,s,a,c;const{matchUpId:l,structureId:u,drawPositions:d=[]}=n,{structure:p}=Te({drawDefinition:t,structureId:u});if((p==null?void 0:p.finishingPosition)===Ia){const{roundNumber:v}=n,f=v&&parseInt(v)+1,m=p.matchUps||[],{roundMatchUps:g}=lr({matchUps:m});if(f&&g[f]){const h=d.sort().map((_,I)=>{const P=g[f].find(S=>{var y;return(y=S.drawPositions)==null?void 0:y.includes(_)});return{matchUpId:P==null?void 0:P.matchUpId,roundNumber:f,schedule:P==null?void 0:P.schedule,sideNumber:I+1,structureName:p.structureName}});Object.assign(n,{sidesTo:h})}}else{const v=nr({useTargetMatchUpIds:!0,inContextDrawMatchUps:e,inContextMatchUp:n,drawDefinition:t,matchUpId:l});let{winnerMatchUp:f,loserMatchUp:m}=v.targetMatchUps;!n.winnerMatchUpId&&f&&(n.winnerMatchUpId=f.matchUpId),!n.loserMatchUpId&&m&&(n.loserMatchUpId=m.matchUpId);const g=hp({upcomingMatchUp:f});let h=hp({upcomingMatchUp:m});if(n.matchUpStatus!==qe&&(m==null?void 0:m.matchUpStatus)===qe){const{matchUp:I}=n1({matchUp:m,drawDefinition:t,inContextDrawMatchUps:e})||{};h=I&&hp({upcomingMatchUp:I})||h}const _=(o=n.schedule)==null?void 0:o.timeAfterRecovery;if(_&&((i=g==null?void 0:g.schedule)!=null&&i.scheduledTime&&je(g.schedule.scheduledTime)<je(_)&&(r[g.matchUpId]=n.matchUpId,g.schedule.scheduleConflict=n.matchUpId),(s=h==null?void 0:h.schedule)!=null&&s.scheduledTime&&je(h.schedule.scheduledTime)<je(_)&&(r[h.matchUpId]=n.matchUpId,h.schedule.scheduleConflict=n.matchUpId)),Object.assign(n,{winnerTo:g,loserTo:h}),(a=n.drawPositions)!=null&&a.filter(Boolean).length){const I=(c=v.targetLinks)==null?void 0:c.loserTargetLink,P=(I==null?void 0:I.linkCondition)===zn,S=$G(n);if(S.length){const y=Jn(f==null?void 0:f.sides),O=Jn(m==null?void 0:m.sides),E=S.find(({participantId:w})=>y.includes(w))?[]:S,N=S.find(({participantId:w})=>O.includes(w))?[]:S;m&&P&&N.length<2&&N.push({bye:!0,tbd:!0}),E!=null&&E.length&&f&&(!v.targetMatchUpIds&&f&&(f=e.find(({matchUpId:w})=>w===f.matchUpId)),f.potentialParticipants||(f.potentialParticipants=[]),f.potentialParticipants.push(E)),N!=null&&N.length&&m&&(v.targetMatchUpIds||(f=e.find(({matchUpId:w})=>w===m.matchUpId)),m.potentialParticipants||(m.potentialParticipants=[]),m.potentialParticipants.push(N))}}}}),Object.keys(r).length&&e.forEach(n=>{Object.keys(r).includes(n.matchUpId)&&(n.schedule.scheduleConflict=r[n.matchUpId])}),{scheduleConflictMatchUpIds:r}}function $G(t){var e;return((e=t==null?void 0:t.sides)==null?void 0:e.map(({participant:r,participantId:n,qualifier:o})=>r||n&&{participantId:n}||o&&{qualifier:o}).filter(Boolean))||[]}function n1({matchUp:t,drawDefinition:e,inContextDrawMatchUps:r}){const{matchUpId:n,matchUpStatus:o,structureId:i}=t||{};if(!t||!i||(t==null?void 0:t.matchUpStatus)===pt)return{matchUp:t};if(o===qe){let s;if(t.winnerMatchUpId)s=r.find(({matchUpId:a})=>a===t.winnerMatchUpId);else{const a=nr({inContextDrawMatchUps:r,drawDefinition:e,matchUpId:n});({winnerMatchUp:s}=(a==null?void 0:a.targetMatchUps)||{})}return n1({matchUp:s,drawDefinition:e,inContextDrawMatchUps:r})}return{matchUp:void 0}}function hp({upcomingMatchUp:t}={}){if(t)return(({matchUpId:e,structureId:r,schedule:n,roundNumber:o,roundPosition:i,structureName:s})=>({matchUpId:e,structureId:r,schedule:n,roundNumber:o,roundPosition:i,structureName:s}))(t)}function kc({requireParticipants:t=!0,scheduleVisibilityFilters:e,tournamentAppliedPolicies:r,tournamentParticipants:n,afterRecoveryTimes:o,policyDefinitions:i,tournamentRecord:s,drawDefinition:a,matchUpFilters:c,contextFilters:l,contextProfile:u,contextContent:d,participantMap:p,scheduleTiming:v,exitProfiles:f,matchUpsMap:m,structureId:g,inContext:h,structure:_,context:I,event:P}){!_&&g&&({structure:_}=Te({drawDefinition:a,structureId:g}));const S=Ke({tournamentAppliedPolicies:r,scheduleVisibilityFilters:e,tournamentParticipants:n,afterRecoveryTimes:o,policyDefinitions:i,tournamentRecord:s,drawDefinition:a,matchUpFilters:c,contextFilters:l,contextProfile:u,contextContent:d,participantMap:p,scheduleTiming:v,exitProfiles:f,matchUpsMap:m,structure:_,inContext:h,context:I,event:P});if(S.error)return S;const{matchUps:y}=S,{assignedPositions:O}=St({structure:_}),b=O.filter(A=>A.participantId).map(A=>A.drawPosition),E=[],T=[],N=[],w=[],$=[];let U;return y.filter(A=>{var C;const M=((C=c==null?void 0:c.matchUpTypes)==null?void 0:C.length)===1&&c.matchUpTypes[0]===We;return!(A.matchUpType!==We&&M)}).forEach(A=>{var C,M,D,V;if(A.matchUpStatus===gr){w.push(A);return}A.matchUpType===We&&(U=!0);const R=A.collectionId,W=R&&((C=A.sides)==null?void 0:C.every(G=>G.participantId)),x=!R&&((M=A.drawPositions)==null?void 0:M.filter(Boolean).length)===2,K=!R&&((D=A.drawPositions)==null?void 0:D.every(G=>b.includes(G))),j=O.filter(G=>G.bye).map(G=>G.drawPosition),L=!R&&((V=A.drawPositions)==null?void 0:V.find(G=>j.includes(G))),q=vV.includes(A.matchUpStatus)&&(W||x&&(!t||K));return L?E.push(A):Ds({matchUp:A})?$.push(A):q?N.push(A):T.push(A)}),{includesTeamMatchUps:U,abandonedMatchUps:w,completedMatchUps:$,upcomingMatchUps:N,pendingMatchUps:T,byeMatchUps:E,structure:_}}var AG=Object.defineProperty,UG=Object.defineProperties,CG=Object.getOwnPropertyDescriptors,y_=Object.getOwnPropertySymbols,MG=Object.prototype.hasOwnProperty,DG=Object.prototype.propertyIsEnumerable,O_=(t,e,r)=>e in t?AG(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,_p=(t,e)=>{for(var r in e||(e={}))MG.call(e,r)&&O_(t,r,e[r]);if(y_)for(var r of y_(e))DG.call(e,r)&&O_(t,r,e[r]);return t},jG=(t,e)=>UG(t,CG(e));function wt(t){const e="getAllDrawMatchUps";Object.assign(t,{requireParticipants:!1});const r=gs(t);if(r.error)return k({result:r,stack:e});const{abandonedMatchUps:n,completedMatchUps:o,upcomingMatchUps:i,pendingMatchUps:s,byeMatchUps:a,matchUpsMap:c}=r;return{matchUps:[].concat(...n,...o,...i,...s,...a),matchUpsMap:c}}function gs({scheduleVisibilityFilters:t,tournamentAppliedPolicies:e,tournamentParticipants:r,requireParticipants:n,participantsProfile:o,afterRecoveryTimes:i,includeByeMatchUps:s,policyDefinitions:a,tournamentRecord:c,contextContent:l,contextFilters:u,contextProfile:d,drawDefinition:p,matchUpFilters:v,scheduleTiming:f,participantMap:m,nextMatchUps:g,matchUpsMap:h,inContext:_,context:I,event:P}){if(!p)return{error:pe};let S=[],y=[],O=[],b=[],E=[];d&&!l&&(l=Io({policyDefinitions:a,tournamentRecord:c,contextProfile:d,event:P})),!(r!=null&&r.length)&&c&&(r=c==null?void 0:c.participants,(_||o!=null&&o.withGroupings)&&(r!=null&&r.length)&&(r=kv({participants:r,participantsProfile:o})));const{structures:T}=Ur({drawDefinition:p});h||(h=zt({drawDefinition:p}));const N=p&&Vv({drawDefinition:p}).exitProfiles;T.forEach(U=>{const{byeMatchUps:A=[],pendingMatchUps:C,upcomingMatchUps:M,completedMatchUps:D,abandonedMatchUps:V}=kc({matchUpFilters:g?void 0:v,contextFilters:g?void 0:u,inContext:_||g||u,tournamentAppliedPolicies:e,scheduleVisibilityFilters:t,tournamentParticipants:r,requireParticipants:n,afterRecoveryTimes:i,includeByeMatchUps:s,policyDefinitions:a,tournamentRecord:c,contextProfile:d,contextContent:l,drawDefinition:p,participantMap:m,scheduleTiming:f,exitProfiles:N,matchUpsMap:h,structure:U,context:I,event:P});S=S.concat(...V),y=y.concat(...D),O=O.concat(...M),b=b.concat(...C),E=E.concat(...A)});const w=U=>(!v&&!g&&!u||(v&&(U=Vi(_p({matchUps:U},v))),u&&(U=Vi(jG(_p({matchUps:U},u),{processContext:!0})))),U),$=_p({abandonedMatchUps:w(S),completedMatchUps:w(y),upcomingMatchUps:w(O),pendingMatchUps:w(b),byeMatchUps:w(E),matchUpsMap:h},B);if(g){const U=typeof g=="object"||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:A,completed:C,upcoming:M,pending:D,bye:V}=U,R=[].concat(...A&&S||[],...C&&y||[],...M&&O||[],...D&&b||[],...V&&E||[]);NG({inContextDrawMatchUps:R,drawDefinition:p})}return $}const fd={matchUpStatus:pt,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};var RG=Object.defineProperty,S_=Object.getOwnPropertySymbols,FG=Object.prototype.hasOwnProperty,VG=Object.prototype.propertyIsEnumerable,b_=(t,e,r)=>e in t?RG(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,T_=(t,e)=>{for(var r in e||(e={}))FG.call(e,r)&&b_(t,r,e[r]);if(S_)for(var r of S_(e))VG.call(e,r)&&b_(t,r,e[r]);return t};function On({matchUpStatusCodes:t,removeWinningSide:e,tournamentRecord:r,drawDefinition:n,matchUpFormat:o,matchUpStatus:i,removeScore:s,winningSide:a,matchUpId:c,matchUp:l,event:u,notes:d,score:p}){var v,f,m,g,h,_;const I="modifyMatchUpScore";let P;const S=l.matchUpType===We;S?c&&l.matchUpId!==c&&({matchUp:l,structure:P}=nt({drawDefinition:n,matchUpId:c,event:u})):l.matchUpId!==c&&console.log("!!!!!"),i&&[Ge,gt].includes(i)||s?Object.assign(l,T_({},fd)):p&&(l.score=p);const y=i&&(l==null?void 0:l.matchUpStatus)===Be&&i!==Be;i&&(l.matchUpStatus=i),o&&(l.matchUpFormat=o),t&&(l.matchUpStatusCodes=t),a&&(l.winningSide=a),e&&(l.winningSide=void 0),P||({structure:P}=nt({drawDefinition:n,matchUpId:c,event:u})),!l.winningSide&&At(l)&&!Rt.includes(i)&&![da,hi].includes(i)&&(l.matchUpStatus=dn);let O;if(y&&((v=l==null?void 0:l.processCodes)!=null&&v.length)||i===Be){const w=(f=ct({tournamentRecord:r,drawDefinition:n,structure:P,event:u}))==null?void 0:f.appliedPolicies;O=(g=(m=w==null?void 0:w[va])==null?void 0:m.processCodes)==null?void 0:g.incompleteAssignmentsOnDefault}if((P==null?void 0:P.structureType)===er&&!l.collectionId){o=S?"SET1-S:T100":o||l.matchUpFormat||(P==null?void 0:P.matchUpFormat)||n.matchUpFormat||(u==null?void 0:u.matchUpFormat);const w=P.structures.find(C=>C==null?void 0:C.matchUps.find(M=>M.matchUpId===c)),$=S&&{matchUpTypes:[We]},{matchUps:U}=Ke({afterRecoveryTimes:!1,structure:w,inContext:!0,matchUpFilters:$,event:u}),A=r1({positionAssignments:w.positionAssignments,tournamentRecord:r,drawDefinition:n,matchUpFormat:o,matchUps:U,event:u});if(A.error)return k({result:A,stack:I})}if(d){const w=Gv({element:l,notes:d});if(w.error)return k({result:w,stack:I})}const b=r==null?void 0:r.tournamentId,E=Mn().topics.includes(Ev),T=(E||O)&&zt({drawDefinition:n}),N=T&&((h=wt({matchUpFilters:{matchUpIds:[c]},includeByeMatchUps:!0,nextMatchUps:!0,tournamentRecord:r,inContext:!0,drawDefinition:n,matchUpsMap:T}).matchUps)==null?void 0:h[0]);if(E&&N&&vG({tournamentId:b,inContextMatchUp:N}),Array.isArray(O)&&N&&!((_=N.sides)!=null&&_.every(({participantId:w})=>w)))if(i===Be)l.processCodes?l.processCodes.push(...O):l.processCodes=O;else for(const w of O||[]){const $=l.processCodes.lastIndexOf(w);l.processCodes.splice($,1)}return ze({eventId:u==null?void 0:u.eventId,context:I,drawDefinition:n,tournamentId:b,matchUp:l}),T_({},B)}var LG=Object.defineProperty,BG=Object.defineProperties,xG=Object.getOwnPropertyDescriptors,E_=Object.getOwnPropertySymbols,GG=Object.prototype.hasOwnProperty,kG=Object.prototype.propertyIsEnumerable,w_=(t,e,r)=>e in t?LG(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ip=(t,e)=>{for(var r in e||(e={}))GG.call(e,r)&&w_(t,r,e[r]);if(E_)for(var r of E_(e))kG.call(e,r)&&w_(t,r,e[r]);return t},N_=(t,e)=>BG(t,xG(e));function to({tournamentRecord:t,exitWhenNoValues:e,drawDefinition:r,matchUpStatus:n,removeScore:o,matchUpsMap:i,matchUpId:s,event:a}){var c,l;const u=nt({drawDefinition:r,event:a,matchUpId:s});if(u.error)return u;const{matchUp:d,structure:p}=u;if(!d.tieMatchUps)return{error:Gr};const{extension:v}=_r({name:Bs,element:d});if(v!=null&&v.value)if(o)tn({element:d,name:Bs});else return N_(Ip({},B),{score:d.score});const f=(c=Zt({drawDefinition:r,structure:p,matchUp:d,event:a}))==null?void 0:c.tieFormat;d.tieFormat=ln(f);const{winningSide:m,set:g,scoreStringSide1:h,scoreStringSide2:_}=Lc({drawDefinition:r,matchUpsMap:i,structure:p,matchUp:d,event:a}),I=(g==null?void 0:g.side1Score)||(g==null?void 0:g.side2Score);if(e&&!d.score&&!I)return Ip({},B);const P={scoreStringSide1:h,scoreStringSide2:_,sets:g?[g]:[]},S=[1,2].includes(m),y=S&&_t||xv({matchUpStatus:n||d.matchUpStatus,tieMatchUps:d.tieMatchUps,winningSide:d.winningSide,score:P})&&dn||pt,O=d.winningSide&&!S,b=d.tieMatchUps.find(({score:T,winningSide:N,matchUpStatus:w})=>{var $;return(($=T==null?void 0:T.sets)==null?void 0:$.length)&&(T.sets[0].side1Score||T.sets[0].side2Score)||Rt.includes(w)||N});let E;if(d.tieFormat&&!S&&!b){const T=(l=Zt({drawDefinition:r,structure:p,event:a}))==null?void 0:l.tieFormat;T&&JSON.stringify(f)===JSON.stringify(T)&&(d.tieFormatId=void 0,d.tieFormat=void 0,E=!0)}return On({matchUpStatus:y,score:P,removeWinningSide:O,tournamentRecord:t,drawDefinition:r,removeScore:o,winningSide:m,matchUpId:s,matchUp:d,event:a}),N_(Ip({},B),{score:P,removeWinningSide:O,tieFormatRemoved:E,winningSide:m})}function xn(t){const{winnerFirst:e=!0,addOutcomeString:r,reversed:n=!1,matchUpStatus:o,matchUpFormat:i,autoComplete:s,winningSide:a,sets:c}=t;if(!c)return{error:Se,info:"missing sets"};const l=i&&Ir(i),{bestOf:u,finalSetFormat:d,setFormat:p}=l||{},f=n||!(!e||!a||a===1),m=r?WG({matchUpStatus:o}):"",g=(c==null?void 0:c.sort(qG).map(h).filter(Boolean).join(" "))||"";if(!m)return g;if(a===2)return`${m} ${g}`;return`${g} ${m}`;function h(_){const P=u&&_.setNumber===u&&d?d:p,S=V=>Pt(V==null?void 0:V.side1Score)||Pt(V==null?void 0:V.side2Score),y=V=>Pt(V==null?void 0:V.side1TiebreakScore)||Pt(V==null?void 0:V.side2TiebreakScore),O=(P==null?void 0:P.tiebreakSet)||!S(_)&&y(_),{side1Score:b,side2Score:E,side1TiebreakScore:T,side2TiebreakScore:N}=_,w=T||(Pt(T)||s?0:""),$=N||(Pt(N)||s?0:"");if(O)return`[${(f?[$,w]:[w,$]).join("-")}]`;const U=Math.min(w,$),A=U?`(${U})`:"",C=b||(Pt(b)||s?0:""),M=E||(Pt(E)||s?0:"");let D=f?`${[M,C].join("-")}${A}`:`${[C,M].join("-")}${A}`;return["-"," "].includes(D)&&(D=""),D}}function WG({matchUpStatus:t}){const e={[Xt]:"RET",[Ge]:"WO",[Ot]:"DF/DF",[gt]:"WO/WO",[hi]:"SUS",[gr]:"ABN",[Be]:"DEF",[pa]:"DR"};return t&&e[t]||""}function qG(t,e){return t.setNumber-e.setNumber}function HG({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:r,winningSide:n,score:o}){const i=(o==null?void 0:o.sets)||[],a=((i==null?void 0:i.filter(y=>y==null?void 0:y.winningSide))||[]).reduce((y,O)=>{const{winningSide:b}=O,E=b-1;return y[E]++,y},[0,0]),c=n&&n-1,l=1-c,u=a[c],d=a[l],p=Ir(e),v=Math.max(...a),f=fr(a)[v],{bestOf:m}=p||{},g=m&&Math.ceil(m/2)||1,h=r||t,_=[Be,Xt,Ge].includes(h),I=!p||!i.length||i.every((y,O)=>{const b=O+1,E=b===m,T=b===i.length,{side1Score:N,side2Score:w,side1TiebreakScore:$,side2TiebreakScore:U,winningSide:A}=y,C=Math.max(N||0,w||0),M=$||U,{finalSetFormat:D,setFormat:V}=p,R=E&&D||V;if(M){const{tiebreakTo:x,NoAD:K}=(R==null?void 0:R.tiebreakFormat)||{},j=Math.max($||0,U||0);if(K&&j>x||j<x&&A&&(T&&!_||!T))return!1}return R.setTo?!(!R.noTiebreak&&C>R.setTo+1):!0}),P=(!e||v===g)&&f===1&&a.indexOf(v)+1||void 0;return{valid:I&&(n&&u>d&&n===P||!n&&!P||_)}}function Wv({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:r,winningSide:n,score:o}){if(typeof o!="object")return{error:Z};const{sets:i,scoreStringSide1:s,scoreStringSide2:a}=o,c="scoreString must be a string!";if(s!==void 0&&typeof s!="string")return{error:Z,info:c};if(a!==void 0&&typeof a!="string")return{error:Z,info:c};if(i!==void 0&&!Array.isArray(i))return{error:Z,info:Yt("sets")};if(i!=null&&i.length){const l=i.map(d=>d==null?void 0:d.setNumber).filter(Boolean);if(l.length!==Ve(l).length)return{error:Z,info:"setNumbers not unique"};for(const d of i){const{side1Score:p,side2Score:v,side1TiebreakScore:f,side2TiebreakScore:m,side1PointScore:g,side2PointScore:h,winningSide:_,setNumber:I}=d;if(![[p,v],[f,m],[g,h]].filter(y=>y.some(O=>O!==void 0)).every(y=>y.every(O=>lt(O))))return{error:Z,info:"non-numeric values"};if(![I,_].filter(y=>y!==void 0).every(y=>lt(y)))return{error:Z,info:"non-numeric values"};if(_&&![1,2].includes(_))return{error:Z,info:"winningSide must be 1 or 2"}}const{valid:u}=HG({existingMatchUpStatus:t,matchUpStatus:r,matchUpFormat:e,winningSide:n,score:o});if(!u)return{error:TR,info:"score is invalid for matchUpFormat or winningSide does not match calculated winningSide"}}return{valid:!0}}function qv({analysis:t,set:e}){const r=Hv({set:e}),{isDecidingSet:n,isTiebreakSet:o,matchUpScoringFormat:i}=t;return o1({matchUpScoringFormat:i,isDecidingSet:n,isTiebreakSet:o,set:e})&&r}function o1({ignoreTiebreak:t=!1,matchUpScoringFormat:e,matchUpFormat:r,isTiebreakSet:n,isDecidingSet:o,set:i}){if(!i)return{error:Se};e=e||r;const s=o&&e.finalSetFormat||(e==null?void 0:e.setFormat)||{},{side1Score:a,side2Score:c}=i,{NoAD:l,setTo:u,tiebreakAt:d,tiebreakFormat:p}=s,v=p==null?void 0:p.NoAd,f=Hv({set:i}),m=Math.abs(a-c),g=a>=u||c>=u,h=n||a>=u&&c>=u||d&&d<u&&(a===d||c===d),_=t||h&&(f===1&&i.side1TiebreakScore>i.side2TiebreakScore||f===2&&i.side2TiebreakScore>i.side1TiebreakScore),P=m>=(l||h&&(d&&!n||n&&v)?1:2);return(g&&(P||h)||n)&&(!h||_)}function Hv({set:t}){if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}const Gi=" ",gf="DEF",YG="COMPLETED",i1="WO",KG="WO/WO",s1="ABN",a1="SUS",c1="RET",l1="INT",u1=[c1,gf,i1,KG,s1,a1,l1],hf="DEFAULTED",d1="WALKOVER",p1="ABANDONED",f1="SUSPENDED",v1="RETIRED",m1="INTERRUPTED",zG=[v1,hf,d1],os="()",fi="[]",QG=["up","left","shift+tab"],JG=["enter","down","tab","right"],tu="backspace",g1="r",h1="s",_1="a",I1="d",P1="w",y1="i",Yv=[g1,I1,P1,_1,h1,y1],vd="space",Pp=["[","("],ru=[...QG,...JG,vd,"]"],O1="-",ZG="/",ki=O1,Gn=O1,S1=[ZG],XG=0,b1=["0","1","2","3","4","5","6","7","8","9"].concat(Yv),ek=b1.map(t=>`shift+${t}`),tk=[ki,tu].concat(ru,S1),rk=[b1,ek,tk].join(",");function nk({analysis:t,scoreString:e,sets:r,value:n}){let o;if(!(r!=null&&r.length))return{sets:[]};const i=r[r.length-1];n=parseInt(n);const{validSide2Score:s,requiresTiebreak:a}=ok({analysis:t,set:i,value:n});if(s){o=!0,e=(e||"")+n,i.side2Score=n;const c=qv({analysis:t,set:r[r.length-1]});if(i.winningSide=c||void 0,a){const l=os.split("")[0];e+=l}else t.isDecidingSet||(e+=Gi)}return{sets:r,scoreString:e,updated:o}}function ok({analysis:t,set:e={},value:r}){const n=t.isDecidingSet&&t.matchUpScoringFormat.finalSetFormat||t.matchUpScoringFormat.setFormat,{tiebreakAt:o,setTo:i,NoAD:s}=n,{side1Score:a}=e;let c,l;return o&&o<i?a===o?c=r<=i:c=r<=o:a===i?s?c=r<i:c=r<=i+1:a===i-1?s?c=r<=i:c=r<=i+1:a===i+1?c=r===i||r===i-1:c=r<=i,c&&(o&&o<i?l=a===i&&r===o||a===o&&r===i:l=a>=i&&r>=i&&a!==r),{validSide2Score:c,requiresTiebreak:l}}function bs({scoreString:t,lowSide:e,outcome:r}){if({scoreString:t}=T1({scoreString:t}),e===2){const o=(t&&t[t.length-1])!==Gi?Gi:"";return t+o+r}else return r+Gi+t}function T1({scoreString:t}){if(!t)return{scoreString:""};let e=!1;for(const r of u1){const n=t==null?void 0:t.indexOf(r);n===0?t=t.slice(r.length+1).trim()+Gi:n>0&&(t=t.slice(0,n)),n>=0&&(e=!0)}return t!=null&&t.trim()||(t=""),{scoreString:t,removed:e}}function _f({analysis:t,scoreString:e,sets:r,lowSide:n}){var o,i,s;let a,c;if(!e)return{scoreString:e,sets:r};const{scoreString:l,removed:u}=T1({scoreString:e});if(e=l,u)return{scoreString:e,sets:r,outcomeRemoved:!0};let d=r[r.length-1]||{};const p=Object.values(d).filter(_=>_!==void 0).length;d.setNumber&&p===1&&(r=r.slice(0,r.length-1),d=r[r.length-1]||{});const{tiebreakSet:v}=t.setFormat,{tiebreakTo:f,NoAD:m}=v||{},{isTiebreakEntry:g}=js({brackets:fi,scoreString:e}),h=sk(e);if(h>=0){a=e.slice(0,h);const{isTiebreakEntry:_}=js({brackets:os,scoreString:a}),{lastOpenBracketIndex:I,isTiebreakEntry:P}=js({brackets:fi,scoreString:a}),S=a&&a[a.length-1].trim(),y=a&&!isNaN(S);let O=t.isIncompleteSetScore;if(g&&P){const E=a.slice(I+1).split(Gn),T=(E==null?void 0:E.length)>0&&E[0]!==void 0&&!isNaN(parseInt(E[0]))&&parseInt(E[0])||void 0,N=(E==null?void 0:E.length)>1&&E[1]!==void 0&&parseInt(E[1])||void 0,w=[T,N];if(N){const $=n===1?1:0;w[$]=w[1-$]+(m?1:2),w[$]<f&&(w[$]=f),a=e.slice(0,I+1),a+=w.join(Gn)}else T!==void 0?(a=e.slice(0,I+1),a+=T):(a=e.slice(0,I),O=!0);d.side1TiebreakScore=w[0]||0,d.side2TiebreakScore=w[1]||0}if(a.length||(a=void 0),O){const b=(o=d.side1Score)==null?void 0:o.toString();if(b){const E=b==null?void 0:b.slice(0,b.length-1);d.side1Score=!isNaN(E)&&parseInt(E)||void 0,d.side1Score===void 0&&(d.side2Score=void 0)}t.isTimedSet?(c=d.side1Score?r:(r==null?void 0:r.slice(0,r.length-1))||[],c[r.length-1]=d):c=(r==null?void 0:r.slice(0,r.length-1))||[]}else if(y){const b=(i=d.side2Score)==null?void 0:i.toString(),E=(s=d.side1Score)==null?void 0:s.toString();if(!t.isTiebreakEntry&&!t.isMatchTiebreak)if(d.side2Score){const T=b==null?void 0:b.slice(0,b.length-1);d.side2Score=!isNaN(T)&&parseInt(T)||void 0}else{const T=E==null?void 0:E.slice(0,E.length-1);d.side1Score=!isNaN(T)&&parseInt(T)||void 0}t.isTimedSet?d.side1Score?(c=r||[],c[r.length-1]=d):c=(r==null?void 0:r.slice(0,r.length-1))||[]:(c=r||[],c[r.length-1]=d),c[c.length-1]&&Object.assign(c[c.length-1],{winningSide:void 0})}else _?(c=r||[],Object.assign(c[c.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0})):(g&&!P?c=(r==null?void 0:r.slice(0,r.length-1))||[]:(c=r,c[r.length-1]=d),g||(c[c.length-1].side2Score=0,c[c.length-1].winningSide=void 0));return{scoreString:a,sets:c}}return{scoreString:e,sets:r}}function js({brackets:t=os,scoreString:e}){if(!e)return{};const[r,n]=t.split(""),o=e.split(""),i=Math.max(...Pn(r,o)),s=Math.max(...Pn(n,o));return{isTiebreakEntry:i>s,lastOpenBracketIndex:i}}function ik({scoreString:t}){if(!t)return!1;const e=t&&t[t.length-1].trim(),r=t&&!isNaN(e),[n,o]=fi.split(""),i=t.split(""),s=Math.max(...Pn(n,i)),a=Math.max(...Pn(o,i)),c=Math.max(...Pn(Gn,i));return r&&s>a&&c>s}function sk(t){return t.split("").reduce((n,o,i)=>(o.match(/\d+/g)&&n.push(i),n),[]).pop()}function E1({lowValue:t=0,NoAD:e=!1,tiebreakTo:r}={}){const n=e?1:2;return t+1>=r?t+n:parseInt(r)}function $_({matchUpFormat:t,matchUpStatus:e,winningSide:r,sets:n}){const o=Ir(t),{bestOf:i}=o,s=Math.ceil(i/2),a=n==null?void 0:n.reduce((l,u)=>{const{winningSide:d}=u;return d&&l[d-1]++,l},[0,0]);let c=(a==null?void 0:a.indexOf(s))+1||void 0;return zG.includes(e)&&r&&(c=r),{matchUpWinningSide:c}}function w1({lowSide:t,value:e,sets:r,scoreString:n,winningSide:o,matchUpStatus:i}){let s;return e===g1?n?(s=!0,n=bs({scoreString:n,lowSide:t,outcome:c1}),o=t===2?1:2,i=v1):(s=!0,n=bs({scoreString:n,lowSide:t,outcome:gf}),o=t===2?1:2,i=hf):e===I1?(s=!0,n=bs({scoreString:n,lowSide:t,outcome:gf}),o=t===2?1:2,i=hf):e===P1?(s=!0,r=[],n=i1,o=t===2?1:2,i=d1):e===h1&&n?(s=!0,n=bs({scoreString:n,lowSide:t,outcome:a1}),i=f1,o=void 0):e===_1?(s=!0,n=bs({scoreString:n,lowSide:t,outcome:s1}),i=p1,o=void 0):e===y1&&n&&(s=!0,n=bs({scoreString:n,lowSide:t,outcome:l1}),i=m1,o=void 0),{updated:s,sets:r,scoreString:n,matchUpStatus:i,winningSide:o}}function ak({analysis:t,lowSide:e,scoreString:r,sets:n,winningSide:o,matchUpStatus:i,info:s,value:a}){let c,l;!(n!=null&&n.length)&&a!==tu&&(n=[{setNumber:1}]);const u=n.length-1;if(Yv.includes(a)){const d=n[n.length-1]||{},{side1Score:p,side2Score:v}=d;p&&!v?s="missing side2Score":t.finalSetIsComplete||o?s="final set is already complete":t.isIncompleteSetScore?s="incomplete set scoreString":t.isIncompleteSetScore||({sets:n,scoreString:r,winningSide:o,matchUpStatus:i,updated:c}=w1({lowSide:e,value:a,sets:n,scoreString:r,matchUpStatus:i,winningSide:o}))}else if(a===tu){if({scoreString:r,sets:n,outcomeRemoved:l}=_f({analysis:t,scoreString:r,sets:n}),(r==null?void 0:r.trim())===""&&(r=r.trim()),r||(n=[]),l){const d=n[n.length-1]||{},{side1Score:p,side2Score:v}=d;if(p&&v){const f=p>v&&1||v>p&&2||void 0;f&&(d.winningSide=f,n.push({setNumber:n.length+1}))}}i=void 0,o=void 0,c=!0}else if(t.hasOutcome)s="has outcome";else{if(o)return{sets:n,scoreString:r,winningSide:o,matchUpStatus:i,updated:!1,info:"matchUp is complete"};if(a===vd){const d=n[n.length-1]||{},{side1Score:p,side2Score:v}=d,f=p>v&&1||v>p&&2||void 0;f&&!o&&!t.isIncompleteSetScore&&(n[n.length-1].winningSide=f,n.push({setNumber:n.length+1}),r+=" ",c=!0)}else if(a===ki&&n[u].side1Score!==void 0&&n[u].side2Score===void 0&&r&&t.isNumericEnding)r+="-",n[u].side2Score=0,i=void 0,o=void 0,c=!0;else if(!isNaN(a)){let d;if(n[u].side2Score===void 0){const p=parseInt((n[u].side1Score||0).toString()+a).toString().slice(0,2);n[u].side1Score=parseInt(p),d=n[u].side1Score.toString(),c=!0}else{const p=parseInt((n[u].side2Score||0).toString()+a).toString().slice(0,2);n[u].side2Score=parseInt(p),d=[n[u].side1Score,n[u].side2Score].join("-"),c=!0}if(c){const p=(n.slice(0,u)||[]).filter(v=>v).map(v=>{const{side1Score:f,side2Score:m}=v;return[f,m].join("-")}).join(" ");p?r=p+" "+d:r=d}}}return{sets:n,scoreString:r,winningSide:o,matchUpStatus:i,info:s,updated:c}}function ck({analysis:t,auto:e,lowSide:r,scoreString:n="",sets:o,value:i}){var s;let a,c;const{tiebreakSet:{tiebreakTo:l,NoAD:u}}=t.setFormat,[d]=fi.split("");if(t.isMatchTiebreakEntry||(n+=d),o[t.setNumber-1]){const{lastOpenBracketIndex:v}=js({brackets:fi,scoreString:n}),m=(n.slice(v+1)+(e?"":i)).split(Gn);if((((s=m[r-1])==null?void 0:s.length)||0)>=2)c="tiebreak digit limit";else if(e){r===1&&(m[0]=(m[0]||"")+i),r===2&&(m[1]=(m[1]||"")+i);const h=[m[0]||0,m[1]||0].map(P=>parseInt(P)),_=r===1?1:0;h[_]=h[1-_]+(u?1:2),h[_]<l&&(h[_]=l);const I=o[o.length-1];I.side1TiebreakScore=h[0],I.side2TiebreakScore=h[1],n=n.slice(0,v+1),n+=h.join(Gn),a=!0}else{const h=[m[0]||0,m[1]||0].map(I=>parseInt(I)),_=o[o.length-1];_.side1TiebreakScore=h[0],_.side2TiebreakScore=h[1],n+=i,a=!0}}else{const v=E1({lowValue:parseInt(i||0),tiebreakTo:l,NoAD:u}),f=[parseInt(i),v];r===2&&f.reverse();const m={side1TiebreakScore:f[0],side2TiebreakScore:f[1],setNumber:(o==null?void 0:o.length)+1||1};o.push(m),n+=f.join(Gn),a=!0}return{info:c,scoreString:n,sets:o,updated:a}}function lk({analysis:t,lowSide:e,scoreString:r,value:n}){const{setTo:o,tiebreakAt:i,NoAD:s}=(t==null?void 0:t.setFormat)||{},a=n===parseInt(i||o);if(i&&i<o&&n>i)return{scoreString:r};if(s&&n===o||n>o)return{scoreString:r};const c=m(),l=[n,c];e===2&&l.reverse();const d=os.split("")[0],p=l.join(ki)+(a?d:Gi);r=(r||"")+p;const v={side1Score:l[0],side2Score:l[1]},f=qv({analysis:t,set:v});return v.winningSide=f||void 0,{scoreString:r,set:v};function m(){return a?n+1:n+1===o?n+(s?1:2):o}}function uk({matchUpFormat:t,scoreString:e,winningSide:r,value:n,sets:o}){var i,s,a;const l=(((i=o==null?void 0:o.filter(F=>F==null?void 0:F.winningSide))==null?void 0:i.length)||0)+(r?0:1),u=Ir(t),d=l===(u==null?void 0:u.bestOf),p=d&&u.finalSetFormat||u.setFormat||{},v=(p==null?void 0:p.timed)||u.timed,f=d&&o[(u==null?void 0:u.bestOf)-1],m=f==null?void 0:f.winningSide,{isTiebreakEntry:g}=js({brackets:os,scoreString:e}),{isTiebreakEntry:h}=js({brackets:fi,scoreString:e}),_=g||h,I=!!p.tiebreakSet,P=(s=e==null?void 0:e[e.length-1])==null?void 0:s.trim(),S=e&&!isNaN(P),y=!_&&P===ki,O=g&&Pp.includes(P),b=h&&Pp.includes(P),E=h&&P===Gn,T=e==null?void 0:e.split(""),[N]=fi.split(""),w=T&&Math.max(...Pn(N,T)),$=T&&Math.max(...Pn(Gn,T)),U=T&&$>w,A=(a=o[o.length-1])==null?void 0:a.winningSide,C=(o==null?void 0:o.length)&&!A,M=u1.find(F=>(e==null?void 0:e.indexOf(F))>=0),D=!isNaN(n),V=n===vd,R=ru.includes(n),W=e==null?void 0:e.split("").find(F=>Pp.includes(F)),x=R&&h&&!b&&(E||!ik({scoreString:e}));return{isTiebreakSetValue:I&&D,matchUpScoringFormat:u,setNumber:l,setFormat:p,matchTiebreakHasJoiner:U,isGameScoreEntry:C,isSpace:V,isCloser:R,isTiebreakCloser:R&&W&&_&&S,isDecidingSet:d,isTiebreakSet:I,isTimedSet:v,isNumericEnding:S,isNumericValue:D,hasOpener:W,hasOutcome:M,finalSet:f,finalSetIsComplete:m,lastSetIsComplete:A,isInvalidSetTiebreakValue:V&&_&&O,isInvalidMatchTiebreakValue:x,isTiebreakEntry:_,isSetTiebreakEntry:g,isMatchTiebreakEntry:h,isIncompleteSetScore:y,isIncompleteSetTiebreak:O,isIncompleteMatchTiebreak:b,isPartialMatchTiebreakValue:E}}function dk(t){let{lowSide:e=1,value:r}=t,{scoreString:n,sets:o,winningSide:i,matchUpStatus:s}=t;const{matchUpFormat:a,shiftFirst:c,auto:l=!0}=t;let u,d;const p=c&&e===2||!c&&e===1;if(!rk.includes(r))return{updated:!1,info:"invalid key"};c&&(e=3-e);const{matchUpWinningSide:v}=$_({sets:o,winningSide:i,matchUpStatus:s,matchUpFormat:a});i=v;const f=uk({value:r,winningSide:i,scoreString:n,sets:o,matchUpFormat:a});if(S1.includes(r)&&(r=ki),f.hasOpener&&f.isTiebreakEntry&&!f.isTiebreakSet&&p&&parseInt(r)===0&&(f.isTiebreakCloser=!0),ru.includes(r)&&f.hasOpener&&(r=""),ru.includes(r)&&(r=vd),f.lastSetIsComplete){const m=(n==null?void 0:n.length)&&n[n.length-1];n&&m!==" "&&(n+=" ")}if(f.isTimedSet)({info:d,sets:o,scoreString:n,updated:u,matchUpStatus:s,winningSide:i}=ak({analysis:f,lowSide:e,scoreString:n,sets:o,matchUpStatus:s,winningSide:i,value:r}));else if(Yv.includes(r))f.finalSetIsComplete||i?d="final set is already complete":!f.isTiebreakEntry&&!f.isIncompleteSetScore?{sets:o,scoreString:n,matchUpStatus:s,winningSide:i,updated:u}=w1({lowSide:e,sets:o,scoreString:n,matchUpStatus:s,winningSide:i,value:r}):f.isTiebreakEntry||f.isIncompleteSetScore?d="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:r});else if(r===tu)u=!0,{scoreString:n,sets:o}=_f({analysis:f,scoreString:n,sets:o,lowSide:e,auto:l}),n||(o=[]),s=void 0,i=void 0;else if(f.hasOutcome)d="has outcome";else if(r===ki&&!f.isMatchTiebreakEntry)(!f.isSetTiebreakEntry||f.isSetTiebreakEntry&&!f.isNumericEnding)&&(u=!0,{scoreString:n,sets:o}=_f({analysis:f,scoreString:n,sets:o,lowSide:e,auto:l}),s=void 0);else if(r===Gn&&f.isMatchTiebreakEntry&&!f.isSetTiebreakEntry)f.matchTiebreakHasJoiner?d="existing joiner":f.isNumericEnding&&(u=!0,n+=Gn);else if([ki,Gn].includes(r))d="invalid location for joiner";else{if(i)return{updated:!1,info:"matchUp is complete"};if(f.isIncompleteSetScore)f.isNumericValue&&({sets:o,scoreString:n,updated:u}=nk({analysis:f,scoreString:n,sets:o,value:r}));else if(f.isInvalidMatchTiebreakValue)d="invalid matchUp tiebreak character";else if(f.isInvalidSetTiebreakValue)d="invalid set tiebreak character";else if(f.isTiebreakCloser){const m=f.isSetTiebreakEntry?os:fi,g=m.split("").reverse()[0],h=m.split("")[0],_=o[o.length-1],{tiebreakFormat:I}=f.setFormat,{tiebreakTo:P,NoAD:S}=I||{},y=Hv({set:_});if(!f.isTiebreakSet){const b=parseInt(n.split(h).reverse()[0]),E=E1({lowValue:b,tiebreakTo:P,NoAD:S});y===1?(_.side1TiebreakScore=E,_.side2TiebreakScore=b):(_.side1TiebreakScore=b,_.side2TiebreakScore=E)}n=(n||"")+g,f.isDecidingSet||(n+=Gi);const O=qv({analysis:f,set:_});_.winningSide=O||void 0,u=!0}else if(f.isTiebreakSetValue)({info:d,scoreString:n,sets:o,updated:u}=ck({analysis:f,auto:l,lowSide:e,scoreString:n,sets:o,value:r}));else if(f.isSetTiebreakEntry){const[m]=os.split(""),g=Math.max(...Pn(m,n.split(""))),h=n.slice(g+1),_=h&&parseInt(h)===XG,I=parseInt(h?h+r:r),{tiebreakFormat:P}=f.setFormat,{tiebreakTo:S,NoAD:y}=P||{};!_&&h.length<2?y&&I>S-1?d="invalid low value for NoAD tiebreak":(u=!0,n=(n||"")+r):d=_?"tiebreak begins with zero":"tiebreak digit limit"}else if(f.isCloser)d=`invalid key: ${r}`;else if(f.isGameScoreEntry)d="game scoreString entry";else if(f.lastSetIsComplete||!o.length){u=!0;const{scoreString:m,set:g}=lk({analysis:f,lowSide:e,scoreString:n,value:parseInt(r)});g&&(g.setNumber=(o==null?void 0:o.length)+1||1),o=(o==null?void 0:o.concat(g).filter(Boolean))||[g],n=m||void 0}else console.log("error: unknown outcome")}if(u){o=o==null?void 0:o.filter(Boolean);const{matchUpWinningSide:m}=$_({sets:o,winningSide:i,matchUpStatus:s,matchUpFormat:a});return i=m,m&&(!s||[pt,Hn].includes(s))?(s=YG,o=o.filter(g=>{const{side1Score:h,side2Score:_,side1TiebreakScore:I,side2TiebreakScore:P}=g;return h||_||I||P})):n&&!i&&![f1,p1,m1].includes(s)&&(s=void 0),{updated:u,scoreString:n,sets:o,winningSide:i,matchUpStatus:s,info:d}}return{updated:u,scoreString:n,sets:o,winningSide:i,matchUpStatus:s,info:d}}function pk({matchUpScoringFormat:t,isDecidingSet:e,isTiebreakSet:r,setObject:n}){if(!n)return;const o=N1({set:n});return fk({matchUpScoringFormat:t,isDecidingSet:e,isTiebreakSet:r,set:n})&&o||void 0}function fk({ignoreTiebreak:t=!1,matchUpScoringFormat:e,matchUpFormat:r,isTiebreakSet:n,isDecidingSet:o,set:i}){if(!i)return{error:Se,info:"missing set"};e=e||r;const s=o&&e.finalSetFormat||(e==null?void 0:e.setFormat)||{},{side1Score:a,side2Score:c}=i,{setTo:l,tiebreakAt:u,tiebreakFormat:d}=s,p=d==null?void 0:d.NoAd,v=N1({set:i}),f=Math.abs(a-c),m=a>=l||c>=l,g=n||a>=l&&c>=l||u&&u<l&&(a===u||c===u),h=t||g&&(v===1&&i.side1TiebreakScore>i.side2TiebreakScore||v===2&&i.side2TiebreakScore>i.side1TiebreakScore),I=f>=(g&&(u&&!n||n&&p)?1:2);return(m&&(I||g)||n)&&(!g||h)}function N1({set:t}){if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}function nu(t){const{setObject:e,matchUpScoringFormat:r}=t;if(!e)return{error:Zf};const{setNumber:n}=e||{},{bestOf:o}=r||{},i=!!(n&&o&&n===o),s=i&&(r==null?void 0:r.finalSetFormat)||(r==null?void 0:r.setFormat),a=!!(s!=null&&s.tiebreakSet),c=!!(s!=null&&s.timed),l=!a&&!c,u=!!(n&&o&&n<=o),d=[e==null?void 0:e.side1Score,e==null?void 0:e.side2Score],p=[e==null?void 0:e.side1PointScore,e==null?void 0:e.side2PointScore],v=[e==null?void 0:e.side1TiebreakScore,e==null?void 0:e.side2TiebreakScore],f=d.filter(C=>C!==void 0).length,m=p.filter(C=>C!==void 0).length,g=v.filter(C=>C!==void 0).length,h=d==null?void 0:d.filter(C=>!isNaN(C)).length,_=v==null?void 0:v.filter(C=>!isNaN(C)).length,{tiebreakAt:I}=s||{},P=I&&d.filter(C=>C>=I).length===2,S=P&&(d[0]>d[1]&&1||d[1]>d[0]&&2||void 0),y=!!(_&&!h),O=!!(e!=null&&e.winningSide),{error:b,result:E}=vk({setObject:e,setFormat:s,sideGameScores:d,sideTiebreakScores:v}),{error:T,result:N}=mk({setObject:e,setFormat:s,sideTiebreakScores:v}),w=l&&!y&&E||a&&y&&N,$=u&&!(a&&!y)&&!(l&&y)&&(!O||w),U=pk({isDecidingSet:i,isTiebreakSet:y,matchUpScoringFormat:r,setObject:e}),A={expectTiebreakSet:a,expectTimedSet:c,hasTiebreakCondition:P,isCompletedSet:O,isDecidingSet:i,isTiebreakSet:y,isValidSet:$,isValidSetNumber:u,isValidSetOutcome:w,leadingSide:S,setFormat:s,sideGameScores:d,sideGameScoresCount:f,sidePointScores:p,sidePointScoresCount:m,sideTiebreakScores:v,sideTiebreakScoresCount:g,winningSide:U};return(e==null?void 0:e.winningSide)!==void 0&&(y?(A.isValidTiebreakSetOutcome=N,N||(A.tiebreakSetError=T)):(A.isValidStandardSetOutcome=E,E||(A.standardSetError=b))),A}function vk({setObject:t,setFormat:e,sideGameScores:r,sideTiebreakScores:n}){if(!t)return{result:!1,error:Zf};const o=!!(e!=null&&e.tiebreakSet),i=!!(e!=null&&e.timed);if(!e||o||i)return{result:!1,error:Z};if(!((r==null?void 0:r.filter(N=>!isNaN(N)).length)===2))return{result:!1,error:Yg};const{setTo:a,tiebreakAt:c,tiebreakFormat:l,NoAD:u}=e||{};if(!!!(a&&(r!=null&&r.find(N=>N>=a))))return{result:!1,error:Yg};const p=[1,2].includes(t==null?void 0:t.winningSide);if(!t||!p)return{result:!1,error:mA};const v=(t==null?void 0:t.winningSide)-1,f=1-v,m=r[v],g=r[f],h=m-g;if(!(m>g))return{result:!1,error:{message:"winningSide game scoreString is not high"}};const I=c&&l,P=(n==null?void 0:n.filter(N=>!isNaN(N)).length)===2,S=n==null?void 0:n[v],y=n==null?void 0:n[f],O=c&&r.filter(N=>N>=c).length===2;if(I){const{NoAD:N,tiebreakTo:w}=l;if(O){if(h>1)return{result:!1,error:{message:"invalid winning game scoreString (5)"}};if(!P)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(w))return{result:!1,error:{message:"tiebreakTo error"}};if(!!!(w&&(n!=null&&n.find(R=>R>=w))))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};const A=c<a?a:a+1;if(m>A)return{result:!1,error:{message:"invalid winning game scoreString (1)"}};if(!S||!y||S<y)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};const C=N?1:2,M=S-y,D=y>=w-1;if(M&&D&&M<C)return{result:!1,error:{message:"invalid tiebreak scores (3)"}}}if(m>a&&!O)return{result:!1,error:{message:"invalid winning game scoreString (2)"}}}const b=u?1:2,E=g>=a-1;return h&&E&&!O&&h<b?{result:!1,error:{message:"invalid winning game scoreString (3)"}}:h>b&&m>a?{result:!1,error:{message:"invalid winning game scoreString (4)"}}:{result:!0}}function mk({setObject:t,setFormat:e,sideTiebreakScores:r}){if(!t)return{result:!1,error:Zf};const n=!!(e!=null&&e.tiebreakSet),o=!!(e!=null&&e.timed);if(!e||!n||o)return{result:!1,error:{message:"not tiebreak set"}};const i=[1,2].includes(t==null?void 0:t.winningSide);if(!t||!i)return{result:!1,error:mA};const{tiebreakSet:s}=e||{},{NoAD:a,tiebreakTo:c}=s||{};if(!((r==null?void 0:r.filter(I=>!isNaN(I)).length)===2))return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(c))return{result:!1,error:{message:"tiebreakTo error"}};if(!!!(r!=null&&r.find(I=>I>=c)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};const d=(t==null?void 0:t.winningSide)-1,p=1-d,v=r[d],f=r[p];if(!v||!f||v<f)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};const m=a?1:2,g=v-f,h=f>=c-1;return g&&h&&g<m?{result:!1,error:{message:"invalid tiebreak scores (3)"}}:{result:!0}}var gk=Object.defineProperty,A_=Object.getOwnPropertySymbols,hk=Object.prototype.hasOwnProperty,_k=Object.prototype.propertyIsEnumerable,U_=(t,e,r)=>e in t?gk(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ik=(t,e)=>{for(var r in e||(e={}))hk.call(e,r)&&U_(t,r,e[r]);if(A_)for(var r of A_(e))_k.call(e,r)&&U_(t,r,e[r]);return t};function Pk({score:t}={}){if(!t)return{error:Se};const{sets:e}=t,r=e.map(i=>{const{side1TiebreakScore:s,side2TiebreakScore:a,winningSide:c,side1Score:l,side2Score:u,setNumber:d}=i;return _e({winningSide:c?3-c:void 0,side1TiebreakScore:a,side2TiebreakScore:s,side1Score:u,side2Score:l,setNumber:d})}),n=xn({sets:r}),o=xn({sets:r,reversed:!0});return Ik({reversedScore:{sets:r,scoreStringSide1:n,scoreStringSide2:o}},B)}const $1=t=>{const{isSide1:e,lowValue:r,setTo:n,tiebreakAt:o,NoAD:i}=t;if(r===void 0)return!1;let s=typeof r=="string"?parseInt(r):r;(s==null?void 0:s.toString().length)>2&&(s=parseInt(s.toString().slice(0,2))),o&&o<n&&s>o&&(s=o);let a;return i&&!o?a=s<n?n:n-1:a=s+1<n&&n||o&&o<n&&s===o&&n||!o&&s+2||n+1,[e?s:a,e?a:s]},Kv=t=>{const{isSide1:e,lowValue:r,tiebreakTo:n,tiebreakNoAd:o}=t;if(r===void 0)return!1;let i=typeof r=="string"?parseInt(r):r;(i==null?void 0:i.toString().length)>2&&(i=parseInt(i.toString().slice(0,2))),o&&i>n-1&&(i=n-1);const s=yk({lowValue:i,NoAD:o,tiebreakTo:n});return[e?i:s,e?s:i]};function yk(t){const{lowValue:e,NoAD:r,tiebreakTo:n}=t,o=r?1:2;return e+1>=n?e+o:n}const A1={stringifyMatchUpFormat:Wf,isValidMatchUpFormat:Br,parseMatchUpFormat:Ir,generateTieMatchUpScore:Lc,getTiebreakComplement:Kv,updateTieMatchUpScore:to,generateScoreString:xn,checkSetIsComplete:o1,validateTieFormat:cr,getSetComplement:$1,scoreHasValue:At,keyValueScore:dk,validateScore:Wv,reverseScore:Pk,analyzeSet:nu};function U1(t){return t&&typeof String.fromCodePoint<"u"?t.toUpperCase().replace(/./g,e=>String.fromCodePoint(e.charCodeAt(0)+127397)):t}function Ok(t){const e=Object.assign({},...Ao.filter(r=>r.ioc).map(r=>({[r.ioc]:r.iso})));return U1(e[t])}const Ao=[{ioc:"",iso2:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso2:"AD",iso:"AND",label:"Andorra",phone:"376"},{ioc:"UAE",iso2:"AE",iso:"ARE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso2:"AF",iso:"AFG",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso2:"AG",iso:"ATG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso2:"AI",iso:"AIA",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso2:"AL",iso:"ALB",label:"Albania",phone:"355"},{ioc:"ARM",iso2:"AM",iso:"ARM",label:"Armenia",phone:"374"},{ioc:"ANG",iso2:"AO",iso:"AGO",label:"Angola",phone:"244"},{ioc:"",iso2:"AQ",iso:"ATA",label:"Antarctica",phone:"672"},{ioc:"ARG",iso2:"AR",iso:"ARG",label:"Argentina",phone:"54"},{ioc:"ASA",iso2:"AS",iso:"ASM",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso2:"AT",iso:"AUT",label:"Austria",phone:"43"},{ioc:"AUS",iso2:"AU",iso:"AUS",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso2:"AW",iso:"ABW",label:"Aruba",phone:"297"},{ioc:"AZE",iso2:"AZ",iso:"AZE",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso2:"BA",iso:"BIH",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso2:"BB",iso:"BRB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso2:"BD",iso:"BGD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso2:"BE",iso:"BEL",label:"Belgium",phone:"32"},{ioc:"BUR",iso2:"BF",iso:"BFA",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso2:"BG",iso:"BGR",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso2:"BH",iso:"BHR",label:"Bahrain",phone:"973"},{ioc:"BDI",iso2:"BI",iso:"BDI",label:"Burundi",phone:"257"},{ioc:"BEN",iso2:"BJ",iso:"BEN",label:"Benin",phone:"229"},{ioc:"",iso2:"BL",iso:"BLM",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso2:"BM",iso:"BMU",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso2:"BN",iso:"BRN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso2:"BO",iso:"BOL",label:"Bolivia",phone:"591"},{ioc:"BRA",iso2:"BR",iso:"BRA",label:"Brazil",phone:"55"},{ioc:"BAH",iso2:"BS",iso:"BHS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso2:"BT",iso:"BTN",label:"Bhutan",phone:"975"},{ioc:"",iso2:"BV",iso:"BVT",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso2:"BW",iso:"BWA",label:"Botswana",phone:"267"},{ioc:"BLR",iso2:"BY",iso:"BLR",label:"Belarus",phone:"375"},{ioc:"BIZ",iso2:"BZ",iso:"BLZ",label:"Belize",phone:"501"},{ioc:"CAN",iso2:"CA",iso:"CAN",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso2:"CC",iso:"CCK",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso2:"CD",iso:"COG",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso2:"CF",iso:"CAF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso2:"CG",iso:"CGD",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso2:"CH",iso:"CHE",label:"Switzerland",phone:"41"},{ioc:"CIV",iso2:"CI",iso:"CIV",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso2:"CK",iso:"COK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso2:"CL",iso:"CHL",label:"Chile",phone:"56"},{ioc:"CMR",iso2:"CM",iso:"CMR",label:"Cameroon",phone:"237"},{ioc:"CHN",iso2:"CN",iso:"CHN",label:"China",phone:"86"},{ioc:"COL",iso2:"CO",iso:"COL",label:"Colombia",phone:"57"},{ioc:"CRC",iso2:"CR",iso:"CRI",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso2:"CU",iso:"CUB",label:"Cuba",phone:"53"},{ioc:"CPV",iso2:"CV",iso:"CPV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso2:"CW",iso:"CUW",label:"Curacao",phone:"599"},{ioc:"CXR",iso2:"CX",iso:"CXR",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso2:"CY",iso:"CYP",label:"Cyprus",phone:"357"},{ioc:"CZE",iso2:"CZ",iso:"CZE",label:"Czech Republic",phone:"420"},{ioc:"GER",iso2:"DE",iso:"DEU",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso2:"DJ",iso:"DJI",label:"Djibouti",phone:"253"},{ioc:"DEN",iso2:"DK",iso:"DNK",label:"Denmark",phone:"45"},{ioc:"DMA",iso2:"DM",iso:"DMA",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso2:"DO",iso:"DOM",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso2:"DZ",iso:"DZA",label:"Algeria",phone:"213"},{ioc:"ECU",iso2:"EC",iso:"ECU",label:"Ecuador",phone:"593"},{ioc:"EST",iso2:"EE",iso:"ESE",label:"Estonia",phone:"372"},{ioc:"EGY",iso2:"EG",iso:"EGY",label:"Egypt",phone:"20"},{ioc:"",iso2:"EH",iso:"ESH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso2:"ER",iso:"ERI",label:"Eritrea",phone:"291"},{ioc:"ESP",iso2:"ES",iso:"ESP",label:"Spain",phone:"34"},{ioc:"ETH",iso2:"ET",iso:"ETH",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso2:"FI",iso:"FIN",label:"Finland",phone:"358"},{ioc:"FIJ",iso2:"FJ",iso:"FJI",label:"Fiji",phone:"679"},{ioc:"FLK",iso2:"FK",iso:"FLK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso2:"FM",iso:"FSM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso2:"FO",iso:"FRO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso2:"FR",iso:"FRA",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso2:"GA",iso:"GAB",label:"Gabon",phone:"241"},{ioc:"GBR",iso2:"GB",iso:"GBR",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso2:"GD",iso:"GRD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso2:"GE",iso:"GEO",label:"Georgia",phone:"995"},{ioc:"FGU",iso2:"GF",iso:"GUF",label:"French Guiana",phone:"594"},{ioc:"",iso2:"GG",iso:"GGY",label:"Guernsey",phone:"44"},{ioc:"",iso2:"GH",iso:"GHA",label:"Ghana",phone:"233"},{ioc:"GIB",iso2:"GI",iso:"GIB",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso2:"GL",iso:"GRL",label:"Greenland",phone:"299"},{ioc:"GAM",iso2:"GM",iso:"GMB",label:"Gambia",phone:"220"},{ioc:"GUI",iso2:"GN",iso:"GIN",label:"Guinea",phone:"224"},{ioc:"GUD",iso2:"GP",iso:"GLP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso2:"GQ",iso:"GNQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso2:"GR",iso:"GRC",label:"Greece",phone:"30"},{ioc:"",iso2:"GS",iso:"SGS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso2:"GT",iso:"GTM",label:"Guatemala",phone:"502"},{ioc:"GUM",iso2:"GU",iso:"GUM",label:"Guam",phone:"1-671"},{ioc:"GBS",iso2:"GW",iso:"GNB",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso2:"GY",iso:"GUY",label:"Guyana",phone:"592"},{ioc:"HKG",iso2:"HK",iso:"HKG",label:"Hong Kong",phone:"852"},{ioc:"",iso2:"HM",iso:"HMD",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso2:"HN",iso:"HND",label:"Honduras",phone:"504"},{ioc:"CRO",iso2:"HR",iso:"HRV",label:"Croatia",phone:"385"},{ioc:"HAI",iso2:"HT",iso:"HTI",label:"Haiti",phone:"509"},{ioc:"HUN",iso2:"HU",iso:"HUN",label:"Hungary",phone:"36"},{ioc:"INA",iso2:"ID",iso:"IDN",label:"Indonesia",phone:"62"},{ioc:"IRL",iso2:"IE",iso:"IRL",label:"Ireland",phone:"353"},{ioc:"ISR",iso2:"IL",iso:"ISR",label:"Israel",phone:"972"},{ioc:"",iso2:"IM",iso:"IMN",label:"Isle of Man",phone:"44"},{ioc:"IND",iso2:"IN",iso:"IND",label:"India",phone:"91"},{ioc:"",iso2:"IO",iso:"IOT",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso2:"IQ",iso:"IRQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso2:"IR",iso:"IRN",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso2:"IS",iso:"ISL",label:"Iceland",phone:"354"},{ioc:"ITA",iso2:"IT",iso:"ITA",label:"Italy",phone:"39"},{ioc:"",iso2:"JE",iso:"JEY",label:"Jersey",phone:"44"},{ioc:"JAM",iso2:"JM",iso:"JAM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso2:"JO",iso:"JOR",label:"Jordan",phone:"962"},{ioc:"JPN",iso2:"JP",iso:"JPN",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso2:"KE",iso:"KEN",label:"Kenya",phone:"254"},{ioc:"KGZ",iso2:"KG",iso:"KGZ",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso2:"KH",iso:"KHM",label:"Cambodia",phone:"855"},{ioc:"KIR",iso2:"KI",iso:"KIR",label:"Kiribati",phone:"686"},{ioc:"COM",iso2:"KM",iso:"COM",label:"Comoros",phone:"269"},{ioc:"SKN",iso2:"KN",iso:"KNA",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso2:"KP",iso:"KOR",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso2:"KR",iso:"PRK",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso2:"KW",iso:"KWT",label:"Kuwait",phone:"965"},{ioc:"CAY",iso2:"KY",iso:"CYM",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso2:"KZ",iso:"KAZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso2:"LA",iso:"LAO",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso2:"LB",iso:"LBN",label:"Lebanon",phone:"961"},{ioc:"LCA",iso2:"LC",iso:"LCA",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso2:"LI",iso:"LIE",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso2:"LK",iso:"LKA",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso2:"LR",iso:"LBR",label:"Liberia",phone:"231"},{ioc:"LES",iso2:"LS",iso:"LSO",label:"Lesotho",phone:"266"},{ioc:"LTU",iso2:"LT",iso:"LTU",label:"Lithuania",phone:"370"},{ioc:"LUX",iso2:"LU",iso:"LUX",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso2:"LV",iso:"LVA",label:"Latvia",phone:"371"},{ioc:"LBA",iso2:"LY",iso:"LBY",label:"Libya",phone:"218"},{ioc:"MAR",iso2:"MA",iso:"MAR",label:"Morocco",phone:"212"},{ioc:"MON",iso2:"MC",iso:"MCO",label:"Monaco",phone:"377"},{ioc:"MDA",iso2:"MD",iso:"MDA",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso2:"ME",iso:"MNE",label:"Montenegro",phone:"382"},{ioc:"",iso2:"MF",iso:"MAF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso2:"MG",iso:"MDG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso2:"MH",iso:"MHL",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso2:"MK",iso:"MKD",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso2:"ML",iso:"MLI",label:"Mali",phone:"223"},{ioc:"MYA",iso2:"MM",iso:"MMR",label:"Myanmar",phone:"95"},{ioc:"MGL",iso2:"MN",iso:"MNG",label:"Mongolia",phone:"976"},{ioc:"MAC",iso2:"MO",iso:"MAC",label:"Macao",phone:"853"},{ioc:"NMA",iso2:"MP",iso:"NMP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso2:"MQ",iso:"MTQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso2:"MR",iso:"MRT",label:"Mauritania",phone:"222"},{ioc:"MNT",iso2:"MS",iso:"MSR",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso2:"MT",iso:"MLT",label:"Malta",phone:"356"},{ioc:"MRI",iso2:"MU",iso:"MUS",label:"Mauritius",phone:"230"},{ioc:"MDV",iso2:"MV",iso:"MDV",label:"Maldives",phone:"960"},{ioc:"MAW",iso2:"MW",iso:"MWI",label:"Malawi",phone:"265"},{ioc:"MEX",iso2:"MX",iso:"MEX",label:"Mexico",phone:"52"},{ioc:"MAS",iso2:"MY",iso:"MYS",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso2:"MZ",iso:"MOZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso2:"NA",iso:"NAM",label:"Namibia",phone:"264"},{ioc:"NCL",iso2:"NC",iso:"NCL",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso2:"NE",iso:"NER",label:"Niger",phone:"227"},{ioc:"NFI",iso2:"NF",iso:"NFK",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso2:"NG",iso:"NGA",label:"Nigeria",phone:"234"},{ioc:"NCA",iso2:"NI",iso:"NIC",label:"Nicaragua",phone:"505"},{ioc:"NED",iso2:"NL",iso:"NLD",label:"Netherlands",phone:"31"},{ioc:"NOR",iso2:"NO",iso:"NOR",label:"Norway",phone:"47"},{ioc:"NEP",iso2:"NP",iso:"NPL",label:"Nepal",phone:"977"},{ioc:"NRU",iso2:"NR",iso:"NRU",label:"Nauru",phone:"674"},{ioc:"NIU",iso2:"NU",iso:"NIU",label:"Niue",phone:"683"},{ioc:"NZL",iso2:"NZ",iso:"NZL",label:"New Zealand",phone:"64"},{ioc:"OMA",iso2:"OM",iso:"OMN",label:"Oman",phone:"968"},{ioc:"PAN",iso2:"PA",iso:"PAN",label:"Panama",phone:"507"},{ioc:"PER",iso2:"PE",iso:"PER",label:"Peru",phone:"51"},{ioc:"FPO",iso2:"PF",iso:"PYF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso2:"PG",iso:"PNG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso2:"PH",iso:"PHL",label:"Philippines",phone:"63"},{ioc:"PAK",iso2:"PK",iso:"PAK",label:"Pakistan",phone:"92"},{ioc:"POL",iso2:"PL",iso:"POL",label:"Poland",phone:"48"},{ioc:"SPM",iso2:"PM",iso:"SPM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso2:"PN",iso:"PCN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso2:"PR",iso:"PRI",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso2:"PS",iso:"PSE",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso2:"PT",iso:"PRT",label:"Portugal",phone:"351"},{ioc:"PLW",iso2:"PW",iso:"PLW",label:"Palau",phone:"680"},{ioc:"PAR",iso2:"PY",iso:"PRY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso2:"QA",iso:"QAT",label:"Qatar",phone:"974"},{ioc:"REU",iso2:"RE",iso:"REU",label:"Reunion",phone:"262"},{ioc:"ROU",iso2:"RO",iso:"ROU",label:"Romania",phone:"40"},{ioc:"SRB",iso2:"RS",iso:"SRB",label:"Serbia",phone:"381"},{ioc:"RUS",iso2:"RU",iso:"RUS",label:"Russia",phone:"7"},{ioc:"RWA",iso2:"RW",iso:"RWA",label:"Rwanda",phone:"250"},{ioc:"KSA",iso2:"SA",iso:"SAU",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso2:"SB",iso:"SLB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso2:"SC",iso:"SYC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso2:"SD",iso:"SDN",label:"Sudan",phone:"249"},{ioc:"SWE",iso2:"SE",iso:"SWE",label:"Sweden",phone:"46"},{ioc:"SIN",iso2:"SG",iso:"SGP",label:"Singapore",phone:"65"},{ioc:"HEL",iso2:"SH",iso:"SHN",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso2:"SI",iso:"SVN",label:"Slovenia",phone:"386"},{ioc:"",iso2:"SJ",iso:"SJM",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso2:"SK",iso:"SVK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso2:"SL",iso:"SLE",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso2:"SM",iso:"SMR",label:"San Marino",phone:"378"},{ioc:"SEN",iso2:"SN",iso:"SEN",label:"Senegal",phone:"221"},{ioc:"SOM",iso2:"SO",iso:"SOM",label:"Somalia",phone:"252"},{ioc:"SUR",iso2:"SR",iso:"SUR",label:"Suriname",phone:"597"},{ioc:"",iso2:"SS",iso:"SSD",label:"South Sudan",phone:"211"},{ioc:"STP",iso2:"ST",iso:"STP",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso2:"SV",iso:"SLV",label:"El Salvador",phone:"503"},{ioc:"",iso2:"SX",iso:"SMX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso2:"SY",iso:"SYR",label:"Syria",phone:"963"},{ioc:"",iso2:"SZ",iso:"SWZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso2:"TC",iso:"TCA",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso2:"TD",iso:"TCD",label:"Chad",phone:"235"},{ioc:"",iso2:"TF",iso:"ATF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso2:"TG",iso:"TGO",label:"Togo",phone:"228"},{ioc:"THA",iso2:"TH",iso:"THA",label:"Thailand",phone:"66"},{ioc:"TJK",iso2:"TJ",iso:"TJK",label:"Tajikistan",phone:"992"},{ioc:"",iso2:"TK",iso:"TKL",label:"Tokelau",phone:"690"},{ioc:"TLS",iso2:"TL",iso:"TLS",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso2:"TM",iso:"TKM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso2:"TN",iso:"TUN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso2:"TO",iso:"TON",label:"Tonga",phone:"676"},{ioc:"TUR",iso2:"TR",iso:"TUR",label:"Turkey",phone:"90"},{ioc:"TTO",iso2:"TT",iso:"TTO",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso2:"TV",iso:"TUV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso2:"TW",iso:"TWN",label:"Taiwan",phone:"886"},{ioc:"TAN",iso2:"TZ",iso:"TZA",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso2:"UA",iso:"UKR",label:"Ukraine",phone:"380"},{ioc:"UGA",iso2:"UG",iso:"UGA",label:"Uganda",phone:"256"},{ioc:"USA",iso2:"US",label:"United States",phone:"1",suggested:!0,iso:"USA"},{ioc:"URU",iso2:"UY",iso:"URY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso2:"UZ",iso:"UZB",label:"Uzbekistan",phone:"998"},{ioc:"",iso2:"VA",iso:"VAT",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso2:"VC",iso:"VCT",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso2:"VE",iso:"VEN",label:"Venezuela",phone:"58"},{ioc:"IVB",iso2:"VG",iso:"VGB",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso2:"VI",iso:"VIR",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso2:"VN",iso:"VNM",label:"Vietnam",phone:"84"},{ioc:"VAN",iso2:"VU",iso:"VUT",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso2:"WF",iso:"WLF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso2:"WS",iso:"WSM",label:"Samoa",phone:"685"},{ioc:"KOS",iso2:"XK",iso:"KOS",label:"Kosovo",phone:"383"},{ioc:"YEM",iso2:"YE",iso:"YEM",label:"Yemen",phone:"967"},{ioc:"MAY",iso2:"YT",iso:"MYT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso2:"ZA",iso:"ZAF",label:"South Africa",phone:"27"},{ioc:"ZAM",iso2:"ZM",iso:"ZMB",label:"Zambia",phone:"260"},{ioc:"ZIM",iso2:"ZW",iso:"ZWE",label:"Zimbabwe",phone:"263"}],Fi="ELO",Sk="NTRP",bk="UTR",C1="WTN",Bn={[Fi]:{range:[0,3e3],decimalsCount:0,defaultInitialization:1500},[Sk]:{range:[1,7],decimalsCount:1,defaultInitialization:3,accessor:"dntrpRatingHundredths",accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""}},[bk]:{range:[1,16],decimalsCount:2,defaultInitialization:6},[C1]:{range:[40,1],decimalsCount:2,defaultInitialization:23,accessor:"wtnRating",accessors:["wtnRating"],attributes:{confidence:{generator:!0,range:[60,100]}}}};var Tk=[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],Ek="COLLEGE_D3",wk={valueGoal:5},Nk={collectionDefinitions:Tk,tieFormatName:Ek,winCriteria:wk},$k=[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],Ak="COLLEGE_DEFAULT",Uk={valueGoal:5},Ck={collectionDefinitions:$k,tieFormatName:Ak,winCriteria:Uk},Mk=[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],Dk="COLLEGE_JUCO",jk={valueGoal:5},Rk={collectionDefinitions:Mk,tieFormatName:Dk,winCriteria:jk},Fk=[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],Vk="DOMINANT_DUO",Lk={valueGoal:2},M1={collectionDefinitions:Fk,tieFormatName:Vk,winCriteria:Lk},Bk=[{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],xk="DOMINANT_DUO_MIXED",Gk={valueGoal:2},D1={collectionDefinitions:Bk,tieFormatName:xk,winCriteria:Gk},kk=[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],Wk=[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}],qk="LAVER_CUP",Hk={valueGoal:13},j1={collectionDefinitions:kk,collectionGroups:Wk,tieFormatName:qk,winCriteria:Hk},Yk=[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],Kk="Doubles Shuffle",zk=!0,Qk={aggregateValue:!0},R1={collectionDefinitions:Yk,tieFormatName:Kk,unrestrictedSelections:zk,winCriteria:Qk},Jk=[{category:{ageCategoryCode:"14U"},collectionName:"14U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],Zk=[{groupNumber:1,groupName:"Doubles",groupValue:1,winCriteria:{valueGoal:2}}],Xk="USTA_BREWER_CUP",e3={valueGoal:4},F1={collectionDefinitions:Jk,collectionGroups:Zk,tieFormatName:Xk,winCriteria:e3},t3={valueGoal:23},r3="USTA_OZAKI_CUP",n3=[{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},collectionName:"18U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},collectionName:"16U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},collectionName:"14U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},collectionName:"12U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1}],V1={winCriteria:t3,tieFormatName:r3,collectionDefinitions:n3},o3=[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",collectionValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],i3="USTA_COLLEGE",s3={valueGoal:4},L1={collectionDefinitions:o3,tieFormatName:i3,winCriteria:s3},a3=[{collectionName:"Male Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpCount:4,matchUpValue:1,gender:"MALE"},{collectionName:"Female Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:4,matchUpValue:1},{collectionName:"Male Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:2,matchUpValue:1,gender:"MALE"},{collectionName:"Female Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:2,matchUpValue:1},{collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:4,matchUpValue:1,gender:"MIXED"}],c3="USTA_GOLD_TEAM_CHALLENGE",l3={valueGoal:9},B1={collectionDefinitions:a3,tieFormatName:c3,winCriteria:l3},u3=[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],d3="USTA_INTERSECTIONAL",p3={valueGoal:8},x1={collectionDefinitions:u3,tieFormatName:d3,winCriteria:p3},f3=[{collectionName:"Male Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],v3="USTA_LEVEL_1",m3={valueGoal:10},G1={collectionDefinitions:f3,tieFormatName:v3,winCriteria:m3},g3=[{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Tiebreak Doubles",matchUpCount:1,matchUpFormat:"SET1-S:TB10",matchUpType:"DOUBLES",matchUpValue:1,processCodes:["RANKING.IGNORE"]}],h3="USTA_SECTION_BATTLE",_3={valueGoal:9},k1={collectionDefinitions:g3,tieFormatName:h3,winCriteria:_3},I3=[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],P3="USTA_SOUTHERN_LEVEL_5",y3={valueGoal:8},W1={collectionDefinitions:I3,tieFormatName:P3,winCriteria:y3},O3=[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],S3="USTA_TOC",b3={aggregateValue:!0},q1={collectionDefinitions:O3,tieFormatName:S3,winCriteria:b3},T3=[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],E3="USTA_WTT_ITT",w3={aggregateValue:!0},H1={collectionDefinitions:T3,tieFormatName:E3,winCriteria:w3},N3=[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],$3="USTA_ZONAL",A3={valueGoal:10},Y1={collectionDefinitions:N3,tieFormatName:$3,winCriteria:A3};const K1={COLLEGE_D3:Nk,COLLEGE_DEFAULT:Ck,COLLEGE_JUCO:Rk,DOMINANT_DUO:M1,DOMINANT_DUO_MIXED:D1,LAVER_CUP:j1,TEAM_DOUBLES_3_AGGREGATION:R1,USTA_BREWER_CUP:F1,USTA_OZAKI_CUP:V1,USTA_COLLEGE:L1,USTA_GOLD_TEAM_CHALLENGE:B1,USTA_INTERSECTIONAL:x1,USTA_LEVEL_1:G1,USTA_SECTION_BATTLE:k1,USTA_SOUTHERN_LEVEL_5:W1,USTA_TOC:q1,USTA_WTT_ITT:H1,USTA_ZONAL:Y1},U3={[VV]:{roundsToSeparate:void 0,policyName:"Nationality Code",policyAttributes:[{key:"person.nationalityCode"},{key:"individualParticipants.person.nationalityCode"}]}},C3="qualifierDrawPositionAssignment",M3="withdrawParticipantAtDrawPosition",D3="alternateDrawPositionAssignment",j3="luckyLoserDrawPositionAssignment",C_="removeDrawPositionAssignment",R3="swapDrawPositionAssignments",F3="modifyPairAssignment",V3="modifyParticipantOtherName",M_="assignMatchUpSideParticipant",D_="assignDrawPosition",L3="removeSeededParticipant",B3="assignDrawPositionBye",x3="modifySeedAssignment",z1="addPenalty",Q1="MODIFY_PAIR",zv="QUALIFIER",J1="ALTERNATE",Z1="WITHDRAW",Ys="ASSIGN",j_="REMOVE",X1="LUCKY",Cl="REMOVE_SEED",eC="SWAP",ou="NICKNAME",Rs="SEED_VALUE",Ks="PENALTY",If="BYE",tC={[lo]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[Ie,ue],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[ou,Ks,zv,Rs],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1,activePositionOverrides:[]}},G3={[lo]:{policyName:"positionActionsDisabled",enabledStructures:!1}},k3={[lo]:{policyName:"positionActionsNoMovement",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[Rs,ou,Ks],disabledActions:[]}]}},W3={[lo]:{policyName:"positionActionsUnrestricted",enabledStructures:[],otherFlightEntries:!0,disableRoundRestrictions:!0,activePositionOverrides:[Rs,Cl]}},q3={[Sc]:{policyName:"Participant Privacy Policy",participant:{contacts:!1,individualParticipants:{onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}},individualParticipantIds:!0,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},yp="ADULT",Op="JUNIOR",pl="WHEELCHAIR",H3={[fv]:{defaultTimes:{averageTimes:[{categoryNames:[],minutes:{default:90}}],recoveryTimes:[{minutes:{[ot]:30,default:60}}]},defaultDailyLimits:{[ut]:2,[ot]:2,total:3},matchUpAverageTimes:[{matchUpFormatCodes:["SET3-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:90}},{categoryTypes:[pl],minutes:{default:120}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:85}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:70}}]},{matchUpFormatCodes:["SET3-S:4NOAD-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB7"],averageTimes:[{categoryNames:[],minutes:{default:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:50}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB5@3"],averageTimes:[{categoryNames:[],minutes:{default:45}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7"],averageTimes:[{categoryNames:[],minutes:{default:40}}]},{matchUpFormatCodes:["SET1-S:5/TB9@4"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6NOAD"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB7","SET1-S:4/TB5@3","SET3-S:TB10","SET1-S:T20"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:4NOAD"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:TB10"],averageTimes:[{categoryNames:[],minutes:{default:10}}]}],matchUpRecoveryTimes:[{matchUpFormatCodes:["SET3-S:6/TB7","SET3-S:6/TB7-F:TB10","SET3-S:6/TB7-F:TB7"],recoveryTimes:[{categoryTypes:[yp,pl],minutes:{default:60,[ot]:30}},{categoryTypes:[Op],minutes:{default:60,[ot]:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7","SET3-S:4/TB7-F:TB10","SET3-S:4NOAD-F:TB7","SET3-S:4/TB7","SET3-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[yp,pl],minutes:{default:30}},{categoryTypes:[Op],minutes:{default:60}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7","SET1-S:5/TB9@4","SET1-S:6/TB7","SET1-S:6NOAD","SET1-S:4/TB7","SET1-S:4NOAD","SET3-S:TB10","SET1-S:T20"],recoveryTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[yp,Op],minutes:{default:30}},{categoryTypes:[pl],minutes:{default:15}}]},{matchUpFormatCodes:["SET1-S:TB10"],recoveryTimes:[{categoryNames:[],minutes:{default:15}}]}],matchUpDailyLimits:[]}},Y3={[va]:{requireAllPositionsAssigned:!1,stage:{[ue]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},defaultMatchUpFormat:"SET3-S:6/TB7",matchUpFormats:[{description:"Best of 3 tiebreak sets",matchUpFormat:"SET3-S:6/TB7",categoryNames:[],categoryTypes:[]},{description:"Two tiebreak sets, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB7"},{description:"Two tiebreak sets, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB10"},{description:"One standard tiebreak set to 6, 7-point tiebreak at 6 games all",matchUpFormat:"SET1-S:6/TB7"},{description:"Best of 3 sets to 4",matchUpFormat:"SET3-S:4/TB7"},{description:"Two out of three short sets to 4 with 5-point tiebreak at 3 games all",matchUpFormat:"SET3-S:4/TB5@3"},{description:"One short set to 4, 7-point tiebreak at 4 games all",matchUpFormat:"SET1-S:4/TB7"},{description:"One short set to 4, 5-point tiebreak at 3 games all",matchUpFormat:"SET1-S:4/TB5@3"},{description:"Two short sets to 4, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB10"},{description:"Two short sets to 4, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB7"},{description:"One no advantage set to 5, tiebreak to 9 at 4-4",matchUpFormat:"SET1-S:5/TB9@4"},{description:"One set to 6 with deciding game at 5 games all",matchUpFormat:"SET1-S:6NOAD"},{description:"One short set to 4, deciding game is played at 3 games all",matchUpFormat:"SET1-S:4NOAD"},{description:"Two short sets to 4 with deciding game at 3-3, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4NOAD-F:TB7"},{description:"8 game pro-set with 7 point tiebreak at 8 games all",matchUpFormat:"SET1-S:8/TB7"},{description:"8 game pro-set with 7 point tiebreak at 7 games all",matchUpFormat:"SET1-S:8/TB7@7"},{description:"Best of 3 10-point tiebreak games",matchUpFormat:"SET3-S:TB10"},{description:"One 10-point tiebreak game",matchUpFormat:"SET1-S:TB10"},{description:"Timed 20 minute game - game based",matchUpFormat:"SET1-S:T20"}]}},K3={[va]:{defaultMatchUpFormat:"SET3-S:6/TB7",requireAllPositionsAssigned:!1,processCodes:{incompleteAssignmentsOnDefault:["RANKING.IGNORE"]},stage:{[ue]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}}}},z3={[fa]:{seedingProfile:{positioning:Uv},validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,policyName:"ITF SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:97,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},Pf={[fa]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:$x,policyName:"USTA SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},Q3={POLICY_AVOIDANCE_COUNTRY:U3,POLICY_POSITION_ACTIONS_DEFAULT:tC,POLICY_POSITION_ACTIONS_DISABLED:G3,POLICY_POSITION_ACTIONS_NO_MOVEMENT:k3,POLICY_POSITION_ACTIONS_UNRESTRICTED:W3,POLICY_PRIVACY_DEFAULT:q3,POLICY_ROUND_NAMING_DEFAULT:JU,POLICY_SCHEDULING_USTA:H3,POLICY_SCORING_DEFAULT:K3,POLICY_SCORING_USTA:Y3,POLICY_SEEDING_ITF:z3,POLICY_SEEDING_USTA:Pf},J3={ratingsParameters:Bn,matchUpFormats:SV,countryToFlag:U1,tieFormats:K1,countries:Ao,policies:Q3,flagIOC:Ok};function Pa({collectionDefinitions:t=[],collectionGroups:e=[]}={}){let r=0;const{groupValueNumbers:n}=XU({collectionGroups:e});let o;for(const s of t||[]){const{collectionValueProfiles:a,collectionGroupNumber:c,collectionValue:l,matchUpCount:u,matchUpValue:d,scoreValue:p,setValue:v}=s,f=c&&n.includes(c);if(v||p)o=!0;else{if(f)continue;if(l)r+=l;else if(a!=null&&a.length)for(const m of a)r+=m.matchUpValue;else d?r+=u*d:r+=u}}for(const s of e)r+=s.groupValue||0;return o||!r?{aggregateValue:!0}:{valueGoal:Math.floor(r/2)+1}}function md({participant:t,withISO2:e,withIOC:r}){const{person:n,individualParticipants:o}=t,i=[n,o==null?void 0:o.map(({person:a})=>a)].flat().filter(Boolean);function s(a){const{nationalityCode:c}=a||{};if(c){const l=Ao.find(({iso:u})=>u===c);r&&(l!=null&&l.ioc)&&!a.iocNationalityCode&&(a.iocNationalityCode=l.ioc),e&&(l!=null&&l.iso2)&&!a.iso2NationalityCode&&(a.iso2NationalityCode=l.iso2),l!=null&&l.label&&!a.countryName&&(a.countryName=l.label)}}i.forEach(s)}var Z3=Object.defineProperty,R_=Object.getOwnPropertySymbols,X3=Object.prototype.hasOwnProperty,e4=Object.prototype.propertyIsEnumerable,F_=(t,e,r)=>e in t?Z3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,t4=(t,e)=>{for(var r in e||(e={}))X3.call(e,r)&&F_(t,r,e[r]);if(R_)for(var r of R_(e))e4.call(e,r)&&F_(t,r,e[r]);return t};function pn({returnPreviousValues:t,itemSubTypes:e,itemType:r,element:n}){if(!n)return{error:Se,info:Iv};if(e&&!Array.isArray(e))return{error:Z,context:{itemSubTypes:e}};if(!Array.isArray(n.timeItems))return{error:EA};const o=n.timeItems.filter(s=>(s==null?void 0:s.itemType)===r).filter(s=>!(e!=null&&e.length)||e.some(a=>{var c;return(c=s==null?void 0:s.itemSubTypes)==null?void 0:c.includes(a)})).sort((s,a)=>new Date(s.createdAt||void 0)-new Date(a.createdAt||void 0)),i=o.pop();if(i){const s=t4({timeItem:i},B);return t&&Object.assign(s,{previousItems:o}),s}else return{info:Ht}}function r4({returnPreviousValues:t,drawDefinition:e,itemSubTypes:r,itemType:n}){if(!e)return{error:Mr};if(!e.timeItems)return{info:Ht};const{timeItem:o,previousItems:i,info:s}=pn({element:e,returnPreviousValues:t,itemSubTypes:r,itemType:n});return o&&{timeItem:o,previousItems:i}||{info:s}}function yo({returnPreviousValues:t,itemSubTypes:e,itemType:r,event:n}){if(!n)return{error:Re};if(!n.timeItems)return{info:Ht};const{timeItem:o,previousItems:i,info:s}=pn({returnPreviousValues:t,element:n,itemSubTypes:e,itemType:r});return o&&{timeItem:o,previousItems:i}||{info:s}}function gd({returnPreviousValues:t,tournamentRecord:e,itemSubTypes:r,itemType:n}){if(!e)return{error:ee};if(!e.timeItems)return{info:Ht};const{timeItem:o,previousItems:i,info:s}=pn({element:e,returnPreviousValues:t,itemSubTypes:r,itemType:n});return o&&{timeItem:o,previousItems:i}||{info:s}}function n4({returnPreviousValues:t,tournamentRecord:e,participantId:r,itemSubTypes:n,itemType:o}){if(!e)return{error:ee};if(!r)return{error:It};const i=qo({tournamentRecord:e,participantId:r});if(i.error)return i;const{participant:s}=i;if(!(s!=null&&s.timeItems))return{info:Ht};const{timeItem:a,previousItems:c,info:l}=pn({element:i.participant,returnPreviousValues:t,itemSubTypes:n,itemType:o});return a&&{timeItem:a,previousItems:c}||{info:l}}var o4=Object.defineProperty,V_=Object.getOwnPropertySymbols,i4=Object.prototype.hasOwnProperty,s4=Object.prototype.propertyIsEnumerable,L_=(t,e,r)=>e in t?o4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,fl=(t,e)=>{for(var r in e||(e={}))i4.call(e,r)&&L_(t,r,e[r]);if(V_)for(var r of V_(e))s4.call(e,r)&&L_(t,r,e[r]);return t};const a4={[dr]:"groupParticipantIds",[we]:"pairParticipantIds",[Ye]:"teamParticipantIds"},c4={[dr]:"groups",[Ye]:"teams"};function rC({withIndividualParticipants:t,convertExtensions:e,policyDefinitions:r,tournamentRecord:n,withSignInStatus:o,withScaleValues:i,internalUse:s,withISO2:a,withIOC:c}){const l=r==null?void 0:r[Sc],u=l==null?void 0:l.participant,d={};for(const p of n.participants||[]){const v=p==null?void 0:p.participantId;v&&p4({participantMap:d,participantId:v})}for(const p of n.participants||[]){const v=de(p,e,s),f=u?Yu({template:l.participant,source:v}):v,{participantId:m,individualParticipantIds:g,participantType:h}=f;if(Object.assign(d[m].participant,f),g&&d4({individualParticipantIds:g,filteredParticipant:f,participantMap:d,participantType:h,participantId:m}),o&&(d[m].participant.signedIn=l4(v)),i){const{ratings:_,rankings:I,seedings:P}=ga({participant:v});d[m].participant.seedings=P,d[m].participant.rankings=I,d[m].participant.ratings=_}(c||a)&&md({participant:d[m].participant,withISO2:a,withIOC:c})}return t&&u4({participantMap:d}),{participantMap:d}}function l4(t){const{timeItem:e}=pn({itemType:$c,element:t});return(e==null?void 0:e.itemValue)===nc}function u4({participantMap:t}){var e;for(const{participant:r}of Object.values(t))if((e=r.individualParticipantIds)!=null&&e.length){r.individualParticipants=[];for(const n of r.individualParticipantIds)r.individualParticipants.push(t[n].participant)}}function d4({individualParticipantIds:t,filteredParticipant:e,participantMap:r,participantType:n,participantId:o}){for(const i of t){const s=r[i].participant;if(s[a4[n]].push(o),[Ye,dr].includes(n)){const{participantRoleResponsibilities:a,participantOtherName:c,participantName:l,participantId:u,teamId:d}=e,p=c4[n];s[p].push({participantRoleResponsibilities:a,participantOtherName:c,participantName:l,participantId:u,teamId:d})}if(n===we){const a=t.find(c=>c!==i);r[i].pairIdMap[o]=a,r[i].pairIdMap[a]=o}}}function p4({participantMap:t,participantId:e}){if(t[e])return;const r={walkoverWins:0,defaultWins:0,walkovers:0,defaults:0,losses:0,wins:0};t[e]={structureParticipation:{},potentialMatchUps:{},scheduleConflicts:[],scheduleItems:[],participant:{groupParticipantIds:[],pairParticipantIds:[],teamParticipantIds:[],groups:[],teams:[]},statistics:{},opponents:{},pairIdMap:{},matchUps:{},events:{},draws:{},counters:fl({[ut]:fl({},r),[ot]:fl({},r),[Ye]:fl({},r)},r)}}var f4=Object.defineProperty,v4=Object.defineProperties,m4=Object.getOwnPropertyDescriptors,B_=Object.getOwnPropertySymbols,g4=Object.prototype.hasOwnProperty,h4=Object.prototype.propertyIsEnumerable,x_=(t,e,r)=>e in t?f4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Sp=(t,e)=>{for(var r in e||(e={}))g4.call(e,r)&&x_(t,r,e[r]);if(B_)for(var r of B_(e))h4.call(e,r)&&x_(t,r,e[r]);return t},_4=(t,e)=>v4(t,m4(e));function hs({participantsProfile:t,useParticipantMap:e,policyDefinitions:r,tournamentRecord:n,contextProfile:o,inContext:i}){var s;if(e)return{participantMap:(s=rC(_4(Sp(Sp({},t),o),{policyDefinitions:r,tournamentRecord:n,inContext:i})))==null?void 0:s.participantMap};let a=n.participants||[];if((t!=null&&t.withIOC||t!=null&&t.withISO2)&&a.forEach(c=>md(Sp({participant:c},t))),(i||t!=null&&t.withGroupings)&&(a!=null&&a.length)&&(a=kv({participantsProfile:t,participants:a})),t!=null&&t.withScaleValues&&(a!=null&&a.length))for(const c of a){const{ratings:l,rankings:u}=ga({participant:c});c.rankings=u,c.ratings=l}return{participants:a}}var I4=Object.defineProperty,P4=Object.defineProperties,y4=Object.getOwnPropertyDescriptors,G_=Object.getOwnPropertySymbols,O4=Object.prototype.hasOwnProperty,S4=Object.prototype.propertyIsEnumerable,k_=(t,e,r)=>e in t?I4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Bo=(t,e)=>{for(var r in e||(e={}))O4.call(e,r)&&k_(t,r,e[r]);if(G_)for(var r of G_(e))S4.call(e,r)&&k_(t,r,e[r]);return t},nC=(t,e)=>P4(t,y4(e));function Vt({scheduleVisibilityFilters:t,participantsProfile:e,afterRecoveryTimes:r,useParticipantMap:n,policyDefinitions:o,tournamentRecord:i,inContext:s=!0,contextProfile:a,matchUpFilters:c,contextFilters:l,participantMap:u,nextMatchUps:d,participants:p,context:v}){var f;if(!i)return{error:ee};const m=((f=i.unifiedTournamentId)==null?void 0:f.tournamentId)||i.tournamentId,g=(i==null?void 0:i.events)||[];p||({participants:p,participantMap:u}=hs({participantsProfile:e,policyDefinitions:o,useParticipantMap:n,tournamentRecord:i,contextProfile:a,inContext:s}));const{appliedPolicies:h}=ct({tournamentRecord:i}),_=nC(Bo({},v),{tournamentId:m,indoorOutDoor:i.indoorOutDoor,surfaceCategory:i.surfaceCategory,endDate:i.endDate}),I=Io({policyDefinitions:o,tournamentRecord:i,contextProfile:a});return{matchUps:g.map(S=>{var y;return _.eventDrawsCount=((y=S.drawDefinitions)==null?void 0:y.length)||0,Si({context:_,scheduleVisibilityFilters:t,tournamentAppliedPolicies:h,participantsProfile:e,afterRecoveryTimes:r,policyDefinitions:o,tournamentRecord:i,contextContent:I,contextFilters:l,contextProfile:a,matchUpFilters:c,participantMap:u,nextMatchUps:d,participants:p,inContext:s,event:S}).matchUps}).flat(1/0).concat(...i.matchUps||[])}}function Er({participants:t,scheduleVisibilityFilters:e,tournamentAppliedPolicies:r,participantsProfile:n,afterRecoveryTimes:o,policyDefinitions:i,useParticipantMap:s,tournamentRecord:a,contextContent:c,contextFilters:l,contextProfile:u,drawDefinition:d,matchUpFilters:p,participantMap:v,nextMatchUps:f,inContext:m,context:g,event:h}){const{eventId:_,eventName:I,eventType:P,category:S,gender:y,matchUpFormat:O}=h||{},b=nC(Bo({},g),{eventId:_,eventType:P,eventName:I,category:S,gender:y,matchUpFormat:O,indoorOutDoor:(h==null?void 0:h.indoorOutDoor)||(a==null?void 0:a.indoorOutDoor),surfaceCategory:(h==null?void 0:h.surfaceCategory)||(a==null?void 0:a.surfaceCategory),endDate:h==null?void 0:h.endDate});return!(t!=null&&t.length)&&!v&&a&&({participants:t=[],participantMap:v}=hs({participantsProfile:n,useParticipantMap:s,policyDefinitions:i,tournamentRecord:a,contextProfile:u,inContext:m})),u&&!c&&(c=Io({policyDefinitions:i,tournamentRecord:a,contextProfile:u,drawDefinition:d,event:h})),wt({context:b,tournamentAppliedPolicies:r,scheduleVisibilityFilters:e,tournamentParticipants:t,participantsProfile:n,afterRecoveryTimes:o,policyDefinitions:i,tournamentRecord:a,drawDefinition:d,contextContent:c,contextFilters:l,contextProfile:u,matchUpFilters:p,participantMap:v,nextMatchUps:f,inContext:m,event:h})}function Si({scheduleVisibilityFilters:t,tournamentAppliedPolicies:e,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:o,participants:i=[],useParticipantMap:s,tournamentRecord:a,contextContent:c,contextFilters:l,contextProfile:u,matchUpFilters:d,participantMap:p,nextMatchUps:v,inContext:f,context:m,event:g}){if(!g)return{error:Re};const{eventId:h,eventName:_,endDate:I,category:P,gender:S,matchUpFormat:y}=g,O=Bo(Bo({},m),_e({indoorOutDoor:g.indoorOutDoor||(a==null?void 0:a.indoorOutDoor),surfaceCategory:g.surfaceCategory||(a==null?void 0:a.surfaceCategory),endDate:g.endDate||(a==null?void 0:a.endDate),tournamentId:a==null?void 0:a.tournamentId,matchUpFormat:y,eventName:_,category:P,gender:S,eventId:h}));I&&(O.endDate=I),u&&!c&&(c=Io({policyDefinitions:o,tournamentRecord:a,contextProfile:u,event:g})),!(i!=null&&i.length)&&!p&&a&&({participants:i,participantMap:p}=hs({participantsProfile:r,useParticipantMap:s,policyDefinitions:o,tournamentRecord:a,contextProfile:u,inContext:f}));const b=g.drawDefinitions||[],E=bc({tournamentRecord:a,event:g}).scheduleTiming;return{matchUps:b.map(N=>{const{matchUps:w}=wt({tournamentParticipants:i,tournamentAppliedPolicies:e,scheduleVisibilityFilters:t,context:O,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:o,tournamentRecord:a,contextFilters:l,contextProfile:u,drawDefinition:N,contextContent:c,matchUpFilters:d,participantMap:p,scheduleTiming:E,nextMatchUps:v,inContext:f,event:g});return w}).flat(1/0)}}function Qv({scheduleVisibilityFilters:t,participantsProfile:e,afterRecoveryTimes:r,policyDefinitions:n,useParticipantMap:o,tournamentRecord:i,inContext:s=!0,contextFilters:a,contextProfile:c,contextContent:l,matchUpFilters:u,nextMatchUps:d,context:p}){var v;if(!i)return{error:ee};const f=((v=i.unifiedTournamentId)==null?void 0:v.tournamentId)||i.tournamentId,m=(i==null?void 0:i.events)||[],{participants:g,participantMap:h}=hs({participantsProfile:e,policyDefinitions:n,useParticipantMap:o,tournamentRecord:i,contextProfile:c,inContext:s});c&&!l&&(l=Io({policyDefinitions:n,tournamentRecord:i,contextProfile:c}));const{appliedPolicies:_}=ct({tournamentRecord:i}),I=(a==null?void 0:a.eventIds)||[];return m.filter(S=>!I.includes(S.eventId)).map(S=>{var y,O;const b=ht({event:S}).flightProfile,E=Bo({eventDrawsCount:((y=b==null?void 0:b.flights)==null?void 0:y.length)||((O=S.drawDefinitions)==null?void 0:O.length)||0},p);return oC({context:E,tournamentAppliedPolicies:_,scheduleVisibilityFilters:t,participantsProfile:e,afterRecoveryTimes:r,policyDefinitions:n,tournamentRecord:i,contextFilters:a,contextProfile:c,contextContent:l,matchUpFilters:u,participantMap:h,participants:g,tournamentId:f,nextMatchUps:d,inContext:s,event:S})}).reduce((S,y)=>{const O=y&&Object.keys(y).filter(b=>!["success","matchUpsMap"].includes(b));return O==null||O.forEach(b=>{S[b]||(S[b]=[]),S[b]=S[b].concat(y[b]),S.matchUpsCount+=y[b].length}),S},{matchUpsCount:0})}function oC({participants:t,tournamentAppliedPolicies:e,scheduleVisibilityFilters:r,participantsProfile:n,afterRecoveryTimes:o,policyDefinitions:i,useParticipantMap:s,tournamentRecord:a,contextFilters:c,contextProfile:l,contextContent:u,matchUpFilters:d,participantMap:p,nextMatchUps:v,tournamentId:f,inContext:m,context:g,event:h}){if(!h)return{error:Re};const{eventId:_,eventName:I,endDate:P}=h,S=Bo(Bo({},g),_e({eventId:_,eventName:I,endDate:P||(a==null?void 0:a.endDate),tournamentId:f||(a==null?void 0:a.tournamentId),indoorOutDoor:h.indoorOutDoor||(a==null?void 0:a.indoorOutDoor),surfaceCategory:h.surfaceCategory||(a==null?void 0:a.surfaceCategory)}));return!t&&a&&({participants:t,participantMap:p}=hs({participantsProfile:n,policyDefinitions:i,useParticipantMap:s,tournamentRecord:a,contextProfile:l,inContext:m})),l&&!u&&(u=Io({policyDefinitions:i,tournamentRecord:a,contextProfile:l,event:h})),(h.drawDefinitions||[]).reduce((O,b)=>{const E=gs({context:S,tournamentAppliedPolicies:e,scheduleVisibilityFilters:r,tournamentParticipants:t,participantsProfile:n,afterRecoveryTimes:o,policyDefinitions:i,tournamentRecord:a,drawDefinition:b,contextContent:u,contextFilters:c,contextProfile:l,matchUpFilters:d,participantMap:p,nextMatchUps:v,inContext:m,event:h}),T=Object.keys(E);return T==null||T.forEach(N=>{O[N]||(O[N]=[]),O[N]=O[N].concat(E[N])}),O},{})}function b4({participants:t,tournamentAppliedPolicies:e,scheduleVisibilityFilters:r,participantsProfile:n,afterRecoveryTimes:o,policyDefinitions:i,useParticipantMap:s,tournamentRecord:a,contextFilters:c,contextProfile:l,contextContent:u,drawDefinition:d,matchUpFilters:p,participantMap:v,nextMatchUps:f,tournamentId:m,inContext:g,context:h,event:_}){if(!_)return{error:Re};const{eventId:I,eventName:P,endDate:S}=_||{},y=Bo(Bo({},h),_e({eventId:I,eventName:P,endDate:S||(_==null?void 0:_.endDate)||(a==null?void 0:a.endDate),tournamentId:m||(a==null?void 0:a.tournamentId),indoorOutDoor:(_==null?void 0:_.indoorOutDoor)||(a==null?void 0:a.indoorOutDoor),surfaceCategory:(_==null?void 0:_.surfaceCategory)||(a==null?void 0:a.surfaceCategory)}));return!(t!=null&&t.length)&&a&&({participants:t,participantMap:v}=hs({participantsProfile:n,policyDefinitions:i,useParticipantMap:s,tournamentRecord:a,contextProfile:l,inContext:g})),l&&!u&&(u=Io({policyDefinitions:i,tournamentRecord:a,contextProfile:l,drawDefinition:d,event:_})),gs({context:y,tournamentAppliedPolicies:e,scheduleVisibilityFilters:r,tournamentParticipants:t,participantsProfile:n,afterRecoveryTimes:o,policyDefinitions:i,tournamentRecord:a,participantMap:v,drawDefinition:d,matchUpFilters:p,contextFilters:c,contextProfile:l,contextContent:u,nextMatchUps:f,inContext:g,event:_})}function Wc({finishingPositionOffset:t=0,finishingPositionLimit:e,positionsFed:r,roundsCount:n,roundLimit:o,matchUps:i,lucky:s,fmlc:a}){var c;if(!Array.isArray(i))return[];const{roundProfile:l,roundNumbers:u}=lr({interpolate:!0,matchUps:i});n=n||Math.max(...u);const d=o?n-o:0,p=d&&((c=l[n-d])==null?void 0:c.matchUpsCount),v=Object.values(l).map(({matchUpsCount:h})=>h),f=(h,_)=>{let I=Math.min(...h);p&&_&&I===1&&(I=p);let P=Math.max(...h);return P>e&&(P=e),[I,P]},m=Object.assign({},...u.map(h=>{const _=n+1-h-d,I=l[h].matchUpsCount,P={finishingRound:_},S=v.slice(h-1).reduce(($,U)=>$+U,0),y=a&&h!==1,O=1+t+(y?r:0),b=1,E=le(O,s?O+I*2:S+O+b),T=S+b-I,N=f(E.slice(T)),w=f(E.slice(0,T),!0);return P.finishingPositionRange={loser:N,winner:w},{[h]:P}})),g=Ct({finishingRound:!0});return i.filter(Boolean).forEach(h=>{const _=m[h.roundNumber];g&&!_&&console.log({roundFinishingData:m,matchUp:h}),h.finishingRound=_==null?void 0:_.finishingRound,h.finishingPositionRange=_==null?void 0:_.finishingPositionRange}),i}function zs({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:r}){if(!e)return{error:pe};const n={loserMatchUpIds:{},winnerMatchUpIds:[]};return t||({matchUps:t,matchUpsMap:r}=wt({includeByeMatchUps:!0,inContext:!0,drawDefinition:e,matchUpsMap:r})),!r.drawMatchUps.some(i=>i.finishingPositionRange)&&e.structures.length===1&&!e.structures[0].structures&&Wc({matchUps:r.drawMatchUps}),(t||[]).filter(({collectionId:i})=>!i).forEach(i=>{const{matchUpId:s,structureId:a}=i,c=nr({inContextDrawMatchUps:t,drawDefinition:e,matchUpId:s}),{winnerMatchUp:l,loserMatchUp:u}=c.targetMatchUps,d=l==null?void 0:l.matchUpId,p=u==null?void 0:u.matchUpId,f=ui({matchUpsMap:r,structureId:a}).find(m=>m.matchUpId===s);if(f&&(d&&(n.winnerMatchUpIds[f.matchUpId]=d,Object.assign(f,{winnerMatchUpId:d}),Object.assign(i,{winnerMatchUpId:d})),p&&(n.loserMatchUpIds[f.matchUpId]=p,i.loserMatchUpId=p,f.loserMatchUpId=p,i.finishingPositionRange))){const m=u.finishingPositionRange&&[...i.finishingPositionRange.loser,...u.finishingPositionRange.loser],g=m&&[Math.min(...m),Math.max(...m)];i.finishingPositionRange.loser=g,f.finishingPositionRange.loser=g}}),{inContextDrawMatchUps:t,goesToMap:n}}function hd(t){var e;const{sides:r,matchUpType:n}=t||{},o=(e=t.potentialParticipants)!=null&&e.length?t.potentialParticipants.flat().map(a=>n===ot?(a==null?void 0:a.individualParticipantIds)||[]:a.participantId).flat():[],i=(r||[]).map(a=>{var c;return n===ot&&(((c=a==null?void 0:a.participant)==null?void 0:c.individualParticipantIds)||[])||(a==null?void 0:a.participantId)&&[a.participantId]||[]}).flat();return{individualParticipantIds:i.concat(o).flat(),enteredIndividualParticipantIds:i,potentialIndividualParticipantIds:o}}function ho({scheduleVisibilityFilters:t,afterRecoveryTimes:e,tournamentRecords:r,matchUpFilters:n,contextFilters:o,nextMatchUps:i}){return typeof r!="object"||!Object.keys(r).length?{error:Fe}:{matchUps:Object.keys(r).map(c=>{const l=r[c],{matchUps:u}=Vt({scheduleVisibilityFilters:t,afterRecoveryTimes:e,tournamentRecord:l,matchUpFilters:n,contextFilters:o,nextMatchUps:i});return u}).flat()}}function yf({scheduleVisibilityFilters:t,participantsProfile:e,policyDefinitions:r,tournamentRecords:n,matchUpFilters:o,contextFilters:i,nextMatchUps:s}){return typeof n!="object"||!Object.keys(n).length?{error:Fe}:Object.keys(n).map(l=>{const u=n[l];return Qv({scheduleVisibilityFilters:t,participantsProfile:e,policyDefinitions:r,tournamentRecord:u,matchUpFilters:o,contextFilters:i,nextMatchUps:s})}).reduce((l,u)=>(Object.keys(u).forEach(p=>{l[p]||(l[p]=[]),l[p]=l[p].concat(u[p])}),l),{})}function _s(t,e){return T4(t,e)||((t==null?void 0:t.stageSequence)||0)-((e==null?void 0:e.stageSequence)||0)||(t==null?void 0:t.roundNumber)-(e==null?void 0:e.roundNumber)||((t==null?void 0:t.roundPosition)||0)-((e==null?void 0:e.roundPosition)||0)}function T4(t,e){return(rs[t==null?void 0:t.stage]||0)-(rs[e==null?void 0:e.stage]||0)}var E4=Object.defineProperty,W_=Object.getOwnPropertySymbols,w4=Object.prototype.hasOwnProperty,N4=Object.prototype.propertyIsEnumerable,q_=(t,e,r)=>e in t?E4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,$4=(t,e)=>{for(var r in e||(e={}))w4.call(e,r)&&q_(t,r,e[r]);if(W_)for(var r of W_(e))N4.call(e,r)&&q_(t,r,e[r]);return t};function qr({includeParticipantDependencies:t,tournamentRecords:e={},tournamentRecord:r,drawDefinition:n,matchUpIds:o=[],matchUps:i=[],drawIds:s=[]}){if(!Array.isArray(o))return{error:_c};if(!Array.isArray(i))return{error:ko};if(!Array.isArray(s))return{error:Mr};o.length||(o=i.map(({matchUpId:h})=>h));const a={},c={},l={},u={};r&&!Object.keys(e).length&&(e={[r.tournamentId]:r});const d=Object.values(e),v=d.reduce((h,_)=>(_.events||[]).map(I=>(I.drawDefinitions||[]).map(P=>P.links||[])).flat(1/0),[]).filter(({linkType:h})=>h===po);if(v.length){({matchUps:i}=ho({nextMatchUps:!0,tournamentRecords:e}));const h=v.reduce((_,I)=>{var P,S;const y=(P=I.source)==null?void 0:P.structureId,O=(S=I.target)==null?void 0:S.structureId;return y&&O&&(l[O]=y),y&&!_.includes(y)&&_.push(y),_},[]);for(const _ of h)a[_]=[];for(const _ of i){const I=_.containerStructureId||_.structureId;h.includes(I)&&a[I].push(_.matchUpId)}}const f=h=>{c[h]||(c[h]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[],sources:[]},u[h]=[])},m=(h,_)=>{c[h].matchUpIds.forEach(P=>{c[_].matchUpIds.push(P)}),c[_].matchUpIds.push(h),c[h].dependentMatchUpIds.push(_),t&&c[h].participantIds.forEach(P=>c[_].participantIds.push(P))},g=h=>{const _=Object.keys(a).length;for(const I of h){const{matchUpId:P,winnerMatchUpId:S,loserMatchUpId:y}=I;if(!o.length||o.includes(P)){if(f(P),t){const{individualParticipantIds:E}=hd(I);c[P].participantIds=E}S&&(f(S),m(P,S),u[S].push(P)),y&&(f(y),m(P,y),u[y].push(P)),c[P].sources.push(u[P]);const O=u[P].map(E=>c[E].sources[0]).flat(),b=u[P].map(E=>c[E].sources[1]).flat();if(c[P].sources.push(O,b),_){const E=I.containerStructureId||I.structureId,T=l[E];if(a[T])for(const N of a[T])f(N),m(N,P),u[N].push(P)}}}};if(n)zs({drawDefinition:n}),i.length||({matchUps:i}=Er({drawDefinition:n})),g(i);else{i.length||({matchUps:i}=ho({nextMatchUps:!0,tournamentRecords:e})),s.length||(s=d!=null&&d.length?d.map(({events:h=[]})=>h.map(({drawDefinitions:_=[]})=>_.map(({drawId:I})=>I))).flat(1/0):[]);for(const h of s){let _=i.filter(P=>P.drawId===h).sort(_s);if(!_.find(({roundPosition:P})=>!P)){const P=_.find(({tournamentId:y})=>y),{drawDefinition:S}=Ft({tournamentRecord:e[P==null?void 0:P.tournamentId],drawId:h});S&&zs({drawDefinition:S})}g(_)}}return $4({positionDependencies:a,matchUpDependencies:c,sourceMatchUpIds:u,matchUps:i},B)}function iC({tournamentRecords:t,matchUps:e}={}){if(!Array.isArray(e))return{error:ko};if(e.some(({matchUpId:f,hasContext:m})=>f&&!m))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:qu};const r=Math.max(...e.map(({schedule:f})=>(f==null?void 0:f.courtOrder)||1).map(f=>parseInt(f))),n=le(1,r+1).map(f=>e.filter(m=>{var g;return parseInt((g=m.schedule)==null?void 0:g.courtOrder)===f})),o={},i={},s={};n.flat().filter(Boolean).sort(_s).forEach(({schedule:f})=>delete f[pp]);const c=Ve(e.map(({drawId:f})=>f)),l=qr({includeParticipantDependencies:!0,tournamentRecords:t,drawIds:c}).matchUpDependencies,u=n.map((f,m)=>f.reduce((g,h)=>{if(!h.matchUpId)return g;const{matchUpId:_,winnerMatchUpId:I,loserMatchUpId:P,schedule:S,sides:y,potentialParticipants:O}=h,b=S==null?void 0:S.courtId;s[_]=m,i[b]=[],g.matchUpIds.push(_),o[_]=h;const E=l[_].matchUpIds;E.length&&g.sourceMatchUpIds.push(...E);const T=(y==null?void 0:y.map(({participantId:w,participant:$})=>[$==null?void 0:$.individualParticipantIds,w]).flat().filter(Boolean))||[],N=(O==null?void 0:O.flat().map(({individualParticipantIds:w,participantId:$})=>[w,$]).flat().filter(Boolean))||[];return g.participantIds.push(...N,...T),I&&g.targetMatchUpIds.push(I),P&&g.targetMatchUpIds.push(P),g},{sourceMatchUpIds:[],targetMatchUpIds:[],participantIds:[],matchUpIds:[]})),d=(f,m)=>l[f].sources.reduce((g,h,_)=>h.includes(m)&&_+1||g,0),p=u.map(()=>[]),v=(f,m,g,h)=>{if(!o[f].schedule[pp]){o[f].schedule[pp]=m,o[f].schedule[bL]=h,p[s[f]].push({matchUpId:f,issue:m,issueType:g,issueIds:h});const _=o[f].schedule.courtId;i[_]||(i[_]=[]),i[_].push({matchUpId:f,issue:m,issueType:g,issueIds:h})}};return u.forEach((f,m)=>{const g=m?u[m-1]:void 0,h=u.slice(m+1),_={},I=fr(f.participantIds),P=Object.keys(I).filter(O=>I[O]>1),S=f.matchUpIds.filter(O=>l[O].participantIds.some(b=>P.includes(b)));S.forEach(O=>{_[O]||(_[O]={}),_[O][Ni]||(_[O][Ni]=S.filter(b=>b!==O))});const y=g&&f.participantIds.filter(O=>g.participantIds.includes(O));y&&y.forEach(O=>{const b=f.matchUpIds.concat(g.matchUpIds).filter(E=>l[E].participantIds.includes(O));b.forEach(E=>{_[E]||(_[E]={}),_[E][$i]||(_[E][$i]=b.filter(T=>T!==E))})}),f.matchUpIds.forEach(O=>{var b,E,T,N;const w=l[O].matchUpIds;for(const U of h){const A=U.matchUpIds.filter(C=>w.includes(C));A!=null&&A.length&&(A.forEach(C=>v(C,Eh,Jo,[O])),v(O,Eh,Jo,A))}if((b=_[O])!=null&&b[Ni]&&v(O,Ni,Th,_[O][Ni]),f.sourceMatchUpIds.includes(O)){const U=f.matchUpIds.filter(A=>l[A].matchUpIds.includes(O));v(O,Ni,Jo,U),f.matchUpIds.filter(A=>l[A].matchUpIds.includes(O)).forEach(A=>v(A,Ni,Jo,[O]))}const $=(E=g==null?void 0:g.matchUpIds)==null?void 0:E.filter(U=>d(O,U)>1);if($!=null&&$.length&&(v(O,wh,Jo,$),$.forEach(U=>v(U,wh,Jo,[O]))),(T=_[O])!=null&&T[$i]&&v(O,$i,Th,_[O][$i]),(N=g==null?void 0:g.targetMatchUpIds)!=null&&N.includes(O)){const U=o[O].schedule.courtId,A=w.filter(M=>g.matchUpIds.includes(M));A.some(M=>o[M].schedule.courtId===U)||(A.forEach(M=>v(M,$i,Jo,[O])),v(O,$i,Jo,A))}})}),{courtIssues:i,rowIssues:p}}function iu(t){var e;if(!t)return{};const r=[],n=t.tieFormatName,o=(e=t.collectionDefinitions)==null?void 0:e.map(i=>{const{matchUpType:s,matchUpFormat:a,matchUpCount:c,category:l,gender:u}=i;r.includes(a)||r.push(a);const d=l==null?void 0:l.ageCategoryCode;return[c,s===Kr?"D":"S",d,a,u].join(";")}).join("|");return{tieFormatName:t&&n||"UNNAMED",matchUpFormats:r,tieFormatDesc:o}}var A4=Object.defineProperty,U4=Object.defineProperties,C4=Object.getOwnPropertyDescriptors,H_=Object.getOwnPropertySymbols,M4=Object.prototype.hasOwnProperty,D4=Object.prototype.propertyIsEnumerable,Y_=(t,e,r)=>e in t?A4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,j4=(t,e)=>{for(var r in e||(e={}))M4.call(e,r)&&Y_(t,r,e[r]);if(H_)for(var r of H_(e))D4.call(e,r)&&Y_(t,r,e[r]);return t},R4=(t,e)=>U4(t,C4(e));function _d({considerations:t={},descendant:e,ancestor:r}){var n,o;const i={},s={},{matchUpFormats:a,tieFormatDesc:c}=iu(e),{matchUpFormats:l,tieFormatDesc:u}=iu(r),d=Ve((a||[]).filter(I=>!(l||[]).includes(I)).concat((l||[]).filter(I=>!(a||[]).includes(I)))),p=!!(t!=null&&t.collectionName&&e.collectionDefinitions.map(({collectionName:I})=>I).join("|")!==r.collectionDefinitions.map(({collectionName:I})=>I).join("|")),v=!!(t!=null&&t.collectionOrder&&e.collectionDefinitions.map(({collectionOrder:I})=>I).join("|")!==r.collectionDefinitions.map(({collectionOrder:I})=>I).join("|")),f=p||v||u!==c,m=Object.assign({},...((e==null?void 0:e.collectionDefinitions)||[]).map(I=>({[I.collectionId]:I}))),g=Object.assign({},...((r==null?void 0:r.collectionDefinitions)||[]).map(I=>({[I.collectionId]:I})));i.collectionIds=xg(Object.keys(m),Object.keys(g)),s.collectionIds=xg(Object.keys(g),Object.keys(m)),i.collectionsValue=K_(m,i),s.collectionsValue=K_(g,s),i.groupsCount=((n=r==null?void 0:r.collectionGroups)==null?void 0:n.length)||0-((o=e==null?void 0:e.collectionGroups)==null?void 0:o.length)||0,s.groupsCount=i.groupsCount?-1*i.groupsCount:0;const h=i.collectionsValue.totalValue-s.collectionsValue.totalValue,_=i.collectionsValue.totalMatchUps-s.collectionsValue.totalMatchUps;return R4(j4({matchUpFormatDifferences:d,matchUpCountDifference:_,descendantDifferences:i,ancestorDifferences:s,orderDifference:v,valueDifference:h,nameDifference:p,descendantDesc:c,ancestorDesc:u},B),{different:f})}function K_(t,e){let r=0;return{totalValue:e.collectionIds.reduce((o,i)=>{const s=t[i],{collectionValueProfile:a,collectionValue:c,matchUpCount:l,matchUpValue:u}=s;return r+=l,a?a.reduce((d,p)=>d+p.value,0):u&&l?u*l:c},0),totalMatchUps:r}}var F4=Object.defineProperty,z_=Object.getOwnPropertySymbols,V4=Object.prototype.hasOwnProperty,L4=Object.prototype.propertyIsEnumerable,Q_=(t,e,r)=>e in t?F4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,B4=(t,e)=>{for(var r in e||(e={}))V4.call(e,r)&&Q_(t,r,e[r]);if(z_)for(var r of z_(e))L4.call(e,r)&&Q_(t,r,e[r]);return t};function x4({tournamentRecord:t}){if(!t)return{error:ee};if(typeof t!="object"||!t.tournamentId)return{error:Z};const{matchUps:e}=Vt({tournamentRecord:t,inContext:!1});if(e!=null&&e.length){const r=G4({tournamentRecord:t});W4(e,r)}return B4({},B)}function G4({tournamentRecord:t}){const e={};for(const r of t.events||[]){r.matchUpFormat&&(e[r.eventId]=r.matchUpFormat);for(const n of r.drawDefinitions||[]){n.matchUpFormat&&(e[n.drawId]=n.matchUpFormat);for(const o of n.structures||[]){o.matchUpFormat&&(e[o.structureId]=o.matchUpFormat);for(const i of o.structures||[])i.matchUpFormat&&(e[i.structureId]=i.matchUpFormat)}}}return e}const k4=["collectionId","collectionPosition","drawPositions","extensions","finishingPositionRange","finishingRound","isMock","matchUpId","matchUpStatus","matchUpStatusCodes","orderOfFinish","processCodes","roundNumber","tieFormat","tieMatchUps","roundPosition","score","sides","winnerMatchUpId","loserMatchUpId","matchUpDuration","winningSide"];function W4(t,e={}){for(const r of t){const{structureId:n,drawId:o,eventId:i}=r,s=e[n]||e[o]||e[i],a=r.matchUpFormat===s?void 0:r.matchUpFormat;for(const c of Object.keys(r))k4.includes(c)||delete r[c];r.sides&&r.drawPositions&&!r.tieMatchUps&&delete r.sides,a&&(r.matchUpFormat=a)}}function qc({court:t,date:e}){const r=e&&t.dateAvailability.find(o=>qn(o.date,e)),n=t.dateAvailability.find(o=>!o.date);return r||n}function ya({courtDate:t,includeBookingTypes:e=[]}){const r=[];let n=mt(t.startTime);(t.bookings||[]).filter(i=>!i.bookingType||!e.includes(i.bookingType)).sort((i,s)=>Wl(i.startTime).localeCompare(Wl(s.startTime))).forEach(i=>{const s={startTime:tt(n.toISOString()),endTime:i.startTime};mt(i.startTime)>n&&r.push(s),mt(i.endTime)>n&&(n=mt(i.endTime))});const o={startTime:tt(n.toISOString()),endTime:t.endTime};return mt(t.endTime)>n&&r.push(o),r}function q4({includeBookingTypes:t,averageMatchUpMinutes:e,periodStartTime:r,periodEndTime:n,periodLength:o}){const i=a=>!!ya({includeBookingTypes:t,periodLength:o,courtDate:a}).filter(s).length;function s(a){const c=mt(a.startTime),l=mt(a.endTime);return c>r||l<n?!1:Oc(r,l)>=e}return{enoughTime:i}}function sC({averageMatchUpMinutes:t,includeBookingTypes:e,periodLength:r,periodStart:n,courts:o,date:i}){const s=mt(n),a=cv(s,t),{enoughTime:c}=q4({averageMatchUpMinutes:t,includeBookingTypes:e,periodStartTime:s,periodEndTime:a,periodLength:r});return{availableToScheduleCount:((o==null?void 0:o.filter(u=>{if(!Array.isArray(u.dateAvailability))return!1;const d=qc({date:i,court:u});return!!(d&&c(d))}))||[]).length}}function Jv({remainingScheduleTimes:t=[],clearScheduleDates:e,periodLength:r=30,bookings:n=[],scheduleDate:o,courts:i=[]}){if(!Array.isArray(i)||!i.length)return{error:Z,courts:i};if(!Array.isArray(n))return{error:cf};if(!Nr(o))return{error:ar};e&&(Array.isArray(e)?e.includes(o)&&(n=[]):n=[]);const{courtBookings:s,unassignedBookings:a}=n.reduce((p,v)=>{const{courtId:f}=v;return f?p.courtBookings[f]?p.courtBookings[f].push(v):p.courtBookings[f]=[v]:p.unassignedBookings.push(v),p},{courtBookings:{},unassignedBookings:[]}),c=i.map((p,v)=>{const{courtId:f,courtName:m}=p,g=s[f]||[],h=qc({date:o,court:p})||{},{bookings:_=[],startTime:I,endTime:P,date:S}=h,O=[t[v]&&{startTime:I,endTime:t[v]},...de(_,!1,!0),...g].filter(Boolean);return{courtId:f,courtName:m,dateAvailability:{bookings:O,startTime:I,endTime:P,date:S}}});a.sort((p,v)=>je(p.startTime)-je(v.startTime));const l=()=>c.map(p=>{const v=p.dateAvailability,f=ya({courtDate:v});return{courtName:p.courtName,courtId:p.courtId,timeSlots:f}}).flat(),u=[];for(const p of a){const{startTime:v,endTime:f,averageMinutes:m,recoveryMinutes:g,matchUpId:h}=p,_=je(v),I=je(f),S=l().reduce((y,{courtId:O,courtName:b,timeSlots:E})=>{let T;return E.find(({startTime:w,endTime:$})=>{T=je(w)-_;const U=_>=je(w);return I<=je($)&&y.startDifference!==0&&((T===0||T+r>=0)&&(y.startDifference===void 0||T<y.startDifference)||U)})?{courtName:b,courtId:O,startDifference:T}:y},{});if(S.courtId){const y={averageMinutes:m,recoveryMinutes:g,matchUpId:h,startTime:v,endTime:f};u.push(y),c.find(({courtId:b})=>b===S.courtId).dateAvailability.bookings.push(y)}else console.log({unassignedBooking:p})}return{virtualCourts:c.map(({courtId:p,courtName:v,dateAvailability:f})=>({dateAvailability:[f],courtName:v,courtId:p})),assignedBookings:u}}function Id({averageMatchUpMinutes:t,periodLength:e=30,recoveryMinutes:r}){const n=(t||90)+(r||0);return e>n?n:e||30}function Qs({scheduleDate:t,startTime:e,endTime:r,courts:n}){const o=e&&"startTime"||r&&"endTime"||void 0;return n.reduce((i,s)=>{const a=qc({date:t,court:s}),c=(a==null?void 0:a[o])||s[o];return c&&(!i||e&&je(c)<je(i)||je(c)>je(i))?c:i},void 0)}function H4({averageMinutes:t,startTime:e,endTime:r,courts:n,date:o}){e=e||Qs({courts:n,scheduleDate:o,startTime:!0}),r=r||Qs({courts:n,scheduleDate:o,endTime:!0});let i;if(e&&r){const s=mt(e),a=mt(r);for(const c of n||[]){if(!Array.isArray(c.dateAvailability))continue;const l=qc({court:c,date:o});ya({courtDate:l}).forEach(d=>{const p=mt(d.startTime),v=mt(d.endTime);if(p>a||p<s||v<s)return!1;if(Oc(p,v)>=t){const g=tt(p.toISOString());(!i||g<i)&&(i=g)}})}}return{firstTimeSlotStartTime:i}}function aC({startTime:t="8:00",endTime:e="20:30",count:r=10,date:n}={}){return le(0,r).map(()=>({dateAvailability:[{date:n,startTime:t,endTime:e}]}))}function Zv({calculateStartTimeFromCourts:t=!0,remainingScheduleTimes:e,date:r=sv(),averageMatchUpMinutes:n,startTime:o="08:00",clearScheduleDates:i,endTime:s="19:00",periodLength:a,courtsCount:c,bookings:l,courts:u}={}){a=a||Id({averageMatchUpMinutes:n}),r=Me(r),o=tt(o),s=tt(s);let d=0,p=0,v=0,f=0,m=0;!u&&c&&(u=aC({startTime:o,endTime:s,count:c,date:r}));const{virtualCourts:g}=Jv({remainingScheduleTimes:e,clearScheduleDates:i,scheduleDate:r,periodLength:a,bookings:l,courts:u}),{firstTimeSlotStartTime:h}=H4({averageMinutes:n,courts:g,startTime:o,endTime:s,date:r});t&&h&&(o=h||o);const _=je(o),P=je(s)-_,S=Math.floor(P/a),O=le(0,S+1).map(E=>{const T=_+E*a,N=HF(T),{availableToScheduleCount:w}=sC({courts:g,averageMatchUpMinutes:n,periodLength:a,periodStart:N,period:E,date:r}),$=w>p?w-p:0;m+=E?w:0;const U=E?m/E:w,C=a*U/n,M=E?C*(E-1)+U:U,D=w?p&&M-d||$:0;d=M,p=w,v+=D;const V=parseInt(v)-f;return f+=V,{periodStart:N,add:V,availableToScheduleCount:w,newCourts:$,totalMatchUps:f}});return{scheduleTimes:O.reduce((E,T)=>E.concat(...le(0,T.add).map(()=>({scheduleTime:T.periodStart}))),[]).flat(),timingProfile:O,totalMatchUps:f}}const Y4={getCourtsAvailableAtPeriodStart:sC,generateTimeSlots:ya,getScheduleTimes:Zv,courtGenerator:aC},K4=(t,e)=>t.filter(Boolean).every(r=>typeof r===e),z4=t=>t.filter(Boolean).every(Pt);function cC({consideredDate:t,category:e}={}){const r={error:Z,ageMin:8,ageMax:99};if(typeof e!="object"||!Nr(t))return r;const n=parseInt(t.split("-")[0]),o=[];let i,{ageCategoryCode:s,categoryName:a,ageMaxDate:c,ageMinDate:l,ageMax:u,ageMin:d}=e;if(!K4([s,c,l,a],"string")||!z4([u,d]))return r;s=s||a;const p=/^([UO]?)(\d{1,2})([UO]?)$/,v=/^C(\d{1,2})-(\d{1,2})$/,f=(s==null?void 0:s.indexOf("-"))>0,m=f&&(s==null?void 0:s.match(v)),g=s==null?void 0:s.match(p),h=b=>b.match(/^\d{2}-\d{2}$/),_=(b,E,T)=>Nr(E)&&E||E&&h(E)&&`${b}-${E}`||`${b}-${T}`,I=b=>{const E=n-b;return l=_(E,l,"01-01"),u&&u!==b-1&&o.push(`Invalid ageMax: ${u}`),u||(u=b-1),{ageMinDate:l,ageMax:u}},P=b=>{const E=n-b-1;return l=_(E,l,"01-01"),u&&u!==b&&o.push(`Invalid ageMax: ${u}`),u||(u=b),{ageMinDate:l,ageMax:u}},S=b=>{const E=n-b-2;return c=_(E,c,"12-31"),d&&d!==b+1&&o.push(`Invalid ageMin: ${d}`),d||(d=b+1),{ageMaxDate:c,ageMin:d}},y=b=>{const E=n-b-1;return c=_(E,c,"12-31"),d&&d!==b&&o.push(`Invalid ageMin: ${d}`),d||(d=b),{ageMaxDate:c,ageMin:d}},O=b=>{const[E,T,N]=(b.match(p)||[]).slice(1),w=parseInt(T);E==="U"&&({ageMinDate:l,ageMax:u}=I(w)),N==="U"&&({ageMinDate:l,ageMax:u}=P(w)),E==="O"&&({ageMaxDate:c,ageMin:d}=S(w)),N==="O"&&({ageMaxDate:c,ageMin:d}=y(w))};if(m){const[b,E]=s.match(v).slice(1).map(T=>parseInt(T));b<=E?(d=d||b,u=u||E,i=!0):o.push(`Invalid combined age range ${s}`)}else f?s.split("-").forEach(O):g&&O(s);return o.length?{error:o,ageMin:8,ageMax:99}:_e({combinedAge:i,ageMaxDate:c,ageMinDate:l,ageMax:u,ageMin:d})}function su({tiebreakTo:t=7,scoreString:e}){return e.split(" ").filter(Boolean).map((n,o)=>r({set:n,setNumber:o+1}));function r({set:n,setNumber:o}){const i=(n==null?void 0:n.startsWith("["))&&n.split("[")[1].split("]")[0].split("-").map(g=>parseInt(g)),s=n.includes("(")&&n.split("(")[0]||n.includes("[")&&n.split("[")[0]||n,a=!i&&s.split("-").map(g=>parseInt(g)),c=i?i[0]>i[1]&&1||i[0]<i[1]&&2||void 0:a[0]>a[1]&&1||a[0]<a[1]&&2||void 0,l=n.includes("(")?n.split("(")[1].split(")")[0]:void 0,d=l&&Kv({lowValue:l,isSide1:c===2,tiebreakTo:t})||[],[p,v]=a||[],[f,m]=i||d||[];return{side1Score:p,side2Score:v,side1TiebreakScore:f,side2TiebreakScore:m,winningSide:c,setNumber:o}}}const Pd="\\d+-\\d+",cc="\\d+-\\d+\\(\\d+\\)",Xv="\\[\\d+-\\d+\\]",Q4="\\d+-\\d+\\(\\d+-\\d+\\)",J4=new RegExp(`(${Pd}),`,"g"),Z4=new RegExp(`(${cc}),`,"g"),X4=[Pd,cc,Xv,Q4],eW=["0","1","2","00","01","10","11","002","012","102","112","000","001","010","100","011","101","110","111","002","012","102","112","0002","0012","0102","1002","0112","1012","1102","1112","3","03","13","013","103"],tW=eW.map(t=>{const r=t.split("").map(n=>X4[n]).join(" ");return new RegExp(`^${r}$`)});function J_(t){return!t||tW.some(e=>e.test(t))}function rW(t){const e="[];",r="()",n=e+r,o=[e[0],r[0]],i=Object.assign({},...n.split("").map(c=>({[c]:0})));let s="";const a=t.split("").map(c=>{const l=n.includes(c)&&c,u=o.includes(l);if(u&&l)return i[l]+=1,s=l,c;if(!u&&l&&s&&l!==s){i[s]-=1;const d=e.includes(s)&&e||r.includes(s)&&r,p=d.split("").find(v=>v!==s);if(d.includes(l))i[s]||(s="");else return i[l]||(s=""),p}return c}).join("");return t!==a?a:t}function Ml(t){return/^\(\d+\)$/.test(t)||/^\(\d+$/.test(t)}function nW(t){return/^\(\d+-\d+\)$/.test(t)||/^\[\d+-\d+\]$/.test(t)}function Js(t){const r=(n=>n==null?void 0:n.split("-").join("").split("/").join(""))(t);if(/^\d+$/.test(r)&&r.length===2){const n=r.split("");return Math.abs(n.reduce((i,s)=>+i-+s))===1}}function au(t,e){const r=[t.slice(e,e+2),e?t.slice(0,1):t.slice(2)].map(i=>parseInt(i.join(""))),n=e?r.reverse():r;if(Math.abs(n.reduce((i,s)=>+i-+s))>=2)return n.join("-")}function Z_(t){return t.length===2?t.split("").join("-"):([", ",",","/"," "].forEach(e=>t=t.split(e).join("-")),t=t.replace(/-{2,}/,"-"),t)}function oW(t){return t.startsWith("(")&&t.endsWith(")")}function iW({score:t,applied:e}){t=rW(t);const r=/\)(\d+)/g;if(r.test(t))for(const y of t.match(r)){const O=y.replace(")",") ");t=t.replace(y,O)}t=t.replace(/\)\//g,") / "),t=t.replace(/\/\)/g,")");const n=/\(([\d- ]+)\)/g,o=/\(([\d- ]+)\)/,i=t.match(n);for(const y of i||[]){const[O]=y.match(o).slice(1),b=O.replace(/ /g,"");t=t.replace(y,`(${b})`)}let s=/\(\(\d-\d\)\)/g;if(s.test(t)){const y=t.match(s);y.length&&y.forEach(O=>{const b=O.match(/\((\(\d-\d\))\)/).slice(1)[0];t=t.replace(O,b)})}if(s=/\(\((\d)\)\)/g,s.test(t)){const y=t.match(s);y.length&&y.forEach(O=>{const b=O.match(/\((\(\d\))\)/).slice(1)[0];t=t.replace(O,b)})}/(^|\s)6-,/.test(t)&&(t=t.replace(/(^|\s)6-,/g,"6-0,"));const a=new RegExp(/[-,]{2,}/g);t=t.replace(a,"-"),["- "," -"].forEach(y=>{const O=new RegExp(`(\\d+)${y}(\\d+)`,"g"),b=t.match(O);b&&b.forEach(E=>t=t.replace(E,E.split(y).join("-")))}),/^[(-/,]+$/.test(t)&&(t=""),/\)[-/,]+$/.test(t)&&(t=t.slice(0,t.length-1)),/\d \/\d/.test(t)&&(t=t.replace(/ \//g,"/")),t.includes(" /")&&(t=t.replace(/ \//g," "));const c=/\(\d+, \)/g;c.test(t)&&t.match(c).forEach(O=>{const[b]=O.match(/\((\d+), \)/).slice(1);b.length===2?t=t.replace(O,`(${b})`):b.length===1&&b==="6"&&(t=t.replace(O,"(6-0)"))});const l=/\((\d+)\/\)/g;l.test(t)&&t.match(l).forEach(O=>{const[b]=O.match(/\((\d+)\/\)/).slice(1);b.length===2?t=t.replace(O,`(${b})`):b.length===1&&b==="6"?t=t.replace(O,"(6-0)"):t=t.replace(O,`(${b})`)});const u=/\d\/\d\/,/g;u.test(t)&&t.match(u).forEach(O=>{const[b]=O.match(/(\d\/\d)\/,/).slice(1);t=t.replace(O,`${b},`),e.push("slashComma")});const d=/\(\/(\d+)\)/g;d.test(t)&&t.match(d).forEach(O=>{const[b]=O.match(/\(\/(\d+)\)/).slice(1);b.length===2?t=t.replace(O,`(${b})`):b.length===1&&parseInt(b)<6?t=t.replace(O,`(6-${b})`):t=t.replace(O,`(${b})`)});let p,v,f,m,g;const h=()=>{g=fr(t.split("")),v=g["("]===(g[")"]||0)+1,p=(g["("]||0)+1===g[")"],f=g["["]===g["]"]+1,m=v&&!f};h();const _=/(\d+-\d+\(\d+)0,/;if(_.test(t)){const[y]=t.match(_).slice(1);t=t.replace(_,y+")")}if(g["("]===g[")"]&&g["("]>1){const y=t.split(")(").join(") (").split(" ");y.every(oW)?t=y.map(O=>{const b=O.slice(1,O.length-1);return b.length>2?b:O}).join(" "):t=y.join(" ")}h();const I=/[A-Za-z]+/.test(t),P=/\d+/.test(t);if(!I&&!P)return{score:""};if(/^\[.+\]$/.test(t)&&"()/,- ".split("").some(y=>g[y])&&(t=t.slice(1,t.length-1)),/^\(.+\)$/.test(t)&&g["("]===1&&g[")"]===1&&"[]/,".split("").some(y=>g[y]>1)&&(t=t.slice(1,t.length-1)),t.startsWith("(")&&t.endsWith("))")&&(t=t.slice(1,t.length-1)),g["("]>(g[")"]||0)&&t[t.length-1]==="("&&(t=t.slice(0,t.length-1)+")",h()),g["("]===1&&!g[")"]&&t[0]==="("&&(t=t+")",h()),g["("]>(g[")"]||0)&&t.slice(0,2)==="(("&&(t=t.slice(1)),p){if(/^9\d/.test(t))t="("+t.slice(1);else if(t[0]!=="(")t="("+t;else{let y=[],O=0;for(const b of t.split("").reverse())b===")"&&(O?y.push("("):O+=1),b==="("&&(O-=1),y.push(b);y.reverse(),t=y.join("")}h()}if(g[")"]>(g["("]||0)&&t[0]===")"&&(t="("+t.slice(1),h()),m&&(t.endsWith(9)||/\d+0$/.test(t))&&(t=t.slice(0,t.length-1)+")",h()),m&&(!t.endsWith(")")||t.startsWith("(("))&&(t=t+")",h()),m){let y="",O=0;for(const b of t.split(""))b==="("&&(O?y+=")":O+=1),b===")"&&(O-=1),y+=b;t=y}h(),f&&!v&&(t=t+"]"),t.includes("([")&&t.includes("])")&&(t=t.split("([").join("[").split("])").join("]"),h()),/\(\d+0$/.test(t)&&(t=t.slice(0,t.length-1)+")"),h(),g[")"]===1&&!g["("]&&t.endsWith(")")&&(t=t.slice(0,t.length-1)),t.startsWith("(")&&t.endsWith(")")&&g["("]===1&&g[")"]===1&&(t=t.slice(1,t.length-1),h());const S=y=>{const O=y.indexOf("("),b=y.indexOf(")");return O>=0&&b>=0&&O<b};if(/^\([\d ]+.*[\d ]+\)$/.test(t)&&g["("]===g[")"]){const y=t.slice(1,t.length-1);S(y)&&(t=y,h())}return{score:t,applied:e}}function yd(t){if(!/^[\d-]+(\(\d\))*$/.test(t))return t;const e=Pn("-",t.split(""));if(!e.length)return t;const r=t.split("-"),n=!(r.length%2),o=!!(e.length%2);return n&&o&&e.length>r.length/2&&e.filter((s,a)=>a%2).forEach(s=>{t=t.substring(0,s)+" "+t.substring(s+1)}),t}function sW({score:t,applied:e}){return t.includes("( ")&&(e.push("removeParenSpacingAfterOpen"),t=t.split("( ").map(r=>r.trim()).join("(")),t.includes(" )")&&(e.push("removeParenSpacingBeforeClose"),t=t.split(" )").map(r=>r.trim()).join(")")),[J4,Z4].forEach(r=>{const n=t.match(r);n!=null&&n.length&&(n.forEach(o=>{t=t.replace(o,o.slice(0,o.length-1)+" ")}),e.push("setsEndComma"))}),t=t.split(" ").filter(Boolean).map(yd).join(" "),{score:t,applied:e}}function aW({score:t}){if(typeof t!="string")return{score:t};const e=p=>p==null?void 0:p.split("-").join("").split("/").join(""),r=p=>p.split("[").join("(").split("]").join(")");t=t.split(", ").join(" ");let n=t.split(" ");t=n.map(p=>{const v=/^-(\d+)$/;if(v.test(p)){const[f]=p.match(v).slice(1);if(f.length===2)return f.split("").join("-")}return p}).join(" "),n=t.split(" ");const o=n.filter(Ml);let i=0,s="";for(const p of o){const v=Pn(p,n).filter(h=>!i||h>i)[0],f=n.slice(i,v-1),m=n[v-1],g=e(m);if(/^\d+$/.test(g)&&g.length===2){const h=g.split(""),_=Math.abs(h.reduce((I,P)=>+I-+P));if(_===1){const I=[f.join(" "),[m,p].join("")].join(" ");s+=I,i=v+1}else if(_===0){const I=Math.max(...h);if([4,5,6,7,8,9].includes(I)){const P=[6,4].includes(I)?I+1:I-1,S=[I,P].sort().reverse().join("-"),y=[f.join(" "),[S,p].join("")].join(" ");s+=y,i=v+1}}}}if(o.length&&s.length){const p=n.slice(i).join(" ");return s=[s,p].join(" "),{score:s.trim()}}if(n.length===2&&["(","["].some(p=>n[1].includes(p))){const v=e(n[0]).split("");if(Math.abs(v.reduce((m,g)=>+m-+g,0))===1)return n[1]=r(n[1]),{score:n.join("")}}const a=n.map(p=>nW(p)&&"bracket"||Js(p)&&"set");if(a.includes("set")&&a.includes("bracket")){let p,v="";return n.forEach((f,m)=>{a[m]==="bracket"&&p==="set"?(f=r(f),v+=f):v+=` ${f}`,p=a[m]}),{score:v.trim()}}n=t.split(" ");let c,l=n.map(p=>{const v=new RegExp(/^(\d+)-(\d+)$/);if(v.test(p)){const[f,m]=p.match(v).slice(1),g=Math.abs([f,m].reduce((_,I)=>+_-+I)),h=Math.max(f,m);if(g===1)return c="tiebreakSet",c;if(g>=2&&h>=7&&c==="tiebreakSet")return c="tiebreak",c}});const u=Pn("tiebreak",l);if(u.length){let p="";n.forEach((v,f)=>{u.includes(f)?p+=`(${v}) `:u.includes(f+1)?p+=`${v}`:p+=`${v} `}),t=p.trim()}const d=/(\d+-\d+)\((\d+)-(\d+)\)$/;if(d.test(t)){const[p,v,f]=t.match(d).slice(1),g=Math.max(v,f)>=10;!Js(p)&&g&&(t=t.replace(d,`${p} [${v}-${f}]`))}return l=[],t=t.split(" ").map(p=>{const v=/^\((.*)\)$/,f=v.test(p),m=new RegExp(Xv).test(p)&&"super"||new RegExp(cc).test(p)&&"tiebreak"||new RegExp(Pd).test(p)&&"standard"||"unknown";return l.push(m),m==="standard"&&f?p.match(v)[1]:p}).join(" "),{score:t}}function cW({score:t,applied:e}){for(const T of[".",","," ","/"]){const N=new RegExp(`^(\\d+)\\${T}(\\d+)$`);if(N.test(t)){const w=t.match(N).slice(1).map(U=>parseInt(U)),$=Math.abs(w[0]-w[1]);$<=10&&$>=2&&(t=t.split(T).join("-"),e.push("variedJoinerPattern"))}}t.includes(";")&&(t=t.split(";").join(" "),e.push("semicolon set separation"));const r=/(^|\s)(\d)\/(\d)(\d)\/(\d)(\(|$)/;if(r.test(t)){const[T,N,w,$,U,A]=t.match(r).slice(1);t=t.replace(r,`${T}${N}-${w} ${$}-${U}${A}`),e.push("smashSlashPattern")}/.*\s6[/-]+$/.test(t)&&(t+="0",e.push("incompleteFinalSetPattern"));const o=/\(6,\)/g;o.test(t)&&(t=t.replace(o,"(6, 0)"),e.push("missingZeroPattern1"));const i=/^\d{3,}\(/,s=/\(\d+\)\d+/;[i,s].forEach(()=>{t=t.split(" ").map(N=>(i.test(N)&&(N=N.replace("("," (")),s.test(N)&&(N=N.replace(")",") ")),N)).join(" "),e.push("spaceConsiderationPatterns")});let c=yd(t);c!==t&&(t=c,e.push("deDashMash"));const l=/^(\d)[-/,]+(\d{2})[-/,]+(\d)$/;if(l.test(t)){const[T,N,w]=t.match(l).slice(1),[$,U]=N.split("");t=`${T}-${$} ${U}-${w}`,e.push("smashSetPattern")}const u=/^(\d+)[ -](\d+)$/,d=/^([\d -]+)\/([\d -]+)$/;if(d.test(t)){const[T,N]=t.match(d).slice(1),w=T.trim(),$=N.trim();if(u.test(w)&&u.test($)){const U=w.match(u).slice(1,3).join("-"),A=$.match(u).slice(1,3).join("-");t=`${U} ${A}`,e.push("slashSeparationPattern")}}const p=/^([\d -]+),([\d -]+)$/;if(p.test(t)){const[T,N]=t.match(p).slice(1),w=T.trim(),$=N.trim();if(u.test(w)&&u.test($)){const U=w.match(u).slice(1,3).join("-"),A=$.match(u).slice(1,3).join("-");t=`${U} ${A}`,e.push("commaSeparationPattern")}}const v=/^\d \d,/;if(v.test(t)){const T=t.match(v)[0],N=T.slice(0,T.length-1).split(" ").join("-");t=t.replace(T,N),e.push("singleSetCommaSeparationPattern")}let f=0;const m=/(\d+)-(\d{2})-(\d+)/;for(;m.test(t)&&f<3;){const[T,N,w]=t.match(m).slice(1),$=N.split(""),U=`${T}-${$[0]} ${$[1]}-${w}`;t=t.replace(m,U),e.push("noSetSeparationPattern"),f+=1}const g=/(^|\s)7-6\s(\d+)\s/g,h=t.match(g);if(h!=null&&h.length){const T=/(^|\s)7-6\s(\d+)\s/;h.forEach(N=>{const w=N.match(T).slice(2)[0];t=t.replace(N,`7-6(${w}) `),e.push("floatingTiebreakPattern1")})}let _=t.match(/\d \d /);_==null||_.forEach(T=>{const N=T.slice(0,T.length-1).split(" ").join("-");t=t.replace(T,N),e.push("spaceSeparatedSetPattern1")}),_=t.match(/ \d \d$/),_==null||_.forEach(T=>{const N=" "+T.slice(1).split(" ").join("-");t=t.replace(T,N),e.push("spaceSeparatedSetPattern2")});const I=/^\d, *\d\/\d, *\d/;if(I.test(t)){const T=t.match(I)[0],N=T.split("/").map(w=>`(${w})`).join(" ")+" ";t=t.replace(T,N),e.push("slashCommaSetPattern")}const P=/\(6-\)/g;P.test(t)&&(t=t.replace(P,"(6-0)"),e.push("missingZeroPattern2"));const S=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)","g");if(S.test(t)){const T=t.match(S),N=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)");let w=t;T.forEach($=>{const[U,A]=$.match(N).slice(1),C=`${U}-${A}`;w=w.replace($,C)}),t=w,e.push("slashSetPattern")}const y=/(.*)\s(1\d)\s(\d+)$/;if(y.test(t)){const[T,N,w]=t.match(y).slice(1);T.replace(/\D/g,"").length>=4&&(t=T+` ${N}${w}`,e.push("spaceSeparatedSuperPattern"))}const O=/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/g;for(const T of t.match(O)||[]){const[N,w,$,U]=T.match(/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/).slice(1),[A,C]=w.split("-").map(D=>parseInt(D));Math.abs(A-C)===1&&(t=t.replace(T,`${N}${w}(${$})${U}`),e.push("spaceSeparatedSetPattern"))}const b=/\d-\d \(\d{1,2}\)(\s|$|,)/g;for(const T of t.match(b)||[]){const N=/(\d-\d) \((\d{1,2})\)(\s|$|,)/,[w,$,U]=T.match(N).slice(1),[A,C]=w.split("-").map(D=>parseInt(D));Math.abs(A-C)===1&&(t=t.replace(T,`${w}(${$})${U}`),e.push("floatingTiebreakPattern2"))}const E=/(^|\s)(\d \d)\(/g;for(const T of t.match(E)||[]){const N=/(^|\s)(\d \d)\(/,[w,$]=T.match(N).slice(1);t=t.replace(T,`${w}${$.split(" ").join("-")}(`),e.push("spacedTiebreakPattern")}return{score:t,applied:e}}function lW({score:t,matchUpStatus:e}){var r;let n=t==null?void 0:t.split(" ");t=n.map(c=>{if(c.endsWith("]")){const l=c.split("[");if(Js(l[0]))return l[0]+`(${l[1].slice(0,l[1].length-1)})`}return c}).join(" ");const o=new RegExp(/(\([\d ]+\))/g);if(o.test(t))for(const c of t.match(o)){let u=(r=c.replace(" ","-").match(/\((.*)\)/))==null?void 0:r[1];if(Pt(u)&&(u==null?void 0:u[0])>2){if([2,4].includes(u.length))u=u.split("").join("-");else if(u.length===3){const d=u.indexOf("1");u=au(u.split(""),d)}}t=t.replace(c,`(${u})`)}n=t==null?void 0:t.split(" ");let i=new RegExp(/^(\d[-/]+\d)\((\d+)[-/]+(\d+)\)$/);const s=n.length-1;t=n.map((c,l)=>{const u=[void 0,"","COMPLETED"].includes(e)||l!==s;if(i.test(c)&&u){const[d,p,v]=Array.from(c.match(i)).slice(1),f=Math.min(p,v);return`${d}(${f})`}return c}).join(" "),n=t==null?void 0:t.split(" "),i=new RegExp(/^(\d{2})\((\d+)\)$/),t=n.map(c=>{if(i.test(c)){const[l,u]=Array.from(c.match(i)).slice(1),d=l.split("");return`${d[0]}-${d[1]}(${u})`}return c}).join(" "),n=t==null?void 0:t.split(" "),i=new RegExp(/^\((\d[-/]+\d)\)(\d+)$/),t=n.map(c=>{if(i.test(c)){const[l,u]=Array.from(c.match(i)).slice(1);return Js(l)?`${l}(${u})`:l}return c}).join(" "),n=t==null?void 0:t.split(" "),i=new RegExp(/^1-0\((\d+)\)$/),t=n.map(c=>{if(i.test(c)){const[l]=c.match(i).slice(1);return`[${l<9?10:parseInt(l)+2}-${l}]`}return c}).join(" ");const a=/\((\d)+0 /;if(a.test(t)){const c=t.match(a)[1];t=t.replace(a,`(${c}) `)}return{score:t}}function uW({score:t,attributes:e,identifier:r}){if(typeof t!="string")return{score:t,identifier:r};const n=new RegExp(/\([\d,/ ]+\)/g),o=t.match(n);for(const d of o||[]){const[p]=d.match(/^\((.*)\)$/).slice(1),f=t.split(d)[0].split(")").reverse()[0].replace(/\D/g,"");if(p.length===2&&(f==null?void 0:f.length)>=2){const h=f.slice(f.length-2).split("").map(I=>parseInt(I));if(Math.abs(h[0]-h[1])===1)continue}const m=Z_(p),g=yd(m);t=t.replace(d,`(${g})`).trim()}const i=new RegExp(/\[[\d,/ ]+\]/g),s=t.match(i);s==null||s.forEach(d=>{const p=Z_(d.match(/^\[(.*)\]$/)[1]);t=t.replace(d,`(${p}) `).trim()});const a=[")","]"],c=[")(","), (",") (",")[",") [","](","] ("];if(t.startsWith("(")&&a.some(d=>t.endsWith(d))&&c.some(d=>t.includes(d))){let d="";const p=t.split(/[)\]]/).filter(Boolean).map(h=>(h.startsWith(",")&&(h=h.slice(1)),h.trim())),v=p.every(h=>h.includes(",")||Ml(h)),f=p.every(h=>h.includes("/")||Ml(h)),m=p.every(h=>h.includes("-")||Ml(h)),g=v&&","||m&&"-"||f&&"/";if(g){let h;p.forEach(_=>{if(_.startsWith("("))if(h==="set"&&(d+=" "),_.includes(g))d+=_.slice(1).split(g).map(I=>I.trim()).join("-"),h="set";else{const I=_.slice(1);d+=`(${I}) `,h="tiebreak"}else if(_.startsWith("[")){const I=_.slice(1).split(g).map(S=>parseInt(S.trim())),P=Math.min(...I);h==="set"?d+=`(${P}) `:d+=`[${I.join("-")}] `,h="tiebreak"}}),t=d.trim()}}let l=fr(t.split(""));l["("]===1&&l[")"]===1&&t.startsWith("(")&&t.endsWith(")")&&(t=t.slice(1,t.length-1),l["-"]===1&&Js(t)&&Pt(e==null?void 0:e.removed)&&(t=t+`(${e.removed})`,e.removed=void 0));const u=/\(\)/g;return u.test(t)&&(t=t.replace(u,"").trim()),{score:t}}function lC({score:t}){const e=t.split(""),r=[];let n;const o=()=>n=[void 0,void 0,void 0],i=()=>{let a=`${n[0]}-${n[1]}`;return n[2]&&(a+=` (${n[2]})`),o(),n.push(n),a};o();const s=()=>n[0]!==void 0&&n[1]!==void 0&&Math.abs(parseInt(n[0])-parseInt(n[1]));for(;e.length;){const a=e.shift(),c=Pt(a)&&parseInt(a),l=n[0]!==void 0&&n[1]!==void 0;if(Pt(c)){if(n[0]===void 0){n[0]=c;continue}if(n[1]===void 0&&(n[1]=c,s()>1)){r.push(i()),n=[void 0,void 0];continue}if(l&&e.length===1&&Pt(e[0])){const u=e.pop();n[0]=n[0].toString()+n[1].toString(),n[1]=u,r.push(i()),n=[void 0,void 0]}l&&s()}}return{sets:r}}function Of(t){const e=t.indexOf("1"),r=t.split(""),n=r.every(o=>!isNaN(o));if(n&&t.length===3&&e===0){const o=au(r,e);if(o)return o}if(n&&t.length===7&&e>3){const o=r.slice(4),i=au(o,e-4);if(i)return`${r[0]}-${r[1]} ${r[2]}-${r[3]} ${i}`}}function uC({score:t,applied:e,matchUpStatus:r}){const n=t==null?void 0:t.toString().split(""),o=n==null?void 0:n.every(s=>Pt(s)),i=s=>Math.abs(s[0]-s[1]);if(typeof t=="number"||o){t=t.toString().toLowerCase(),o&&(t=n.join(""));const s=o?n.map(a=>parseInt(a)):t.split("").map(a=>parseInt(a));if(lC({score:t}),s.length,t.length===3&&i(s.slice(0,2))===1){const[a,c,l]=s;t=`${a}-${c}(${l})`,e.push("numericTiebreakPattern1")}else if(t.length===3&&s[0]===1){const[a,c,l]=s;t=`[${a}${c}-${l}]`,e.push("numericTiebreakPattern2")}else if(t.length===4&&i(s.slice(0,2))===1&&"987654".split("").includes(s[0].toString())){const[a,c,l,u]=s,d=Math.min(l,u);t=`${a}-${c}(${d})`,e.push("numericTiebreakPattern3")}else if(t.length===4&&s[0]===1&&s[2]===1){const[a,c,l,u]=s;t=`[${a}${c}-${l}${u}]`,e.push("bigSuper")}else if(t.length===4){const[a,c,l,u]=s;t=`${a}${c} ${l}${u}`,e.push("split4")}else if(t.length===5&&i(s.slice(0,2))===1){const[a,c,l,u,d]=s;t=`${a}-${c}(${l}) ${u}-${d}`,e.push("numericTiebreakPattern4")}else if(t.length===5&&i(s.slice(3))===1){const[a,c,l,u,d]=s;t=`${a}-${c} ${l}-${u}(${d})`,e.push("numericTiebreakPattern5")}else if(s.length===7)if(i(s.slice(0,2))>1&&i(s.slice(2,4))>1&&s[4]===1){const[a,c,l,u,d,p,v]=s;t=`${a}-${c} ${l}-${u} [${d}${p}-${v}]`,e.push("numericTiebreakPattern6")}else if(i(s.slice(0,2))===1&&i(s.slice(3,5))>1&&i(s.slice(5,7))>1){const[a,c,l,u,d,p,v]=s;t=`${a}-${c}(${l}) ${u}-${d} ${p}-${v}`,e.push("numericTiebreakPattern7")}else if(i(s.slice(0,2))>1&&i(s.slice(2,4))===1&&i(s.slice(5,7))>1){const[a,c,l,u,d,p,v]=s;t=`${a}-${c} ${l}-${u}(${d}) ${p}-${v}`,e.push("numericTiebreakPattern8")}else if(i(s.slice(0,2))>1&&i(s.slice(2,4))>1&&i(s.slice(4,6))===1){const[a,c,l,u,d,p,v]=s;t=`${a}-${c} ${l}-${u} ${d}-${p}(${v})`,e.push("numericTiebreakPattern9")}else t=t.slice(0,2)+" "+t.slice(2,4)+" "+t.slice(4),e.push("numericMatchTiebreakPattern");else if(t.length%2){const a=Of(t);a&&t!==a&&e.push("parsedSuperPattern"),t=a||t}else{const a=jt(t.split(""),2).map(m=>m.join("")),c=a.map(m=>{const[g,h]=m.split("").map(P=>parseInt(P)),_=Math.abs(g-h),I=g>h?1:2;return _>1&&I||I*-1}),l=c.reduce((m,g)=>m>0&&g>0,1),u=fr(c),d=c.map(m=>Math.abs(m)),p=fr(d),v=c[0]<0,f=!v&&c[1]<0;if(c[0]>0&&c[1]>0&&c[0]!==c[1])t=[a.slice(0,2).join(" "),a.slice(2).join("-")].join(" "),e.push("numeric3rdSetTiebreakPattern");else if(l)t=a.join(" "),e.push("chunkSplit");else if(s.length==6){if(u[1]==2||u[2]===2)if(!Object.values(p).includes(3))t=a.join(" "),e.push("chunkSplit");else{const[m,g,h,_,I,P]=s,S=c.reduce((y,O,b)=>O<0?b:y,void 0);if(S===0){const y=Math.min(h,_);t=`${m}-${g}(${y}) ${I}-${P}`,e.push("chunkSplitTiebreak1")}else if(S===1){const y=Math.min(I,P);t=`${m}-${g} ${h}-${_}(${y})`,e.push("chunkSplitTiebreak2")}else t=`${m}-${g} ${h}-${_}`,e.push("chunkSplitTrimExtraneous")}}else if(s.length===8){const[m,g,h,_,I,P,S,y]=s;v||f?s[5]===1&&(v?t=`${m}-${g}(${h}) ${_}-${I} [${P}${S}-${y}]`:t=`${m}-${g} ${h}-${_}(${I}) [${P}${S}-${y}]`):(c[0],c[1])}}}return{score:t,applied:e,matchUpStatus:r}}function dC(t){const e=[0,0],r=[],n=t.split(" "),o=/(\d+)-(\d+)/;n.forEach(c=>{if(o.test(c)){const l=c.match(o).slice(1).map(d=>parseInt(d)),u=l[0]>l[1]&&1||l[1]>l[0]&&2;u&&(e[u-1]+=1,r.push(u))}});const i=e[0]>e[1]&&1||e[1]>e[0]&&2,s=e[0]>0&&e[0]===e[1],a=e.reduce((c,l)=>c+l,0);return{setsWon:e,setsTied:s,setWinners:r,totalSets:a,winningSide:i}}function dW({score:t,matchUpStatus:e,attributes:r}){const n=[];let o;const i=t.split(" "),s=i.length;t=i.map((u,d)=>{if(new RegExp(cc).test(u)){const v=u.slice(3),f=u.slice(0,3),m=f.split("-");if(!Js(f)&&!e){const g=Math.max(...m),h=f.indexOf(g),_=[g,g-1];return(h?_.reverse().join("-"):_.join("-"))+v}}else if(u.length===2&&Pt(u))return u.split("").join("-");u=yd(u);const p=new RegExp(`^${Xv}$`).test(u)&&"super"||new RegExp(`^${cc}$`).test(u)&&"tiebreak"||new RegExp(`^${Pd}$`).test(u)&&"standard"||"unknown";if(n.push(p),s>1&&p==="standard"&&d<2){const[v,f]=u.split("-"),m=Math.abs(parseInt(v)-parseInt(f)),g=Math.max(v,f),h=Math.min(v,f),_=[parseInt(v),parseInt(f)].indexOf(h);if(g>9&&m>2){const I=g.toString().split(""),P=I.find(S=>parseInt(S)>h||d&&parseInt(S)<=o)||I[0];P&&(u=_?[P,h].join("-"):[h,P].join("-"))}g>(o||0)&&(o=g)}if(p==="standard"){const[v,f]=u.split("-");if(!Math.abs(parseInt(v)-parseInt(f))&&e!=="RETIRED")return""}return u}).filter(Boolean).join(" ");const{setsWon:a,setWinners:c,totalSets:l}=dC(t);if(l===1&&(r==null?void 0:r.removed)==="6"&&(t+=" 6-0"),t.split(" ").length>2&&Math.max(...a)>=2&&c[0]===c[1]&&(t=t.split(" ").slice(0,2).join(" ")),Math.max(...a)>2){let u=[0,0];t=t.split(" ").map((d,p)=>(u[c[p]]+=1,Math.max(...u)>2?void 0:d)).filter(Boolean).join(" ")}return{score:t,profile:n}}function pW({score:t}){const{setsTied:e,winningSide:r}=dC(t),n=/\s\((\d+)\)$/;if(!r&&e&&n.test(t)){const a=t.match(n).slice(1)[0],c=a<=8?10:a+2;t=t.replace(n,` [${c}-${a}]`)}const o=t.split(" "),i=o[o.length-1];if(!i.includes("-")||i.indexOf("(")>0)return{score:t};let s=i.split("(").join("").split(")").join("").split("-");if(!s.every(a=>Pt(a)))return{score:t};if(s[0]==="76"){const a=s[1].length===2?Math.min(...s[1].split("").map(c=>parseInt(c))):s[1];t=[...o.slice(0,o.length-1),`7-6(${a})`].join(" ")}else{s=s.map(l=>parseInt(l));const a=Math.max(...s);let c=Math.abs(s[0]-s[1]);if(a>=10){if(c>2&&s.every(l=>+l>=10)){const l=s.map(u=>u===a?u-10:10).sort();c=Math.abs(l[0]-l[1]),c>2&&(s=l)}t=[...o.slice(0,o.length-1),`[${s.join("-")}]`].join(" ")}else o.length===3&&a>=7&&c>2&&(t=[...o.slice(0,o.length-1),`[${s.join("-")}]`].join(" "))}return{score:t}}function fW({score:t}){return t=(t==null?void 0:t.toString().toLowerCase())||"",{score:t}}function vW({score:t,applied:e}){return typeof t!="string"?{score:t}:(t.toLowerCase().includes("o")&&(t=t.toLowerCase().split(" ").map(r=>r.split("o").join("0")).join(" "),e.push("replaceOh")),{score:t,applied:e})}function mW({score:t,applied:e}){return typeof t!="string"?{score:t}:(t=t.toLowerCase().split(" ").map(r=>{if(/^\d+$/.test(r)&&r.length>2){const n=r.indexOf("1");if(r.length%2){if(r.length===3&&n===0){const o=au(r.split(""),n);return e.push("getSuper"),o}}else{const{score:o,applied:i}=uC({score:r,applied:[]});o!==r&&(r=o,e.push(...i))}}return r}).join(" "),{score:t,applied:e})}function gW({score:t,applied:e}){return typeof t!="string"?{score:t}:[3,4].includes(t.length)&&Of(t)?{score:Of(t)}:(t=t.toLowerCase().split(" ").map(r=>{if(/^\d+$/.test(r)&&r.length===1){e.push("removeErroneous1");return}return r}).filter(Boolean).join(" "),{score:t,applied:e})}function hW({score:t,applied:e}){return["walkover","wo","w/o","w-o"].includes(t==null?void 0:t.toString().toLowerCase())?(e.push("handleWalkover"),{matchUpStatus:"walkover",score:"",applied:e}):{score:t}}function _W({score:t,profile:e,applied:r}){var n;t=t==null?void 0:t.toString().toLowerCase();const o=/^(.*\d+.*)(ret|con)+[A-Za-z ]*$/;if(o.test(t)){const[c]=t.match(o).slice(1);return r.push("handleRetired"),{score:c.trim(),matchUpStatus:"retired",applied:r}}const i=(n=e==null?void 0:e.matchUpStatuses)==null?void 0:n.retired,a=["rtd",...Array.isArray(i)?i:[i].filter(Boolean)].find(c=>t==null?void 0:t.endsWith(c));return a?(r.push("handleRetired"),{matchUpStatus:"retired",score:t==null?void 0:t.replace(a,"").trim(),applied:r}):{score:t}}function IW({score:t,attributes:e}){(t.endsWith(" am")||t.endsWith(" pm"))&&(t=""),t=t.replace(/[A-Za-z]+/g,"").trim(),[".",","].some(o=>t.endsWith(o))&&(t=t.slice(0,t.length-1));const r="()/-".split("").some(o=>t.includes(o));/ \d$/.test(t)&&r&&(e={removed:t.slice(t.length-2).trim()},t=t.slice(0,t.length-2));const n=/(.*)[A-Za-z]+$/;return n.test(t)&&(t=t.match(n).slice(1)[0].trim()),{score:t,attributes:e}}function PW({score:t}){return new RegExp(/-\d+\/\d+-/).test(t)&&(t=t.split("/").join(" ")),{score:t}}function yW({score:t}){const e=new RegExp(/^\d+\/\d+/),r=t.split(" ");r.some(o=>e.test(o))&&(t=r.map(o=>e.test(o)?o.replace("/","-"):o).join(" "));const n=/^(\d+), *(\d+)$/;if(n.test(t)){const[o,i]=t.match(n).slice(1);t=[o,i].join("-")}return{score:t}}function OW({score:t}){const e=new RegExp(/\(\d+\/\d+\)/g),r=t.match(e);for(const n of r||[]){const o=n.replace("/","-");t=t.replace(n,o)}return{score:t}}function SW({score:t}){if(t.includes(",")){const e=t.split(",").map(o=>o.trim()),r=o=>/\d \d/.test(o);e.every(r)&&(t=e.map(o=>{const i=/\d+ \d+/g;for(const s of o.match(i)){const[a,c]=s.match(/(\d+) (\d+)/).slice(1);o=o.replace(s,`${a}-${c}`)}return o}).join(" "))}if(t.includes(" ")){const e=t.replace(/[ ,]/g,"");e.split("").every(n=>Pt(n))&&e.length===4&&(t=e)}return{score:t}}function bW({score:t}){const e=new RegExp(/^\[\d+\](.*)$/);e.test(t)&&(t=t.match(e).slice(1)[0].trim());const r=/\(,/g;return r.test(t)&&(t=t.replace(r,"(")),{score:t}}const TW={handleTiebreakSlashSeparation:OW,handleSetSlashSeparation:PW,punctuationAdjustments:iW,handleGameSeparation:yW,joinFloatingTiebreak:aW,handleBracketSpacing:sW,handleSpaceSeparator:SW,separateScoreBlocks:mW,matchKnownPatterns:cW,removeDanglingBits:IW,removeErroneous:gW,handleWalkover:hW,properTiebreak:lW,handleNumeric:uC,handleRetired:_W,containedSets:uW,sensibleSets:dW,stringScore:fW,superSquare:pW,setBuilder:lC,excisions:bW,replaceOh:vW};let bp={};const EW=["handleNumeric","handleWalkover","handleRetired","replaceOh","stringScore","punctuationAdjustments","excisions","handleSpaceSeparator","matchKnownPatterns","removeDanglingBits","handleBracketSpacing","matchKnownPatterns","containedSets","separateScoreBlocks","handleGameSeparation","removeErroneous","joinFloatingTiebreak","handleSetSlashSeparation","handleTiebreakSlashSeparation","properTiebreak","sensibleSets","superSquare"],wW=["handleNumeric","separateScoreBlocks","sensibleSets","superSquare"];function NW({score:t,stepLog:e,fullLog:r,profile:n,identifier:o,fileName:i,sheetName:s}){let a=[],c,l=[],u,d,p=t;const v=m=>{m.forEach(g=>{d=TW[g]({profile:n,identifier:o,matchUpStatus:c,attributes:u,applied:l,score:p});const h=d.score!==p;h&&a.push({method:g,score:d.score}),e&&(r||h||d.matchUpStatus!==c)&&console.log(c?{score:d.score,matchUpStatus:c}:{score:d.score},g),d.matchUpStatus&&(c=d.matchUpStatus),d.attributes&&(u=d.attributes),d.applied&&(l=d.applied),p=d.score})};v(EW);let f=J_(p);return f||(p=t.toString().replace(/\D/g,""),u!=null&&u.removed&&(u.removed=void 0),v(wW),f=J_(p),f||(p="")),l.forEach(m=>{bp[m]||(bp[m]=0),bp[m]+=1}),{score:p,matchUpStatus:c==null?void 0:c.toUpperCase(),modifications:a,isValid:f}}var $W=Object.defineProperty,X_=Object.getOwnPropertySymbols,AW=Object.prototype.hasOwnProperty,UW=Object.prototype.propertyIsEnumerable,eI=(t,e,r)=>e in t?$W(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,tI=(t,e)=>{for(var r in e||(e={}))AW.call(e,r)&&eI(t,r,e[r]);if(X_)for(var r of X_(e))UW.call(e,r)&&eI(t,r,e[r]);return t};const{FACTORY:rI}=XA;function cu({tournamentRecord:t,value:e}){const{extension:r}=_r({element:t,name:rI}),n={name:rI,value:tI(tI({},r==null?void 0:r.value),e)};et({element:t,extension:n})}function vi({mutationStatus:t,tournamentId:e,directives:r,timeStamp:n}={}){const{topics:o}=Mn();for(const i of[...o].sort(CW)){const s=jF({topic:i});s&&eh({topic:i,notices:s})}t&&n&&o.includes(kh)&&eh({notices:[{tournamentId:e,directives:r,timeStamp:n}],topic:kh})}const nI={[EU]:5,[TU]:5,[wU]:5,[bU]:5,[SU]:5,[yU]:5,[_B]:5,[IB]:5,[OU]:1,[Ev]:1,[kt]:5,[ds]:5,[PU]:4,[hU]:4,[_U]:4,[IU]:4,[Tv]:3,[vU]:2};function CW(t,e){return(nI[e]||0)-(nI[t]||0)}function Is({tournamentRecords:t,convertExtensions:e,ignoreDisabled:r,venueIds:n=[],dates:o}){if(typeof t!="object"||!Object.keys(t).length)return{error:Fe};const i=[],s=[],a=[],c=[];return Object.keys(t).forEach(u=>{const d=t[u];for(const p of d.venues||[])if(d.venues,!(n.length&&!n.includes(p.venueId))){if(r){const{extension:v}=_r({name:Zr,element:p});if(v!=null&&v.value)continue}i.includes(p.venueId)||(a.push(de(p,e,!0)),i.push(p.venueId));for(const v of p.courts||[])if(!s.includes(v.courtId)){if(r&&o){const{extension:m}=_r({name:Zr,element:v});if(pU({extension:m,dates:o}))continue}const{inContextCourt:f}=fU({convertExtensions:e,ignoreDisabled:r,venue:p,court:v});c.push(f),s.push(v.courtId)}}}),{courts:c,venues:a}}function em({tournamentRecords:t,requireCourts:e,dates:r}){return typeof t!="object"||!Object.keys(t).length?{error:Fe}:Object.keys(t).reduce((o,i)=>{const s=t[i],{venues:a}=wv({tournamentRecord:s,dates:r});return a.forEach(c=>{const{venueId:l,courts:u}=c;(!e||(u==null?void 0:u.length))&&!o.venueIds.includes(l)&&(o.venues.push(c),o.venueIds.push(l))}),o},{venues:[],venueIds:[]})}var MW=Object.defineProperty,oI=Object.getOwnPropertySymbols,DW=Object.prototype.hasOwnProperty,jW=Object.prototype.propertyIsEnumerable,iI=(t,e,r)=>e in t?MW(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,sI=(t,e)=>{for(var r in e||(e={}))DW.call(e,r)&&iI(t,r,e[r]);if(oI)for(var r of oI(e))jW.call(e,r)&&iI(t,r,e[r]);return t};function Hc({duplicateValues:t=!0,creationTime:e=!0,removePriorValues:r,timeItem:n,element:o}){if(!n)return{error:TA};if(!o)return{error:Se,info:Iv};const i=n&&Object.keys(n),s=["itemType","itemValue"];if(!(s.filter(l=>i.includes(l)).length===s.length))return{error:bA};if(!o.timeItems)o.timeItems=[];else{const{itemType:l,itemSubTypes:u,itemValue:d}=n,{timeItem:p}=pn({itemSubTypes:u,itemType:l,element:o});if(JSON.stringify(p==null?void 0:p.itemValue)===JSON.stringify(d)&&!t)return sI({},B)}if(n.itemSubTypes&&!n.itemSubTypes.length&&delete n.itemSubTypes,e){const l=new Date().toISOString();Object.assign(n,{createdAt:l})}return r&&(o.timeItems=o.timeItems.filter(({itemType:l})=>n.itemType!==l)),r&&!n.itemValue||o.timeItems.push(n),sI({},B)}function pC({creationTime:t=!0,removePriorValues:e,tournamentRecord:r,duplicateValues:n,participantId:o,timeItem:i}){if(!r)return{error:ee};if(!o)return{error:It};const s=qo({tournamentRecord:r,participantId:o});return s.error?s:Hc({element:s.participant,removePriorValues:e,duplicateValues:n,creationTime:t,timeItem:i})}function Oo({removePriorValues:t,tournamentRecord:e,duplicateValues:r,creationTime:n,timeItem:o}){return e?Hc({element:e,removePriorValues:t,duplicateValues:r,creationTime:n,timeItem:o}):{error:ee}}function zo({removePriorValues:t,duplicateValues:e,creationTime:r,timeItem:n,event:o}){return o?Hc({removePriorValues:t,duplicateValues:e,element:o,creationTime:r,timeItem:n}):{error:Pr}}var RW=Object.defineProperty,aI=Object.getOwnPropertySymbols,FW=Object.prototype.hasOwnProperty,VW=Object.prototype.propertyIsEnumerable,cI=(t,e,r)=>e in t?RW(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,LW=(t,e)=>{for(var r in e||(e={}))FW.call(e,r)&&cI(t,r,e[r]);if(aI)for(var r of aI(e))VW.call(e,r)&&cI(t,r,e[r]);return t};function vr({removePriorValues:t,tournamentRecord:e,duplicateValues:r,drawDefinition:n,disableNotice:o,matchUpId:i,timeItem:s,event:a}){const{matchUp:c}=nt({drawDefinition:n,event:a,matchUpId:i});if(!c)return{error:kr};const l=Hc({removePriorValues:t,element:c,duplicateValues:r,timeItem:s});return o||ze({tournamentId:e==null?void 0:e.tournamentId,eventId:a==null?void 0:a.eventId,context:"addTimeItem",drawDefinition:n,matchUp:c}),l}function BW({tournamentRecord:t,drawDefinition:e,matchUpId:r,event:n}){const{matchUp:o}=nt({drawDefinition:e,event:n,matchUpId:r});return o?(o.timeItems=[],ze({tournamentId:t==null?void 0:t.tournamentId,context:"resetTimeItems",eventId:n==null?void 0:n.eventId,drawDefinition:e,matchUp:o}),LW({},B)):{error:kr}}function Od({removePriorValues:t,tournamentRecords:e,tournamentRecord:r,drawDefinition:n,disableNotice:o,courtDayDate:i,matchUpId:s,courtIds:a}){if(!r&&!e)return{error:ee};if(!s)return{error:Ut};const c=nt({drawDefinition:n,matchUpId:s});if(c.error)return c;if(c.matchUp.matchUpType!==Qr)return{error:Gr};if(!(a===void 0||Array.isArray(a)&&a.length&&a.every(p=>typeof p=="string")))return{error:Z,context:{courtIds:a}};let u;if(a){const p=e||{[r.tournamentId]:r},v=Is({tournamentRecords:p});if(v.error)return v;const f=v.courts.filter(m=>a.includes(m.courtId));if(f.length!==a.length)return{error:Z,context:{courtIds:a}};u=f.map(m=>({venueId:m.venueId,courtId:m.courtId}))}return vr({duplicateValues:!1,removePriorValues:t,tournamentRecord:r,drawDefinition:n,disableNotice:o,matchUpId:s,timeItem:{itemType:jo,itemDate:i,itemValue:u}})}function Oa({removePriorValues:t,tournamentRecords:e,tournamentRecord:r,drawDefinition:n,disableNotice:o,matchUpId:i,venueId:s}){if(!r)return{error:ee};if(!i)return{error:Ut};if(s){const c=Yo({tournamentRecords:e,tournamentRecord:r,venueId:s});if(c.error)return c}return vr({duplicateValues:!1,removePriorValues:t,tournamentRecord:r,drawDefinition:n,disableNotice:o,matchUpId:i,timeItem:{itemType:Ec,itemValue:s}})}function Ps({removePriorValues:t,tournamentRecords:e,tournamentRecord:r,drawDefinition:n,disableNotice:o,courtDayDate:i,matchUpId:s,courtId:a}){var c;if(!r&&!e)return{error:ee};if(!s)return{error:Ut};if(a){const u=ps({tournamentRecords:e,tournamentRecord:r,courtId:a});if(u.error)return u;const d=(c=u.venue)==null?void 0:c.venueId;Oa({tournamentRecord:r,drawDefinition:n,disableNotice:o,matchUpId:s,venueId:d})}return vr({duplicateValues:!1,removePriorValues:t,tournamentRecord:r,drawDefinition:n,disableNotice:o,matchUpId:s,timeItem:{itemType:ts,itemDate:i,itemValue:a}})}function xW({matchUps:t,matchUpId:e}){if(!Array.isArray(t))return{error:Z};const r=t.find(a=>a.matchUpId===e),{drawId:n,eventId:o,structureId:i,tournamentId:s}=r||{};return{matchUpId:e,drawId:n,eventId:o,structureId:i,tournamentId:s}}var GW=Object.defineProperty,lI=Object.getOwnPropertySymbols,kW=Object.prototype.hasOwnProperty,WW=Object.prototype.propertyIsEnumerable,uI=(t,e,r)=>e in t?GW(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,qW=(t,e)=>{for(var r in e||(e={}))kW.call(e,r)&&uI(t,r,e[r]);if(lI)for(var r of lI(e))WW.call(e,r)&&uI(t,r,e[r]);return t};function bi({removePriorValues:t,tournamentRecord:e,drawDefinition:r,disableNotice:n,scheduledTime:o,matchUpId:i,matchUp:s}){if(!i)return{error:Ut};if(!ua(o))return{error:Rr};if(!s){const v=nt({drawDefinition:r,matchUpId:i});if(v.error)return v;s=v.matchUp}const a=Me(o),c="addMatchUpScheduledTime";if(a){const v=li({matchUp:s}).scheduledDate;if(v&&v!==a)return k({info:`date in time: ${a} does not corresponde to scheduledDate: ${v}`,result:{error:Rr},stack:c})}let l=Nv({matchUp:s}).timeModifiers||[];if(l!=null&&l.length){const v=tm({disableNotice:!0,removePriorValues:t,tournamentRecord:e,timeModifiers:[],drawDefinition:r,matchUpId:i,matchUp:s});if(v!=null&&v.error)return v}const d=cs(o,!0,!0);return vr({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:r,disableNotice:n,matchUpId:i,timeItem:{itemType:Nc,itemValue:d}})}function tm({removePriorValues:t,tournamentRecord:e,drawDefinition:r,disableNotice:n,timeModifiers:o,matchUpId:i,matchUp:s}){if(!i)return{error:Ut};if(o!==void 0&&!Array.isArray(o))return{error:Z,info:Yt("timeModifiers")};let a=Nv({matchUp:s}).timeModifiers||[];const c=o.filter(p=>!a.includes(p));if(o.length&&!c.length)return qW({},B);if(c.some(p=>o_.includes(p))){a=a.filter(v=>!o_.includes(v));const p=bi({disableNotice:!0,removePriorValues:t,scheduledTime:"",tournamentRecord:e,drawDefinition:r,matchUpId:i});if(p.error)return p}const u=o!=null&&o.length?[...c,...a]:void 0;return vr({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:r,disableNotice:n,matchUpId:i,timeItem:{itemType:CU,itemValue:u}})}var HW=Object.defineProperty,YW=Object.defineProperties,KW=Object.getOwnPropertyDescriptors,dI=Object.getOwnPropertySymbols,zW=Object.prototype.hasOwnProperty,QW=Object.prototype.propertyIsEnumerable,pI=(t,e,r)=>e in t?HW(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,fI=(t,e)=>{for(var r in e||(e={}))zW.call(e,r)&&pI(t,r,e[r]);if(dI)for(var r of dI(e))QW.call(e,r)&&pI(t,r,e[r]);return t},JW=(t,e)=>YW(t,KW(e));function In(t,e){const r=RA.test(t)?t:tt(t),n=Me(t)||Me(e)||yn(new Date);return new Date(`${n}T${r}`)}function Sd({errorOnAnachronism:t=!1,checkChronology:e=!0,matchUpDependencies:r,inContextMatchUps:n,removePriorValues:o,tournamentRecords:i,tournamentRecord:s,drawDefinition:a,disableNotice:c,drawMatchUps:l,matchUpId:u,schedule:d,event:p}){var v;if(!d)return{error:Se,info:"Missing schedule"};if(!a)return{error:pe};if(!u)return{error:Ut};const f="drawEngine.addMatchUpScheduleItems";let m,g;if(l)m=l.find($=>$.matchUpId===u);else{const $=nt({drawDefinition:a,event:p,matchUpId:u});if($.error)return $;m=$.matchUp}const{endTime:h,courtId:_,courtIds:I,courtOrder:P,resumeTime:S,scheduledDate:y,scheduledTime:O,startTime:b,stopTime:E,timeModifiers:T,venueId:N}=d;e&&(!r||!n)&&({matchUpDependencies:r,matchUps:n}=qr({drawDefinition:a}));const w=(v=r==null?void 0:r[u])==null?void 0:v.matchUpIds;if(d.scheduledDate&&e&&w){const $=n.filter(U=>{var A,C;return(((A=U.schedule)==null?void 0:A.scheduledDate)||Me((C=U.schedule)==null?void 0:C.scheduledTime))&&w.includes(U.matchUpId)}).map(({schedule:U})=>{const A=Gl(U);return new Date(A).getTime()});if($!=null&&$.length){const U=Gl(d),A=new Date(U).getTime();if(Math.max(...$)>=A){if(t)return k({result:{error:kg},stack:f});g=kg}}}if(y!==void 0){const $=rm({disableNotice:!0,removePriorValues:o,tournamentRecord:s,drawDefinition:a,scheduledDate:y,matchUpId:u});if($!=null&&$.error)return k({result:$,stack:f,context:{scheduledDate:y}})}if(O!==void 0){const $=bi({disableNotice:!0,removePriorValues:o,tournamentRecord:s,drawDefinition:a,scheduledTime:O,matchUpId:u,matchUp:m});if($!=null&&$.error)return k({result:$,stack:f,context:{scheduledTime:O}})}if(b!==void 0){const $=om({disableNotice:!0,removePriorValues:o,tournamentRecord:s,drawDefinition:a,matchUpId:u,startTime:b,matchUp:m,event:p});if($!=null&&$.error)return k({result:$,stack:f,context:{startTime:b}})}if(E!==void 0){const $=sm({disableNotice:!0,removePriorValues:o,tournamentRecord:s,drawDefinition:a,matchUpId:u,stopTime:E,matchUp:m,event:p});if($!=null&&$.error)return k({result:$,stack:f,context:{stopTime:E}})}if(S!==void 0){const $=am({disableNotice:!0,removePriorValues:o,tournamentRecord:s,drawDefinition:a,resumeTime:S,matchUpId:u,matchUp:m,event:p});if($!=null&&$.error)return k({result:$,stack:f,context:{resumeTime:S}})}if(h!==void 0){const $=im({disableNotice:!0,removePriorValues:o,tournamentRecord:s,drawDefinition:a,matchUpId:u,endTime:h,matchUp:m,event:p});if($!=null&&$.error)return k({result:$,stack:f,context:{endTime:h}})}if(I!==void 0){const $=Od({disableNotice:!0,removePriorValues:o,tournamentRecord:s,drawDefinition:a,matchUpId:u,courtIds:I});if($!=null&&$.error)return k({result:$,stack:f,context:{courtIds:I}})}if(_!==void 0&&y!==void 0){const $=Ps({courtDayDate:y,disableNotice:!0,removePriorValues:o,tournamentRecords:i,tournamentRecord:s,drawDefinition:a,matchUpId:u,courtId:_});if($!=null&&$.error)return k({result:$,stack:f,context:{courtId:_}})}if(N!==void 0){const $=Oa({disableNotice:!0,removePriorValues:o,tournamentRecords:i,tournamentRecord:s,drawDefinition:a,matchUpId:u,venueId:N});if($!=null&&$.error)return k({result:$,stack:f,context:{venueId:N}})}if(P!==void 0&&lt(P)){const $=nm({disableNotice:!0,removePriorValues:o,tournamentRecords:i,tournamentRecord:s,drawDefinition:a,courtOrder:P,matchUpId:u});if($!=null&&$.error)return k({result:$,stack:f,context:{courtOrder:P}})}if(T!==void 0){const $=tm({disableNotice:!0,removePriorValues:o,tournamentRecords:i,tournamentRecord:s,drawDefinition:a,timeModifiers:T,matchUpId:u,matchUp:m});if($!=null&&$.error)return k({result:$,stack:f,context:{timeModifiers:T}})}return c||ze({tournamentId:s==null?void 0:s.tournamentId,eventId:p==null?void 0:p.eventId,context:f,drawDefinition:a,matchUp:m}),g?JW(fI({},B),{warnings:[g]}):fI({},B)}function rm({scheduledDate:t,removePriorValues:e,tournamentRecord:r,drawDefinition:n,disableNotice:o,matchUpId:i}){if(!i)return{error:Ut};const s=Tn.test(t);if(t&&!s)return{error:ar};const c={itemValue:Me(t),itemType:wc};return vr({duplicateValues:!1,removePriorValues:e,tournamentRecord:r,drawDefinition:n,disableNotice:o,matchUpId:i,timeItem:c})}function nm({removePriorValues:t,tournamentRecord:e,drawDefinition:r,disableNotice:n,courtOrder:o,matchUpId:i}){if(!i)return{error:Ut};if(o&&!lt(o))return{error:Z,info:"courtOrder must be numeric"};const s=parseInt(o);return vr({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:r,disableNotice:n,matchUpId:i,timeItem:{itemType:UU,itemValue:s}})}function fC({removePriorValues:t,tournamentRecord:e,drawDefinition:r,disableNotice:n,participantId:o,officialType:i,matchUpId:s}){return s?vr({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:r,disableNotice:n,matchUpId:s,timeItem:{itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemSubTypes:[i],itemValue:o}}):{error:Ut}}function om({removePriorValues:t,tournamentRecord:e,drawDefinition:r,disableNotice:n,matchUpId:o,startTime:i,event:s}){if(!o)return{error:Ut};if(!ua(i))return{error:Rr};const{matchUp:a}=nt({drawDefinition:r,event:s,matchUpId:o}),{scheduledDate:c}=li({matchUp:a}),u=(a.timeItems||[]).filter(d=>[$o,io,Ro].includes(d==null?void 0:d.itemType)).map(d=>In(d.itemValue,c)).reduce((d,p)=>!d||p<d?p:d,void 0);if(!u||In(i,c)<u){a.timeItems&&(a.timeItems=a.timeItems.filter(v=>v.itemType!==mn));const d=cs(i,!0,!0);return vr({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:r,disableNotice:n,matchUpId:o,timeItem:{itemType:mn,itemValue:d}})}else return{error:HR}}function im({validateTimeSeries:t=!0,removePriorValues:e,tournamentRecord:r,drawDefinition:n,disableNotice:o,matchUpId:i,endTime:s,event:a}){if(!i)return{error:Ut};if(!ua(s))return{error:Rr};const{matchUp:c}=nt({drawDefinition:n,event:a,matchUpId:i}),{scheduledDate:l}=li({matchUp:c}),d=(c.timeItems||[]).filter(p=>[mn,io,$o].includes(p==null?void 0:p.itemType)).map(p=>In(p.itemValue,l)).reduce((p,v)=>!p||v>p?v:p,void 0);if(!t||!d||In(s,l)>d){c.timeItems&&(c.timeItems=c.timeItems.filter(f=>f.itemType!==Ro));const p=cs(s,!0,!0);return vr({duplicateValues:!1,removePriorValues:e,tournamentRecord:r,drawDefinition:n,disableNotice:o,matchUpId:i,timeItem:{itemType:Ro,itemValue:p}})}else return{error:WR}}function sm({removePriorValues:t,tournamentRecord:e,drawDefinition:r,disableNotice:n,matchUpId:o,stopTime:i,event:s}){if(!o)return{error:Ut};if(!ua(i))return{error:Rr};const{matchUp:a}=nt({drawDefinition:r,event:s,matchUpId:o}),{scheduledDate:c}=li({matchUp:a}),l=a.timeItems||[];if(l.reduce((m,g)=>g.itemType===Ro||m,void 0))return{error:SA};const d=l.filter(m=>[mn,io,$o].includes(m==null?void 0:m.itemType)).sort((m,g)=>In(m.itemValue,c)-In(g.itemValue,c)),p=d[d.length-1],v=p&&p.itemType===$o,f=d.filter(m=>!v||m.createdAt!==p.createdAt).map(m=>In(m.itemValue,c)).reduce((m,g)=>!m||g>m?g:m,void 0);if(In(i,c)>f){if(a.timeItems&&v){const h=p.createdAt;a.timeItems=a.timeItems.filter(_=>_.createdAt!==h)}const g={itemValue:cs(i,!0,!0),itemType:$o};return vr({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:r,disableNotice:n,matchUpId:o,timeItem:g})}else return{error:qR}}function am({removePriorValues:t,tournamentRecord:e,drawDefinition:r,disableNotice:n,resumeTime:o,matchUpId:i,event:s}){if(!i)return{error:Ut};if(!ua(o))return{error:Rr};const{matchUp:a}=nt({drawDefinition:r,event:s,matchUpId:i}),{scheduledDate:c}=li({matchUp:a}),l=a.timeItems||[];if(l.reduce((m,g)=>g.itemType===Ro||m,void 0))return{error:SA};const d=l.filter(m=>[mn,io,$o].includes(m==null?void 0:m.itemType)).sort((m,g)=>In(m.itemValue,c)-In(g.itemValue,c)),p=d[d.length-1],v=p&&p.itemType===io,f=d.filter(m=>!v||m.createdAt!==p.createdAt).map(m=>In(m.itemValue,c)).reduce((m,g)=>!m||g>m?g:m,void 0);if(In(o,c)>f){if(a.timeItems&&v){const h=p.createdAt;a.timeItems=a.timeItems.filter(_=>_.createdAt!==h)}const g={itemValue:cs(o,!0,!0),itemType:io};return vr({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:r,disableNotice:n,matchUpId:i,timeItem:g})}else return{error:YR}}var ZW=Object.defineProperty,XW=Object.defineProperties,eq=Object.getOwnPropertyDescriptors,vI=Object.getOwnPropertySymbols,tq=Object.prototype.hasOwnProperty,rq=Object.prototype.propertyIsEnumerable,mI=(t,e,r)=>e in t?ZW(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,gI=(t,e)=>{for(var r in e||(e={}))tq.call(e,r)&&mI(t,r,e[r]);if(vI)for(var r of vI(e))rq.call(e,r)&&mI(t,r,e[r]);return t},hI=(t,e)=>XW(t,eq(e));function vC({errorOnAnachronism:t=!1,checkChronology:e=!0,matchUpDependencies:r,tournamentRecords:n,tournamentRecord:o,matchUpDetails:i,matchUpIds:s,schedule:a}){var c,l,u;if(!o)return{error:ee};if(!i&&(!s||!Array.isArray(s)))return{error:_c};if(!i&&(!a||typeof a!="object"))return{error:KR};let d;const p=[];let v=0;if(e&&!r){const g=qr({tournamentRecords:n});r=g.matchUpDependencies,d=g.matchUps}d||(d=((c=Vt({tournamentRecord:o}))==null?void 0:c.matchUps)||[]);const f=d.reduce((g,h)=>{const{matchUpId:_,drawId:I}=h;return g[I]?g[I].push(_):g[I]=[_],g},{}),m=i==null?void 0:i.map(g=>g.matchUpId);for(const g of Object.keys(f)){const{drawDefinition:h}=Ho({tournamentRecord:o,drawId:g}),_=f[g].filter(P=>(s==null?void 0:s.includes(P))||(m==null?void 0:m.includes(P))),I=Er({inContext:!1,drawDefinition:h}).matchUps;for(const P of _){const S=((l=i==null?void 0:i.find(O=>O.matchUpId===P))==null?void 0:l.schedule)||a,y=Sd({schedule:S,matchUpDependencies:r,errorOnAnachronism:t,inContextMatchUps:d,tournamentRecords:n,tournamentRecord:o,checkChronology:e,drawDefinition:h,drawMatchUps:I,matchUpId:P});if((u=y.warnings)!=null&&u.length&&p.push(...y.warnings),y.success&&(v+=1),y.error)return y}}return p.length?hI(gI({},B),{scheduled:v,warnings:p}):hI(gI({},B),{scheduled:v})}var nq=Object.defineProperty,oq=Object.defineProperties,iq=Object.getOwnPropertyDescriptors,_I=Object.getOwnPropertySymbols,sq=Object.prototype.hasOwnProperty,aq=Object.prototype.propertyIsEnumerable,II=(t,e,r)=>e in t?nq(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,PI=(t,e)=>{for(var r in e||(e={}))sq.call(e,r)&&II(t,r,e[r]);if(_I)for(var r of _I(e))aq.call(e,r)&&II(t,r,e[r]);return t},yI=(t,e)=>oq(t,iq(e));function mC({errorOnAnachronism:t,matchUpContextIds:e,tournamentRecords:r,checkChronology:n,matchUpDetails:o,schedule:i}){var s;if(!r)return{error:Fe};if(!Array.isArray(e)&&!Array.isArray(o))return{error:Z};if((!o||e)&&!i)return{error:Se,info:"schedule is required"};const a=[];let c=0;const{matchUpDependencies:l}=qr({tournamentRecords:r});for(const u of Object.values(r)){const{tournamentId:d}=u,p=e==null?void 0:e.filter(f=>f.tournamentId===d).map($t),v=o==null?void 0:o.filter(f=>(f==null?void 0:f.tournamentId)===d);if(p!=null&&p.length||v!=null&&v.length){const f=vC({matchUpDetails:v,matchUpDependencies:l,errorOnAnachronism:t,tournamentRecord:u,checkChronology:n,matchUpIds:p,schedule:i});if((s=f.warnings)!=null&&s.length&&a.push(...f.warnings),f.scheduled&&(c+=f.scheduled),f.error)return f}}return a.length?yI(PI({},B),{scheduled:c,warnings:a}):yI(PI({},B),{scheduled:c})}function bd({tournamentRecords:t}){return t?Object.keys(t).reduce((r,n)=>{r.tournamentIdMap[n]=[];const i=t[n].events||[],s=i.map(({eventId:c})=>c),a=i.map(c=>(c.drawDefinitions||[]).map(({drawId:l})=>l)).flat();return r.tournamentIdMap[n].push(...s,...a),r.eventIds.push(...s),r.drawIds.push(...a),r},{eventIds:[],drawIds:[],tournamentIdMap:{}}):{error:Fe}}function cm({drawId:t,eventId:e,tournamentRecords:r}){const{tournamentIdMap:n}=bd({tournamentRecords:r});return Object.keys(n).find(o=>n[o].includes(e)||n[o].includes(t))}var cq=Object.defineProperty,OI=Object.getOwnPropertySymbols,lq=Object.prototype.hasOwnProperty,uq=Object.prototype.propertyIsEnumerable,SI=(t,e,r)=>e in t?cq(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,dq=(t,e)=>{for(var r in e||(e={}))lq.call(e,r)&&SI(t,r,e[r]);if(OI)for(var r of OI(e))uq.call(e,r)&&SI(t,r,e[r]);return t};function pq({drawDefinition:t,matchUpStatus:e,matchUpsMap:r,winningSide:n,dualMatchUp:o,tieFormat:i,structure:s,matchUp:a,event:c,score:l}){var u;const d=de(o,void 0,!0);for(const v of(d==null?void 0:d.tieMatchUps)||[])v.matchUpId===a.matchUpId&&(v.winningSide=n,v.score=l,!At({score:l})&&!e?Object.assign(v,dq({},fd)):e&&(v.matchUpStatus=e));i=i||((u=Zt({matchUp:a,structure:s,drawDefinition:t,event:c}))==null?void 0:u.tieFormat);const{winningSide:p}=Lc({matchUp:d,drawDefinition:t,matchUpsMap:r,structure:s,tieFormat:i,event:c});return{projectedWinningSide:p}}function is({drawPosition:t,matchUps:e=[]}){return{initialRoundNumber:e.filter(({drawPositions:n})=>t&&(n==null?void 0:n.includes(t))).map(({roundNumber:n})=>parseInt(n)).sort(Bt)[0]}}function gC({structureId:t,matchUpsMap:e,matchUp:r}){const n=r==null?void 0:r.roundPosition,o=n%2?1:-1,i=n+o;return{pairedPreviousMatchUp:ui({matchUpsMap:e,structureId:t}).find(({roundNumber:c,roundPosition:l})=>c===(r==null?void 0:r.roundNumber)&&l===i)}}var fq=Object.defineProperty,vq=Object.defineProperties,mq=Object.getOwnPropertyDescriptors,bI=Object.getOwnPropertySymbols,gq=Object.prototype.hasOwnProperty,hq=Object.prototype.propertyIsEnumerable,TI=(t,e,r)=>e in t?fq(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,_q=(t,e)=>{for(var r in e||(e={}))gq.call(e,r)&&TI(t,r,e[r]);if(bI)for(var r of bI(e))hq.call(e,r)&&TI(t,r,e[r]);return t},Iq=(t,e)=>vq(t,mq(e));function hC({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:r,matchUpsMap:n,matchUp:o}){const i=t.find(a=>a.matchUpId===r),{pairedPreviousMatchUp:s}=gC({structureId:i==null?void 0:i.structureId,matchUp:i,matchUpsMap:n});if(i&&s){const a=s==null?void 0:s.matchUpId,c=t.find(u=>u.matchUpId===a),l=(i==null?void 0:i.structureId)===(c==null?void 0:c.structureId)?(i==null?void 0:i.roundPosition)<(c==null?void 0:c.roundPosition)&&1||2:i.structureId===(c==null?void 0:c.structureId)&&2||1;o.matchUpStatusCodes=o.matchUpStatusCodes.map(u=>u.sideNumber===l?Iq(_q({},u),{previousMatchUpStatus:e}):u)}}var Pq=Object.defineProperty,EI=Object.getOwnPropertySymbols,yq=Object.prototype.hasOwnProperty,Oq=Object.prototype.propertyIsEnumerable,wI=(t,e,r)=>e in t?Pq(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,_C=(t,e)=>{for(var r in e||(e={}))yq.call(e,r)&&wI(t,r,e[r]);if(EI)for(var r of EI(e))Oq.call(e,r)&&wI(t,r,e[r]);return t};function Sq({inContextDrawMatchUps:t,sourceMatchUpStatus:e,targetDrawPosition:r,tournamentRecord:n,sourceMatchUpId:o,drawDefinition:i,structureId:s,dualMatchUp:a,roundNumber:c,matchUpsMap:l,event:u}){const{structure:d}=Te({drawDefinition:i,structureId:s});if(d.structureType===er)return;l=l||zt({drawDefinition:i});const v=((l==null?void 0:l.mappedMatchUps)||{})[s].matchUps,{initialRoundNumber:f}=is({drawPosition:r,matchUps:v}),m=v==null?void 0:v.filter(h=>{var _;return h.roundNumber>=c&&h.roundNumber!==f&&((_=h.drawPositions)==null?void 0:_.includes(r))}),{positionAssignments:g}=Xe({drawDefinition:i,structureId:s});for(const h of m){const _=bq({inContextDrawMatchUps:t,sourceMatchUpStatus:e,positionAssignments:g,targetDrawPosition:r,tournamentRecord:n,sourceMatchUpId:o,drawDefinition:i,dualMatchUp:a,matchUpsMap:l,matchUp:h,event:u});if(_.error)return _}return _C({},B)}function bq({inContextDrawMatchUps:t,positionAssignments:e,sourceMatchUpStatus:r,targetDrawPosition:n,tournamentRecord:o,sourceMatchUpId:i,drawDefinition:s,dualMatchUp:a,matchUpsMap:c,matchUp:l,event:u}){var d,p,v;const f="removeSubsequentDrawPosition";if(a){const _=(p=(d=t.find(({matchUpId:P})=>l.matchUpId===P).sides)==null?void 0:d.find(P=>P.drawPosition===n))==null?void 0:p.sideNumber,I=(v=l.sides)==null?void 0:v.find(P=>P.sideNumber===_);I&&delete I.lineUp}l.drawPositions=(l.drawPositions||[]).map(h=>h===n?void 0:h).filter(Boolean);const g=e.filter(({drawPosition:h})=>{var _;return(_=l.drawPositions)==null?void 0:_.includes(h)}).filter(h=>h.bye).length;return l.matchUpStatus=g?qe:[Be,Ge].includes(l.matchUpStatus)?l.matchUpStatus:pt,[Ge,Be].includes(l.matchUpStatus)&&(l.winningSide=void 0),l.matchUpStatusCodes&&hC({inContextDrawMatchUps:t,sourceMatchUpStatus:r,sourceMatchUpId:i,matchUpsMap:c,matchUp:l}),ze({tournamentId:o==null?void 0:o.tournamentId,eventId:u==null?void 0:u.eventId,context:`${f}-${n}`,drawDefinition:s,matchUp:l}),_C({},B)}function IC({positionAssignments:t,tournamentRecord:e,drawDefinition:r,matchUpsMap:n,structure:o,event:i}){const{matchUps:s}=Ke({drawDefinition:r,matchUpsMap:n,structure:o,event:i});s.forEach(a=>{const l=t.filter(({drawPosition:u})=>{var d;return(d=a.drawPositions)==null?void 0:d.includes(u)}).filter(u=>u.bye).length;a.winningSide||(Object.assign(a,{matchUpStatus:l?qe:pt}),ze({tournamentId:e==null?void 0:e.tournamentId,context:"modifyRoundRobinMatchUpsStatus",eventId:i==null?void 0:i.eventId,drawDefinition:r,matchUp:a}))})}function Sa({tournamentRecord:t,drawDefinition:e,event:r}){const n=(t==null?void 0:t.events)||r&&[r],o=(n==null?void 0:n.map(c=>c==null?void 0:c.drawDefinitions).flat().filter(Boolean))||e&&[e]||[],i={},s={},a=o.map(({structures:c})=>c==null?void 0:c.filter(l=>l==null?void 0:l.structures)).flat().filter(Boolean);for(const c of a){const{structures:l,structureId:u}=c||{};l&&(i[u]=l==null?void 0:l.map(d=>d.structureId))&&l.forEach(d=>s[d.structureId]=c.structureId)}return{containedStructures:i,containerStructures:s}}function Yc({drawDefinition:t,findContainer:e,structureId:r,structure:n}){var o;const i={isCollectionMatchUp:!1},{containedStructures:s}=Sa({drawDefinition:t}),a=s[r]||[];if(!n){const y=Te({drawDefinition:t,structureId:r});if(y.error)return y;n=e&&y.containingStructure||y.structure}if(mo({drawDefinition:t,structure:n}))return{structure:n,isAdHoc:!0,error:sa};const{matchUps:c}=wt({inContext:!0,drawDefinition:t,matchUpFilters:i}),l=c.filter(y=>y.structureId===r||a.includes(y.structureId)),{matchUpDependencies:u}=qr({drawIds:[t.drawId],matchUps:c,drawDefinition:t}),d=[],p={},v=[],f=[];for(const y of c){if(y.structureId===r||a.includes(y.structureId)){v.push(...y.drawPositions||[]);const O=y.roundNumber;for(const b of(y.drawPositions||[]).filter(Boolean))(!p[b]||p[b]>O)&&(p[b]=O)}xv(y)&&(f.push(y),d.push(y.matchUpId,...((o=u==null?void 0:u[y==null?void 0:y.matchUpId])==null?void 0:o.matchUpIds)||[]))}const m=Ve(v.filter(Boolean)).sort(Bt),g=Ve(d),h=Ve(l.map(({matchUpId:y,drawPositions:O})=>g.includes(y)?O:[]).flat().filter(Boolean)).sort(Bt),{positionAssignments:_}=Xe({drawDefinition:t,structure:n}),I=_.filter(y=>y.bye).map(y=>y.drawPosition),P=_.filter(y=>y.qualifier).map(y=>y.drawPosition),S=(m==null?void 0:m.filter(y=>!h.includes(y)))||[];return{allDrawPositions:m,inContextStructureMatchUps:l,drawPositionInitialRounds:p,activeDependentMatchUpIds:g,qualifyingDrawPositions:P,inactiveDrawPositions:S,positionAssignments:_,activeDrawPositions:h,byeDrawPositions:I,activeMatchUps:f,structure:n}}function Sn(t,e){e||Ct()}var Tq=Object.defineProperty,Eq=Object.defineProperties,wq=Object.getOwnPropertyDescriptors,NI=Object.getOwnPropertySymbols,Nq=Object.prototype.hasOwnProperty,$q=Object.prototype.propertyIsEnumerable,$I=(t,e,r)=>e in t?Tq(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Td=(t,e)=>{for(var r in e||(e={}))Nq.call(e,r)&&$I(t,r,e[r]);if(NI)for(var r of NI(e))$q.call(e,r)&&$I(t,r,e[r]);return t},Aq=(t,e)=>Eq(t,wq(e));function ba({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:r,drawPosition:n,participantId:o,structureId:i,matchUpsMap:s,event:a}){const c="clearDrawPosition",{structure:l}=Te({drawDefinition:r,structureId:i}),{positionAssignments:u}=St({drawDefinition:r,structure:l}),d=u.find(m=>o&&m.participantId===o||n&&m.drawPosition===n);if(o&&!n&&(n=d==null?void 0:d.drawPosition),!n)return{error:hc};o||(o=d==null?void 0:d.participantId);const{activeDrawPositions:p}=Yc({drawDefinition:r,structureId:i});if(p.includes(n))return{error:zf};t||({matchUps:t}=wt({includeByeMatchUps:!0,inContext:!0,drawDefinition:r,matchUpsMap:s}));const f=Sf({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:r,structureId:i,drawPosition:n,matchUpsMap:s,event:a});return f.error?f:f.drawPositionCleared?(Lo({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:r,source:c,structure:l,event:a}),Aq(Td({},B),{participantId:o})):{error:eR}}function Sf({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:r,drawPosition:n,matchUpsMap:o,structureId:i,event:s}){const{structure:a}=Te({drawDefinition:r,structureId:i}),{positionAssignments:c}=St({drawDefinition:r,structure:a}),l=c.some(_=>{if(_.drawPosition===n)return delete _.participantId,delete _.qualifier,delete _.bye,!0});if(a.structureType===er)return IC({positionAssignments:c,tournamentRecord:e,drawDefinition:r,matchUpsMap:o,structure:a}),Td({drawPositionCleared:l},B);const u={isCollectionMatchUp:!1},{matchUps:d}=Ke({drawDefinition:r,matchUpFilters:u,matchUpsMap:o,structure:a,event:s}),{roundProfile:p,roundMatchUps:v}=lr({matchUps:d}),f=Object.keys(p).map(_=>parseInt(_));let m=n;const h=f.map(_=>{var I;const P=p[_].pairedDrawPositions.find($=>$.includes(m)),S=P==null?void 0:P.find($=>$!==m),y=c.find($=>$.drawPosition===S),O=p[_+1],b=y==null?void 0:y.bye,E=O==null?void 0:O.pairedDrawPositions.find($=>$.includes(S)),T=b&&E&&O&&((I=O.drawPositions)==null?void 0:I.includes(S)),w=P&&{pairedDrawPositionByeAdvancedPair:!T&&E,pairedDrawPosition:S,targetDrawPosition:m,relevantPair:P,roundNumber:_};return T&&(m=S),w}).filter(_=>_==null?void 0:_.targetDrawPosition).reduce((_,I)=>{const{roundNumber:P,relevantPair:S,targetDrawPosition:y,pairedDrawPosition:O,pairedDrawPositionByeAdvancedPair:b}=I,E={roundNumber:P,targetDrawPosition:y,relevantPair:S},T=b&&{roundNumber:P+1,targetDrawPosition:O,relevantPair:b,subsequentRoundRemoval:!0},N=[E,T].filter(Boolean);return _.concat(...N)},[]);return h.forEach(({roundNumber:_,targetDrawPosition:I,relevantPair:P})=>{const S=v[_].find(y=>Gt(y.drawPositions.filter(Boolean),P.filter(Boolean)));S&&(Uq({inContextDrawMatchUps:t,targetDrawPosition:I,tournamentRecord:e,drawDefinition:r,structureId:i,roundNumber:_,matchUpsMap:o,event:s}),PC({inContextDrawMatchUps:t,positionAssignments:c,tournamentRecord:e,drawDefinition:r,targetMatchUp:S,drawPosition:n,matchUpsMap:o,structure:a,event:s}))}),{tasks:h,drawPositionCleared:l,positionAssignments:c}}function Uq({inContextDrawMatchUps:t,targetDrawPosition:e,tournamentRecord:r,drawDefinition:n,matchUpsMap:o,roundNumber:i,structureId:s}){const{structure:a}=Te({drawDefinition:n,structureId:s});if(a.structureType===er)return;o=o||zt({drawDefinition:n});const l=((o==null?void 0:o.mappedMatchUps)||{})[s].matchUps,{initialRoundNumber:u}=is({drawPosition:e,matchUps:l}),d=l==null?void 0:l.filter(v=>{var f;return v.roundNumber>=i&&v.roundNumber!==u&&((f=v.drawPositions)==null?void 0:f.includes(e))}),{positionAssignments:p}=Xe({drawDefinition:n,structureId:s});d==null||d.forEach(v=>PC({drawPosition:e,targetMatchUp:v,inContextDrawMatchUps:t,positionAssignments:p,tournamentRecord:r,drawDefinition:n,matchUpsMap:o,structure:a}))}function PC({inContextDrawMatchUps:t,positionAssignments:e,tournamentRecord:r,drawDefinition:n,targetMatchUp:o,drawPosition:i,matchUpsMap:s,structure:a,event:c}){var l,u,d,p;const v="removeDrawPosition",f=o.drawPositions.slice(),m=o.matchUpStatus,g=o.winningSide;s=s||zt({drawDefinition:n});const _=s.mappedMatchUps[a.structureId].matchUps,{initialRoundNumber:I}=is({drawPosition:i,matchUps:_});if(o.roundNumber>I&&(o.drawPositions=(o.drawPositions||[]).map(A=>A===i?void 0:A)),o.matchUpType===We){const A=t==null?void 0:t.find(M=>M.matchUpId===o.matchUpId),C=(l=A==null?void 0:A.sides)==null?void 0:l.reduce((M,D,V)=>D.drawPosition===i?V:M,void 0);C!==void 0&&((d=(u=o.sides)==null?void 0:u[C])!=null&&d.lineUp)&&((p=o.sides)==null||delete p[C].lineUp,ze({tournamentId:r==null?void 0:r.tournamentId,eventId:c==null?void 0:c.eventId,matchUp:o,context:`${v}-TEAM`,drawDefinition:n}))}const P=nr({matchUpId:o.matchUpId,inContextDrawMatchUps:t,drawDefinition:n,structure:a}),{targetLinks:{winnerTargetLink:S},targetMatchUps:{loserMatchUp:y,winnerMatchUp:O,loserMatchUpDrawPositionIndex:b,winnerMatchUpDrawPositionIndex:E}}=P,N=e.filter(({drawPosition:A})=>{var C;return(C=o.drawPositions)==null?void 0:C.includes(A)}).filter(A=>A.bye).length,w=N&&qe||[Be,Ge].includes(o.matchUpStatus)&&o.matcHUpStatus||o.drawPositions.length===2&&pt||void 0;o.matchUpStatus=w,[Ge,Be].includes(o.matchUpStatus)&&(o.winningSide=void 0);const $=f.find(A=>!o.drawPositions.includes(A));if(f.includes(i)&&m===o.matchUpStatus&&g===o.winningSide||($&&Sn(),ze({tournamentId:r==null?void 0:r.tournamentId,eventId:c==null?void 0:c.eventId,matchUp:o,context:`${v}-${i}`,drawDefinition:n})),y&&y.structureId!==P.matchUp.structureId&&!N){const{drawPositions:A,roundNumber:C}=y;if(C===1){const M=A[b];Sf({structureId:y.structureId,drawPosition:M,inContextDrawMatchUps:t,tournamentRecord:r,drawDefinition:n,matchUpsMap:s})}else{const M=Math.min(...A.filter(Boolean)),D=Cq({loserMatchUpDrawPosition:M,inContextDrawMatchUps:t,tournamentRecord:r,drawDefinition:n,loserMatchUp:y,matchUpsMap:s,event:c});if(D.error)return k({result:D,stack:v});const R=((s==null?void 0:s.mappedMatchUps)||{})[y.structureId].matchUps,{initialRoundNumber:W}=is({drawPosition:M,matchUps:R});W===1&&(Sn(),Sf({structureId:y.structureId,drawPosition:M,inContextDrawMatchUps:t,tournamentRecord:r,drawDefinition:n,matchUpsMap:s}))}}if(O&&O.structureId!==P.matchUp.structureId&&S.target.feedProfile!==zr){const{structure:A}=Te({structureId:P.matchUp.structureId,drawDefinition:n});A.structureType!==Ie&&console.log("linked structure winnerMatchUp removal",{winnerMatchUpDrawPositionIndex:E,winnerTargetLink:S})}return Td({},B)}function Cq({loserMatchUpDrawPosition:t,inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:n,loserMatchUp:o,matchUpsMap:i,event:s}){const{structure:a}=Te({structureId:o.structureId,drawDefinition:n}),{positionAssignments:c}=Xe({structure:a});if(c.find(u=>u.drawPosition===t).bye){const u=ba({drawPosition:t,structureId:o.structureId,inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:n,matchUpsMap:i,event:s});if(u.error)return u}return Td({},B)}function Mq({matchUpStatuses:t=[qe,Ge,Be],drawPositionMatchUps:e,loserDrawPosition:r,sourceMatchUps:n}){var o;const i=e==null?void 0:e.reduce((d,p)=>!d||p.roundNumber>d.roundNumber?p:d,void 0),s=(o=i==null?void 0:i.drawPositions)==null?void 0:o.find(d=>d!==r),a=n.filter(d=>{var p;return(p=d==null?void 0:d.drawPositions)==null?void 0:p.includes(s)}).map(d=>d.matchUpStatus),c=n.filter(d=>{var p;return(p=d==null?void 0:d.drawPositions)==null?void 0:p.includes(r)}).map(d=>d.matchUpStatus),l=Gt(a||[],t),u=Gt(c||[],t);return{sourceMatchUp:i,winnerHadMatchUpStatus:l,winnerMatchUpStatuses:a,loserHadMatchUpStatus:u,loserMatchUpStatuses:c}}var Dq=Object.defineProperty,jq=Object.defineProperties,Rq=Object.getOwnPropertyDescriptors,AI=Object.getOwnPropertySymbols,Fq=Object.prototype.hasOwnProperty,Vq=Object.prototype.propertyIsEnumerable,UI=(t,e,r)=>e in t?Dq(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ei=(t,e)=>{for(var r in e||(e={}))Fq.call(e,r)&&UI(t,r,e[r]);if(AI)for(var r of AI(e))Vq.call(e,r)&&UI(t,r,e[r]);return t},Lq=(t,e)=>jq(t,Rq(e));function Ta(t){const{dualWinningSideChange:e,inContextDrawMatchUps:r,tournamentRecord:n,drawDefinition:o,matchUpStatus:i,matchUpsMap:s,dualMatchUp:a,targetData:c,matchUpId:l,structure:u,event:d}=t,p=!!t.matchUp.collectionId,v=mo({drawDefinition:o,structure:u}),{drawPositions:f,winningSide:m}=c.matchUp||{};if(!v&&!f)return{error:Kf};const{targetLinks:{loserTargetLink:g,winnerTargetLink:h,byeTargetLink:_},targetMatchUps:{loserMatchUp:I,winnerMatchUp:P,byeMatchUp:S}}=c,y=On(Lq(ei({},t),{matchUpStatus:i||pt,removeWinningSide:!0}));if(y.error)return y;let O;if(p){const{matchUpTieId:D,matchUpsMap:V}=t;if(O=to({matchUpId:D,tournamentRecord:n,drawDefinition:o,matchUpsMap:V,event:d}),!e&&!O.removeWinningSide)return ei({},B)}if(v)return ei({},B);const{matchUps:b}=Ke({afterRecoveryTimes:!1,inContext:!0,drawDefinition:o,matchUpsMap:s,structure:u}),{positionAssignments:E}=St({structure:u}),T=m-1,N=1-T,w=f[T],$=f[N],{winnerParticipantId:U,loserParticipantId:A}=E.reduce((D,V)=>(V.drawPosition===$&&(D.loserParticipantId=V.participantId),V.drawPosition===w&&(D.winnerParticipantId=V.participantId),D),{winnerParticipantId:void 0,loserParticipantId:void 0}),C=b.filter(D=>{var V;return(V=D.drawPositions)==null?void 0:V.includes($)});if(P){const D=yC({sourceMatchUpStatus:i,sourceMatchUpId:l,inContextDrawMatchUps:r,winningDrawPosition:w,winnerParticipantId:U,tournamentRecord:n,winnerTargetLink:h,drawDefinition:o,winnerMatchUp:P,dualMatchUp:a,matchUpsMap:s});if(D.error)return D}if(I){const{winnerHadMatchUpStatus:D}=Mq({drawPositionMatchUps:C,loserDrawPosition:$,sourceMatchUps:b}),R=g.linkCondition===zn;if(D&&R){const x=Math.min(...I.drawPositions),K=bf({targetLink:g,inContextDrawMatchUps:r,drawDefinition:o,drawPosition:x,matchUpsMap:s,event:d});if(K.error)return K}const W=Bq({sourceMatchUpStatus:i,sourceMatchUpId:l,inContextDrawMatchUps:r,loserParticipantId:A,tournamentRecord:n,loserTargetLink:g,drawDefinition:o,loserMatchUp:I,dualMatchUp:a,matchUpsMap:s,event:d});if(W.error)return W}if(S){const D=Math.min(...S.drawPositions),V=bf({sourceMatchUpId:l,targetLink:_,inContextDrawMatchUps:r,drawDefinition:o,drawPosition:D,matchUpsMap:s,event:d});V.error&&console.log({removeByeResult:V})}const M=O&&{tieMatchUpResult:O};return ei(ei({},B),M)}function yC({inContextDrawMatchUps:t,winningDrawPosition:e,sourceMatchUpStatus:r,winnerParticipantId:n,tournamentRecord:o,winnerTargetLink:i,sourceMatchUpId:s,drawDefinition:a,winnerMatchUp:c,matchUpsMap:l,dualMatchUp:u,event:d}){var p;const{structureId:v,roundNumber:f}=c,m="removeDirectedWinner";if(i){const h=i.target.structureId,{structure:_}=Te({drawDefinition:a,structureId:h}),{positionAssignments:I}=St({structure:_});_.seedAssignments=(_.seedAssignments||[]).filter(N=>N.participantId!==n);const P=I.find(N=>N.participantId===n),S=P==null?void 0:P.drawPosition,{matchUps:y}=Ke({drawDefinition:a,structure:_,event:d}),O=y.map(N=>N.drawPositions).flat(1/0).filter(Boolean);if(fr(O)[S]===1)I.forEach(N=>{N.participantId===n&&delete N.participantId});else{const N=y.filter(({drawPositions:w})=>w.includes(S));console.log("not removing from position assignments since instances > 1",{drawPositionMatchUps:N,winnerTargetLink:i})}const T=(p=l==null?void 0:l.drawMatchUps)==null?void 0:p.find(({matchUpId:N})=>N===c.matchUpId);ze({tournamentId:o==null?void 0:o.tournamentId,eventId:d==null?void 0:d.eventId,matchUp:T,context:m,drawDefinition:a})}const g=Sq({targetDrawPosition:e,inContextDrawMatchUps:t,sourceMatchUpStatus:r,tournamentRecord:o,sourceMatchUpId:s,drawDefinition:a,dualMatchUp:u,matchUpsMap:l,roundNumber:f,structureId:v});return g.error?k({result:g,stack:m}):ei({},B)}function Bq({sourceMatchUpStatus:t,loserParticipantId:e,tournamentRecord:r,loserTargetLink:n,sourceMatchUpId:o,drawDefinition:i,loserMatchUp:s,matchUpsMap:a,dualMatchUp:c,event:l}){var u,d,p;const v="removeDirectedLoser",f=n.target.structureId,{structure:m}=Te({drawDefinition:i,structureId:f}),{positionAssignments:g}=St({structure:m}),h=(u=g.find(_=>_.participantId===e))==null?void 0:u.drawPosition;if(g.forEach(_=>{_.participantId===e&&delete _.participantId}),m.seedAssignments=(m.seedAssignments||[]).filter(_=>_.participantId!==e),c){const _=s==null?void 0:s.sides.reduce((S,y,O)=>y.drawPosition===h?O:S,void 0),I=(d=a==null?void 0:a.drawMatchUps)==null?void 0:d.find(({matchUpId:S})=>S===s.matchUpId),P=(p=I==null?void 0:I.sides)==null?void 0:p[_];P&&(delete P.lineUp,ze({tournamentId:r==null?void 0:r.tournamentId,eventId:l==null?void 0:l.eventId,matchUp:I,context:v,drawDefinition:i}))}return ei({},B)}function bf({inContextDrawMatchUps:t,tournamentRecord:e,sourceMatchUpId:r,drawDefinition:n,drawPosition:o,matchUpsMap:i,targetLink:s,event:a}){const c=s.target.structureId;return ba({sourceMatchUpStatus:qe,inContextDrawMatchUps:t,tournamentRecord:e,sourceMatchUpId:r,drawDefinition:n,matchUpsMap:i,drawPosition:o,structureId:c,event:a}),ei({},B)}function OC(t){let{sourceMatchUp:e}=t;const{targetMatchUp:r,structure:n,matchUpsMap:o,drawPosition:i}=t,s=r.roundNumber>1&&r.roundNumber-1,a=ui({structureId:n.structureId,matchUpsMap:o});!e&&i&&(e=a.find(({drawPositions:f,roundNumber:m})=>m===s&&(f==null?void 0:f.includes(i))));const c=e==null?void 0:e.roundPosition,l=c%2?1:-1,u=c+l,d=s&&a.find(({roundNumber:f,roundPosition:m})=>f===s&&m===u),p=d==null?void 0:d.matchUpStatus,v=[gt,Ot].includes(p);return{pairedPreviousMatchUp:d,pairedPreviousMatchUpIsDoubleExit:v}}function Kc({drawDefinition:t,positionAction:e}){const{extension:r}=_r({name:Kl,element:t}),n=Array.isArray(r==null?void 0:r.value)?r.value:[];if(!n.length){const i=t.structures.find(s=>s.stage===ue);if(i){const s=Xe({structure:i}).positionAssignments.map(({drawPosition:a,participantId:c,bye:l,qualifier:u})=>({drawPosition:a,participantId:c,qualifier:u,bye:l}));n.push({name:"initialMainAssignments",initialAssignments:s})}}const o={name:Kl,value:n.concat(e)};et({element:t,extension:o})}var xq=Object.defineProperty,CI=Object.getOwnPropertySymbols,Gq=Object.prototype.hasOwnProperty,kq=Object.prototype.propertyIsEnumerable,MI=(t,e,r)=>e in t?xq(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,lu=(t,e)=>{for(var r in e||(e={}))Gq.call(e,r)&&MI(t,r,e[r]);if(CI)for(var r of CI(e))kq.call(e,r)&&MI(t,r,e[r]);return t};function Dr({provisionalPositioning:t,isPositionAction:e,tournamentRecord:r,drawDefinition:n,drawPosition:o,matchUpsMap:i,structureId:s,structure:a,event:c}){var l;if(!n)return{error:pe};if(a||({structure:a}=Te({drawDefinition:n,structureId:s})),!a)return{error:xr};s||({structureId:s}=a);const u="assignDrawPositionBye";Sn(),i||(i=zt({drawDefinition:n}));const{positionAssignments:d}=Xe({structure:a}),{activeDrawPositions:p}=Yc({drawDefinition:n,structureId:s}),v=d.find(w=>w.drawPosition===o);if(v!=null&&v.bye)return lu({},B);if(p==null?void 0:p.includes(o))return{error:zf};const m=d.find(w=>w.drawPosition===o);if(!m)return{error:sa};const{filled:g,containsBye:h,assignedParticipantId:_}=Wq(m);if(h)return lu({},B);if(g&&!h)return k({result:{error:Ha},stack:u});const{matchUps:I}=wt({includeByeMatchUps:!0,inContext:!0,drawDefinition:n,matchUpsMap:i}),P={isCollectionMatchUp:!1},{matchUps:S}=Ke({provisionalPositioning:t,drawDefinition:n,matchUpFilters:P,matchUpsMap:i,structure:a});if(d.forEach(w=>{w.drawPosition===o&&(w.bye=!0)}),a.structureType===er)return qq({tournamentRecord:r,drawDefinition:n,drawPosition:o,matchUps:S}),Lo({tournamentId:r==null?void 0:r.tournamentId,drawDefinition:n,source:u,structure:a,event:c}),DI({assignedParticipantId:_,isPositionAction:e,drawDefinition:n,drawPosition:o,structureId:s,stack:u});const{roundProfile:y,roundMatchUps:O}=lr({matchUps:S}),E=Object.keys(y).map(w=>parseInt(w)).reverse().find(w=>{var $;return($=y[w].drawPositions)==null?void 0:$.includes(o)}),T=O[E].find(({drawPositions:w})=>w==null?void 0:w.includes(o));SC({tournamentRecord:r,drawDefinition:n,matchUp:T,event:c});const N=(l=T.drawPositions)==null?void 0:l.find(w=>w!==o);if(N){const w=lm({sourceDrawPositions:T.drawPositions,matchUpId:T.matchUpId,inContextDrawMatchUps:I,drawPositionToAdvance:N,tournamentRecord:r,drawDefinition:n,matchUpsMap:i});if(w.error)return w}return Lo({tournamentId:r==null?void 0:r.tournamentId,drawDefinition:n,source:u,structure:a,event:c}),DI({assignedParticipantId:_,isPositionAction:e,drawDefinition:n,drawPosition:o,structureId:s,stack:u})}function DI({assignedParticipantId:t,isPositionAction:e,drawDefinition:r,drawPosition:n,structureId:o,stack:i}){return e&&Kc({drawDefinition:r,positionAction:{removedParticipantId:t,drawPosition:n,structureId:o,name:i}}),k({result:lu({},B),stack:i})}function Wq(t){const e=t.bye,r=t.qualifier,n=t.participantId;return{containsBye:e,containsQualifier:r,assignedParticipantId:n,filled:e||r||n}}function SC({tournamentRecord:t,drawDefinition:e,matchUp:r,event:n}){Object.assign(r,{matchUpStatus:qe,score:void 0,winningSide:void 0}),ze({tournamentId:t==null?void 0:t.tournamentId,context:"setMatchUpStatusBye",eventId:n==null?void 0:n.eventId,drawDefinition:e,matchUp:r})}function qq({tournamentRecord:t,drawDefinition:e,drawPosition:r,matchUps:n,event:o}){n.forEach(i=>{var s;(s=i.drawPositions)!=null&&s.includes(r)&&SC({eventId:o==null?void 0:o.eventId,tournamentRecord:t,drawDefinition:e,matchUp:i})})}function lm({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:r,tournamentRecord:n,drawDefinition:o,matchUpsMap:i,matchUpId:s,event:a}){Sn();const c=i.drawMatchUps.find(P=>P.matchUpId===s),l=e.find(P=>P.matchUpId===s),u=l==null?void 0:l.structureId,{structure:d}=Te({drawDefinition:o,structureId:u}),{positionAssignments:p}=Xe({structure:d}),v=p.filter(P=>P.bye).map(P=>P.drawPosition),f=c.drawPositions.find(P=>P!==t),m=v==null?void 0:v.includes(f),{targetLinks:{loserTargetLink:g},targetMatchUps:{loserMatchUp:h,winnerMatchUp:_,loserTargetDrawPosition:I}}=nr({inContextDrawMatchUps:e,drawDefinition:o,matchUpId:s,structure:d});if(_&&_.structureId===d.structureId&&Hq({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:r,tournamentRecord:n,drawDefinition:o,winnerMatchUp:_,matchUpsMap:i,event:a}),h&&m&&h.structureId!==d.structureId){const{roundNumber:P}=h;if(P===1){const S=Dr({structureId:g.target.structureId,drawPosition:I,iterative:"brightyellow",tournamentRecord:n,drawDefinition:o,event:a});if(S.error)return S}else bC({loserTargetDrawPosition:I,tournamentRecord:n,loserTargetLink:g,drawDefinition:o,loserMatchUp:h,matchUpsMap:i,event:a})}return lu({},B)}function Hq({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:r,tournamentRecord:n,drawDefinition:o,winnerMatchUp:i,matchUpsMap:s,event:a}){var c,l,u;const d="advanceWinner",p=s.drawMatchUps.find(R=>R.matchUpId===i.matchUpId),v=e.find(R=>R.matchUpId===i.matchUpId),f=v==null?void 0:v.structureId,{structure:m}=Te({drawDefinition:o,structureId:f}),{positionAssignments:g}=Xe({structure:m}),_=g.find(({drawPosition:R})=>R===t).bye,I=(c=p.drawPositions)==null?void 0:c.filter(Boolean),P=g.filter(R=>I==null?void 0:I.includes(R.drawPosition)),S=g.find(({drawPosition:R})=>R===t),y=r==null?void 0:r.find(R=>R!==t),O=y&&P.find(({drawPosition:R})=>R===y),b=O==null?void 0:O.bye,E=_&&b;if(E&&console.log({isByeAdvancedBye:E}),(I==null?void 0:I.length)>1&&_&&!b)return k({result:{error:Ha},stack:d});const T=I==null?void 0:I.find(R=>R!==t);let N=E;const w=[].concat(...(p.drawPositions||[]).filter(Boolean),void 0,void 0).slice(0,2),$=w.map(R=>!R&&!N||R===t?(N=!0,t):R).sort(Bt);if(!N)return console.log("@@@@@@@",{advancingAssignmentIsBye:S,drawPositionToAdvance:t,existingAssignments:P}),k({result:{error:Ha},stack:d});const U=(l=g.find(({drawPosition:R})=>R===T))==null?void 0:l.bye,A=(u=g.find(({drawPosition:R})=>R===t))==null?void 0:u.bye;Object.assign(p,{matchUpStatus:A||U?qe:pt,score:void 0,winningSide:void 0,drawPositions:$}),p.drawPositions.find(R=>!w.includes(R)),Sn(),ze({tournamentId:n==null?void 0:n.tournamentId,matchUp:p,eventId:a==null?void 0:a.eventId,context:d,drawDefinition:o});const{targetLinks:{loserTargetLink:M},targetMatchUps:{loserMatchUp:D,loserTargetDrawPosition:V}}=nr({matchUpId:i.matchUpId,inContextDrawMatchUps:e,drawDefinition:o,structure:m});if(U||A){const R=U?t:T;if(R)lm({drawPositionToAdvance:R,matchUpId:i.matchUpId,inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:o,matchUpsMap:s});else if(A&&M&&D)if(D.feedRound)bC({loserTargetDrawPosition:V,tournamentRecord:n,loserTargetLink:M,drawDefinition:o,loserMatchUp:D,matchUpsMap:s});else{const x=1-i.roundPosition%2,K=D.drawPositions[x],j=Dr({structureId:M.target.structureId,drawPosition:K,loserTargetDrawPosition:V,iterative:"brightgreen",tournamentRecord:n,drawDefinition:o,event:a});if(j.error)return j}}}function bC({loserTargetDrawPosition:t,tournamentRecord:e,loserTargetLink:r,drawDefinition:n,loserMatchUp:o,matchUpsMap:i,event:s}){const{roundNumber:a}=o;Sn();const l=((i==null?void 0:i.mappedMatchUps)||{})[o.structureId].matchUps,{initialRoundNumber:u}=is({drawPosition:t,matchUps:l});if(u===a){const d=Dr({structureId:r.target.structureId,drawPosition:t,tournamentRecord:e,iterative:"red",drawDefinition:n,event:s});if(d.error)return d}}var Yq=Object.defineProperty,Kq=Object.defineProperties,zq=Object.getOwnPropertyDescriptors,jI=Object.getOwnPropertySymbols,Qq=Object.prototype.hasOwnProperty,Jq=Object.prototype.propertyIsEnumerable,RI=(t,e,r)=>e in t?Yq(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Zq=(t,e)=>{for(var r in e||(e={}))Qq.call(e,r)&&RI(t,r,e[r]);if(jI)for(var r of jI(e))Jq.call(e,r)&&RI(t,r,e[r]);return t},Xq=(t,e)=>Kq(t,zq(e));function um({inContextTargetMatchUp:t,drawPositionSideIndex:e,teamParticipantId:r,tournamentRecord:n,drawDefinition:o,matchUp:i,event:s}){var a,c,l;const u=(c=(a=t==null?void 0:t.sides)==null?void 0:a[e])==null?void 0:c.sideNumber,d=u&&((l=i.sides)==null?void 0:l.find(m=>m.sideNumber===u)),{extension:p}=Lt({element:o,name:En}),f=((p==null?void 0:p.value)||{})[r];if(d)i.sides.forEach(m=>{m.sideNumber===u&&(m.lineUp=f)});else{i.sides=[1,2].map(g=>{var h;const _=((h=i.sides)==null?void 0:h.find(I=>I.sideNumber===g))||{};return Xq(Zq({},_),{sideNumber:g})});const m=i.sides.find(g=>g.sideNumber===u);m&&(m.lineUp=f)}ze({tournamentId:n==null?void 0:n.tournamentId,context:"updateSidLineUps",eventId:s==null?void 0:s.eventId,drawDefinition:o,matchUp:i})}function eH({drawPosition:t,drawPositions:e}){let r,n=e==null?void 0:e.includes(t);return{updatedDrawPositions:n?e||[]:[].concat(...e,void 0,void 0).slice(0,2).map(i=>!i&&!n?(n=!0,r=!0,t):i).sort(Bt).filter(Boolean),positionAdded:r,positionAssigned:n}}function Dl({inContextDrawMatchUps:t,drawPosition:e,matchUpId:r}){const n=t.filter(({winnerMatchUpId:s,loserMatchUpId:a})=>a===r||s===r).sort((s,a)=>s.roundPosition-a.roundPosition);return t.find(s=>s.matchUpId===r).feedRound?1:n.reduce((s,a,c)=>{var l;return(l=a.drawPositions)!=null&&l.includes(e)?c+1:s},void 0)}var tH=Object.defineProperty,FI=Object.getOwnPropertySymbols,rH=Object.prototype.hasOwnProperty,nH=Object.prototype.propertyIsEnumerable,VI=(t,e,r)=>e in t?tH(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,oH=(t,e)=>{for(var r in e||(e={}))rH.call(e,r)&&VI(t,r,e[r]);if(FI)for(var r of FI(e))nH.call(e,r)&&VI(t,r,e[r]);return t};function Zs({inContextDrawMatchUps:t,sourceMatchUpStatus:e,tournamentRecord:r,sourceMatchUpId:n,drawDefinition:o,matchUpStatus:i,drawPosition:s,matchUpsMap:a,matchUpId:c,event:l}){var u,d,p,v;const f="assignMatchUpDrawPosition";a||(a=zt({drawDefinition:o})),t||({matchUps:t}=wt({includeByeMatchUps:!0,inContext:!0,drawDefinition:o,matchUpsMap:a}));const m=t.find(M=>M.matchUpId===c),g=m==null?void 0:m.structureId,h=(u=o==null?void 0:o.structures)==null?void 0:u.find(M=>M.structureId===g);if(!h)return{error:xr};const _=(d=a==null?void 0:a.drawMatchUps)==null?void 0:d.find(M=>M.matchUpId===c),I=_.drawPositions||[],{positionAdded:P,positionAssigned:S,updatedDrawPositions:y}=eH({drawPosition:s,drawPositions:I}),{positionAssignments:O}=Xe({drawDefinition:o,structure:h}),E=O.filter(M=>y.includes(M.drawPosition)).find(({bye:M})=>M),T=[Ge,Be].includes(_.matchUpStatus)&&y.filter(Boolean).length<2;if(i=E&&qe||i||T&&_.matchUpStatus||[gt,Ot].includes(_.matchUpStatus)&&_.matchUpStatus||pt,P){({matchUps:t}=wt({includeByeMatchUps:!0,inContext:!0,drawDefinition:o,matchUpsMap:a}));const M=T&&Dl({inContextDrawMatchUps:t,drawPosition:s,matchUpId:c})||void 0;_.matchUpStatusCodes&&hC({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:n,matchUpsMap:a,matchUp:_}),Object.assign(_,{drawPositions:y,winningSide:M,matchUpStatus:i}),ze({tournamentId:r==null?void 0:r.tournamentId,eventId:m==null?void 0:m.eventId,context:f,drawDefinition:o,matchUp:_})}const N=nr({inContextDrawMatchUps:t,inContextMatchUp:m,drawDefinition:o,matchUpId:c}),{targetMatchUps:{winnerMatchUp:w,loserMatchUp:$,loserTargetDrawPosition:U},targetLinks:{loserTargetLink:A}}=N,C=ui({structureId:h.structureId,matchUpsMap:a});if(S&&E){if(w)if([qe,gt,Ot].includes(i)){const M=Zs({matchUpId:w.matchUpId,iterative:"brightmagenta",inContextDrawMatchUps:t,tournamentRecord:r,drawDefinition:o,drawPosition:s,matchUpsMap:a});if(M.error)return M}else{const{structureId:M}=w;M!==h.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(w&&!m.feedRound){const{pairedPreviousMatchUpIsDoubleExit:M}=OC({targetMatchUp:_,drawPosition:s,matchUpsMap:a,structure:h});if(M){const D=Zs({matchUpId:w.matchUpId,iterative:"brightred",inContextDrawMatchUps:t,tournamentRecord:r,drawDefinition:o,drawPosition:s,matchUpsMap:a});if(D.error)return D}}if(_.matchUpType===We){const M=t==null?void 0:t.find(({matchUpId:R})=>R===_.matchUpId),D=(p=M==null?void 0:M.sides)==null?void 0:p.reduce((R,W,x)=>W.drawPosition===s?x:R,void 0),V=(v=O.find(R=>R.drawPosition===s))==null?void 0:v.participantId;V&&D!==void 0&&um({inContextTargetMatchUp:M,drawPositionSideIndex:D,teamParticipantId:V,tournamentRecord:r,drawDefinition:o,matchUp:_})}if((A==null?void 0:A.linkCondition)===zn&&y.filter(Boolean).length===2&&!E&&C.filter(({drawPositions:V,roundNumber:R})=>R===1&&Gt(V,y)).every(({matchUpStatus:V})=>[_t,Xt].includes(V))&&$){const{structureId:V}=$,R=Dr({drawPosition:U,tournamentRecord:r,drawDefinition:o,structureId:V,matchUpsMap:a,event:l});if(R.error)return R}return S?oH({},B):k({result:{error:Ha},context:{drawPosition:s},stack:f})}var iH=Object.defineProperty,sH=Object.defineProperties,aH=Object.getOwnPropertyDescriptors,LI=Object.getOwnPropertySymbols,cH=Object.prototype.hasOwnProperty,lH=Object.prototype.propertyIsEnumerable,BI=(t,e,r)=>e in t?iH(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ln=(t,e)=>{for(var r in e||(e={}))cH.call(e,r)&&BI(t,r,e[r]);if(LI)for(var r of LI(e))lH.call(e,r)&&BI(t,r,e[r]);return t},Ms=(t,e)=>sH(t,aH(e));function Ga(t){var e;const{tournamentRecord:r,appliedPolicies:n,drawDefinition:o,matchUpsMap:i,targetData:s,structure:a,event:c}=t,l="doubleExitAdvancement";if(a.structureType===er)return k({result:Ln({},B),stack:l});const{matchUp:u,targetMatchUps:d,targetLinks:p}=s,{loserMatchUp:v,winnerMatchUp:f,loserTargetDrawPosition:m}=d;if(v&&v.matchUpStatus!==qe){const{loserTargetLink:g}=p;if((e=n==null?void 0:n.progression)!=null&&e.doubleExitPropagateBye){const h=TC({loserTargetDrawPosition:m,tournamentRecord:r,loserTargetLink:g,drawDefinition:o,loserMatchUp:v,matchUpsMap:i,event:c});if(h.error)return k({result:h,stack:l})}else{const{feedRound:h,drawPositions:_,matchUpId:I}=v,P=h?2:2-_.indexOf(m),S=xI(Ms(Ln({},t),{targetMatchUp:v,walkoverWinningSide:P,tournamentRecord:r,sourceMatchUp:u,matchUpId:I}));if(S.error)return k({result:S,stack:l})}}if(f){const g=xI(Ms(Ln({},t),{matchUpId:f.matchUpId,targetMatchUp:f,tournamentRecord:r,sourceMatchUp:u}));if(g.error)return k({result:g,stack:l})}return k({result:Ln({},B),stack:l})}function xI(t){var e,r,n;const{inContextDrawMatchUps:o,tournamentRecord:i,drawDefinition:s,sourceMatchUp:a,targetMatchUp:c,matchUpsMap:l}=t,u=s.structures.find(({structureId:G})=>G===c.structureId),d=t.matchUpStatus===Ot?Ot:gt,p=t.matchUpStatus===Ot?Be:Ge,v="conditionallyAdvanceDrawPosition",f=l.drawMatchUps.find(G=>G.matchUpId===c.matchUpId);if(!f)return{error:wr};const m=(a==null?void 0:a.drawPositions)||[];let g=(e=f.drawPositions)==null?void 0:e.filter(Boolean);const h=(a==null?void 0:a.structureId)===c.structureId;if(h&&Gt(m,g)&&(g=g.filter(G=>!m.includes(G))),h&&g.length>1)return k({result:{error:Ha},stack:v});const{pairedPreviousMatchUpIsDoubleExit:_,pairedPreviousMatchUp:I}=OC(t),P=nr({matchUpId:c.matchUpId,inContextDrawMatchUps:o,drawDefinition:s,structure:u}),{targetMatchUps:S,targetLinks:y}=P,{loserTargetDrawPosition:O,winnerMatchUp:b,loserMatchUp:E}=S;if(E){const{loserTargetLink:G}=y,H=TC({loserTargetDrawPosition:O,loserMatchUp:E,tournamentRecord:i,loserTargetLink:G,drawDefinition:s,matchUpsMap:l});if(H.error)return k({result:H,stack:v})}const T=((r=f.drawPositions)==null?void 0:r.filter(Boolean))||[],N=T.length===1,w=t.walkoverWinningSide||N&&Dl({drawPosition:T[0],matchUpId:c.matchUpId,inContextDrawMatchUps:o})||void 0,$=[Ge,Be].includes(f.matchUpStatus)&&!T.length,U=f.finishingRound===1,A=$&&!U?d:p,C=o.find(G=>G.matchUpId===I.matchUpId);let M=[],D;a&&((a==null?void 0:a.structureId)===(C==null?void 0:C.structureId)?a.roundPosition<(I==null?void 0:I.roundPosition)?D=1:D=2:c.feedRound?a.structureId===c.structureId?D=2:D=1:w&&(D=3-w));const V=t.matchUpStatus,R=I==null?void 0:I.matchUpStatus;D===1?M=[{sideNumber:1,previousMatchUpStatus:V,matchUpStatus:vl(V)},{sideNumber:2,previousMatchUpStatus:R,matchUpStatus:vl(R)}]:D===2&&(M=[{sideNumber:1,previousMatchUpStatus:R,matchUpStatus:vl(R)},{sideNumber:2,previousMatchUpStatus:V,matchUpStatus:vl(V)}]),M.length&&(M=M.map(G=>_e(G)));const W=On(Ms(Ln({},t),{matchUp:f,winningSide:w,matchUpStatusCodes:M,matchUpStatus:A}));if(W.error)return k({result:W,stack:v});if($)return Ga(Ms(Ln({},t),{matchUpStatus:A,targetData:P}));if(!b)return k({result:Ln({},B),stack:v});const x=g.length===2?g[w-1]:g[0],{positionAssignments:K}=Xe({structure:u}),j=K.find(G=>G.drawPosition===x),L=l.drawMatchUps.find(G=>G.matchUpId===b.matchUpId),F=(n=L==null?void 0:L.drawPositions)==null?void 0:n.filter(Boolean),q=F.length===1;if(x){if(j.bye){const G=nr({matchUpId:L.matchUpId,inContextDrawMatchUps:o,drawDefinition:s,structure:u});if(q){const H=F.filter(Boolean)[0],Q=Dl({drawPosition:H,matchUpId:L.matchUpId,inContextDrawMatchUps:o}),z=On({matchUpId:L.matchUpId,matchUp:L,matchUpStatus:p,matchUpStatusCodes:[],removeScore:!0,drawDefinition:s,winningSide:Q});return z.error?k({result:z,stack:v}):lm({drawPositionToAdvance:H,matchUpId:L.matchUpId,inContextDrawMatchUps:o,drawDefinition:s,matchUpsMap:l})}else if([Ge,Be].includes(b.matchUpStatus)){const H=Ga(Ms(Ln({},t),{matchUpId:L.matchUpId,matchUpStatus:A,targetData:G}));if(H.error)return k({result:H,stack:v})}return k({result:Ln({},B),stack:v})}return Zs({matchUpId:b.matchUpId,drawPosition:x,inContextDrawMatchUps:o,drawDefinition:s})}else if(_){if(!L)return{error:wr};if(q){const Q=F[0],z=Dl({matchUpId:c.matchUpId,inContextDrawMatchUps:o,drawPosition:Q});console.log("existing drawPosition is winningSide",{walkoverWinningSide:z})}const G=[Ge,Be].includes(L.matchUpStatus)?p:d,H=On({matchUpId:L.matchUpId,matchUp:L,matchUpStatusCodes:[],removeScore:!0,drawDefinition:s,matchUpStatus:G});if(H.error)return k({result:H,stack:v});if(G===d){const Q=Ga(Ms(Ln({},t),{matchUpId:c.matchUpId,matchUpStatus:G,targetData:P}));if(Q.error)return Q}}return k({result:Ln({},B),stack:v})}function TC(t){var e;const{loserTargetDrawPosition:r,tournamentRecord:n,loserTargetLink:o,drawDefinition:i,matchUpsMap:s,event:a}=t,c=(e=o==null?void 0:o.target)==null?void 0:e.structureId,{structure:l}=Te({drawDefinition:i,structureId:c});return l?Dr({drawPosition:r,tournamentRecord:n,drawDefinition:i,structureId:c,matchUpsMap:s,event:a}):{error:aa}}function vl(t){return t===gt?Ge:t===Ot?Be:t}var uH=Object.defineProperty,GI=Object.getOwnPropertySymbols,dH=Object.prototype.hasOwnProperty,pH=Object.prototype.propertyIsEnumerable,kI=(t,e,r)=>e in t?uH(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,fH=(t,e)=>{for(var r in e||(e={}))dH.call(e,r)&&kI(t,r,e[r]);if(GI)for(var r of GI(e))pH.call(e,r)&&kI(t,r,e[r]);return t};function vH({tournamentRecord:t,drawDefinition:e,structure:r,matchUp:n}){var o;if(n!=null&&n.winningSide)return k({result:{error:Ya},context:{matchUpStatus:qe},stack:i});const i="attemptToSetMatchUpStatusBYE",{positionAssignments:s}=St({structure:r}),a=s.filter(l=>l.bye).map(l=>l.drawPosition);return((o=n.drawPositions)==null?void 0:o.some(l=>a.includes(l)))?(n.matchUpStatus=qe,n.matchUpStatusCodes=[],ze({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,context:i,matchUp:n}),fH({},B)):k({result:{error:gR},info:"matchUp does not include BYE",stack:i})}var mH=Object.defineProperty,gH=Object.defineProperties,hH=Object.getOwnPropertyDescriptors,WI=Object.getOwnPropertySymbols,_H=Object.prototype.hasOwnProperty,IH=Object.prototype.propertyIsEnumerable,qI=(t,e,r)=>e in t?mH(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,EC=(t,e)=>{for(var r in e||(e={}))_H.call(e,r)&&qI(t,r,e[r]);if(WI)for(var r of WI(e))IH.call(e,r)&&qI(t,r,e[r]);return t},wC=(t,e)=>gH(t,hH(e));function PH(t){const{tournamentRecord:e,drawDefinition:r,matchUpStatus:n,structure:o,matchUp:i}=t,s=!!(i.tieMatchUps&&!i.rondPosition&&t.inContextDrawMatchUps.find(h=>h.matchUpId===i.matchUpId).containerStructureId),a="attemptToSetMatchUpStatus",c=n===qe,l=i.winningSide,u=[gt,Ot].includes(n),d=Bc({matchUpStatus:n}),p=mf({matchUpStatus:n}),v=!d&&!p,f=t.matchUpTieId||l&&d&&!u,m=l&&u,g=()=>On(wC(EC({},t),{removeScore:[_o,Ge].includes(n),matchUpStatus:n||pt}));return v&&{error:Hg}||f&&Tf(t)||m&&yH(t)||l&&Ta(t)||p&&g()||c&&vH({tournamentRecord:e,drawDefinition:r,structure:o,matchUp:i})||!d&&{error:Hg}||u&&OH(t)||s&&Tf(t)||k({result:{error:Ya},stack:a})}function yH(t){let e=Ta(t);return e.error?e:Ga(t)}function OH(t){const e=Tf(wC(EC({},t),{removeScore:!0}));return e.error?e:Ga(t)}function Tf(t){var e;const r="scoreModification";if(t.isCollectionMatchUp&&((e=t.dualMatchUp)==null?void 0:e.winningSide)&&!t.projectedWinningSide){const s=Ta(t);if(s.error)return k({result:s,stack:r})}const o=!!t.matchUp.collectionId,i=On(t);if(o){const{matchUpTieId:s,drawDefinition:a,matchUpsMap:c}=t,l=to({tournamentRecord:t.tournamentRecord,matchUpId:s,event:t.event,drawDefinition:a,matchUpsMap:c});if(l.error)return k({result:l,stack:r});Object.assign(i,{tieMatchUpResult:l})}return k({result:i,stack:r})}function SH({drawDefinition:t,structure:e,matchUp:r}){var n,o;const{drawPositions:i}=r,{positionAssignments:s}=Xe({drawDefinition:t,structure:e}),c=s.filter(({drawPosition:v})=>i==null?void 0:i.includes(v)).map(v=>{var f;const{extension:m}=Lt({element:v,name:Do});return(f=m==null?void 0:m.value)==null?void 0:f.groupOrder}),{containerStructures:l}=Sa({drawDefinition:t}),u=l[e.structureId],d=(o=(n=Gc({drawDefinition:t,structureId:u}))==null?void 0:n.links)==null?void 0:o.source;return{structureIds:d==null?void 0:d.filter(v=>{var f;return Gt(c,((f=v.source)==null?void 0:f.finishingPositions)||[])}).map(v=>v.source.structureId)}}function NC({drawDefinition:t,structureId:e}){if(!t)return{error:pe};const{structure:r}=Te({drawDefinition:t,structureId:e}),n=((t==null?void 0:t.links)||[]).filter(i=>{var s;return((s=i.source)==null?void 0:s.structureId)===e}).map(i=>{var s;return(s=i.target)==null?void 0:s.structureId});return{playoffStructures:((t==null?void 0:t.structures)||[]).filter(i=>n.includes(i.structureId)&&i.stage===it),structure:r}}function $C({withStageGrouping:t,stageSequences:e,stageSequence:r,roundTarget:n,stages:o,event:i,stage:s}){if(!i)return{error:Re};const a={},c=[];for(const l of i.drawDefinitions||[]){const{structures:u,stageStructures:d}=Ur({withStageGrouping:t,stageSequences:e,drawDefinition:l,stageSequence:r,roundTarget:n,stages:o,stage:s});if(c.push(...u),d)for(const p of Object.keys(d))a[p]||(a[p]=[]),a[p].push(...d[p])}return{structures:c,stageStructures:a}}function bH({withStageGrouping:t,tournamentRecord:e,stageSequences:r,stageSequence:n,roundTarget:o,stages:i,stage:s}){if(!e)return{error:ee};const a={},c=[];for(const l of e.events||[]){const{structures:u,stageStructures:d}=$C({withStageGrouping:t,stageSequences:r,stageSequence:n,roundTarget:o,stages:i,event:l,stage:s});if(c.push(...u),d)for(const p of Object.keys(d))a[p]||(a[p]=[]),a[p].push(...d[p])}return{structures:c,stageStructures:a}}function TH(t){const e=[];if(!(t!=null&&t.drawDefinition))return{error:pe};const r=mi(t),n=AC(t);return{actions:e,state:{isComplete:r,hasPlayoffPositionsFilled:n}}}function mi(t){if(!(t!=null&&t.drawDefinition))return!1;const e=kc(t);let{includesTeamMatchUps:r,completedMatchUps:n,pendingMatchUps:o,upcomingMatchUps:i}=e||{};return r&&(n=n.filter(({matchUpType:a})=>a===We),o=o.filter(({matchUpType:a})=>a===We),i=i.filter(({matchUpType:a})=>a===We)),!!((n==null?void 0:n.length)&&!(o!=null&&o.length)&&!i.length)}function AC(t){var e,r;const{drawDefinition:n,structureId:o}=t;if(!n)return{error:pe};const{playoffStructures:i}=NC({drawDefinition:n,structureId:o});if(!(i!=null&&i.length))return!1;const s=((r=(e=n==null?void 0:n.entries)==null?void 0:e.filter(u=>Ko.includes(u==null?void 0:u.entryStatus)))==null?void 0:r.length)||0;let a=0;return(i||[]).reduce((u,d)=>{var p;return!((p=d==null?void 0:d.positionAssignments)!=null&&p.filter(f=>(f.participantId&&a++,!(f!=null&&f.bye)&&!(f!=null&&f.participantId))).length)&&u},!0)||a===s}function UC({drawDefinition:t,matchUpsMap:e,structure:r,matchUp:n}){const o=[];if(r.finishingPosition===Ia&&mi({drawDefinition:t,structure:r})){const{structureIds:s}=SH({drawDefinition:t,matchUpsMap:e,structure:r,matchUp:n});s!=null&&s.length&&o.push(...s)}return{connectedStructureIds:o}}function dm(t){const{dualWinningSideChange:e,matchUpStatusCodes:r,tournamentRecord:n,drawDefinition:o,matchUpFormat:i,matchUpStatus:s,winningSide:a,matchUpId:c,structure:l,matchUp:u,event:d,score:p}=t,v=Bc({matchUpStatus:s})||[_o,gr].includes(s)&&e,f="attemptToModifyScore",m=!!u.collectionId,g=mo({drawDefinition:o,structure:l});if(!(m||g||EH({structure:l,matchUp:u})))return{error:aA};const _=[Ge].includes(s),I=On({matchUpStatusCodes:v&&r||[],matchUpStatus:v&&s||_t,tournamentRecord:n,drawDefinition:o,matchUpFormat:i,removeScore:_,winningSide:a,matchUpId:c,matchUp:u,event:d,score:p});return k({result:I,stack:f})}function EH({structure:t,matchUp:e}){const{drawPositions:r}=e,{positionAssignments:n}=St({structure:t});return n.filter(i=>(r==null?void 0:r.includes(i.drawPosition))&&i.participantId).length===2}function pm({lineUp:t}){if(!Array.isArray(t))return;const e={};return Ve(t.flatMap(({collectionAssignments:n})=>n.map(({collectionId:o,collectionPosition:i})=>[o,i].join("|")))).forEach(n=>{const[o,i]=n.split("|"),s=parseInt(i),{assignedParticipantIds:a}=Xl({collectionPosition:s,collectionId:o,lineUp:t});a.forEach(c=>{e[c]||(e[c]=[]),e[c].push({collectionId:o,collectionPosition:s})})}),Object.keys(e).map(n=>({participantId:n,collectionAssignments:e[n]}))}function Ed({drawPositions:t,structure:e}){if([Ie,ue].includes(e.stage)&&e.stageSequence===1)return;const{positionAssignments:r}=Xe({structure:e});r.filter(({drawPosition:o})=>t==null?void 0:t.includes(o)).forEach(o=>{et({element:o,extension:{name:Qu,value:!0}})})}function Xs(t){if(!t)return;if(lt(t))return parseInt(t);const e=t.split("-")[0];if(lt(e))return parseInt(e)}const Mt=({finishingPosition:t=di,structureAbbreviation:e,seedAssignments:r=[],stageSequence:n=1,qualifyingRoundNumber:o,seedingProfile:i,matchUpFormat:s,structureType:a,structureName:c,matchUps:l=[],structureId:u,roundOffset:d,roundLimit:p,stageOrder:v,structures:f,stage:m})=>{const g={structureId:u||ke(),structureAbbreviation:e,finishingPosition:t,seedAssignments:r,matchUpFormat:s,stageSequence:n,structureName:c};m&&(g.stage=m),v&&(g.stageOrder=v),p&&(g.roundLimit=p),d&&(g.roundOffset=d),a&&(g.structureType=a),i&&(g.seedingProfile=i),o&&(g.qualifyingRoundNumber=o);const h=[].concat(...l.map(_=>_.drawPositions)).filter(Boolean);return f?g.structures=f:(g.matchUps=l,g.positionAssignments=Ve(h).sort((_,I)=>_-I).map(_=>({drawPosition:_}))),g};function CC({drawPositions:t}){const e=o=>t.filter(i=>i!==o).map(i=>[o,i]),r=[].concat(...t.map(e)),n=Ve(r.map(fm)).map(o=>o.split("|").map(i=>+i));return{groupMatchUps:r,uniqueMatchUpGroupings:n}}function fm(t){return t.sort(Bt).join("|")}var wH=Object.defineProperty,NH=Object.defineProperties,$H=Object.getOwnPropertyDescriptors,HI=Object.getOwnPropertySymbols,AH=Object.prototype.hasOwnProperty,UH=Object.prototype.propertyIsEnumerable,YI=(t,e,r)=>e in t?wH(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,MC=(t,e)=>{for(var r in e||(e={}))AH.call(e,r)&&YI(t,r,e[r]);if(HI)for(var r of HI(e))UH.call(e,r)&&YI(t,r,e[r]);return t},CH=(t,e)=>NH(t,$H(e));function zc({structureName:t=ue,stageSequence:e=1,structureOptions:r,appliedPolicies:n,seedingProfile:o,stage:i=ue,matchUpType:s,roundTarget:a,structureId:c,drawSize:l,idPrefix:u,isMock:d,uuids:p}){const{groupCount:v,groupSize:f}=MH({structureOptions:r,appliedPolicies:n,drawSize:l}),m=Ia;let g;const h=le(1,v+1).map(I=>{const P=DH({groupSize:f,structureOrder:I,matchUpType:s,drawSize:l,idPrefix:u,isMock:d});return g=Math.max(...P.map(({roundNumber:S})=>S)),Mt({structureName:`Group ${I}`,structureId:p==null?void 0:p.pop(),structureType:nd,finishingPosition:m,structureOrder:I,matchUpType:s,matchUps:P})}),_=Mt({structureId:c||(p==null?void 0:p.pop()),structureType:er,finishingPosition:m,seedingProfile:o,structureName:t,stageSequence:e,matchUpType:s,structures:h,stage:i});return a&&et({extension:{name:Dn,value:a},element:_}),MC({structures:[_],maxRoundNumber:g,groupCount:v,links:[],groupSize:f},B)}function MH({appliedPolicies:t,structureOptions:e,drawSize:r}){let n=e==null?void 0:e.groupSize;const o=(e==null?void 0:e.groupSizeLimit)||8,{validGroupSizes:i}=vm({groupSizeLimit:o,drawSize:r}),s=Math.max(...i);n&&i.includes(n)||(n&&n>4||!i.includes(4)?n=s:n=4);const c=Math.ceil(r/n);return{groupSize:n,groupCount:c}}function vm({drawSize:t,groupSizeLimit:e=10}){const r=le(3,e+1).filter(n=>{const o=Math.ceil(t/n),i=o*n-t,s=Math.ceil(t/o),a=Math.ceil(i/o);return(!i||i<n)&&s===n&&s>=3&&a<2});return CH(MC({},B),{validGroupSizes:r})}function DH({structureOrder:t,matchUpType:e,groupSize:r,idPrefix:n,drawSize:o,isMock:i,uuids:s}){const a=(t-1)*r,c=le(1+a,r+1+a),{uniqueMatchUpGroupings:l}=CC({drawPositions:c}),u=RH({groupSize:r,drawPositionOffset:a});return l.map(v).sort((f,m)=>(f.roundNumber||1/0)-(m.roundNumber||1/0));function p(f){return u.reduce((m,g,h)=>g.includes(f)?h+1:m,void 0)}function v(f){const m=fm(f),g=p(m),h=[1,o],_=jH({structureOrder:t,drawPositions:f,roundNumber:g,idPrefix:n,uuids:s}),I={matchUpStatus:g?pt:qe,matchUpType:e,finishingPositionRange:{winner:h,loser:h},drawPositions:f,roundNumber:g,matchUpId:_};return i&&(I.isMock=!0),I}}function jH({structureOrder:t,drawPositions:e,roundNumber:r,idPrefix:n,uuids:o}){return n?`${n}-${t}-${r}-DP-${e.join("-")}`:(o==null?void 0:o.pop())||ke()}function RH({groupSize:t,drawPositionOffset:e}){const r=d=>[...Array(d)].map((p,v)=>v),n=r(2*Math.round(t/2)+1).slice(1),o=r(n.length-1).map(()=>[]);let i=n.slice(0,n.length/2),s=n.slice(n.length/2);n.slice(1).forEach((d,p)=>{i.forEach((g,h)=>{o[p].push([i[h],s[h]])});const v=i.shift(),f=i.pop(),m=s.shift();i=[].concat(v,m,...i),s=[].concat(...s,f)});const a=i.shift(),c=i.pop(),l=s.shift();i=[].concat(a,l,...i),s=[].concat(...s,c);const u=d=>d[0].reduce((p,v)=>p+v);return o.reverse().sort((d,p)=>u(d)-u(p)).map(d=>d.filter(p=>p.every(v=>v<=t)).map(p=>{const v=p.map(f=>f+e);return fm(v)}))}var FH=Object.defineProperty,VH=Object.defineProperties,LH=Object.getOwnPropertyDescriptors,KI=Object.getOwnPropertySymbols,BH=Object.prototype.hasOwnProperty,xH=Object.prototype.propertyIsEnumerable,zI=(t,e,r)=>e in t?FH(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ef=(t,e)=>{for(var r in e||(e={}))BH.call(e,r)&&zI(t,r,e[r]);if(KI)for(var r of KI(e))xH.call(e,r)&&zI(t,r,e[r]);return t},wf=(t,e)=>VH(t,LH(e));function wd({roundRobinGroupsCount:t,participantsCount:e,cluster:r}){if(!lt(e))return k({result:{error:Z},context:{participantsCount:e},stack:"getSeedBlocks"});const n=ia(e);if(t){const p=Math.min(t,n),v=[];let f=1;for(le(0,p).forEach(()=>{v.push([f]),f++});f<n;){const m=le(f,f+p);f+=p,v.push(m)}return wf(Ef({},B),{seedBlocks:v})}const o=le(1,n+1);let i=[],s=n/2;for(;s>1;){const p=jt(o,s),v=p.length;p.forEach((f,m)=>{let g;const h=m<v/2,_=m%2===0,I=f[0],P=f[f.length-1];r&&v>4?v===8?g=h?P:I:g=_?I:P:g=h?I:P,Gt(f,i)||i.push(g)}),s=s/2}const a=o.filter(p=>!i.includes(p));for(;a.length;)a.length%2===0?i.push(a.pop()):i.push(a.shift());const c=le(0,20).map(p=>Math.pow(2,p));c.unshift(1);const l=c.indexOf(n);let u=0;const d=[];return le(0,l).forEach(p=>{d.push(i.slice(u,u+c[p])),u+=c[p]}),wf(Ef({},B),{seedBlocks:d})}function Nd({drawSize:t,roundRobinGroupsCount:e}){const r="getSeedGroups";if(!lt(t))return k({result:{error:Z},context:{drawSize:t},stack:r});if(e){if(!lt(e))return k({result:{error:Z},context:{roundRobinGroupsCount:e},stack:r});let n=1;const o=Math.floor(t/e);return{seedGroups:le(0,o).map(()=>{const s=le(n,n+e);return n+=e,s})}}else{const{seedBlocks:n}=wd({participantsCount:t,roundRobinGroupsCount:e});let o=0;return{seedGroups:(n||[]).map(s=>(s||[]).map(()=>(o+=1,o)))}}}function GH({roundRobinGroupsCount:t,participantsCount:e}){if(t){const{validGroupSizes:o}=vm({drawSize:e});if(!o.map(a=>Math.ceil(e/a)).includes(t))return k({result:{error:Z},context:{roundRobinGroupsCount:t}})}const{seedGroups:r}=Nd({drawSize:e,roundRobinGroupsCount:t}),n=(r==null?void 0:r.map(o=>Math.min(...o)))||[];return wf(Ef({},B),{seedingThresholds:n})}function ys({provisionalPositioning:t,appliedPolicies:e,drawDefinition:r,allPositions:n,structure:o,event:i}){var s;let a=[];if(!o)return{error:aa};const{roundMatchUps:c}=Ke({matchUpFilters:{roundNumbers:[1]},provisionalPositioning:t,structure:o}),{seedAssignments:l}=cn({provisionalPositioning:t,drawDefinition:r,structure:o,event:i}),{positionAssignments:u}=St({structure:o}),d=u.length,p=(l==null?void 0:l.length)||0;let v=[];const m=Object.keys(c).sort((D,V)=>D-V).map(D=>{const V=c[D].map(W=>W.drawPositions).flat(1/0).filter(Boolean),R=V.filter(W=>!v.includes(W));return v=v.concat(...V),R}).filter(D=>D.length).reverse(),g=m.pop(),h=g&&Math.min(...g)-1||0,_=(s=e==null?void 0:e.seeding)==null?void 0:s.seedingProfile,I=(g==null?void 0:g.length)||0,P=m.filter(D=>D.filter(V=>V<=p).length),{stage:S,structureType:y,roundLimit:O}=o,b=y===er,E=!b&&(m==null?void 0:m.length),T=(g==null?void 0:g.length)&&!Lr(I),N=!b&&S===Ie&&O,w=P.flat(1/0),$=E?w==null?void 0:w.length:0,U=n?d:p,A=T?0:!E&&U||w.length<U&&U-w.length||0;if(N){const D=o.matchUps.filter(({roundNumber:R})=>R===o.roundLimit).length,V=g.length/D;if(!E){const R=Qc(_),W=jt(g,V);let x=1;const K=le(0,W[0].length).map(()=>{const j=le(x,x+W.length);return x+=W.length,j});({validSeedBlocks:a}=DC({drawPositionBlocks:W,positioning:R,seedGroups:K}))}}else if(b){const D=kH({seedingProfile:_,structure:o});if(!D||D.error)return console.log(D),D;({validSeedBlocks:a}=D)}else E?a=P.map(D=>({seedNumbers:D,drawPositions:D})):T&&jt(g,2).map((V,R)=>({drawPositions:[V[0]],seedNumbers:[R+1]})).forEach(V=>a.push(V));if(!b&&!T&&!N){const{blocks:D,error:V}=WH({drawPositionOffset:h,seedNumberOffset:$,seedCountGoal:A,seedingProfile:_,baseDrawSize:I});if(V)return{validSeedBlocks:[],isContainer:b,isFeedIn:E,error:V};D.forEach(R=>a.push(R))}const M=[].concat(...a.map(D=>D.drawPositions)).reduce((D,V)=>(g==null?void 0:g.includes(V))&&D,!0);return!T&&!E&&!b&&!M?{error:cR,validSeedBlocks:[],isContainer:b,isFeedIn:E}:{validSeedBlocks:a,isContainer:b,isFeedIn:E,isLucky:T}}function kH({seedingProfile:t,structure:e}){var r;const n=e.structures||[],o=n.length,i=(r=Xe({structure:e}))==null?void 0:r.positionAssignments,s=Qc(t),{seedGroups:a}=Nd({drawSize:i.length,roundRobinGroupsCount:o}),c=n.map(l=>Xe({structure:l}).positionAssignments.map(u=>u.drawPosition));return DC({drawPositionBlocks:c,positioning:s,seedGroups:a})}function DC({positioning:t,seedGroups:e,drawPositionBlocks:r}){const n=[],o=(a,c)=>a-c,i=(a,c)=>c-a,s=[];return e.forEach((a,c)=>{c&&t!==Cv&&tr(a),a.forEach((l,u)=>{const d=c%2?r.length-u-1:u,p=r[d].sort(c%2?i:o).find(v=>!s.includes(v));s.push(p),n.push({seedNumbers:[l],drawPositions:[p]})})}),{validSeedBlocks:n}}function WH({roundRobinGroupsCount:t,drawPositionOffset:e=0,seedNumberOffset:r=0,seedingProfile:n,seedCountGoal:o,baseDrawSize:i}){let s=1;const a=[],{seedBlocks:c}=wd({cluster:Qc(n)===Uv,participantsCount:i,roundRobinGroupsCount:t});s=0;for(const u of c){if(s+1>o)break;const d=u.map(v=>v+e),p=l(s+1,u.length).map(v=>+v+r);s+=u.length,a.push({drawPositions:d,seedNumbers:p})}return{blocks:a};function l(u,d){return Array.from(new Array(d),(p,v)=>v+u)}}function uu({drawDefinition:t,seedBlockInfo:e,drawPosition:r,structureId:n,seedNumber:o}){var i,s,a,c,l;const{structure:u}=Te({drawDefinition:t,structureId:n}),{appliedPolicies:d}=ct({drawDefinition:t});let p=e==null?void 0:e.validSeedBlocks;if(p||(p=(i=ys({appliedPolicies:d,drawDefinition:t,structure:u}))==null?void 0:i.validSeedBlocks),(a=(s=d==null?void 0:d.seeding)==null?void 0:s.validSeedPositions)!=null&&a.ignore)return!0;if((l=(c=d==null?void 0:d.seeding)==null?void 0:c.validSeedPositions)!=null&&l.strict){const f=p.find(g=>g.seedNumbers.includes(o));return((f==null?void 0:f.drawPositions)||[]).includes(r)}return[].concat(...p.map(f=>f.drawPositions)).includes(r)}function $d({provisionalPositioning:t,drawDefinition:e,seedBlockInfo:r,structureId:n,randomize:o,event:i}){var s,a;const{structure:c}=Te({drawDefinition:e,structureId:n}),{seedAssignments:l}=cn({provisionalPositioning:t,drawDefinition:e,structure:c,event:i}),{positionAssignments:u}=St({structure:c}),p=u.filter(R=>R.participantId||R.bye||R.qualifier).map(R=>R.drawPosition).filter(Boolean),{appliedPolicies:v}=ct({drawDefinition:e}),g=((r==null?void 0:r.validSeedBlocks)||((s=ys({provisionalPositioning:t,appliedPolicies:v,drawDefinition:e,structure:c,event:i}))==null?void 0:s.validSeedBlocks)||[]).filter(R=>R.drawPositions.filter(x=>!p.includes(x)).length)[0],h=l.map(R=>R.participantId).filter(Boolean),_=u.map(R=>R.participantId).filter(Boolean),I=h.filter(R=>_.includes(R)),P=h.filter(R=>!_.includes(R)),S=l.filter(R=>P.includes(R.participantId)),y=l.filter(R=>!R.participantId),b=(S.length||y.length)&&(g==null?void 0:g.drawPositions.filter(R=>!p.includes(R)))||[],E=o?tr(b):b,T=[],N=E.map(()=>{const R=V(S,T),W=R==null?void 0:R.participantId;return W&&T.push(W),W}).filter(Boolean),w=l.filter(R=>I.includes(R.participantId)).map(R=>R.seedNumber),U=((g==null?void 0:g.seedNumbers)||[]).filter(R=>!w.includes(R)),A=l.filter(R=>U.includes(R.seedNumber)).map(R=>R.participantId),C=(a=v==null?void 0:v.seeding)==null?void 0:a.duplicateSeedNumbers;return{nextSeedBlock:g,unplacedSeedParticipantIds:(C!==void 0?C:!0)?N:A,unplacedSeedNumbers:U,unfilledPositions:E,unplacedSeedAssignments:S};function V(R,W){const x=R.filter(F=>!W.includes(F.participantId)),K=Math.min(...x.map(F=>Xs(F.seedValue))),j=x.filter(F=>Xs(F.seedValue)===K);return tr(j).pop()}}function Qc(t){if(typeof t=="string")return t;if(typeof t=="object")return t.positioning}function Wi({participantId:t,drawDefinition:e,entryStatus:r,entryStage:n}){var o;if(!e)return{error:pe};const i=(o=e.entries)==null?void 0:o.find(s=>s.participantId===t&&(!r||r===s.entryStatus)&&(!n||n===s.entryStage));return t&&i}var qH=Object.defineProperty,QI=Object.getOwnPropertySymbols,HH=Object.prototype.hasOwnProperty,YH=Object.prototype.propertyIsEnumerable,JI=(t,e,r)=>e in t?qH(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,KH=(t,e)=>{for(var r in e||(e={}))HH.call(e,r)&&JI(t,r,e[r]);if(QI)for(var r of QI(e))YH.call(e,r)&&JI(t,r,e[r]);return t};function ss({provisionalPositioning:t,tournamentRecord:e,drawDefinition:r,seedingProfile:n,participantId:o,seedBlockInfo:i,structureId:s,seedNumber:a,seedValue:c,eventId:l,event:u}){var d,p;const v="assignSeed",{structure:f}=Te({drawDefinition:r,structureId:s}),{positionAssignments:m}=St({structure:f}),{seedAssignments:g}=cn({provisionalPositioning:t,drawDefinition:r,structure:f,event:u}),h=g.map(b=>b.seedNumber),_=Wi({drawDefinition:r,participantId:o});if(o&&!_)return k({result:{error:ao},context:{participantId:o},stack:v});const I=(p=(d=ht({event:u}).flightProfile)==null?void 0:d.flights)==null?void 0:p.length,P=I&&I>1,S=m.find(b=>b.participantId===o),y=S==null?void 0:S.drawPosition;if(y){const{appliedPolicies:b}=ct({tournamentRecord:e,drawDefinition:r,event:u});if(!uu({drawPosition:y,appliedPolicies:b,drawDefinition:r,seedBlockInfo:i,structureId:s,seedNumber:a}))return k({result:{error:nA},context:{assignedDrawPosition:y},info:"invalid seed position",stack:v})}h.includes(a)||g.push({seedNumber:a,seedValue:c});let O;return g.forEach(b=>{b.participantId===o&&b.seedNumber!==a&&(b.participantId=void 0),b.seedNumber===a&&(b.participantId=o,!(n!=null&&n.groupSeedingThreshold)&&!P&&(b.seedValue=c||a),O=!0)}),O?(t1({tournamentId:e==null?void 0:e.tournamentId,structureIds:[s],drawDefinition:r,structure:f,eventId:l}),KH({},B)):k({result:{error:aR},stack:v})}function jC({inContextDrawMatchUps:t,drawDefinition:e,assignments:r,matchUpsMap:n,structure:o}){var i,s,a;const c=(i=Sa({drawDefinition:e}))==null?void 0:i.containedStructures,l=((s=c==null?void 0:c[o.structureId])==null?void 0:s.map(({structureId:f})=>f))||[];l.push(o==null?void 0:o.structureId);const u=(r==null?void 0:r.map(({drawPosition:f})=>f))||[],d=(t==null?void 0:t.filter(f=>l.includes(f.structureId)&&Dt(f.drawPositions||[],u).length))||[],p=d.map(({matchUpId:f})=>f),v=((a=n==null?void 0:n.drawMatchUps)==null?void 0:a.filter(f=>p.includes(f.matchUpId)))||[];return{drawPositions:u,matchUps:v,targetMatchUps:d}}var zH=Object.defineProperty,ZI=Object.getOwnPropertySymbols,QH=Object.prototype.hasOwnProperty,JH=Object.prototype.propertyIsEnumerable,XI=(t,e,r)=>e in t?zH(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ZH=(t,e)=>{for(var r in e||(e={}))QH.call(e,r)&&XI(t,r,e[r]);if(ZI)for(var r of ZI(e))JH.call(e,r)&&XI(t,r,e[r]);return t};function mm({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:r,matchUpsMap:n,assignments:o,structure:i,event:s}){const{drawPositions:a,matchUps:c,targetMatchUps:l}=jC({inContextDrawMatchUps:t,matchUpsMap:n,assignments:o,structure:i});for(const u of l)u.matchUpType===Qr&&(u.sides||[]).forEach((d,p)=>{var v;if(d!=null&&d.drawPosition&&(a!=null&&a.includes(d.drawPosition))){const f=c.find(({matchUpId:m})=>m===u.matchUpId);(v=f.sides)!=null&&v[p]&&(delete f.sides[p].lineUp,ze({tournamentId:e==null?void 0:e.tournamentId,context:"cleanupLineUps",eventId:s==null?void 0:s.eventId,drawDefinition:r,matchUp:f}))}});return ZH({},B)}var XH=Object.defineProperty,e6=Object.defineProperties,t6=Object.getOwnPropertyDescriptors,eP=Object.getOwnPropertySymbols,r6=Object.prototype.hasOwnProperty,n6=Object.prototype.propertyIsEnumerable,tP=(t,e,r)=>e in t?XH(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,o6=(t,e)=>{for(var r in e||(e={}))r6.call(e,r)&&tP(t,r,e[r]);if(eP)for(var r of eP(e))n6.call(e,r)&&tP(t,r,e[r]);return t},i6=(t,e)=>e6(t,t6(e));function un({provisionalPositioning:t,inContextDrawMatchUps:e,isQualifierPosition:r,sourceMatchUpStatus:n,automaticPlacement:o,drawPositionIndex:i,tournamentRecord:s,drawDefinition:a,seedingProfile:c,participantId:l,seedBlockInfo:u,drawPosition:d,matchUpsMap:p,structureId:v,event:f}){var m;const g="assignDrawPosition";if(!l&&!r)return k({result:{error:It},stack:g});p=p||zt({drawDefinition:a}),e||({matchUps:e}=wt({includeByeMatchUps:!0,inContext:!0,drawDefinition:a,matchUpsMap:p}));const h=Te({drawDefinition:a,structureId:v});if(h.error)return k({result:h,stack:g});const{structure:_}=h;if(mo({drawDefinition:a,structure:_}))return k({result:{error:Gr},stack:g});const{seedAssignments:I}=cn({provisionalPositioning:t,drawDefinition:a,structure:_,event:f}),P=I.find($=>$.participantId===l),S=P==null?void 0:P.seedNumber,{appliedPolicies:y}=ct({tournamentRecord:s,drawDefinition:a,structure:_,event:f});if(S&&!uu({seedNumber:S,appliedPolicies:y,drawDefinition:a,seedBlockInfo:u,drawPosition:d,structureId:v}))return k({result:{error:nA},context:{drawPosition:d},stack:g});const{positionAssignments:O}=St({structure:_}),b=O.find($=>$.drawPosition===d);if(!b)return k({result:{error:sa},context:{drawPosition:d},stack:g});if(O.map(Ze).includes(l))return k({result:{error:la},context:{drawPosition:d},stack:g});const{containsParticipant:T,containsBye:N}=w(b);if(N){let $=ba({inContextDrawMatchUps:e,tournamentRecord:s,drawDefinition:a,drawPosition:d,structureId:v,matchUpsMap:p,event:f});if($.error)return k({result:$,stack:g})}if(T&&b.participantId!==l){const{activeDrawPositions:$}=Yc({drawDefinition:a,structureId:v});if($.includes(d))return k({result:{error:zf},stack:g});mm({assignments:[b],inContextDrawMatchUps:e,tournamentRecord:s,drawDefinition:a,matchUpsMap:p,structure:_})}if(b.participantId=l,r&&(b.qualifier=!0),(_==null?void 0:_.stageSequence)>1||[Et,it].includes(_.stage)){const $=_.stage===Ie?Ie:ue,A=(a.structures.find(C=>C.stage===$&&C.stageSequence===1).seedAssignments||[]).find(C=>C.participantId===l);A&&ss(i6(o6({eventId:f==null?void 0:f.eventId,provisionalPositioning:t,tournamentRecord:s,drawDefinition:a,seedingProfile:c},A),{structureId:v,event:f}))}if(_.structureType!==er)s6({provisionalPositioning:t,inContextDrawMatchUps:e,positionAssignments:O,sourceMatchUpStatus:n,automaticPlacement:o,drawPositionIndex:i,tournamentRecord:s,drawDefinition:a,drawPosition:d,matchUpsMap:p,structure:_,event:f});else{IC({inContextDrawMatchUps:e,positionAssignments:O,tournamentRecord:s,drawDefinition:a,matchUpsMap:p,structure:_});const{drawPositions:$,matchUps:U,targetMatchUps:A}=jC({assignments:[b],inContextDrawMatchUps:e,drawDefinition:a,matchUpsMap:p,structure:_});if((U==null?void 0:U.length)===1&&U[0].matchUpType===We){const C=(m=A==null?void 0:A[0])==null?void 0:m.sides.reduce((M,D,V)=>$!=null&&$.includes(D.drawPosition)?V:M,void 0);um({inContextTargetMatchUp:A[0],teamParticipantId:l,matchUp:U[0],drawPositionSideIndex:C,tournamentRecord:s,drawDefinition:a})}}return o||(Ed({drawPositions:[d],structure:_}),Kc({drawDefinition:a,positionAction:{name:"positionAssignment",participantId:l,drawPosition:d,structureId:v}})),Lo({tournamentId:s==null?void 0:s.tournamentId,drawDefinition:a,source:g,structure:_,event:f}),Object.assign({positionAssignments:O},B);function w($){const U=$.bye,A=$.qualifier,C=$.participantId;return{containsBye:U,containsQualifier:A,containsParticipant:C,filled:U||A||C}}}function s6({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:r,automaticPlacement:n,drawPositionIndex:o,tournamentRecord:i,drawDefinition:s,drawPosition:a,matchUpsMap:c,structure:l,event:u}){const d={isCollectionMatchUp:!1},{matchUps:p}=Ke({provisionalPositioning:t,inContextDrawMatchUps:e,drawDefinition:s,matchUpFilters:d,matchUpsMap:c,structure:l,event:u}),{roundMatchUps:v}=lr({matchUps:p}),{initialRoundNumber:f}=is({drawPosition:a,matchUps:p}),m=v[f].find(g=>{var h;return(h=g.drawPositions)==null?void 0:h.includes(a)});if(m){const g=Zs({matchUpId:m.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:r,automaticPlacement:n,drawPositionIndex:o,tournamentRecord:i,drawDefinition:s,drawPosition:a,matchUpsMap:c});if(g.error)return k({stack:"assignDrawPositionToMatchUps",context:{drawPosition:a},result:g})}}var a6=Object.defineProperty,c6=Object.defineProperties,l6=Object.getOwnPropertyDescriptors,rP=Object.getOwnPropertySymbols,u6=Object.prototype.hasOwnProperty,d6=Object.prototype.propertyIsEnumerable,nP=(t,e,r)=>e in t?a6(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Tp=(t,e)=>{for(var r in e||(e={}))u6.call(e,r)&&nP(t,r,e[r]);if(rP)for(var r of rP(e))d6.call(e,r)&&nP(t,r,e[r]);return t},oP=(t,e)=>c6(t,l6(e));function p6({winnerMatchUpDrawPositionIndex:t,inContextDrawMatchUps:e,projectedWinningSide:r,sourceMatchUpStatus:n,winningDrawPosition:o,tournamentRecord:i,winnerTargetLink:s,sourceMatchUpId:a,drawDefinition:c,winnerMatchUp:l,dualMatchUp:u,matchUpsMap:d,event:p}){var v,f,m;const g="directWinner";if(s){const h=l.drawPositions||[],_=h[t],I=s.source.structureId,P=Te({structureId:I,drawDefinition:c});if(P.error)return P;const{structure:S}=P,{positionAssignments:y}=St({structureId:I,drawDefinition:c}),O=y.find(A=>A.drawPosition===o),b=O==null?void 0:O.participantId,E=s.target.structureId,{positionAssignments:T}=St({structureId:E,drawDefinition:c}),N=T.find(A=>A.participantId===b),w=N==null?void 0:N.drawPosition,$=T.filter(A=>{const C=h.includes(A.drawPosition),M=!A.participantId&&!A.bye&&!A.qualifier;return C&&M}).map(A=>A.drawPosition),U=$.includes(_);if(s.target.roundNumber===1&&U)un({drawPositionIndex:t,drawPosition:_,participantId:b,structureId:E,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:i,sourceMatchUpId:a,drawDefinition:c,matchUpsMap:d,event:p});else if($.length){const A=$.pop();un({drawPositionIndex:t,participantId:b,structureId:E,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:i,sourceMatchUpId:a,drawDefinition:c,drawPosition:A,matchUpsMap:d,event:p})}else if(w){const A=Zs({drawPositionIndex:t,drawPosition:w,matchUpId:l.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:i,sourceMatchUpId:a,drawDefinition:c,matchUpsMap:d});if(A.error)return k({result:A,stack:g})}else if(S.stage!==Ie){const A="winner target position unavaiallble";return console.log(A),{error:A}}if(S!=null&&S.seedAssignments&&S.structureId!==E){const A=S.seedAssignments.find(({participantId:C})=>C===b);A&&ss(oP(Tp({eventId:l==null?void 0:l.eventId,structureId:E},A),{tournamentRecord:i,drawDefinition:c}))}}else{const h=Zs({drawPositionIndex:t,matchUpId:l.matchUpId,drawPosition:o,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:i,sourceMatchUpId:a,drawDefinition:c,matchUpsMap:d});if(h.error)return h}if(u&&r){const h=(v=u.sides)==null?void 0:v.find(_=>_.sideNumber===r);if(h!=null&&h.lineUp){const _=u.roundPosition,I=l.roundPosition,P=_===I&&_!==1||Math.floor(_/2)===I?2:1,S=(f=d==null?void 0:d.drawMatchUps)==null?void 0:f.find(({matchUpId:b})=>b===l.matchUpId),y=[1,2].map(b=>{var E;const T=((E=S.sides)==null?void 0:E.find(N=>N.sideNumber===b))||{};return oP(Tp({},T),{sideNumber:b})});S.sides=y;const O=S.sides.find(b=>b.sideNumber===P);if(O){const b=(m=h.lineUp)==null?void 0:m.filter(E=>E==null?void 0:E.participantId);O.lineUp=pm({lineUp:b}),ze({tournamentId:i==null?void 0:i.tournamentId,eventId:l==null?void 0:l.eventId,matchUp:S,context:g,drawDefinition:c})}}}return Tp({},B)}var f6=Object.defineProperty,v6=Object.defineProperties,m6=Object.getOwnPropertyDescriptors,iP=Object.getOwnPropertySymbols,g6=Object.prototype.hasOwnProperty,h6=Object.prototype.propertyIsEnumerable,sP=(t,e,r)=>e in t?f6(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ml=(t,e)=>{for(var r in e||(e={}))g6.call(e,r)&&sP(t,r,e[r]);if(iP)for(var r of iP(e))h6.call(e,r)&&sP(t,r,e[r]);return t},aP=(t,e)=>v6(t,m6(e));function _6(t){var e,r;const{loserMatchUpDrawPositionIndex:n,inContextDrawMatchUps:o,projectedWinningSide:i,sourceMatchUpStatus:s,loserDrawPosition:a,tournamentRecord:c,loserTargetLink:l,sourceMatchUpId:u,drawDefinition:d,loserMatchUp:p,dualMatchUp:v,matchUpsMap:f,event:m}=t,g="directLoser",h=l.linkCondition,_=p.drawPositions||[],I=h===zn&&p.roundNumber===2&&Math.min(..._.filter(Boolean)),P=I||_[n],S=I||_[1-n],y=l.source.structureId,{structure:O}=Te({structureId:y,drawDefinition:d}),{matchUps:b}=Ke({afterRecoveryTimes:!1,inContext:!0,drawDefinition:d,structure:O,event:m}),T=b.filter(F=>{var q;return(q=F.drawPositions)==null?void 0:q.includes(a)}).filter(F=>{const q=F.sides.find(H=>H.drawPosition===a),G=F.matchUpStatus===Ge||F.matchUpStatus===Be&&!At(F);return(q==null?void 0:q.sideNumber)===F.winningSide&&!G}),N=h===zn&&T.length===0,{positionAssignments:w}=St({structureId:y,drawDefinition:d}),$=w.find(F=>F.drawPosition===a),U=$==null?void 0:$.participantId,A=l.target.structureId,{positionAssignments:C}=St({structureId:A,drawDefinition:d}),M=C.filter(({drawPosition:F})=>_.includes(F));if(M.some(F=>F.participantId===U))return ml({},B);const V=M.filter(F=>{const q=_.includes(F.drawPosition),G=!F.participantId&&!F.bye&&!F.qualifier;return q&&G}).map(F=>F.drawPosition),R=V.includes(P),W=l.target.roundNumber>1&&V.length,x=l.target.roundNumber===1&&R;if(I){const F=K();if(F.error)return k({result:F,stack:g})}else if(x){const F=L();if(F.error)return k({result:F,stack:g})}else if(W){const F=V.sort(Bt)[0],q=un({drawPositionIndex:n,participantId:U,structureId:A,drawPosition:F,automaticPlacement:!0,inContextDrawMatchUps:o,sourceMatchUpStatus:s,tournamentRecord:c,sourceMatchUpId:u,drawDefinition:d,matchUpsMap:f,event:m});if(q.error)return k({result:q,stack:g})}else return k({result:{error:sa},context:{loserDrawPosition:a,loserTargetLink:l},stack:g});if(O!=null&&O.seedAssignments&&O.structureId!==A){const F=O.seedAssignments.find(({participantId:q})=>q===U);F&&ss(aP(ml({eventId:p==null?void 0:p.eventId,structureId:A},F),{tournamentRecord:c,drawDefinition:d}))}if(v&&i){const F=(e=v.sides)==null?void 0:e.find(q=>q.sideNumber===3-i);if(F!=null&&F.lineUp){const{roundNumber:q,eventId:G}=p,{roundPosition:H}=v,Q=q===1?2-H%2:1,z=(r=f==null?void 0:f.drawMatchUps)==null?void 0:r.find(({matchUpId:te})=>te===p.matchUpId),Y=[1,2].map(te=>{var ne;const oe=((ne=z.sides)==null?void 0:ne.find(se=>se.sideNumber===te))||{};return aP(ml({},oe),{sideNumber:te})});z.sides=Y;const J=z.sides.find(te=>te.sideNumber===Q);J&&(J.lineUp=pm({lineUp:F.lineUp}),ze({tournamentId:c==null?void 0:c.tournamentId,matchUp:z,context:g,drawDefinition:d,eventId:G}))}}return ml({},B);function K(){const F="loserLinkFedFMLC";return k(N?{result:L(),stack:F}:{result:j(),stack:F})}function j(){const F=Dr({drawPositionIndex:n,drawPosition:S,structureId:A,tournamentRecord:c,sourceMatchUpId:u,drawDefinition:d,event:m});return k({result:F,stack:"assignLoserPositionBye"})}function L(){const F=un({drawPositionIndex:n,drawPosition:P,participantId:U,structureId:A,automaticPlacement:!0,inContextDrawMatchUps:o,sourceMatchUpStatus:s,tournamentRecord:c,sourceMatchUpId:u,drawDefinition:d,matchUpsMap:f,event:m});return k({result:F,stack:"assignLoserDrawPosition"})}}var I6=Object.defineProperty,cP=Object.getOwnPropertySymbols,P6=Object.prototype.hasOwnProperty,y6=Object.prototype.propertyIsEnumerable,lP=(t,e,r)=>e in t?I6(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ts=(t,e)=>{for(var r in e||(e={}))P6.call(e,r)&&lP(t,r,e[r]);if(cP)for(var r of cP(e))y6.call(e,r)&&lP(t,r,e[r]);return t};function RC(t){const e=dm(t);if(e.error)return e;const r=Bc({matchUpStatus:t.matchUpStatus}),{dualWinningSideChange:n,projectedWinningSide:o,inContextDrawMatchUps:i,tournamentRecord:s,drawDefinition:a,matchUpStatus:c,dualMatchUp:l,matchUpsMap:u,winningSide:d,targetData:p,matchUpId:v,structure:f,matchUp:m,event:g}=t,h="directParticipants",_=!!m.collectionId,I=mo({drawDefinition:a,structure:f});let P=m.drawPositions,S;if(_){const{matchUpTieId:y,matchUpsMap:O}=t,b=to({matchUpId:y,tournamentRecord:s,drawDefinition:a,matchUpsMap:O,event:g});S=b&&{tieMatchUpResult:b};const E=i.find(({matchUpId:T})=>T===y);if(P=E==null?void 0:E.drawPositions,!n)return k({result:Ts(Ts({},B),S),stack:h})}if(I)return k({result:Ts(Ts({},B),S),stack:h});if(P){const y=o?o-1:d-1,O=1-y,b=P[y],E=P[O],{targetLinks:{loserTargetLink:T,winnerTargetLink:N,byeTargetLink:w},targetMatchUps:{winnerMatchUpDrawPositionIndex:$,loserMatchUpDrawPositionIndex:U,winnerMatchUp:A,loserMatchUp:C,byeMatchUp:M}}=p;if(A){const D=p6({sourceMatchUpStatus:r&&c||_t,winnerMatchUpDrawPositionIndex:$,sourceMatchUpId:v,inContextDrawMatchUps:i,projectedWinningSide:o,winningDrawPosition:b,tournamentRecord:s,winnerTargetLink:N,drawDefinition:a,winnerMatchUp:A,dualMatchUp:l,matchUpsMap:u,event:g});if(D.error)return k({result:D,stack:h})}if(C){const D=_6({sourceMatchUpStatus:r&&c||_t,loserMatchUpDrawPositionIndex:U,sourceMatchUpId:v,inContextDrawMatchUps:i,projectedWinningSide:o,loserDrawPosition:E,tournamentRecord:s,loserTargetLink:T,drawDefinition:a,loserMatchUp:C,winningSide:d,matchUpsMap:u,dualMatchUp:l,event:g});if(D.error)return k({result:D,stack:h})}if(M){const D=M.drawPositions||[],V=Math.min(...D.filter(Boolean)),R=w.target.structureId,W=Dr({drawPosition:V,structureId:R,tournamentRecord:s,drawDefinition:a,event:g});if(W.error)return k({result:W,stack:h})}}else return k({result:{error:Kf},stack:h});return k({result:Ts(Ts({},B),S),stack:h})}function gi(t){var e,r;const{inContextDrawMatchUps:n,targetData:o,drawDefinition:i,relevantLink:s}=t;if((s==null?void 0:s.linkCondition)===zn&&((e=o==null?void 0:o.matchUp)==null?void 0:e.matchUpStatus)===qe)return!1;const{targetMatchUps:{loserMatchUp:c,winnerMatchUp:l},targetLinks:u}=o,d=[Be,Ge].includes(c==null?void 0:c.matchUpStatus),p=((r=l==null?void 0:l.drawPositions)==null?void 0:r.filter(Boolean).length)||0;if(c!=null&&c.winningSide&&!d||l!=null&&l.winningSide&&p===2&&(!l.feedRound||![Ge,Be].includes(l==null?void 0:l.matchUpStatus)))return!0;let v=c&&nr({matchUpId:c.matchUpId,inContextDrawMatchUps:n,drawDefinition:i}),f=l&&nr({matchUpId:l.matchUpId,inContextDrawMatchUps:n,drawDefinition:i});const m=v&&gi({relevantLink:u==null?void 0:u.loserTargetLink,targetData:v,inContextDrawMatchUps:n,drawDefinition:i});return!!(f&&gi({targetData:f,inContextDrawMatchUps:n,drawDefinition:i})||m)}var O6=Object.defineProperty,S6=Object.defineProperties,b6=Object.getOwnPropertyDescriptors,uP=Object.getOwnPropertySymbols,T6=Object.prototype.hasOwnProperty,E6=Object.prototype.propertyIsEnumerable,dP=(t,e,r)=>e in t?O6(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,w6=(t,e)=>{for(var r in e||(e={}))T6.call(e,r)&&dP(t,r,e[r]);if(uP)for(var r of uP(e))E6.call(e,r)&&dP(t,r,e[r]);return t},N6=(t,e)=>S6(t,b6(e));function $6(t){var e,r;const n="replaceQualifier";let o;const{inContextDrawMatchUps:i,inContextMatchUp:s,drawDefinition:a,winningSide:c}=t,l=(e=t.targetData.targetLinks)==null?void 0:e.winnerTargetLink;if(l.target.feedProfile===zr){const u=s.sides.find(({sideNumber:p})=>p!==c).participantId,d=i.find(p=>p.structureId===l.target.structureId&&p.roundNumber===l.target.roundNumber&&p.sides.some(({participantId:v})=>v===u));if((d==null?void 0:d.matchUpStatus)===pt){const p=nr({matchUpId:d.matchUpId,inContextDrawMatchUps:i,drawDefinition:a});if(!gi({inContextDrawMatchUps:i,drawDefinition:a,targetData:p})){const{structure:f}=Te({structureId:d.structureId,drawDefinition:a}),m=Xe({structure:f}).positionAssignments;for(const g of m)if(g.participantId===u){const h=s.sides.find(({sideNumber:_})=>_===c).participantId;if(g.participantId=h,f.positionAssignments)f.positionAssignments=m;else if(f.structures){const _=Object.assign({},...m.map(I=>({[I.drawPosition]:I.participantId})));for(const I of f.structures)I.positionAssignments.forEach(P=>P.participantId=_[P.drawPosition])}Lo({tournamentId:(r=t.tournamentRecord)==null?void 0:r.tournamentId,event:t.event,drawDefinition:a,source:n,structure:f}),o=!0}}}}return N6(w6({},B),{qualifierReplaced:o})}var A6=Object.defineProperty,U6=Object.defineProperties,C6=Object.getOwnPropertyDescriptors,pP=Object.getOwnPropertySymbols,M6=Object.prototype.hasOwnProperty,D6=Object.prototype.propertyIsEnumerable,fP=(t,e,r)=>e in t?A6(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,j6=(t,e)=>{for(var r in e||(e={}))M6.call(e,r)&&fP(t,r,e[r]);if(pP)for(var r of pP(e))D6.call(e,r)&&fP(t,r,e[r]);return t},R6=(t,e)=>U6(t,C6(e));function F6(t){var e,r,n,o;const i="placeQualifier";let s;const{inContextDrawMatchUps:a,inContextMatchUp:c,drawDefinition:l,winningSide:u}=t,d=(e=t.targetData.targetLinks)==null?void 0:e.winnerTargetLink;if(d.target.feedProfile===zr){const p=(r=c.sides.find(({sideNumber:m})=>m===u))==null?void 0:r.participantId,v=a.filter(m=>m.structureId===d.target.structureId&&m.roundNumber===d.target.roundNumber&&m.sides.some(({participantId:g,qualifier:h})=>h&&!g)),f=pr(v);if((f==null?void 0:f.matchUpStatus)===pt){const m=nr({matchUpId:f.matchUpId,inContextDrawMatchUps:a,drawDefinition:l});if(!gi({inContextDrawMatchUps:a,drawDefinition:l,targetData:m})){const h=(n=f.sides.find(P=>P.qualifier&&!P.participantId))==null?void 0:n.drawPosition,{structure:_}=Te({structureId:f.structureId,drawDefinition:l}),I=Xe({structure:_}).positionAssignments;for(const P of I)if(P.drawPosition===h&&!P.participantId){if(P.participantId=p,_.positionAssignments)_.positionAssignments=I;else if(_.structures){const S=Object.assign({},...I.map(y=>({[y.drawPosition]:y.participantId})));for(const y of _.structures)y.positionAssignments.forEach(O=>O.participantId=S[O.drawPosition])}Lo({tournamentId:(o=t.tournamentRecord)==null?void 0:o.tournamentId,event:t.event,drawDefinition:l,source:i,structure:_}),s=!0}}}}return R6(j6({},B),{qualifierPlaced:s})}var V6=Object.defineProperty,L6=Object.defineProperties,B6=Object.getOwnPropertyDescriptors,vP=Object.getOwnPropertySymbols,x6=Object.prototype.hasOwnProperty,G6=Object.prototype.propertyIsEnumerable,mP=(t,e,r)=>e in t?V6(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,gP=(t,e)=>{for(var r in e||(e={}))x6.call(e,r)&&mP(t,r,e[r]);if(vP)for(var r of vP(e))G6.call(e,r)&&mP(t,r,e[r]);return t},k6=(t,e)=>L6(t,B6(e));function W6(t){var e,r;const n="attemptToSetWinningSide";let o;const{appliedPolicies:i,disableAutoCalc:s,drawDefinition:a,matchUpsMap:c,dualMatchUp:l,winningSide:u,structure:d,matchUp:p}=t;if(l!=null&&l._disableAutoCalc&&s!==!1)return dm(t);if(p.winningSide&&p.winningSide!==u){const{connectedStructureIds:g}=UC({drawDefinition:a,matchUpsMap:c,structure:d,matchUp:p});g.length&&(console.log({connectedStructureIds:g}),o=!0);const h=Ta(t);if(h.error)return h}const v=RC(t);if(v.error)return k({result:v,stack:n});let f,m;return t.qualifierChanging&&((e=i==null?void 0:i[Hl])!=null&&e.autoReplaceQualifiers)&&(f=$6(t).qualifierReplaced),t.qualifierAdvancing&&((r=i==null?void 0:i[Hl])!=null&&r.autoPlaceQualifiers)&&(m=F6(t).qualifierPlaced),k({result:_e(k6(gP(gP({},B),v),{connectedStructures:o,qualifierReplaced:f,qualifierPlaced:m})),stack:n})}var q6=Object.defineProperty,H6=Object.defineProperties,Y6=Object.getOwnPropertyDescriptors,hP=Object.getOwnPropertySymbols,K6=Object.prototype.hasOwnProperty,z6=Object.prototype.propertyIsEnumerable,_P=(t,e,r)=>e in t?q6(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ka=(t,e)=>{for(var r in e||(e={}))K6.call(e,r)&&_P(t,r,e[r]);if(hP)for(var r of hP(e))z6.call(e,r)&&_P(t,r,e[r]);return t},Nf=(t,e)=>H6(t,Y6(e));function FC(t){var e;const{inContextDrawMatchUps:r,appliedPolicies:n,drawDefinition:o,matchUpsMap:i,targetData:s,matchUp:a}=t;let{iteration:c=0}=t;c+=1;const l="removeDoubleExit";Sn();const{targetLinks:{loserTargetLink:u},targetMatchUps:{loserMatchUp:d,winnerMatchUp:p,loserTargetDrawPosition:v}}=s;if(p&&p.matchUpStatus!==qe&&(Sn(),IP(Nf(ka({},t),{targetMatchUp:p,sourceMatchUp:a,iteration:c}))),d&&d.matchUpStatus!==qe){const f=r.find(({matchUpId:g})=>g===d.matchUpId),{structure:m}=Te({drawDefinition:o,structureId:f.structureId});if(Sn(),(e=n==null?void 0:n.progression)!=null&&e.doubleExitPropagateBye){const g=bf({targetLink:u,drawPosition:v,inContextDrawMatchUps:r,drawDefinition:o,matchUpsMap:i});if(g.error)return k({result:g,stack:l})}else{const g=IP(Nf(ka({},t),{structure:m,targetMatchUp:d,iteration:c}));if(g.error)return k({result:g,stack:l})}}return k({result:ka({},B),stack:l})}function IP(t){var e,r,n,o,i;const{inContextDrawMatchUps:s,appliedPolicies:a,drawDefinition:c,sourceMatchUp:l,targetMatchUp:u,matchUpsMap:d,structure:p,iteration:v}=t,f="conditionallyRemoveDrawPosition";Sn();const m=nr({matchUpId:u.matchUpId,inContextDrawMatchUps:s,drawDefinition:c}),{targetMatchUps:{winnerMatchUp:g}}=m,h=d==null?void 0:d.drawMatchUps.find(E=>E.matchUpId===u.matchUpId);let _=[],I,P,S;if(u.feedRound){const E=(e=g==null?void 0:g.drawPositions)==null?void 0:e.filter(Boolean);S=E==null?void 0:E.find(T=>u.drawPositions.includes(T))}else if(!l)S=(r=Dt((u==null?void 0:u.drawPositions)||[],(g==null?void 0:g.drawPositions)||[]))==null?void 0:r[0];else if(P=(n=gC({structureId:p.structureId,matchUp:l,matchUpsMap:d}))==null?void 0:n.pairedPreviousMatchUp,I=[gt,Ot].includes(P==null?void 0:P.matchUpStatus),_=((o=P==null?void 0:P.drawPositions)==null?void 0:o.filter(Boolean))||[],[...Rt,qe].includes(P==null?void 0:P.matchUpStatus)||(P==null?void 0:P.winningSide)){const T=l.drawPositions||[];let N=(i=u.drawPositions)==null?void 0:i.filter(Boolean);Gt(T,N)&&(N=N==null?void 0:N.filter($=>!T.includes($))),S=T.concat(_).find($=>N==null?void 0:N.includes($))}if(g&&S){Sn();const E=yC({winningDrawPosition:S,winnerMatchUp:g,inContextDrawMatchUps:s,drawDefinition:c,matchUpsMap:d});if(E.error)return k({result:E,stack:f})}let y=FC({targetData:m,matchUp:u,inContextDrawMatchUps:s,appliedPolicies:a,drawDefinition:c,matchUpsMap:d,structure:p,iteration:v});if(y.error)return k({result:y,stack:f});const O=Q6({pairedPreviousDoubleExit:I,noContextTargetMatchUp:h}),b=!I;return y=On(Nf(ka({},t),{matchUpStatus:O,removeScore:b,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},removeWinningSide:!0,matchUp:h,matchUpId:u.matchUpId,matchUpStatusCodes:[]})),y.error?k({result:y,stack:f}):ka({},B)}function Q6({pairedPreviousDoubleExit:t,noContextTargetMatchUp:e}){return e.matchUpStatus===qe?qe:t?[Ot,Be].includes(e==null?void 0:e.matchUpStatus)?Be:Ge:pt}function J6(t){var e,r,n;const o="removeQualifier";let i;const{inContextDrawMatchUps:s,inContextMatchUp:a,drawDefinition:c}=t,l=(e=t.targetData.targetLinks)==null?void 0:e.winnerTargetLink;if(l.target.feedProfile===zr){const u=(r=a.sides.find(({sideNumber:p})=>p===a.winningSide))==null?void 0:r.participantId,d=s.find(p=>p.structureId===l.target.structureId&&p.roundNumber===l.target.roundNumber&&p.sides.some(({participantId:v})=>v===u));if((d==null?void 0:d.matchUpStatus)===pt){const p=nr({matchUpId:d.matchUpId,inContextDrawMatchUps:s,drawDefinition:c});if(!gi({inContextDrawMatchUps:s,drawDefinition:c,targetData:p})){const{structure:f}=Te({structureId:d.structureId,drawDefinition:c}),m=Xe({structure:f}).positionAssignments;for(const g of m)if(g.participantId===u){if(g.participantId=void 0,f.positionAssignments)f.positionAssignments=m;else if(f.structures){const h=Object.assign({},...m.map(_=>({[_.drawPosition]:_.participantId})));for(const _ of f.structures)_.positionAssignments.forEach(I=>I.participantId=h[I.drawPosition])}Lo({tournamentId:(n=t.tournamentRecord)==null?void 0:n.tournamentId,event:t.event,drawDefinition:c,source:o,structure:f}),i=!0}}}}return{qualifierRemoved:i}}var Z6=Object.defineProperty,X6=Object.defineProperties,eY=Object.getOwnPropertyDescriptors,PP=Object.getOwnPropertySymbols,tY=Object.prototype.hasOwnProperty,rY=Object.prototype.propertyIsEnumerable,yP=(t,e,r)=>e in t?Z6(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,$s=(t,e)=>{for(var r in e||(e={}))tY.call(e,r)&&yP(t,r,e[r]);if(PP)for(var r of PP(e))rY.call(e,r)&&yP(t,r,e[r]);return t},Ep=(t,e)=>X6(t,eY(e));function nY(t){const{matchUp:e,matchUpStatus:r,score:n,winningSide:o}=t,i="noDownStreamDependencies";if([gt,Ot].includes(e==null?void 0:e.matchUpStatus)&&![gt,Ot].includes(r)){const m=FC(t);if(m.error)return k({result:m,stack:i})}const a=r===gt,c=At({score:n})&&!a&&(t.isCollectionMatchUp&&!t.projectedWinningSide||!o),l=t.removeScore||![Hn,gr].includes(r||Hn),u=t.isCollectionMatchUp&&t.dualMatchUp.winningSide&&!t.projectedWinningSide||e.winningSide&&!o&&!At({score:n}),d=r&&r!==pt,p=({removeScore:m}={})=>{var g,h;let _;const{structure:I,drawDefinition:P,dualMatchUp:S,disableAutoCalc:y}=t;if(S!=null&&S._disableAutoCalc&&y!==!1)return dm(t);const{connectedStructureIds:O}=UC({drawDefinition:P,structure:I,matchUp:e});O.length&&(console.log({connectedStructureIds:O}),_=!0),Object.assign(t,{removeScore:m});const b=Ta(t);if(b.error)return b;if(t.removingQualifier&&((h=(g=t.appliedPolicies)==null?void 0:g[Hl])!=null&&h.autoRemoveQualifiers)){const E=J6(t);return E.error?E:$s(Ep($s({},B),{connectedStructures:_}),E)}return Ep($s({},B),{connectedStructures:_})};if(u&&o&&t.isCollectionMatchUp)return OP(t);const v=[_o,gr].includes(r)&&t.dualWinningSideChange,f=(o||v)&&W6(t)||c&&p({removeScore:l})||d&&PH(t)||u&&p({removeScore:l})||e&&OP(Ep($s({},t),{removeScore:!0}))||console.log("unknown condition")&&$s({},B);return k({result:f,stack:i})}function OP(t){var e;const r="scoreModification";if(t.isCollectionMatchUp&&((e=t.dualMatchUp)==null?void 0:e.winningSide)&&!t.projectedWinningSide){const i=Ta(t);if(i.error)return i}const o=On($s({},t));if(t.isCollectionMatchUp){const{matchUpTieId:i,drawDefinition:s,event:a,matchUpsMap:c}=t,{removeWinningSide:l}=to({tournamentRecord:t.tournamentRecord,matchUpId:i,drawDefinition:s,matchUpsMap:c,event:a});l&&console.log("REMOVE WINNING SIDE")}return k({result:o,stack:r})}function oY(t){var e;const{tournamentRecord:r,inContextMatchUp:n,structure:o,drawDefinition:i}=t,s=n.roundNumber,a=n.sides.find(O=>O.sideNumber===n.winningSide),c=n.sides.find(O=>O.sideNumber!==n.winningSide),{drawPosition:l,participantId:u}=a,{drawPosition:d,participantId:p}=c,v="swapWinnerLoser",{matchUps:f}=Ke(t),m=f.filter(({drawPositions:O,roundNumber:b})=>(O==null?void 0:O.includes(l))&&b>s);Ct({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:m}),m.forEach(O=>{var b,E;O.drawPositions=((b=O.drawPositions)==null?void 0:b.map(T=>T===l?d:T))||[],ze({tournamentId:r==null?void 0:r.tournamentId,eventId:(E=t.event)==null?void 0:E.eventId,context:v,drawDefinition:i,matchUp:O})});const{stage:g,stageSequence:h}=o,_=i.structures.filter(({stage:O,stageSequence:b})=>O===g&&b>h).map(({structureId:O})=>O),{targetLinks:{loserTargetLink:I,winnerTargetLink:P}}=t.targetData,S=[I==null?void 0:I.target.structureId,(e=P==null?void 0:P.target)==null?void 0:e.structureId].filter(Boolean);return i.structures.filter(({stage:O,structureId:b})=>O!==g&&S.includes(b)).forEach(({stage:O,stageSequence:b,structureId:E})=>{_.includes(E)||_.push(E),i.structures.filter(({stage:T,stageSequence:N})=>T===O&&N>b).forEach(({structureId:T})=>{_.includes(T)||_.push(T)})}),i.structures.filter(({structureId:O})=>_.includes(O)).forEach(O=>{const{positionAssignments:b}=Xe({structure:O}),E=b.find(({participantId:N})=>N===u),T=b.find(({participantId:N})=>N===p);E&&(E.participantId=p),T&&(T.participantId=u)}),On(t)}var iY=Object.defineProperty,sY=Object.defineProperties,aY=Object.getOwnPropertyDescriptors,SP=Object.getOwnPropertySymbols,cY=Object.prototype.hasOwnProperty,lY=Object.prototype.propertyIsEnumerable,bP=(t,e,r)=>e in t?iY(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,uY=(t,e)=>{for(var r in e||(e={}))cY.call(e,r)&&bP(t,r,e[r]);if(SP)for(var r of SP(e))lY.call(e,r)&&bP(t,r,e[r]);return t},dY=(t,e)=>sY(t,aY(e));function Jc(t){var e,r,n;const o="setMatchUpStatus";[Ge,gt].includes(t.matchUpStatus)&&(t.score=void 0);const{allowChangePropagation:i,disableScoreValidation:s,tournamentRecords:a,tournamentRecord:c,disableAutoCalc:l,enableAutoCalc:u,drawDefinition:d,matchUpStatus:p,winningSide:v,matchUpId:f,event:m,score:g}=t;if(!d)return{error:pe};if([_o,Hn,gr,pt].includes(p)&&v)return{error:Z,winningSide:v,matchUpStatus:p};if(![void 0,...dV].includes(p))return k({result:{error:Ya},info:"matchUpStatus does not exist",stack:"setMatchUpStatus"});const h=zt({drawDefinition:d});let{matchUps:_}=wt({includeByeMatchUps:!0,nextMatchUps:!0,inContext:!0,drawDefinition:d,matchUpsMap:h});const I=h.drawMatchUps.find(j=>j.matchUpId===f),P=_.find(j=>j.matchUpId===f);if(!I||!_)return{error:kr};if((I.winningSide||v)&&p===qe)return{context:"Cannot have Bye with winningSide",error:np,matchUpStatus:p};const S=P.structureId,{structure:y}=Te({drawDefinition:d,structureId:S}),O=(e=P.drawPositions)==null?void 0:e.filter(Boolean);let b;if(I.matchUpType===We){if(l)et({extension:{name:Bs,value:!0},element:I});else if(u){const j=I.winningSide;tn({name:Bs,element:I});const{winningSide:L,scoreStringSide1:F,scoreStringSide2:q,set:G}=Lc({drawDefinition:d,matchUpsMap:h,structure:y,matchUp:I,event:m}),H={scoreStringSide1:F,scoreStringSide2:q,sets:G?[G]:[]};b=L!==j,Object.assign(t,{winningSide:L,dualWinningSideChange:b,projectedWinningSide:L,score:H})}}if(I.matchUpType===We&&[da].includes(p))return{error:Z,info:"Not supported for matchUpType: TEAM"};const E=P.matchUpTieId,T=nr({matchUpId:E||f,inContextDrawMatchUps:_,drawDefinition:d});if(g&&I.matchUpType!==We&&!s){const j=I.matchUpFormat||(y==null?void 0:y.matchUpFormat)||(d==null?void 0:d.matchUpFormat)||(m==null?void 0:m.matchUpFormat),L=Wv({existingMatchUpStatus:I.matchUpStatus,matchUpFormat:j,matchUpStatus:p,winningSide:v,score:g});if(L.error)return L}const N=I!=null&&I.sides?[]:Xe({drawDefinition:d,structureId:S}).positionAssignments,w=((r=I.sides)==null?void 0:r.map(j=>j.participantId).filter(Boolean).length)===2||(O==null?void 0:O.length)===2&&(N==null?void 0:N.filter(j=>O.includes(j.drawPosition)).every(j=>j.participantId));if(p&&uV.includes(p)&&!w)return k({result:{error:Ya},info:"present in participantRequiredMatchUpStatuses",context:{matchUpStatus:p,bothSideParticipants:w}});const{appliedPolicies:$}=ct({policyTypes:[Hl],tournamentRecord:c,drawDefinition:d,event:m});typeof t.policyDefinitions=="object"&&Object.assign($,t.policyDefinitions);const U=P.stage===Ie&&P.finishingRound===1,A=U&&v,C=U&&I.winningSide&&!v&&(!t.matchUpStatus||mf(t.matchUpStatus))&&!At(t.outcome),M=A&&v!==I.winningSide&&I.winningSide;if(Object.assign(t,{inContextDrawMatchUps:_,qualifierAdvancing:A,qualifierChanging:M,removingQualifier:C,inContextMatchUp:P,appliedPolicies:$,matchUpTieId:E,matchUpsMap:h,targetData:T,structure:y,matchUp:I}),E){const{matchUp:j}=nt({matchUpId:E,inContext:!0,drawDefinition:d,matchUpsMap:h,event:m}),L=(n=Zt({matchUp:j,drawDefinition:d,structure:y,event:m}))==null?void 0:n.tieFormat,{projectedWinningSide:F}=pq({matchUpStatus:p,dualMatchUp:j,matchUpsMap:h,winningSide:v,tieFormat:L,structure:y,matchUp:I,event:m,score:g}),q=j.winningSide;b=F!==q,Object.assign(t,{isCollectionMatchUp:!0,dualWinningSideChange:b,projectedWinningSide:F,matchUpTieId:E,dualMatchUp:j,tieFormat:L})}const D=gi(t),V=Bc({matchUpStatus:p});if(!E){if(D&&!v&&(mf({matchUpStatus:p})||[gt,Ot].includes(p)))return{error:np,activeDownstream:D,winningSide:v};if(v&&v===I.winningSide&&p&&!V)return{context:"winningSide must include directing matchUpStatus",error:np,directingMatchUpStatus:V,matchUpStatus:p}}const{schedule:R}=t;if(R){const j=Sd({disableNotice:!0,tournamentRecords:a,tournamentRecord:c,drawDefinition:d,matchUpId:f,schedule:R});if(j.error)return j}const W=I.matchUpType!==We&&!b&&v&&I.winningSide&&I.winningSide!==v;if(i&&W&&I.roundPosition)return oY(t);const x=v&&!E||t.projectedWinningSide;Sn();const K=!D&&nY(t)||x&&pY(t)||V&&VC(t)||{error:eF};return k({result:K,stack:o})}function pY(t){const{matchUp:e,winningSide:r,matchUpTieId:n,dualWinningSideChange:o}=t;return r===e.winningSide||n&&!o?VC(t):k({result:{error:hA},stack:"winningSideWithDownstreamDependencies",context:{winningSide:r,matchUp:e}})}function VC(t){const{tournamentRecord:e,matchUp:r,event:n}=t,o=t.isCollectionMatchUp&&r.winningSide&&!t.winningSide&&!At({score:t.score}),i=t.isCollectionMatchUp?t.matchUpStatus||o&&pt||_t:t.matchUpStatus||_t,s=t.removeScore||[_o,Ge].includes(i)&&![Hn,gr].includes(i),a=On(dY(uY({},t),{matchUpStatus:i,removeWinningSide:o,removeScore:s}));if(a.error)return a;if(t.isCollectionMatchUp){const{matchUpTieId:c,drawDefinition:l,matchUpsMap:u}=t,d=to({matchUpId:c,tournamentRecord:e,drawDefinition:l,matchUpsMap:u,event:n});if(d.error)return d;Object.assign(a,{tieMatchUpResult:d})}return a}var fY=Object.defineProperty,TP=Object.getOwnPropertySymbols,vY=Object.prototype.hasOwnProperty,mY=Object.prototype.propertyIsEnumerable,EP=(t,e,r)=>e in t?fY(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,gY=(t,e)=>{for(var r in e||(e={}))vY.call(e,r)&&EP(t,r,e[r]);if(TP)for(var r of TP(e))mY.call(e,r)&&EP(t,r,e[r]);return t};function Ad(t){let e=t.structureIds;const{tournamentRecord:r,drawDefinition:n,matchUpFormat:o,structureId:i,matchUpId:s,event:a}=t;if(!n)return{error:pe};if(!o)return{error:Qf};if(!Br(o))return{error:xu};const c="setMatchUpFormat";if(s){const l=nt({drawDefinition:n,matchUpId:s,event:a});if(l.error)return l;const u=l.matchUp;if((u==null?void 0:u.matchUpType)===yt)return{error:Gr,info:"Cannot set matchUpFormat when { matchUpType: TEAM }"};u.matchUpFormat=o,ze({tournamentId:r==null?void 0:r.tournamentId,eventId:a==null?void 0:a.eventId,context:c,drawDefinition:n,matchUp:u})}else if(Array.isArray(e)){if((a==null?void 0:a.eventType)===yt)return{error:ni};for(const l of e){const u=Te({drawDefinition:n,structureId:l});if(u.error)return u;if(u.structure)u.structure.matchUpFormat=o;else return{error:xr}}}else if(i){if((a==null?void 0:a.eventType)===yt)return{error:ni};const l=Te({drawDefinition:n,structureId:i});if(l.error)return l;if(l.structure)l.structure.matchUpFormat=o;else return{error:xr}}else n&&(n.matchUpFormat=o);return e=e||(i?[i]:void 0),Qe({drawDefinition:n,structureIds:e}),gY({},B)}function LC({matchUpFormat:t,matchUpStatus:e,winningSide:r,score:n}={}){if(!n)return{sets:[]};const o=n.sets||[];let i=xn({winnerFirst:!1,matchUpFormat:t,matchUpStatus:e,sets:o}),s=xn({winnerFirst:!1,reversed:!0,matchUpFormat:t,matchUpStatus:e,sets:o}),a=xn({matchUpFormat:t,matchUpStatus:e,winningSide:r,sets:o}),c=i===a?s:i;return r&&(i=r===1?a:c,s=r===2?a:c),{score:{sets:o,scoreStringSide1:i,scoreStringSide2:s}}}var hY=Object.defineProperty,wP=Object.getOwnPropertySymbols,_Y=Object.prototype.hasOwnProperty,IY=Object.prototype.propertyIsEnumerable,NP=(t,e,r)=>e in t?hY(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,PY=(t,e)=>{for(var r in e||(e={}))_Y.call(e,r)&&NP(t,r,e[r]);if(wP)for(var r of wP(e))IY.call(e,r)&&NP(t,r,e[r]);return t};function Zc(t){var e;const{policyDefinitions:r,tournamentRecords:n,tournamentRecord:o,disableAutoCalc:i,enableAutoCalc:s,drawDefinition:a,matchUpFormat:c,matchUpId:l,schedule:u,event:d,notes:p}=t;if(!a)return{error:Mr};if(!l)return{error:Ut};const{policy:v}=us({policyType:va,tournamentRecord:o,event:d}),f=t.allowChangePropagation!==void 0&&t.allowChangePropagation||(v==null?void 0:v.allowChangePropagation)!==void 0&&v.allowChangePropagation||void 0;let{outcome:m}=t;if(c){const g=Ad({tournamentRecord:o,drawDefinition:a,matchUpFormat:c,matchUpId:l,event:d});if(g.error)return g}if((e=m==null?void 0:m.score)!=null&&e.sets&&!m.score.scoreStringSide1){const{score:g}=LC(m);m.score=g,m.score.sets=m.score.sets.filter(h=>h.side1Score||h.side2Score||h.side1TiebreakScore||h.side2TiebreakScore)}return Jc({matchUpStatusCodes:m==null?void 0:m.matchUpStatusCodes,matchUpStatus:m==null?void 0:m.matchUpStatus,winningSide:m==null?void 0:m.winningSide,allowChangePropagation:f,score:m==null?void 0:m.score,policyDefinitions:r,tournamentRecords:n,tournamentRecord:o,disableAutoCalc:i,enableAutoCalc:s,drawDefinition:a,matchUpFormat:c,matchUpId:l,schedule:u,event:d,notes:p})}function BC(t){if(!t.tournamentRecord)return{error:ee};const{tournamentRecords:e,tournamentRecord:r,outcomes:n}=t,o={};n.forEach(i=>{const{eventId:s}=i;o[s]||(o[s]=[]),o[s].push(i)});for(const i of Object.keys(o)){const{event:s}=Ft({tournamentRecord:r,eventId:i});for(const a of o[i]){const{drawId:c}=a,l=s.drawDefinitions.find(u=>u.drawId===c);if(l){const{matchUpFormat:u,matchUpId:d}=a,p=Zc({schedule:a==null?void 0:a.schedule,tournamentRecords:e,tournamentRecord:r,drawDefinition:l,matchUpFormat:u,matchUpId:d,outcome:a,drawId:c,event:s});if(p.error)return p}}}return PY({},B)}var yY=Object.defineProperty,OY=Object.defineProperties,SY=Object.getOwnPropertyDescriptors,$P=Object.getOwnPropertySymbols,bY=Object.prototype.hasOwnProperty,TY=Object.prototype.propertyIsEnumerable,AP=(t,e,r)=>e in t?yY(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,xC=(t,e)=>{for(var r in e||(e={}))bY.call(e,r)&&AP(t,r,e[r]);if($P)for(var r of $P(e))TY.call(e,r)&&AP(t,r,e[r]);return t},EY=(t,e)=>OY(t,SY(e));function wY(t){const e=t.tournamentRecords,r=t.tournamentId||cm(t);if(typeof r!="string")return{error:so};const n=e[r];if(!n)return{error:ee};const{drawDefinition:o,event:i}=Ft({eventId:t.eventId,drawId:t.drawId,tournamentRecord:n});return Zc(EY(xC({tournamentRecord:n},t),{drawDefinition:o,event:i}))}function NY(t){const{tournamentRecords:e,outcomes:r}=t;if(!Array.isArray(r))return{error:Se,info:Yt("outcomes")};const n=r.reduce((o,i)=>o.includes(i.tournamentId)?o:o.concat(i.tournamentId),[]);for(const o of n){const i=e[o];if(!i)return{error:ee};const s=r.filter(a=>a.tournamentId===o);if(s.length){const a=BC({tournamentRecord:i,outcomes:s});if(a.error)return a}}return xC({},B)}function GC({courtPrefix:t="C|",minRowsCount:e,courtsData:r}){if(!Array.isArray(r))return{error:Z};const n=r==null?void 0:r.reduce((s,a)=>{const c=a.matchUps||[],l=Math.max(0,...c.map(u=>u.schedule.courtOrder||0));return l>s?l:s},1),o=e?Math.max(e,n):n,i=le(0,o).map(s=>({matchUps:le(0,r.length).map(a=>{const c=r[a],{courtId:l,venueId:u}=c;return{schedule:{courtOrder:s+1,venueId:u,courtId:l}}})}));return r.forEach((s,a)=>{var c;for(const l of s.matchUps){const u=(c=l.schedule)==null?void 0:c.courtOrder;u&&(i[u-1].matchUps[a]=l)}}),{courtPrefix:t,rows:i.map((s,a)=>Object.assign({rowId:`rowId-${a+1}`},...s.matchUps.map((c,l)=>({[`${t}${l}`]:c}))))}}var $Y=Object.defineProperty,AY=Object.defineProperties,UY=Object.getOwnPropertyDescriptors,UP=Object.getOwnPropertySymbols,CY=Object.prototype.hasOwnProperty,MY=Object.prototype.propertyIsEnumerable,CP=(t,e,r)=>e in t?$Y(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,wp=(t,e)=>{for(var r in e||(e={}))CY.call(e,r)&&CP(t,r,e[r]);if(UP)for(var r of UP(e))MY.call(e,r)&&CP(t,r,e[r]);return t},Np=(t,e)=>AY(t,UY(e));function Xc({flight:t,suppressNotifications:e,modifyEventEntries:r,existingDrawCount:n,allowReplacement:o,checkEntryStatus:i,tournamentRecord:s,drawDefinition:a,event:c}){var l,u,d,p,v,f,m,g,h,_,I;if(!a)return{error:Mr};if(!c)return{error:Re};c.drawDefinitions||(c.drawDefinitions=[]);const{drawId:P,drawName:S,entries:y}=a,{entries:O}=c;let b=0;if(n!==void 0&&n!==c.drawDefinitions.length)return{error:Z,info:"drawDefintions count mismatch"};const{flightProfile:E}=ht({event:c}),T=t&&((l=E==null?void 0:E.flights)==null?void 0:l.find(j=>j.flightNumber===t.flightNumber)),N=(p=(d=(u=E==null?void 0:E.links)==null?void 0:u.find(j=>{var L;return((L=j==null?void 0:j.target)==null?void 0:L.drawId)===P}))==null?void 0:d.source)==null?void 0:p.drawId;if(N&&!c.drawDefinitions.find(j=>j.drawId===N))return{error:pe,sourceDrawId:N};if(T&&T.drawId!==a.drawId)return{error:Bi,relevantFlight:T};const U=y.every(({participantId:j,entryStatus:L})=>{const F=T==null?void 0:T.drawEntries.find(q=>q.participantId===j);return!L||(F==null?void 0:F.entryStatus)===L}),A=!i||O&&(y==null?void 0:y.every(({participantId:j,entryStatus:L,entryStage:F})=>{const q=O.find(G=>G.participantId===j&&(!G.entryStage||G.entryStage===F));return(q==null?void 0:q.entryStatus)===L}));if(T&&!U)return k({result:{error:Bi,context:{drawEntriesPresentInFlight:U,matchingEventEntries:A,relevantFlight:T},info:"Draw entries are not present in flight or do not match entryStatuses"}});if(r&&y.filter(Boolean).forEach(j=>{if(Ko.includes(j==null?void 0:j.entryStatus)){const L=O.filter(Boolean).find(F=>F.participantId===j.participantId);j.entryStatus&&L.entryStatus!==j.entryStatus&&(L.entryStatus=j.entryStatus,b+=1)}}),O&&!A)return k({result:{error:Bi,context:{matchingEventEntries:A,eventEntries:O},info:"Draw entries do not match event entryStatuses"}});const C=((f=(v=E==null?void 0:E.flights)==null?void 0:v.map(({flightNumber:j})=>!isNaN(j)&&parseInt(j)))==null?void 0:f.filter(Boolean))||[],M=((m=c.drawDefinitions.map(({drawOrder:j})=>!isNaN(j)&&parseInt(j)))==null?void 0:m.filter(Boolean))||[];let D=Math.max(0,...M,...C)+1;const V=(g=E==null?void 0:E.flights)==null?void 0:g.find(j=>j.drawId===P);let R;if(V){V.drawName=a.drawName,R={name:nn,value:Np(wp({},E),{flights:E.flights})};const j=V.flightNumber;j&&!M.includes(j)?D=j:V.flightNumber=D}else{const j=(E==null?void 0:E.flights)||[];j.push({manuallyAdded:!0,flightNumber:D,drawEntries:y,drawName:S,drawId:P}),R={name:nn,value:Np(wp({},E||{}),{flights:j})}}eo({event:c,extension:R}),Object.assign(a,{drawOrder:D});const W=c.drawDefinitions.find(j=>j.drawId===P),x=s==null?void 0:s.tournamentId,K=c.eventId;if(W){if(!o)return{error:tR};const j=(h=Er({drawDefinition:W}))==null?void 0:h.matchUps,L=j==null?void 0:j.map($t),F=(_=Er({drawDefinition:a}))==null?void 0:_.matchUps;if(!e){L!=null&&L.length&&Oi({matchUpIds:L,action:"modifyDrawDefinition",tournamentId:x,eventId:K}),F!=null&&F.length&&pi({matchUps:F,tournamentId:x,eventId:K}),c.drawDefinitions=c.drawDefinitions.map(G=>G.drawId===P?a:G);const q=(I=a.structures)==null?void 0:I.map(({structureId:G})=>G);Qe({drawDefinition:a,tournamentId:x,structureIds:q,eventId:K})}}else if(c.drawDefinitions.push(a),!e){const{matchUps:j}=Er({drawDefinition:a,event:c});pi({tournamentId:s==null?void 0:s.tournamentId,matchUps:j}),xc({drawDefinition:a,tournamentId:x,eventId:K})}return Np(wp({},B),{modifiedEventEntryStatusCount:b})}function DY({tournamentRecords:t,existingDrawCount:e,allowReplacement:r,drawDefinition:n,tournamentId:o,eventId:i,flight:s}){if(!i)return{error:Re};if(o=o||cm({tournamentRecords:t,eventId:i}),!o)return{error:so};const a=t[o];if(!a)return{error:ee};const c=Ft({tournamentRecord:a,eventId:i});return c.error?c:Xc({event:c.event,existingDrawCount:e,allowReplacement:r,drawDefinition:n,flight:s})}var jY=Object.defineProperty,RY=Object.defineProperties,FY=Object.getOwnPropertyDescriptors,MP=Object.getOwnPropertySymbols,VY=Object.prototype.hasOwnProperty,LY=Object.prototype.propertyIsEnumerable,DP=(t,e,r)=>e in t?jY(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,du=(t,e)=>{for(var r in e||(e={}))VY.call(e,r)&&DP(t,r,e[r]);if(MP)for(var r of MP(e))LY.call(e,r)&&DP(t,r,e[r]);return t},BY=(t,e)=>RY(t,FY(e));function An({allowDuplicateParticipantIdPairs:t,returnParticipant:e,tournamentRecord:r,disableNotice:n,pairOverride:o,participant:i}){var s,a,c;const l="addParticipant";if(!r)return{error:ee};if(!i)return k({result:{error:Vs},stack:l});i.participantId||(i.participantId=ke()),r.participants||(r.participants=[]);const{participantId:u,individualParticipantIds:d}=i;if(r.participants.reduce((_,I)=>I.participantId===u||_,!1))return{error:AR};const{participantType:v,participantRole:f}=i;if(!v||!Object.keys(ja).includes(v))return{error:bn,participantType:v};if(!f)return{error:$R};const m=r.participants||[],g=m.filter(_=>_.participantType===Ce).map(_=>_.participantId);if(v!==Ce&&i.person)return{error:Z,person:i.person};if(d&&!Array.isArray(d))return{error:Z,individualParticipantIds:d};if(v===we){if(i.person)return{error:Z,person:i.person};if(i.individualParticipantIds){if(i.individualParticipantIds.length!==2&&!o)return k({result:{error:Jr,info:"PAIR must be 2 individualParticipantIds"},stack:l});{const P=m.filter(y=>y.participantType===Ce).map(y=>y.participantId);if(!Array.isArray(i.individualParticipantIds))return k({result:{error:Jr},stack:l});if(!i.individualParticipantIds.reduce((y,O)=>P.includes(O)&&y,!0))return k({result:{error:Jr},stack:l})}}else return k({result:{error:co},stack:l});const _=m.filter(P=>P.participantType===we).map(P=>({individualParticipantIds:P.individualParticipantIds,participant:P})),I=i.participantType===we&&_.find(P=>Dt(P.individualParticipantIds,i.individualParticipantIds).length===2);if(I&&!t)return BY(du({},B),{existingParticipant:!0,participant:e&&de(I.participant)});if(!i.participantName){const P=m.filter(y=>{var O;return(O=i.individualParticipantIds)==null?void 0:O.includes(y.participantId)});let S=P.map(y=>{var O;return(O=y.person)==null?void 0:O.standardFamilyName}).filter(Boolean).join("/");P.length===1&&(S+="/Unknown"),i.participantName=S}}else if(v===Ce){if(!((s=i.person)!=null&&s.standardFamilyName)||!((a=i.person)!=null&&a.standardGivenName))return{error:DR};if(!i.participantName){const _=`${i.person.standardFamilyName.toUpperCase()}, ${i.person.standardGivenName}`;i.participantName=_}}else if(v&&[Ye,dr].includes(v)){if(d||(i.individualParticipantIds=[]),(c=i.individualParticipantIds)!=null&&c.length)for(const _ of i.individualParticipantIds){if(typeof _!="string")return k({result:{participantId:_,error:Z},stack:l});if(!g.includes(_))return k({result:{participantId:_,error:Tt},stack:l})}}else return{error:bn};r.participants.push(i),n||Le({payload:{tournamentId:r.tournamentId,participants:[i]},topic:ci});const h=du({participant:e&&de(i)},B);return _e(h)}function Zn({allowDuplicateParticipantIdPairs:t,returnParticipants:e,participants:r=[],tournamentRecord:n}){if(!n)return{error:ee};n.participants||(n.participants=[]);const i=n.participants.map(p=>p.participantId)||[];r.forEach(p=>{p.participantId||(p.participantId=ke())});const s=r.filter(p=>!i.includes(p.participantId)),a=r.filter(p=>i.includes(p.participantId)),c=s.filter(p=>p.participantType===Ce),l=s.filter(p=>p.participantType!==Ce),u=c.concat(...l),d=[];if(u.length){for(const v of u){const f=An({allowDuplicateParticipantIdPairs:t,returnParticipant:!0,disableNotice:!0,tournamentRecord:n,participant:v});if(f.error)return f;f.success&&!f.existingParticipant&&d.push(f.participant)}d.length&&Le({topic:ci,payload:{tournamentId:n.tournamentId,participants:d}});const p=du({participants:e&&de(d),addedCount:d.length},B);return a.length&&Object.assign(p,{notAdded:a,info:tv}),_e(p)}else return du({info:"No new participants to add",addedCount:0},B)}function xY({tournamentRecords:t,returnParticipant:e,pairOverride:r,tournamentId:n,participant:o}){if(typeof n!="string")return{error:so};const i=t[n];return i?An({returnParticipant:e,tournamentRecord:i,pairOverride:r,participant:o}):{error:ee}}function GY({event:t}){var e;const r=`${$r}.${Ar}`,{timeItem:n}=pn({element:t,itemType:r});if((e=n==null?void 0:n.itemValue)!=null&&e.PUBLIC){const{drawIds:o=[],seeding:i}=n.itemValue.PUBLIC||{},s={published:void 0,seedingScaleNames:[],drawIds:[]};return i&&Object.assign(s,n.itemValue.PUBLIC.seeding),{publishedDrawIds:o,publishedSeeding:s}}}function Ud({element:t,accessor:e}){if(typeof e!="string")return{values:[]};const r=de(t),n=e.split(".");let o,i=[];a({targetElement:r,attributes:n});const s={value:o};return i.length&&(s.values=i),s;function a({targetElement:c,attributes:l=[],significantCharacters:u}){for(const[p,v]of l.entries())if(c&&c[v])if(Array.isArray(c[v])){const f=c[v],m=l.slice(p);f.forEach(g=>a({targetElement:g,attributes:m}))}else c=c[v],d({targetElement:c,index:p});function d({targetElement:p,index:v}){if(p&&v===l.length-1&&["string","number"].includes(typeof p)){const f=u?p.slice(0,u):p;o?i.includes(f)||i.push(f):(o=f,i.push(f))}}}}function kn({requireTimeStamp:t,scaleAttributes:e,participant:r}){var n,o;if(!r)return{error:Vs};if(typeof e!="object")return{error:Z};if(r.timeItems||(r.timeItems=[]),r&&Array.isArray(r.timeItems)){const{accessor:i,scaleType:s,eventType:a,scaleName:c}=e,l=[es,s,a,c].join("."),d=r.timeItems.filter(p=>(p==null?void 0:p.itemType)===l).filter(p=>!t||(p==null?void 0:p.itemDate)).sort((p,v)=>(p.createdAt?new Date(p.createdAt).getTime():0)-(v.createdAt?new Date(v.createdAt).getTime():0)).pop();if(d){const[p,v,f,m]=(o=(n=d.itemType)==null?void 0:n.split("."))!=null?o:[];if(p!==es)return{error:Hu};const g=i&&Ud({element:d.itemValue,accessor:i}),h=(g==null?void 0:g.value)||d.itemValue;return{scaleItem:{scaleDate:d.itemDate,scaleName:m,scaleType:v,eventType:f,scaleValue:h}}}else return{error:zR}}return{error:Vs}}function kY({publishedSeeding:t,usePublishState:e,withSeeding:r,participant:n,event:o}){var i,s,a;const c={},l=f=>[es,Xr,o.eventType,f].join("."),u=Object.assign({},...(n.timeItems||[]).filter(({itemType:f})=>f.split(".")[1]===Xr).map(({itemType:f,itemValue:m})=>({[f]:m}))),d=((t==null?void 0:t.stageSeedingScaleNames)&&Object.values(t==null?void 0:t.stageSeedingScaleNames)||Array.isArray(t==null?void 0:t.seedingScaleNames)&&t.seedingScaleNames||[]).map(l),p=Dt(Object.keys(u),d);if(!!(!e||!Object.keys(u).length&&!((i=t==null?void 0:t.drawIds)!=null&&i.length)||p.length)&&p.length){if(t!=null&&t.stageSeedingScaleNames){const f=Object.keys(t.stageSeedingScaleNames).map(g=>{const h=l(t.stageSeedingScaleNames[g]),_=u[h];return[g,_]}).filter(g=>g[1]).map(g=>({[g[0]]:{seedValue:g[1]}})),m=Object.assign({},...f);c.seedAssignments=m}else if(p){const f=p.map(m=>u[m]);c.seedValue=f.pop()}}else if(!e&&typeof r=="object"){const f=Object.keys(r).map(g=>{const h=l(r[g]),_=u[h];return[g,_]}).filter(g=>g[1]).map(g=>({[g[0]]:{seedValue:g[1]}})),m=Object.assign({},...f);c.seedAssignments=m}else{const{categoryName:f,ageCategoryCode:m}=o.category||{};let g;for(const h of[m,o.eventId,f]){const _={eventType:o.eventType,scaleType:Xr,scaleName:h},I=kn({scaleAttributes:_,participant:n});if(I.scaleItem){g=I.scaleItem;break}}if(g&&(!e||(t==null?void 0:t.published)&&!((a=(s=t==null?void 0:t.published)==null?void 0:s.drawIds)!=null&&a.length))){const _=g.scaleValue;c.seedValue=_}}return c}var WY=Object.defineProperty,qY=Object.defineProperties,HY=Object.getOwnPropertyDescriptors,jP=Object.getOwnPropertySymbols,YY=Object.prototype.hasOwnProperty,KY=Object.prototype.propertyIsEnumerable,RP=(t,e,r)=>e in t?WY(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,gl=(t,e)=>{for(var r in e||(e={}))YY.call(e,r)&&RP(t,r,e[r]);if(jP)for(var r of jP(e))KY.call(e,r)&&RP(t,r,e[r]);return t},hl=(t,e)=>qY(t,HY(e));function kC({tournamentRecord:t,matchUpFormat:e,event:r}){if(!t)return{error:ee};if(!Br(e))return{error:xu};const{extension:n}=Po({event:r,name:wn}),o=n==null?void 0:n.value,{extension:i}=hr({tournamentRecord:t,name:wn}),s=i==null?void 0:i.value,a=(o==null?void 0:o.matchUpAverageTimes)&&Ba(hl(gl({},o),{matchUpFormat:e})),c=(s==null?void 0:s.matchUpAverageTimes)&&Ba(hl(gl({},s),{matchUpFormat:e})),l=[a,c].find(v=>v),u=(o==null?void 0:o.matchUpRecoveryTimes)&&xa(hl(gl({},o),{matchUpFormat:e})),d=(s==null?void 0:s.matchUpRecoveryTimes)&&xa(hl(gl({},s),{matchUpFormat:e})),p=[u,d].find(v=>v);return{matchUpFormat:e,averageTimes:l,recoveryTimes:p}}var zY=Object.defineProperty,QY=Object.defineProperties,JY=Object.getOwnPropertyDescriptors,FP=Object.getOwnPropertySymbols,ZY=Object.prototype.hasOwnProperty,XY=Object.prototype.propertyIsEnumerable,VP=(t,e,r)=>e in t?zY(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Wa=(t,e)=>{for(var r in e||(e={}))ZY.call(e,r)&&VP(t,r,e[r]);if(FP)for(var r of FP(e))XY.call(e,r)&&VP(t,r,e[r]);return t},pu=(t,e)=>QY(t,JY(e));function gm({tournamentRecord:t,matchUpFormat:e,averageTimes:r,recoveryTimes:n,event:o}){if(!t)return{error:ee};if(r&&!Array.isArray(r))return{error:Z};if(n&&!Array.isArray(n))return{error:Z};const i=wn;if(o){const{extension:s}=Po({event:o,name:i}),a=(s==null?void 0:s.value)||{},c=LP(pu(Wa({},a),{matchUpFormat:e,averageTimes:r,recoveryTimes:n}));eo({event:o,extension:{name:i,value:c}})}else{const{extension:s}=hr({tournamentRecord:t,name:i}),a=(s==null?void 0:s.value)||{},c=LP(pu(Wa({},a),{matchUpFormat:e,averageTimes:r,recoveryTimes:n}));_i({tournamentRecord:t,extension:{name:i,value:c}})}return Wa({},B)}function LP({matchUpAverageTimes:t=[],matchUpRecoveryTimes:e=[],averageTimes:r,recoveryTimes:n,matchUpFormat:o}){r=(r||[]).filter(a=>{var c,l;return((c=a==null?void 0:a.categoryNames)==null?void 0:c.length)||((l=a==null?void 0:a.categoryTypes)==null?void 0:l.length)});const i=(r==null?void 0:r.length)&&t.map(a=>{var c;return a!=null&&a.matchUpFormatCodes.includes(o)?pu(Wa({},a),{matchUpFormatCodes:(c=a.matchUpFormatCodes)==null?void 0:c.filter(l=>l!==o)}):a}).filter(({matchUpFormatCodes:a})=>a==null?void 0:a.length).concat({matchUpFormatCodes:[o],averageTimes:r});n=(n||[]).filter(a=>{var c,l;return((c=a==null?void 0:a.categoryNames)==null?void 0:c.length)||((l=a==null?void 0:a.categoryTypes)==null?void 0:l.length)});const s=(n==null?void 0:n.length)&&e.map(a=>{var c;return a!=null&&a.matchUpFormatCodes.includes(o)?pu(Wa({},a),{matchUpFormatCodes:(c=a.matchUpFormatCodes)==null?void 0:c.filter(l=>l!==o)}):a}).filter(({matchUpFormatCodes:a,averageTimes:c})=>(a==null?void 0:a.length)||c).concat({matchUpFormatCodes:[o],recoveryTimes:n});return{matchUpAverageTimes:(i==null?void 0:i.length)&&i||t,matchUpRecoveryTimes:(s==null?void 0:s.length)&&s||e}}function WC({tournamentRecord:t,recoveryMinutes:e,averageMinutes:r,matchUpFormat:n,categoryType:o,event:i}){if(!t)return{error:ee};if(!Br(n))return{error:Z};if(!i)return{error:Re};const{averageTimes:s=[],recoveryTimes:a=[]}=kC({tournamentRecord:t,matchUpFormat:n,event:i}),c=i.category,l=(c==null?void 0:c.categoryName)||(c==null?void 0:c.ageCategoryCode)||(i==null?void 0:i.eventId);let u={categoryNames:[l],minutes:{}},d={categoryNames:[l],minutes:{}};const p=h=>{var _,I;if((_=h.categoryTypes)!=null&&_.includes(o)&&console.log("encountered:",{categoryType:o}),!((I=h.categoryNames)!=null&&I.includes(l)&&(h.categoryNames=h.categoryNames.filter(P=>P!==l),u={minutes:h.minutes,categoryNames:[l]},!h.categoryNames.length)))return h},v=!isNaN(parseInt(r)),f=!isNaN(parseInt(e)),m=s.map(p).filter(h=>{var _;return(_=h==null?void 0:h.categoryNames)==null?void 0:_.length}),g=a.map(p).filter(h=>{var _;return(_=h==null?void 0:h.categoryNames)==null?void 0:_.length});return v&&(Object.assign(u.minutes,{[(i==null?void 0:i.eventType)||ut]:r}),m.push(u)),f&&(Object.assign(d.minutes,{[(i==null?void 0:i.eventType)||ut]:e}),g.push(d)),!v&&!f?{error:Z}:gm({tournamentRecord:t,event:i,matchUpFormat:n,averageTimes:v&&m,recoveryTimes:f&&g})}function e5({tournamentRecords:t,recoveryMinutes:e,averageMinutes:r,matchUpFormat:n,categoryType:o,tournamentId:i,eventId:s}){if(!s)return{error:Re};const a=Object.keys(t).filter(c=>!i||i===c);if(i&&!a.includes(i))return{error:Z};for(const c of a){const l=t[c],{event:u}=Ft({tournamentRecord:l,eventId:s});if(u)return WC({tournamentRecord:l,recoveryMinutes:e,averageMinutes:r,matchUpFormat:n,categoryType:o,event:u})}return{error:Pr}}const el=({scheduleAttributes:t=["scheduledDate","scheduledTime"],schedule:e={}})=>!!Object.keys(e).filter(n=>t.includes(n)).filter(n=>e[n]).length;var t5=Object.defineProperty,r5=Object.defineProperties,n5=Object.getOwnPropertyDescriptors,BP=Object.getOwnPropertySymbols,o5=Object.prototype.hasOwnProperty,i5=Object.prototype.propertyIsEnumerable,xP=(t,e,r)=>e in t?t5(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,s5=(t,e)=>{for(var r in e||(e={}))o5.call(e,r)&&xP(t,r,e[r]);if(BP)for(var r of BP(e))i5.call(e,r)&&xP(t,r,e[r]);return t},a5=(t,e)=>r5(t,n5(e));function tl({tournamentRecord:t}){if(!t)return{error:ee};const e=(({tournamentId:r,tournamentRank:n,tournamentStatus:o,formalName:i,tournamentName:s,promotionalName:a,onlineResources:c,localTimeZone:l,startDate:u,endDate:d,hostCountryCode:p,tournamentContacts:v,tournamentAddresses:f})=>({tournamentId:r,tournamentRank:n,tournamentStatus:o,formalName:i,tournamentName:s,promotionalName:a,onlineResources:c,localTimeZone:l,startDate:u,endDate:d,hostCountryCode:p,tournamentContacts:v,tournamentAddresses:f}))(t);return a5(s5({},B),{tournamentInfo:de(e,!1,!0)})}var c5=Object.defineProperty,fu=Object.getOwnPropertySymbols,qC=Object.prototype.hasOwnProperty,HC=Object.prototype.propertyIsEnumerable,GP=(t,e,r)=>e in t?c5(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,kP=(t,e)=>{for(var r in e||(e={}))qC.call(e,r)&&GP(t,r,e[r]);if(fu)for(var r of fu(e))HC.call(e,r)&&GP(t,r,e[r]);return t},WP=(t,e)=>{var r={};for(var n in t)qC.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&fu)for(var n of fu(t))e.indexOf(n)<0&&HC.call(t,n)&&(r[n]=t[n]);return r};function YC({derivedDrawInfo:t,participantId:e,drawId:r}){var n,o,i,s;const a=(o=(n=t[r])==null?void 0:n.mainPositionAssignments)==null?void 0:o.find(u=>u.participantId===e),c=(s=(i=t[r])==null?void 0:i.qualifyingPositionAssignments)==null?void 0:s.find(u=>u.participantId===e),l={};if(a){const u=a,{participantId:d}=u,p=WP(u,["participantId"]);d&&(l[ue]=kP({},p))}if(c){const u=c,{participantId:d}=u,p=WP(u,["participantId"]);d&&(l[Ie]=kP({},p))}return Object.keys(l).length?l:void 0}function l5({processParticipantId:t,tournamentRecords:e,tournamentRecord:r}){if(typeof r!="object"&&typeof e!="object")return{error:ee};const n=e?Object.values(e).map(({participants:i=[]})=>i).flat():r.participants||[];return{relevantParticipantIdsMap:Object.assign({},...n.map(({participantId:i,participantType:s,individualParticipantIds:a})=>{typeof t=="function"&&t(i);const c=(a||[]).map(l=>({participantType:Ce,relevantParticipantId:l}));return{[i]:c.concat({relevantParticipantId:i,participantType:s})}}))}}var u5=Object.defineProperty,vu=Object.getOwnPropertySymbols,KC=Object.prototype.hasOwnProperty,zC=Object.prototype.propertyIsEnumerable,qP=(t,e,r)=>e in t?u5(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,HP=(t,e)=>{for(var r in e||(e={}))KC.call(e,r)&&qP(t,r,e[r]);if(vu)for(var r of vu(e))zC.call(e,r)&&qP(t,r,e[r]);return t},YP=(t,e)=>{var r={};for(var n in t)KC.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&vu)for(var n of vu(t))e.indexOf(n)<0&&zC.call(t,n)&&(r[n]=t[n]);return r};function mu({derivedDrawInfo:t,participantId:e,drawId:r}){var n,o,i,s;const a=(o=(n=t[r])==null?void 0:n.mainSeedAssignments)==null?void 0:o.find(u=>u.participantId===e),c=(s=(i=t[r])==null?void 0:i.qualifyingSeedAssignments)==null?void 0:s.find(u=>u.participantId===e),l={};if(a){const u=a,{participantId:d}=u,p=YP(u,["participantId"]);d&&(l[ue]=HP({},p))}if(c){const u=c,{participantId:d}=u,p=YP(u,["participantId"]);d&&(l[Ie]=HP({},p))}return Object.keys(l).length?l:void 0}function QC({matchUps:t=[],scheduleAttributes:e=["scheduledDate","scheduledTime"]}){if(!Array.isArray(t))return{error:ko};if(!Array.isArray(e))return{error:Z};const r=t.filter(Boolean).filter(({schedule:o})=>el({schedule:o,scheduleAttributes:e})).reduce((o,i)=>{const{schedule:s}=i,a=Me(s==null?void 0:s.scheduledDate),c=tt(s==null?void 0:s.scheduledTime);return a&&c&&(o[a]?o[a].push(i):o[a]=[i]),o},{});return Object.keys(r).forEach(o=>{r[o].sort((i,s)=>{var a,c;return VA(tt((a=i.schedule)==null?void 0:a.scheduledTime),tt((c=s.schedule)==null?void 0:c.scheduledTime))})}),{scheduledMatchUps:r}}var d5=Object.defineProperty,p5=Object.defineProperties,f5=Object.getOwnPropertyDescriptors,KP=Object.getOwnPropertySymbols,v5=Object.prototype.hasOwnProperty,m5=Object.prototype.propertyIsEnumerable,zP=(t,e,r)=>e in t?d5(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,g5=(t,e)=>{for(var r in e||(e={}))v5.call(e,r)&&zP(t,r,e[r]);if(KP)for(var r of KP(e))m5.call(e,r)&&zP(t,r,e[r]);return t},h5=(t,e)=>p5(t,f5(e));function _5({withScaleValues:t=!0,eventsPublishStatuses:e,withEvents:r=!0,withDraws:n=!0,participantIdMap:o,scheduleAnalysis:i,derivedDrawInfo:s,usePublishState:a,withStatistics:c,withOpponents:l,withMatchUps:u,withSeeding:d,participant:p,withISO2:v,withIOC:f}){var m,g,h,_,I,P,S,y,O,b;const E=[],T=[];if((f||v)&&md({participant:p,withIOC:f,withISO2:v}),t){const{ratings:z,rankings:Y}=ga({participant:p});p.rankings=Y,p.ratings=z}const N=p==null?void 0:p.participantId;if(!N||!o[N])return{};const{potentialMatchUps:w,opponents:$,matchUps:U,events:A,losses:C,draws:M,wins:D}=o[N],V=D+C,R=D,W=V&&R/V,x={statCode:La,denominator:V,numerator:R,statValue:W},K=Object.values(M),j=Object.values(A);if(n&&K){p.draws=K;for(const z of K){const Y=(m=e[z.eventId])==null?void 0:m.publishedSeeding;if(!a||(Y==null?void 0:Y.published)&&(((g=Y==null?void 0:Y.drawIds)==null?void 0:g.length)===0||((h=Y==null?void 0:Y.drawIds)==null?void 0:h.includes(z.drawId)))){const te=mu({drawId:z.drawId,derivedDrawInfo:s,participantId:N});te&&(z.seedAssignments=te)}}}if(r&&j&&(p.events=j,d)){const z=Object.assign({},...(p.timeItems||[]).filter(({itemType:Y})=>Y.split(".")[1]===Xr).map(({itemType:Y,itemValue:J})=>({[Y]:J})));for(const Y of j){const J=ve=>[es,Xr,Y.eventType,ve].join("."),te=(_=e[Y.eventId])==null?void 0:_.publishedSeeding,ne=((te==null?void 0:te.stageSeedingScaleNames)&&Object.values(te==null?void 0:te.stageSeedingScaleNames)||Array.isArray(te==null?void 0:te.seedingScaleNames)&&te.seedingScaleNames||[]).map(J),oe=Dt(Object.keys(z),ne),se=!!(!a||!Object.keys(z).length&&!((I=te==null?void 0:te.drawIds)!=null&&I.length)||oe.length);if(se&&oe.length){if(te!=null&&te.stageSeedingScaleNames){const ve=Object.keys(te.stageSeedingScaleNames).map(ie=>{const fe=J(te.stageSeedingScaleNames[ie]),Ee=z[fe];return[ie,Ee]}).filter(ie=>ie[1]).map(ie=>({[ie[0]]:{seedValue:ie[1]}})),X=Object.assign({},...ve);Y.seedAssignments=X}else if(oe){const ve=oe.map(X=>z[X]);Y.seedValue=ve.pop()}}else if(!a&&typeof d=="object"){const ve=Object.keys(d).map(ie=>{const fe=J(d[ie]),Ee=z[fe];return[ie,Ee]}).filter(ie=>ie[1]).map(ie=>({[ie[0]]:{seedValue:ie[1]}})),X=Object.assign({},...ve);Y.seedAssignments=X}else{const{categoryName:ve,ageCategoryCode:X}=Y.category||{};let ie;for(const fe of[Y.eventId,X,ve]){const Ee={eventType:Y.eventType,scaleType:Xr,scaleName:fe},re=kn({scaleAttributes:Ee,participant:p});if(re.scaleItem){ie=re.scaleItem;break}}if(ie){const fe=ie.scaleValue;(!a||(te==null?void 0:te.published)&&(((P=te==null?void 0:te.drawIds)==null?void 0:P.length)===0||((S=te==null?void 0:te.drawIds)==null?void 0:S.includes(Y.drawId))))&&(Y.seedValue=fe)}}if((y=Y.drawIds)!=null&&y.length)for(const ve of Y.drawIds||[]){const X=((O=te==null?void 0:te.drawIds)==null?void 0:O.length)&&!((b=te==null?void 0:te.drawIds)!=null&&b.includes(ve));if(se&&!X){const ie=mu({drawId:ve,derivedDrawInfo:s,participantId:N});if(ie&&Y.seedAssignments)for(const fe of Object.keys(Y.seedAssignments))Y.seedAssignments[fe]=ie[fe];else Y.seedAssignments=ie}}}}const L=Object.values($).flat();l&&(L!=null&&L.length)&&(p.opponents=L,K==null||K.forEach(z=>{z.opponents=L.filter(Y=>Y.drawId===z.drawId)}));const F=Object.values(w),q=Object.values(U);u&&(p.potentialMatchUps=F,p.matchUps=q);const G=q.concat(F),{scheduledMatchUps:H}=QC({matchUps:G}),{scheduledMinutesDifference:Q}=i||{};return Object.keys(H).forEach(z=>{H[z].filter(Boolean).forEach((Y,J)=>{var te,ne,oe,se;const{schedule:{scheduledTime:ve,timeAfterRecovery:X,typeChangeTimeAfterRecovery:ie},matchUpStatus:fe,roundPosition:Ee,structureName:re,matchUpType:ae,roundNumber:me,matchUpId:Oe,drawId:ce,score:Pe}=Y;T.push(h5(g5({},Y.schedule),{scheduledTime:tt((te=Y.schedule)==null?void 0:te.scheduledTime),roundPosition:Ee,structureName:re,matchUpType:ae,roundNumber:me,matchUpId:Oe,drawId:ce}));const $e=fe===qe||[Ge,Be].includes(fe)&&!At({score:Pe});if(ve&&!$e){const ye=je(ve),Ae=H[z].slice(J+1);for(const be of Ae)if(!(be.matchUpStatus===qe||[Ge,Be].includes(be.matchUpStatus)&&!At(be))&&((ne=be.schedule)!=null&&ne.scheduledTime)){const Ue=Y.matchUpType!==be.matchUpType&&ie||X,he=Y.drawId===be.drawId,xe=Y.potential&&be.potential,Je=je((oe=be.schedule)==null?void 0:oe.scheduledTime)-ye;(Q&&!isNaN(Q)?Je<=Q:je(Ue)>je((se=be.schedule)==null?void 0:se.scheduledTime))&&!(xe&&he)&&E.push({priorScheduledMatchUpId:be.matchUpId,matchUpIdWithConflict:Oe})}}})}),c&&(p.statistics=[x]),{scheduleConflicts:E,scheduleItems:T}}function I5({event:t,eventEntries:e,sortConfig:r}){const n={},o=Object.assign({},...(t.drawDefinitions||[]).map(i=>{var s,a,c,l,u,d,p,v,f;const m=Object.assign({},...(e||[]).filter(N=>N.participantId).map(N=>({[N.participantId]:N})),...i.entries.filter(N=>N.participantId).map(N=>({[N.participantId]:N}))),g=Object.values(m),h=(a=(s=Ur({stageSequence:1,drawDefinition:i,stage:ue}))==null?void 0:s.structures)==null?void 0:a[0],_=h&&((c=Xe({structure:h}))==null?void 0:c.positionAssignments),I=_==null?void 0:_.length,P=(u=(l=Ur({stageSequence:1,stage:Ie,drawDefinition:i}))==null?void 0:l.structures)==null?void 0:u[0],S=h&&((d=Xe({structure:P}))==null?void 0:d.positionAssignments),y=S==null?void 0:S.length,O=h==null?void 0:h.seedAssignments,b=P==null?void 0:P.seedAssignments,E=(i.structures||[]).sort((N,w)=>yi(N,w,r)).map(({structureId:N,structures:w})=>[N,...(w||[]).map(({structureId:$})=>$)]).flat(1/0),T=(f=(v=(p=t==null?void 0:t._flightProfile)==null?void 0:p.flights)==null?void 0:v.find(N=>N.drawId===i.drawId))==null?void 0:f.flightNumber;return n[i.drawId]={qualifyingPositionAssignments:S,qualifyingSeedAssignments:b,mainPositionAssignments:_,mainSeedAssignments:O,orderedStructureIds:E,qualifyingDrawSize:y,flightNumber:T,drawSize:I},{[i.drawId]:{drawType:i.drawType,drawEntries:g}}}));return{derivedInfo:n,drawDetails:o}}function P5({relevantParticipantIdsMap:t,participantFilters:e,participantIdMap:r,derivedDrawInfo:n,eventDrawsCount:o,drawDetails:i,eventType:s,matchUp:a}){var c;const{collectionId:l,collectionPosition:u,drawId:d,drawName:p,eventId:v,eventName:f,finishingRound:m,finishingPositionRange:g,processCodes:h,loserTo:_,matchUpId:I,matchUpType:P,matchUpFormat:S,matchUpStatus:y,matchUpStatusCodes:O,matchUpTieId:b,roundName:E,roundNumber:T,roundPosition:N,score:w,sides:$,stage:U,stageSequence:A,schedule:C,structureName:M,structureId:D,tieFormat:V,tieMatchUps:R,tournamentId:W,winnerTo:x,winningSide:K}=a,j=e==null?void 0:e.participantIds,L=H=>{const Q=H&&t[H]||[];return Q.push(H),Q.some(z=>!j||j.includes(z.relevantParticipantId))?Q:[]},{winner:F,loser:q}=g||{},G=(R==null?void 0:R.length)&&R.filter(({matchUpType:H})=>H===Kr).map(({sides:H})=>H.map(({sideNumber:Q,participantId:z,participant:Y})=>Q&&z&&{sideNumber:Q,participantId:z,participant:Y})).flat().filter(Boolean)||[];if(s===gn&&P===Kr){const H=(((c=a.sides)==null?void 0:c.filter(Boolean))||[]).map(({sideNumber:Q,participantId:z,participant:Y})=>Q&&z&&{sideNumber:Q,participantId:z,participant:Y}).filter(Boolean);G.push(...H)}if($==null||$.forEach(({participantId:H,sideNumber:Q}={})=>{if(!H)return;const{drawType:z,drawEntries:Y}=i[d],J=Q===1?w==null?void 0:w.scoreStringSide1:w==null?void 0:w.scoreStringSide2,te=K&&Q===K,ne=a.sides.find(({sideNumber:re}={})=>re===3-Q),oe=ne==null?void 0:ne.participantId,se=oe&&t[oe]||[],ve=te?F:q,X=Y.find(re=>re.participantId===H),ie=L(H),fe=[];G==null||G.filter(re=>re.sideNumber===Q).forEach(({participantId:re})=>{re&&!fe.includes(re)&&(ie.push({relevantParticipantId:re,participantType:we}),fe.push(re))});const Ee=ie.filter(re=>s!==gn||s===gn&&[Kr,Qr].includes(P)&&[we,hn].includes(re.participantType)||s===gn&&[ri,Kr].includes(P)&&[Ce].includes(re.participantType));Ee==null||Ee.forEach(({relevantParticipantId:re,participantType:ae})=>{var me,Oe;const{entryStage:ce,entryStatus:Pe,entryPosition:$e}=X||{};if(!r[re])return;if(!r[re].draws[d]){const Ue=YC({participantId:re,derivedDrawInfo:n,drawId:d}),he=mu({participantId:re,derivedDrawInfo:n,drawId:d});r[re].draws[d]=_e({qualifyingDrawSize:(me=n[d])==null?void 0:me.qualifyingDrawSize,drawSize:(Oe=n[d])==null?void 0:Oe.drawSize,partnerParticipantIds:[],positionAssignments:Ue,seedAssignments:he,entryPosition:$e,entryStatus:Pe,entryStage:ce,drawName:p,drawType:z,eventId:v,drawId:d})}r[re].events[v]||(r[re].events[v]={partnerParticipantIds:[],drawIds:[],eventName:f,eventId:v});const ye=r[re].events[v].drawIds;ye&&!(ye!=null&&ye.includes(d))&&r[re].events[v].drawIds.push(d);let Ae;if(ae===Ce&&P===Kr){const Ue=Ee.find(he=>he.relevantParticipantId!==re&&he.participantType===Ce);Ae=Ue==null?void 0:Ue.relevantParticipantId}const be=(se==null?void 0:se.filter(Ue=>P===Qr&&ae===hn&&Ue.participantType===hn||P===ri&&Ue.participantType===Ce||P===Kr&&(ae===Ce?[Ce,we].includes(Ue.participantType):Ue.participantType===we)))||[];be.forEach(({relevantParticipantId:Ue,participantType:he})=>{r[re].opponents||(r[re].opponents={}),r[re].opponents[Ue]={eventId:v,drawId:d,matchUpId:I,participantType:he,participantId:Ue}});const ge=be.map(({relevantParticipantId:Ue,participantType:he})=>({participantId:Ue,participantType:he}));(P!==Qr&&[Ce,we].includes(ae)||P===Qr&&ae===hn)&&(r[re].matchUps[I]=_e({collectionId:l,collectionPosition:u,drawId:d,eventId:v,eventType:s,eventDrawsCount:o,finishingRound:m,finishingPositionRange:ve,loserTo:_,matchUpId:I,matchUpType:P,matchUpFormat:S,matchUpStatus:y,matchUpStatusCodes:O,matchUpTieId:b,opponentParticipantInfo:ge,participantWon:te,partnerParticipantId:Ae,perspectiveScoreString:J,processCodes:h,roundName:E,roundNumber:T,roundPosition:N,schedule:C,score:w,sides:$,stage:U,stageSequence:A,structureName:M,structureId:D,tieFormat:V,tournamentId:W,winnerTo:x,winningSide:K})),Ae&&(r[re].events[v].partnerParticipantIds.push(Ae),r[re].draws[d].partnerParticipantIds.push(Ae),r[re].events[v].partnerParticipantId=Ae,r[re].draws[d].partnerParticipantId=Ae),K&&(te?r[re].wins++:r[re].losses++)})}),Array.isArray(a.potentialParticipants)){const H=Jn(a.potentialParticipants.flat());H==null||H.forEach(Q=>{const z=L(Q);z==null||z.forEach(({relevantParticipantId:Y})=>{r[Y].potentialMatchUps[I]=_e({drawId:d,eventId:v,eventType:s,matchUpId:I,matchUpType:P,matchUpFormat:S,roundName:E,roundNumber:T,roundPosition:N,schedule:C,tieFormat:V,structureName:M,tournamentId:W,potential:!0})})})}}var y5=Object.defineProperty,O5=Object.defineProperties,S5=Object.getOwnPropertyDescriptors,QP=Object.getOwnPropertySymbols,b5=Object.prototype.hasOwnProperty,T5=Object.prototype.propertyIsEnumerable,JP=(t,e,r)=>e in t?y5(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,$p=(t,e)=>{for(var r in e||(e={}))b5.call(e,r)&&JP(t,r,e[r]);if(QP)for(var r of QP(e))T5.call(e,r)&&JP(t,r,e[r]);return t},Ap=(t,e)=>O5(t,S5(e));function E5(t){var e,r;const n=[],o={},i={},s={},a=f=>{s[f]||(s[f]={groupParticipantIds:[],teamParticipantIds:[],pairParticipantIds:[],potentialMatchUps:{},scheduleItems:[],opponents:{},matchUps:{},events:{},groups:[],teams:[],draws:{},losses:0,wins:0})},{tournamentRecord:c,participantFilters:l,allTournamentParticipants:u}=t,{relevantParticipantIdsMap:d}=l5({processParticipantId:a,tournamentRecord:c}),p=l==null?void 0:l.participantIds,v=f=>{const m=f&&d[f]||[];return m.push(f),m.some(g=>!p||p.includes(g.relevantParticipantId))?m:[]};return t.withGroupings&&u.forEach(f=>{var m,g,h;if(f.participantType===dr){const _=f.participantId;(m=f==null?void 0:f.individualParticipantIds)==null||m.forEach(I=>{s[I].groupParticipantIds.includes(_)||(s[I].groupParticipantIds.push(_),s[I].groups.push({participantRoleResponsibilities:f.participantRoleResponsibilities,participantOtherName:f.participantOtherName,participantName:f.participantName,participantId:f.participantId}))})}if(f.participantType===We){const _=f.participantId;(g=f==null?void 0:f.individualParticipantIds)==null||g.forEach(I=>{var P,S,y,O;(S=(P=s[I])==null?void 0:P.teamParticipantIds)!=null&&S.includes(_)||((y=s[I])==null||y.teamParticipantIds.push(_),(O=s[I])==null||O.teams.push({participantRoleResponsibilities:f.participantRoleResponsibilities,participantOtherName:f.participantOtherName,participantName:f.participantName,participantId:f.participantId,teamId:f.teamId}))})}if(f.participantType===we){const _=f.participantId;(h=f==null?void 0:f.individualParticipantIds)==null||h.forEach(I=>{s[I]&&!s[I].pairParticipantIds.includes(_)&&s[I].pairParticipantIds.push(_)})}}),t.withMatchUps&&qr({tournamentRecord:c}),(t.withScheduleItems||t.scheduleAnalysis||t.withStatistics||t.withOpponents||t.withMatchUps||t.withSeeding||t.withEvents||t.withDraws)&&((e=t.tournamentEvents)==null||e.forEach(f=>{var m,g,h,_,I,P,S;const y=de(f,!0,!0),O=ht({event:y}).flightProfile,b=((m=O==null?void 0:O.flights)==null?void 0:m.length)||((g=y.drawDefinitions)==null?void 0:g.length)||0;(y.drawDefinitions||[]).forEach((L,F)=>{if((y==null?void 0:y.eventType)===We){const{extension:q}=Lt({element:f.drawDefinitions[F],name:En});q&&(L.extensions=[q])}});const{eventId:E,eventName:T,eventType:N,category:w}=y,$={eventId:E,eventName:T,eventType:N,category:w},U=y&&Object.keys(y).filter(L=>L.startsWith("_"));U==null||U.forEach(L=>$[L]=y[L]);const A=y.entries||[],C=`${$r}.${Ar}`,{timeItem:M}=yo({itemType:C,event:y});if((h=M==null?void 0:M.itemValue)!=null&&h.PUBLIC){const{drawIds:L=[],seeding:F}=M.itemValue.PUBLIC||{},q={published:void 0,seedingScaleNames:[],drawIds:[]};F&&Object.assign(q,M.itemValue.PUBLIC.seeding),o[E]={publishedDrawIds:L,publishedSeeding:q}}const V=[].concat(...Object.values(XA)).map(L=>`_${L}`),R=$&&Object.keys($).filter(L=>!V.includes(L)).reduce((L,F)=>(L[F]=$[F],L),{});A==null||A.filter(L=>L==null?void 0:L.participantId).forEach(L=>{const{participantId:F,entryStage:q,entryStatus:G,entryPosition:H}=L,Q=v(F);Q==null||Q.forEach(({relevantParticipantId:z})=>{s[z]||a(z),s[z].events[E]=Ap($p({},R),{partnerParticipantIds:[],entryPosition:H,entryStatus:G,entryStage:q,drawIds:[],eventId:E})})});const W=({drawEntry:L,drawId:F})=>{const{participantId:q,entryStage:G,entryStatus:H,entryPosition:Q}=L,z=v(q);z==null||z.forEach(({relevantParticipantId:Y})=>{var J,te;if(s[Y].events[E]||(s[Y].events[E]=Ap($p({},R),{partnerParticipantIds:[],entryPosition:Q,entryStatus:H,entryStage:G,drawIds:[],eventId:E})),!s[Y].draws[F]){const oe=YC({participantId:Y,derivedDrawInfo:i,drawId:F}),se=mu({participantId:Y,derivedDrawInfo:i,drawId:F});s[Y].draws[F]=_e({qualifyingDrawSize:(J=i[F])==null?void 0:J.qualifyingDrawSize,drawSize:(te=i[F])==null?void 0:te.drawSize,partnerParticipantIds:[],positionAssignments:oe,eventDrawsCount:b,seedAssignments:se,entryPosition:Q,entryStatus:H,entryStage:G,eventId:E,drawId:F})}const ne=s[Y].events[E].drawIds;ne&&!(ne!=null&&ne.includes(F))&&s[Y].events[E].drawIds.push(F)})},x=((_=y.drawDefinitions)==null?void 0:_.map(({drawId:L})=>L))||[];(P=(I=$._flightProfile)==null?void 0:I.flights)==null||P.forEach(L=>{const{drawId:F,drawEntries:q}=L;x.includes(F)||q==null||q.forEach(G=>W({drawEntry:G,drawId:F}))});const{drawDetails:K,derivedInfo:j}=I5({eventEntries:A,event:y});if(Object.assign(i,j),y.eventType===We||t.withScheduleItems||t.scheduleAnalysis||t.withStatistics||t.withOpponents||t.withMatchUps||t.withDraws){const L=(S=Si({afterRecoveryTimes:t.scheduleAnalysis,participants:u,nextMatchUps:!0,tournamentRecord:c,inContext:!0,event:y}))==null?void 0:S.matchUps;L==null||L.forEach(F=>P5({relevantParticipantIdsMap:d,participantFilters:l,participantIdMap:s,derivedDrawInfo:i,eventDrawsCount:b,drawDetails:K,eventType:N,matchUp:F}))}})),(r=t.tournamentParticipants)==null||r.forEach(f=>{const{scheduleConflicts:m,scheduleItems:g}=_5(Ap($p({},t),{eventsPublishStatuses:o,participantIdMap:s,derivedDrawInfo:i,participant:f}));if(t.withSignInStatus){const{timeItem:h}=pn({itemType:$c,element:f});f.signedIn=(h==null?void 0:h.itemValue)===nc}if(t.withScheduleItems&&(f.scheduleItems=g),t.scheduleAnalysis&&(f.scheduleConflicts=m,m!=null&&m.length&&!n.includes(f.participantId)&&n.push(f.participantId)),t.withGroupings!==!1){const h=s[f.participantId];f.groupParticipantIds=h==null?void 0:h.groupParticipantIds,f.pairParticipantIds=h==null?void 0:h.pairParticipantIds,f.teamParticipantIds=h==null?void 0:h.teamParticipantIds,f.groups=h==null?void 0:h.groups,f.teams=h==null?void 0:h.teams}t.withTeamMatchUps}),{participantIdsWithConflicts:n,eventsPublishStatuses:o}}function Cd({participantFilters:t={},tournamentRecord:e,participants:r=[]}){var n;if(!Object.keys(t).length)return r;const{accessorValues:o,drawEntryStatuses:i,positionedParticipants:s,eventEntryStatuses:a,participantRoles:c,participantRoleResponsibilities:l,participantTypes:u,participantIds:d,signInStatus:p,enableOrFiltering:v,eventIds:f,genders:m}=t,g=Fn(f)&&((n=e==null?void 0:e.events)==null?void 0:n.filter(S=>f.includes(S.eventId)))||(e==null?void 0:e.events)||[],h=i&&w5({drawEntryStatuses:i,tournamentEvents:g}),_=a&&N5({eventEntryStatuses:a,tournamentEvents:g}),I=[!0,!1].includes(s)&&g.reduce((S,y)=>S.concat(...(y.drawDefinitions||[]).map(O=>QU({drawDefinition:O}).allPositionedParticipantIds).filter(Boolean)),[]),P=S=>o.reduce((y,O)=>{const{accessor:b,value:E}=O,{values:T}=Ud({element:S,accessor:b});return y&&(T==null?void 0:T.includes(E))},!0);if(r=r==null?void 0:r.filter(S=>{const y=pn({element:S,itemType:$c}),{participantRoleResponsibilities:O,participantType:b,participantRole:E,participantId:T,person:N}=S,w=Array.isArray(m)&&(m==null?void 0:m.length)&&(N==null?void 0:N.sex)&&m.includes(N.sex);return v?m&&w||s&&I.includes(T)||s===!1&&!I.includes(T)||(h==null?void 0:h.includes(T))||(_==null?void 0:_.includes(T))||(d==null?void 0:d.includes(T))||p&&y===p||u&&Fn(u)&&u.includes(b)||c&&Fn(c)&&c.includes(E)||l&&Fn(O)&&Fn(l)&&l.find($=>O==null?void 0:O.includes($))||(o==null?void 0:o.length)&&Fn(o)&&P(S):(!m||w)&&(s===void 0||s&&I.includes(T)||s===!1&&!I.includes(T))&&(!h||h.includes(T))&&(!_||_.includes(T))&&(!d||d.includes(T))&&(!p||y===p)&&(!u||Fn(u)&&u.includes(b))&&(!c||Fn(c)&&c.includes(E))&&(!l||Fn(O)&&Fn(l)&&l.find($=>O==null?void 0:O.includes($)))&&(!(o!=null&&o.length)||Fn(o)&&P(S))}),g.length&&f){const S=g.filter(y=>f.includes(y.eventId)).map(y=>{const O=(y.entries||[]).map(E=>E.participantId);if(y.eventType===Yn)return O;const b=((e==null?void 0:e.participants)||[]).filter(E=>O.includes(E.participantId)).map(E=>E.individualParticipantIds).flat(1);return O.concat(...b)}).flat(1);r=r==null?void 0:r.filter(y=>S.includes(y.participantId))}return r}function Fn(t){return t&&Array.isArray(t)&&t.length}function w5({drawEntryStatuses:t,tournamentEvents:e}){const r=({entryStatus:n})=>Array.isArray(t)?t.includes(n):!0;return Ve(e.reduce((n,o)=>{var i,s;const{flightProfile:a}=ht({event:o}),c=((i=a==null?void 0:a.flights)==null?void 0:i.map(({drawEntries:u})=>Array.isArray(u)?u.filter(r).map(Ze):[]).flat())||[],l=((s=o.drawDefinitions)==null?void 0:s.map(({entries:u})=>u?u.filter(r).map(Ze):[]))||[];return n.concat(...c,...l)},[]))}function N5({eventEntryStatuses:t,tournamentEvents:e}){return Ve(e.reduce((r,n)=>{const o=(n.entries||[]).filter(({entryStatus:i})=>Array.isArray(t)?t.includes(i):!0).map(Ze);return r.concat(...o)},[]))}function Kt({participantFilters:t={},convertExtensions:e,policyDefinitions:r,withScheduleItems:n,scheduleAnalysis:o,withSignInStatus:i,withTeamMatchUps:s,tournamentRecord:a,usePublishState:c,withScaleValues:l,withStatistics:u,withGroupings:d,withOpponents:p,withMatchUps:v,withSeeding:f,withEvents:m,withDraws:g,inContext:h,withISO2:_,withIOC:I}){if(!a)return{error:ee};if(!a.participants)return{error:Ic};const P=a.participants.map(T=>de(T,e));if(typeof t!="object")return{error:Xn,participantFilters:t};h&&(P==null||P.forEach(T=>{var N;[we,Ye,dr].includes(T.participantType)&&(T.individualParticipants=(N=T.individualParticipantIds)==null?void 0:N.map(w=>{const $=a.participants.find(A=>A.participantId===w),U=de($,e,!0);if(l){const{ratings:A,rankings:C}=ga({participant:U});U.ratings=A,U.rankings=C}return(I||_)&&md({participant:U,withISO2:_,withIOC:I}),U}))}));let S=t?Cd({participants:P,participantFilters:t,tournamentRecord:a}):P,y,O;if(n||i||o||l||u||d||p||v||f||m||g||_||I){const T=E5({tournamentEvents:a.events,allTournamentParticipants:P,tournamentParticipants:S,participantFilters:t,withScheduleItems:n,withSignInStatus:i,tournamentRecord:a,scheduleAnalysis:o,withTeamMatchUps:s,usePublishState:c,withScaleValues:l,withStatistics:u,withGroupings:d,withOpponents:p,withMatchUps:v,withSeeding:f,withEvents:m,withDraws:g,withISO2:_,withIOC:I});y=T==null?void 0:T.participantIdsWithConflicts,O=T==null?void 0:T.eventsPublishStatuses}const E=r==null?void 0:r[Sc];return E!=null&&E.participant&&(S=S.map(T=>Yu({template:E.participant,source:T}))),{participantIdsWithConflicts:y,tournamentParticipants:S,eventsPublishStatuses:O}}const $5="ADMINISTRATION",A5="CAPTAIN",U5="COACH",xt="COMPETITOR",C5="MEDIA",M5="MEDICAL",JC="OFFICIAL",ZC="OTHER",D5="SECURITY",XC={ADMINISTRATION:$5,CAPTAIN:A5,COACH:U5,COMPETITOR:xt,MEDIA:C5,MEDICAL:M5,OFFICIAL:JC,OTHER:ZC,SECURITY:D5};function eM(t){return Sd(t)}function hm({removePriorValues:t,tournamentRecord:e,drawDefinition:r,disableNotice:n,scheduledDate:o,matchUpId:i}){return rm({removePriorValues:t,tournamentRecord:e,drawDefinition:r,disableNotice:n,scheduledDate:o,matchUpId:i})}function _m({removePriorValues:t,tournamentRecord:e,drawDefinition:r,scheduledTime:n,disableNotice:o,matchUpId:i}){return bi({removePriorValues:t,tournamentRecord:e,drawDefinition:r,scheduledTime:n,disableNotice:o,matchUpId:i})}function tM({tournamentRecord:t,drawDefinition:e,disableNotice:r,matchUpId:n,startTime:o}){return om({tournamentRecord:t,drawDefinition:e,disableNotice:r,matchUpId:n,startTime:o})}function rM({tournamentRecord:t,drawDefinition:e,disableNotice:r,matchUpId:n,endTime:o}){return im({tournamentRecord:t,drawDefinition:e,disableNotice:r,matchUpId:n,endTime:o})}function nM({tournamentRecord:t,drawDefinition:e,disableNotice:r,matchUpId:n,stopTime:o}){return sm({tournamentRecord:t,drawDefinition:e,disableNotice:r,matchUpId:n,stopTime:o})}function oM({tournamentRecord:t,drawDefinition:e,disableNotice:r,resumeTime:n,matchUpId:o}){return am({tournamentRecord:t,drawDefinition:e,disableNotice:r,resumeTime:n,matchUpId:o})}function j5({tournamentRecord:t,drawDefinition:e,disableNotice:r,courtOrder:n,matchUpId:o}){return nm({tournamentRecord:t,drawDefinition:e,disableNotice:r,courtOrder:n,matchUpId:o})}function iM({tournamentRecord:t,drawDefinition:e,disableNotice:r,participantId:n,officialType:o,matchUpId:i}){if(!n)return{error:It};const{tournamentParticipants:s}=Kt({tournamentRecord:t,participantFilters:{participantTypes:[Ce],participantRoles:[JC]}});return uo({tournamentParticipants:s,participantId:n})?fC({drawDefinition:e,disableNotice:r,participantId:n,officialType:o,matchUpId:i}):{error:Tt}}var R5=Object.defineProperty,F5=Object.defineProperties,V5=Object.getOwnPropertyDescriptors,ZP=Object.getOwnPropertySymbols,L5=Object.prototype.hasOwnProperty,B5=Object.prototype.propertyIsEnumerable,XP=(t,e,r)=>e in t?R5(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Up=(t,e)=>{for(var r in e||(e={}))L5.call(e,r)&&XP(t,r,e[r]);if(ZP)for(var r of ZP(e))B5.call(e,r)&&XP(t,r,e[r]);return t},x5=(t,e)=>F5(t,V5(e));function sM({tournamentRecord:t,scheduleChange:e,matchUpIds:r,dryRun:n}){if(!t)return{error:ee};if(!r||!Array.isArray(r))return{error:_c};if(typeof e!="object")return{error:Z};const o=[],i=[],{minutesChange:s,daysChange:a}=e;if(!s&&!a)return Up({},B);if(s&&isNaN(s))return{error:Z};if(a&&isNaN(a))return{error:Z};const{matchUps:c}=Vt({matchUpFilters:{matchUpIds:r},tournamentRecord:t}),l=({matchUpStatus:P})=>!Rt.includes(P),u=c==null?void 0:c.filter(el).filter(l);if(!u.length)return Up({},B);const{tournamentInfo:d}=tl({tournamentRecord:t}),{startDate:p,endDate:v}=d,f=u.reduce((P,S)=>{const{matchUpId:y,drawId:O}=S;return P[O]?P[O].push(y):P[O]=[y],P},{}),m=1440;for(const P of Object.keys(f)){const S=Ho({tournamentRecord:t,drawId:P});if(S.error)return S;const y=S.drawDefinition,O=f[P].filter(b=>r.includes(b));for(const b of O)if(b&&y){const T=u.find(C=>C.matchUpId===b).schedule,{scheduledTime:N,scheduledDate:w}=T;let $,U,A;if(!$&&a&&w){const C=Me(w);A=YF(C,a),$=new Date(A)<new Date(p)||new Date(A)>new Date(v)}if(s&&N){const C=Me(N),D=je(tt(N))+s;if($=D<0||D>m,!$){let V=sr(N,s);U=C&&A?`${A}T${V}`:V}}if($)i.push(b);else{if(!n){if(U){const C=_m({scheduledTime:U,drawDefinition:y,matchUpId:b});if(C.error)return C}if(A){const C=hm({scheduledDate:A,drawDefinition:y,matchUpId:b});if(C.error)return C}}(U||A)&&o.push(b)}}}const{matchUps:g}=Vt({matchUpFilters:{matchUpIds:r},tournamentRecord:t}),h=g.filter(({matchUpId:P})=>o.includes(P)),_=g.filter(({matchUpId:P})=>i.includes(P)),I=h.length&&!_.length;return x5(Up({},B),{rescheduled:h,notRescheduled:_,allRescheduled:I})}var G5=Object.defineProperty,k5=Object.defineProperties,W5=Object.getOwnPropertyDescriptors,ey=Object.getOwnPropertySymbols,q5=Object.prototype.hasOwnProperty,H5=Object.prototype.propertyIsEnumerable,ty=(t,e,r)=>e in t?G5(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Y5=(t,e)=>{for(var r in e||(e={}))q5.call(e,r)&&ty(t,r,e[r]);if(ey)for(var r of ey(e))H5.call(e,r)&&ty(t,r,e[r]);return t},K5=(t,e)=>k5(t,W5(e));function z5({tournamentRecords:t,scheduleChange:e,matchUpIds:r,dryRun:n}){var o,i;if(!r||!Array.isArray(r))return{error:_c};if(typeof e!="object")return{error:Z};const s=[];let a=[];for(const l of Object.values(t)){const u=sM({tournamentRecord:l,scheduleChange:e,matchUpIds:r,dryRun:n});if(u.error)return u;Array.isArray(u.notRescheduled)&&a.push(...u.notRescheduled);const d=ud(u.notRescheduled),p=[];(o=u.rescheduled)==null||o.forEach(v=>{const{matchUpId:f}=v;d.includes(f)&&p.push(f),s.push(v)}),p.length&&(a=((i=u==null?void 0:u.notRescheduled)==null?void 0:i.filter(({matchUpId:v})=>!p.includes(v)))||[])}const c=s.length&&!a.length;return K5(Y5({},B),{rescheduled:s,notRescheduled:a,allRescheduled:c})}function aM({tournamentRecord:t,dailyLimits:e}){return t?typeof e!="object"?{error:Xn}:_i({extension:{name:Zi,value:{dailyLimits:e}},tournamentRecord:t}):{error:ee}}var Q5=Object.defineProperty,ry=Object.getOwnPropertySymbols,J5=Object.prototype.hasOwnProperty,Z5=Object.prototype.propertyIsEnumerable,ny=(t,e,r)=>e in t?Q5(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,X5=(t,e)=>{for(var r in e||(e={}))J5.call(e,r)&&ny(t,r,e[r]);if(ry)for(var r of ry(e))Z5.call(e,r)&&ny(t,r,e[r]);return t};function e7({tournamentRecords:t,tournamentId:e,dailyLimits:r}){if(typeof t!="object"||!Object.keys(t).length)return{error:Fe};const n=Object.keys(t).filter(o=>!e||e===o);if(e&&!n.includes(e))return{error:Z};for(const o of n){const i=t[o],s=aM({tournamentRecord:i,dailyLimits:r});if(s.error)return s}return X5({},B)}var t7=Object.defineProperty,r7=Object.defineProperties,n7=Object.getOwnPropertyDescriptors,oy=Object.getOwnPropertySymbols,o7=Object.prototype.hasOwnProperty,i7=Object.prototype.propertyIsEnumerable,iy=(t,e,r)=>e in t?t7(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,s7=(t,e)=>{for(var r in e||(e={}))o7.call(e,r)&&iy(t,r,e[r]);if(oy)for(var r of oy(e))i7.call(e,r)&&iy(t,r,e[r]);return t},a7=(t,e)=>r7(t,n7(e));function c7({extensionConversions:t,seedAssignments:e,participant:r,withSeeding:n,seedValue:o,eventId:i,ranking:s,entry:a}){const{entryStatus:c,entryStage:l,entryPosition:u}=a;r.events[i]=_e(a7(s7({},t),{entryPosition:u,entryStatus:c,entryStage:l,ranking:s,eventId:i}),!1,!1,!0),n&&(e&&(r.events[i].seedAssignments=e),o&&(r.events[i].seedValue=o))}var l7=Object.defineProperty,u7=Object.defineProperties,d7=Object.getOwnPropertyDescriptors,sy=Object.getOwnPropertySymbols,p7=Object.prototype.hasOwnProperty,f7=Object.prototype.propertyIsEnumerable,ay=(t,e,r)=>e in t?l7(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,v7=(t,e)=>{for(var r in e||(e={}))p7.call(e,r)&&ay(t,r,e[r]);if(sy)for(var r of sy(e))f7.call(e,r)&&ay(t,r,e[r]);return t},m7=(t,e)=>u7(t,d7(e));function cM({participantMap:t,participantId:e,matchUpStatus:r,roundPosition:n,structureId:o,matchUpType:i,roundNumber:s,matchUpId:a,potential:c,schedule:l,drawId:u,score:d}){if(!l||!Object.keys(l).length)return;r===qe||t[e].scheduleItems.push(m7(v7({},l),{scheduledDate:Me(l==null?void 0:l.scheduledDate),scheduledTime:tt(l==null?void 0:l.scheduledTime),scoreHasValue:At({score:d}),matchUpStatus:r,roundPosition:n,structureId:o,matchUpType:i,roundNumber:s,matchUpId:a,potential:c,drawId:u}))}function g7({finishingPositionRange:t={},participantMap:e,finishingRound:r,participantWon:n,matchUpStatus:o,participantId:i,stageSequence:s,roundNumber:a,structureId:c,matchUpId:l,drawId:u,stage:d}){const p=e[i],v=_=>Math.abs(_[0]-_[1]);p.structureParticipation[c]||(p.structureParticipation[c]={structureId:c,rankingStage:d,walkoverWinCount:0,defaultWinCount:0,stageSequence:s,winCount:0,drawId:u});const f=p.structureParticipation[c],{winner:m,loser:g}=t,h=n?m:g;n&&(f.winCount+=1,o===Ge&&(f.walkoverWinCount+=1),o===Be&&(f.defaultWinCount+=1)),h&&(!f.finishingPositionRange||v(h)<v(f.finishingPositionRange))&&(f.finishingPositionRange=h),r&&((!f.finishingRound||r<f.finishingRound)&&(f.finishingMatchUpId=l,f.finishingRound=r,f.roundNumber=a),r===1&&(f.participantWon=n))}function cy({withScheduleTimes:t,scheduleAnalysis:e,withTeamMatchUps:r,participantMap:n,withOpponents:o,withMatchUps:i,withEvents:s,withDraws:a,finishingPositionRange:c,finishingRound:l,matchUpStatus:u,stageSequence:d,roundNumber:p,structureId:v,score:f,stage:m,withRankingProfile:g,tieWinningSide:h,roundPosition:_,matchUpTieId:I,matchUpSides:P,collectionId:S,matchUpType:y,winningSide:O,matchUpId:b,schedule:E,eventId:T,drawId:N,sides:w}){var $,U,A,C,M,D,V,R,W,x;const K=o&&(w==null?void 0:w.length)===2&&Object.assign({},...w.map(({sideNumber:j},L)=>{const F=w[1-L].participantId;return j&&{[j]:F}}).filter(Boolean));for(const j of w){const{participantId:L,sideNumber:F,bye:q}=j;if(q)continue;const G=O===F,H=J=>{var te,ne;const oe=(te=n[J])==null?void 0:te.participant,se=oe==null?void 0:oe.participantType,ve=[{participantId:J,participantType:se}];if(se!==hn)for(const X of(oe==null?void 0:oe.individualParticipantIds)||[]){const ie=(ne=n[X])==null?void 0:ne.participant;ve.push({participantType:ie==null?void 0:ie.participantType,participantId:X})}return ve},Q=(J,te)=>{if(i){if(n[J].matchUps[b]={participantWon:G,matchUpType:y,structureId:v,sideNumber:F,matchUpId:b,eventId:T,drawId:N},o){const ne=H(te);n[J].matchUps[b].opponentParticipantInfo=ne}S&&(n[J].matchUps[b].collectionId=S)}g&&g7({finishingPositionRange:c,participantMap:n,participantWon:G,finishingRound:l,matchUpStatus:u,participantId:J,stageSequence:d,roundNumber:p,structureId:v,matchUpId:b,drawId:N,stage:m}),(e||t)&&cM({participantMap:n,participantId:J,matchUpStatus:u,roundPosition:_,matchUpType:y,roundNumber:p,structureId:v,matchUpId:b,schedule:E,drawId:N,score:f})},z=(J,te)=>{J&&(J.partnerParticipantIds||(J.partnerParticipantIds=[]),J.partnerParticipantIds.includes(te)||J.partnerParticipantIds.push(te))},Y=({participantId:J,partnerParticipantId:te})=>{var ne,oe,se,ve,X,ie;a&&z((oe=(ne=n[J])==null?void 0:ne.draws)==null?void 0:oe[N],te),s&&z((ve=(se=n[J])==null?void 0:se.events)==null?void 0:ve[T],te),i&&z((ie=(X=n[J])==null?void 0:X.matchUps)==null?void 0:ie[b],te)};if(L&&n[L]){const J=K==null?void 0:K[F];Q(L,J),o&&J&&(n[L].opponents[J]={participantId:J,matchUpId:b,eventId:T,drawId:N});const te=(($=n[L])==null?void 0:$.participant.participantType)===we,ne=((U=n[L])==null?void 0:U.participant.individualParticipantIds)||[];if(I){if(r){const oe=se=>n[se].matchUps[I]={participantWon:h===F,matchUpType:Qr,matchUpId:I,sideNumber:F};oe(L),ne.forEach(oe)}if(a&&!n[L].draws[N]){const oe=(C=(A=P.find(X=>X.sideNumber===F))==null?void 0:A.participant)==null?void 0:C.participantId,se=(V=(D=(M=n[oe])==null?void 0:M.draws)==null?void 0:D[N])==null?void 0:V.entryStatus,ve=X=>n[X].draws[N]={entryStatus:se,eventId:T,drawId:N};ve(L),ne.forEach(ve)}}if(te&&(ne.forEach(oe=>n[oe]&&Q(oe,J)),ne.forEach((oe,se)=>{const ve=ne[1-se];Y({participantId:oe,partnerParticipantId:ve})}),s&&P)){const oe=(W=(R=P.find(se=>se.sideNumber===F))==null?void 0:R.participant)==null?void 0:W.participantId;if(oe){const se=(x=n[oe])==null?void 0:x.events[T];se?(n[L].events[T]=se,ne.forEach(ve=>n[ve].events[T]=se)):console.log("Missing teamEntry",{eventId:T,teamParticipantId:oe})}}if(O){const oe=se=>{G?(n[se].counters[y].wins+=1,n[se].counters.wins+=1,u===Ge&&(n[se].counters[y].walkoverWins+=1,n[se].counters.walkoverWins+=1),u===Be&&(n[se].counters[y].defaultWins+=1,n[se].counters.defaultWins+=1)):(n[se].counters[y].losses+=1,n[se].counters.losses+=1,u===Ge&&(n[se].counters[y].walkovers+=1,n[se].counters.walkovers+=1),u===Be&&(n[se].counters[y].defaults+=1,n[se].counters.defaults+=1))};oe(L),ne.forEach(oe)}}}}var h7=Object.defineProperty,_7=Object.defineProperties,I7=Object.getOwnPropertyDescriptors,ly=Object.getOwnPropertySymbols,P7=Object.prototype.hasOwnProperty,y7=Object.prototype.propertyIsEnumerable,uy=(t,e,r)=>e in t?h7(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Es=(t,e)=>{for(var r in e||(e={}))P7.call(e,r)&&uy(t,r,e[r]);if(ly)for(var r of ly(e))y7.call(e,r)&&uy(t,r,e[r]);return t},_l=(t,e)=>_7(t,I7(e));function O7({participantFilters:t,convertExtensions:e,policyDefinitions:r,tournamentRecord:n,usePublishState:o,contextProfile:i,participantMap:s,withPotentialMatchUps:a,withRankingProfile:c,withScheduleTimes:l,scheduleAnalysis:u,withTeamMatchUps:d,withStatistics:p,withOpponents:v,withMatchUps:f,withSeeding:m,withEvents:g,withDraws:h}){var _,I,P,S,y;const O=t==null?void 0:t.participantIds,b=M=>{var D;const V=[M];return V.push(M),(D=s[M].participant.individualParticipantIds)==null||D.forEach(R=>V.push(R)),V.some(R=>!(O!=null&&O.length)||O.includes(R.relevantParticipantId))?V:[]},E={withMatchUps:f||c,withEvents:g||c,withDraws:h||c,withPotentialMatchUps:a,withRankingProfile:c,withScheduleTimes:l,scheduleAnalysis:u,withTeamMatchUps:d,withStatistics:p,participantMap:s,withOpponents:v,withSeeding:m},T=[],N={},w={},$={},U={};let A=[];const C=({eventType:M,scaleNames:D,participantId:V})=>{var R,W,x,K;return(K=(x=(W=(R=s[V].participant)==null?void 0:R.rankings)==null?void 0:W[M])==null?void 0:x.find(j=>D.includes(j.scaleName)))==null?void 0:K.scaleValue};for(const M of(n==null?void 0:n.events)||[]){if(t!=null&&t.eventIds&&!t.eventIds.includes(M.eventId))continue;const{drawDefinitions:D=[],extensions:V,eventType:R,eventName:W,category:x,entries:K,eventId:j,gender:L}=M,{flightProfile:F}=ht({event:M}),q=F==null?void 0:F.flights,G=GY({event:M}),H=G==null?void 0:G.publishedSeeding;if(G&&(N[j]=G),g||m||c){const Q=e?Object.assign({},...LA(V)):{};w[j]=_l(Es({},Q),{eventName:W,eventType:R,category:x,eventId:j,gender:L});const z=[x==null?void 0:x.categoryName,x==null?void 0:x.ageCategoryCode].filter(Boolean);for(const Y of K){const{participantId:J}=Y;if(!J||!s[J])continue;const te=C({eventType:R,scaleNames:z,participantId:J});let ne,oe;if(m){const X=s[J].participant;({seedAssignments:ne,seedValue:oe}=kY({publishedSeeding:H,usePublishState:o,withSeeding:m,participant:X,event:M}))}const se=X=>{var ie;if((ie=s[X])!=null&&ie.events[j])return;const fe=s[X];c7({extensionConversions:Q,seedAssignments:ne,participant:fe,withSeeding:m,seedValue:oe,eventId:j,ranking:te,entry:Y})};se(J),(s[J].participant.individualParticipantIds||[]).forEach(se)}}if(h||c||m){const Q=z=>z?Object.assign({},...z.map(Y=>({[Y.participantId]:Y}))):void 0;for(const z of D){const{structures:Y=[],drawOrder:J,drawName:te,drawType:ne,entries:oe,drawId:se}=z,ve=(_=q==null?void 0:q.find(be=>be.drawId===se))==null?void 0:_.flightNumber,X=[x==null?void 0:x.categoryName,x==null?void 0:x.ageCategoryCode].filter(Boolean),ie=(z.structures||[]).sort((be,ge)=>yi(be,ge)).map(({structureId:be,structures:ge})=>[be,...(ge||[]).map(({structureId:Ne})=>Ne)]).flat(1/0);let fe,Ee,re,ae,me=0;const Oe=Y.filter(({stage:be,stageSequence:ge})=>be===ue&&ge===1||be===Ie).flatMap(be=>{const{seedAssignments:ge,stageSequence:Ne,stage:Ue}=be,{positionAssignments:he}=Xe({structure:be});return Ue===ue?(me=(he==null?void 0:he.length)||0,re=he,ae=ge):Ne===1&&(fe=he,Ee=ge),he}).map(({participantId:be})=>be).filter(Boolean),ce=Q(ae),Pe=Q(Ee),$e=oe.filter(({participantId:be})=>Oe.includes(be)),ye=(I=N[j])==null?void 0:I.publishedSeeding,Ae=!o||(ye==null?void 0:ye.published)&&(((P=ye==null?void 0:ye.drawIds)==null?void 0:P.length)===0||((S=ye==null?void 0:ye.drawIds)==null?void 0:S.includes(se)));for(const be of $e){const{entryStatus:ge,entryStage:Ne,entryPosition:Ue,participantId:he}=be,xe=C({participantId:he,scaleNames:X,eventType:R}),De=Je=>{var rt,He,bt,Qt;if(s[Je].draws[se])return;const Wt=m&&Ae,ro=Wt?{}:void 0,Rn=Wt?((rt=ce==null?void 0:ce[he])==null?void 0:rt.seedValue)||((He=ce==null?void 0:ce[he])==null?void 0:He.seedNumber):void 0,Qo=Wt?((bt=Pe==null?void 0:Pe[he])==null?void 0:bt.seedValue)||((Qt=Pe==null?void 0:Pe[he])==null?void 0:Qt.seedNumber):void 0;Rn&&(ro[ue]=Rn),Qo&&(ro[Ie]=Rn),(g||c)&&(Wt?s[Je].events[j].seedValue=Rn||Qo:s[Je].events[j].seedValue&&(s[Je].events[j].seedValue=void 0)),(h||c)&&(s[Je].draws[se]=_e({seedAssignments:ro,entryPosition:Ue,entryStatus:ge,entryStage:Ne,eventId:j,ranking:xe,drawId:se},!1,!1,!0))};if(![Wr,fs].includes(ge)){De(he);const Je=s[he].participant.individualParticipantIds||[];Je==null||Je.forEach(De)}}$[se]={qualifyingPositionAssignments:fe,qualifyingSeedAssignments:Ee,mainPositionAssignments:re,qualifyingSeedingMap:Pe,mainSeedAssignments:ae,orderedStructureIds:ie,mainSeedingMap:ce,flightNumber:ve,drawOrder:J,drawName:te,drawType:ne,drawSize:me,drawId:se}}}if(c||u||d||p||v||f||h){const Q=!!u||a,z=(y=Si({afterRecoveryTimes:!!u,policyDefinitions:r,tournamentRecord:n,inContext:!0,contextProfile:i,participantMap:s,nextMatchUps:Q,event:M}))==null?void 0:y.matchUps;for(const Y of z){const{finishingPositionRange:J,potentialParticipants:te,tieMatchUps:ne=[],sides:oe=[],winningSide:se,matchUpType:ve,matchUpId:X,eventId:ie,drawId:fe,collectionId:Ee,stageSequence:re,finishingRound:ae,matchUpStatus:me,roundPosition:Oe,roundNumber:ce,structureId:Pe,schedule:$e,score:ye,stage:Ae}=Y;U[X]=Y;const be={finishingPositionRange:J,finishingRound:ae,stageSequence:re,roundPosition:Oe,collectionId:Ee,roundNumber:ce,structureId:Pe,schedule:$e,eventId:ie,drawId:fe,score:ye,stage:Ae};cy(_l(Es(Es({},be),E),{matchUpStatus:me,winningSide:se,matchUpType:ve,matchUpId:X,sides:oe}));for(const ge of ne){const{winningSide:Ne,sides:Ue=[],matchUpId:he,matchUpStatus:xe,matchUpType:De}=ge;cy(_l(Es(Es({},be),E),{winningSide:Ne,tieWinningSide:se,matchUpTieId:X,matchUpId:he,sides:Ue,matchUpSides:oe,matchUpStatus:xe,matchUpType:De}))}if(Array.isArray(te)&&(Q||u||l)){const ge=Jn(te.flat());ge==null||ge.forEach(Ne=>{const Ue=b(Ne);Ue==null||Ue.forEach(he=>{s[he].potentialMatchUps[X]=_e({tournamentId:n==null?void 0:n.tournamentId,matchUpId:X,eventId:ie,drawId:fe})}),(u||l)&&cM({potential:!0,participantMap:s,participantId:Ne,matchUpStatus:me,roundPosition:Oe,structureId:Pe,matchUpType:ve,roundNumber:ce,matchUpId:X,schedule:$e,drawId:fe,score:ye})})}}A.push(...z)}}if(p||c||u)for(const M of Object.values(s)){const{wins:D,losses:V,[ut]:{wins:R,losses:W},[ot]:{wins:x,losses:K}}=M.counters,j=(L,F,q)=>{const G=F+q,H=F,Q=G&&H/G;M.statistics[L]={denominator:G,numerator:H,statValue:Q,statCode:L}};if(p&&(j(La,D,V),j(`${La}.${ut}`,R,W),j(`${La}.${ot}`,x,K)),c){const L=(F=[])=>Math.abs(F[0]-F[1]);for(const F of Object.keys(M.draws)){const{orderedStructureIds:q=[],flightNumber:G}=$[F]||{};if(M.structureParticipation&&q.length){let H,Q=0;const z=q.map(Y=>{const J=M.structureParticipation[Y];if(!J)return;H||(H=J.finishingPositionRange),L(H)>L(J.finishingPositionRange)&&(H=J.finishingPositionRange);const te=J.stage!==Ie;te&&(Q+=1);const ne=te?Q:void 0;return _e(_l(Es({},J),{participationOrder:ne,flightNumber:G}))}).filter(Boolean);M.draws[F].finishingPositionRange=H,M.draws[F].structureParticipation=z}}}if(u){const L=Ki(u)?u.scheduledMinutesDifference:0,F=M.scheduleItems||[],q=M.potentialMatchUps||{},G=F.reduce((Q,z)=>{const{scheduledDate:Y,scheduledTime:J}=z;return Q[Y]||(Q[Y]=[]),J&&Q[Y].push(z),Q},{});Object.values(G).forEach(Q=>Q.sort(VA));for(const Q of F){const{typeChangeTimeAfterRecovery:z,timeAfterRecovery:Y,scheduledDate:J,scheduledTime:te}=Q,ne=G[J],oe=je(te);for(const se of ne){if(se.matchUpId===Q.matchUpId||[Ge,Be].includes(se.matchUpStatus)&&!se.scoreHasValue)continue;const ie=Q.matchUpType!==se.matchUpType&&z||Y,fe=Q.drawId===se.drawId,Ee=q[Q.matchUpId]&&q[se.matchUpId],re=je(se.scheduledTime),ae=Math.abs(re-oe);(L&&!isNaN(L)?ae<=L:je(ie)>je(se.scheduledTime))&&!(Ee&&fe)&&M.scheduleConflicts.push({priorScheduledMatchUpId:se.matchUpId,matchUpIdWithConflict:Q.matchUpId})}}const H=M.participant.participantId;M.scheduleConflicts.length&&T.push(H),s[H].scheduleConflicts=M.scheduleConflicts}}return{participantIdsWithConflicts:T,eventsPublishStatuses:N,derivedEventInfo:w,derivedDrawInfo:$,mappedMatchUps:U,participantMap:s,matchUps:A}}var S7=Object.defineProperty,b7=Object.defineProperties,T7=Object.getOwnPropertyDescriptors,gu=Object.getOwnPropertySymbols,lM=Object.prototype.hasOwnProperty,uM=Object.prototype.propertyIsEnumerable,dy=(t,e,r)=>e in t?S7(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,py=(t,e)=>{for(var r in e||(e={}))lM.call(e,r)&&dy(t,r,e[r]);if(gu)for(var r of gu(e))uM.call(e,r)&&dy(t,r,e[r]);return t},fy=(t,e)=>b7(t,T7(e)),E7=(t,e)=>{var r={};for(var n in t)lM.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&gu)for(var n of gu(t))e.indexOf(n)<0&&uM.call(t,n)&&(r[n]=t[n]);return r};function Os({withIndividualParticipants:t,participantFilters:e={},withPotentialMatchUps:r,withRankingProfile:n,convertExtensions:o,policyDefinitions:i,withScheduleItems:s,tournamentRecord:a,scheduleAnalysis:c,withSignInStatus:l,withTeamMatchUps:u,withScaleValues:d,usePublishState:p,contextProfile:v,withStatistics:f,withOpponents:m,withMatchUps:g,internalUse:h,withSeeding:_,withEvents:I,withDraws:P,withISO2:S,withIOC:y}){if(!a)return{error:ee};(g||n)&&qr({tournamentRecord:a});let{participantMap:O}=rC({withIndividualParticipants:t,convertExtensions:o,policyDefinitions:i,tournamentRecord:a,withSignInStatus:l,withScaleValues:d,internalUse:h,withISO2:S,withIOC:y}),b,E,T,N,w,$;({participantIdsWithConflicts:b,eventsPublishStatuses:E,derivedEventInfo:T,derivedDrawInfo:N,participantMap:O,mappedMatchUps:w,matchUps:$}=O7({withMatchUps:g||n,withEvents:I||n,withDraws:P||n,withPotentialMatchUps:r,participantFilters:e,withRankingProfile:n,policyDefinitions:i,convertExtensions:o,withScheduleItems:s,tournamentRecord:a,scheduleAnalysis:c,withTeamMatchUps:u,usePublishState:p,withStatistics:f,contextProfile:v,participantMap:O,withOpponents:m,withSeeding:_}));const U=c||r,A=Object.values(O).map(M=>{var D=M,{potentialMatchUps:V,scheduleConflicts:R,statistics:W,opponents:x,matchUps:K,events:j,draws:L}=D,F=E7(D,["potentialMatchUps","scheduleConflicts","statistics","opponents","matchUps","events","draws"]);const q=Object.values(L),G=Object.values(x);return m&&(q==null||q.forEach(H=>{H.opponents=G.filter(Q=>Q.drawId===H.drawId)})),_e(fy(py({},F.participant),{scheduleConflicts:c?R:void 0,draws:P||n?q:void 0,events:I||n?Object.values(j):void 0,matchUps:g||n?Object.values(K):void 0,opponents:m?G:void 0,potentialMatchUps:U?Object.values(V):void 0,statistics:f?Object.values(W):void 0}),!1,!1,!0)});let C=Cd({participants:A,participantFilters:e,tournamentRecord:a});return fy(py({participantIdsWithConflicts:b,eventsPublishStatuses:E,derivedEventInfo:T,derivedDrawInfo:N,mappedMatchUps:w,participantMap:O,participants:C},B),{matchUps:$})}function Im(t,e,r){return!t&&e?e:t&&!e||typeof t!="object"||typeof e!="object"?t:Ve(Object.keys(t).concat(Object.keys(e))).reduce((o,i)=>{if(!e[i])o[i]=t[i];else if(!t[i])o[i]=e[i];else if(typeof t[i]!=typeof e[i])o[i]=e[i];else if(Array.isArray(t[i]))if(r===!0||Array.isArray(r)&&r.includes(i)){const s=Ve(t[i].map(a=>JSON.stringify(a)).concat(e[i].map(a=>JSON.stringify(a)))).map(a=>JSON.parse(a));o[i]=s}else o[i]=e[i];else typeof t[i]=="object"?o[i]=Im(t[i],e[i],r):o[i]=e[i];return o},{})}var w7=Object.defineProperty,N7=Object.defineProperties,$7=Object.getOwnPropertyDescriptors,vy=Object.getOwnPropertySymbols,A7=Object.prototype.hasOwnProperty,U7=Object.prototype.propertyIsEnumerable,my=(t,e,r)=>e in t?w7(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,lc=(t,e)=>{for(var r in e||(e={}))A7.call(e,r)&&my(t,r,e[r]);if(vy)for(var r of vy(e))U7.call(e,r)&&my(t,r,e[r]);return t},C7=(t,e)=>N7(t,$7(e));function M7(t){const{tournamentRecords:e}=t||{};if(typeof e!="object"||!Object.keys(e).length)return{error:Fe};const r={},n={},o={},i={},s=[],a=[],c=[];for(const l of Object.values(e)){const{participantIdsWithConflicts:u,mappedMatchUps:d,participantMap:p,participants:v,matchUps:f,derivedEventInfo:m,derivedDrawInfo:g}=Os(lc({tournamentRecord:l},t));Object.assign(i,d),Object.assign(o,p),Object.assign(r,m),Object.assign(n,g),s.push(...v),a.push(...f),u==null||u.forEach(h=>{c.includes(h)||c.push(h)})}return C7(lc({participantIdsWithConflicts:c,derivedEventInfo:r,derivedDrawInfo:n,participantMap:o,mappedMatchUps:i,participants:s},B),{matchUps:a})}function D7(t){const{tournamentRecords:e}=t||{};if(typeof e!="object"||!Object.keys(e).length)return{error:Fe};const r=[],n=[];let o=[];for(const i of Object.values(e)){const{tournamentParticipants:s,participantIdsWithConflicts:a}=Kt(lc({tournamentRecord:i},t));for(const c of s){const{participantId:l}=c;n.includes(l)?o=o.map(u=>u.participantId!==l?u:Im(u,c,!0)):(n.push(l),o.push(c))}a&&a.forEach(c=>{r.includes(c)||r.push(c)})}return lc({competitionParticipants:o,participantIdsWithConflicts:r},B)}function dM({policyDefinitions:t,tournamentRecords:e,participantId:r,inContext:n,personId:o}){if(!e)return{error:Fe};if(typeof r!="string"&&typeof o!="string")return{error:Se,stack:"publicFindParticipant"};let i,s;for(const a of Object.values(e)){s=a.tournamentId;const{tournamentParticipants:c}=Kt({policyDefinitions:t,tournamentRecord:a,inContext:n});if(i=uo({tournamentParticipants:c,internalUse:!0,policyDefinitions:t,participantId:r,personId:o}),i)break}return lc({participant:i,tournamentId:s},B)}const pM=({penaltyId:t=ke()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:t});var j7=Object.defineProperty,R7=Object.defineProperties,F7=Object.getOwnPropertyDescriptors,gy=Object.getOwnPropertySymbols,V7=Object.prototype.hasOwnProperty,L7=Object.prototype.propertyIsEnumerable,hy=(t,e,r)=>e in t?j7(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Md=(t,e)=>{for(var r in e||(e={}))V7.call(e,r)&&hy(t,r,e[r]);if(gy)for(var r of gy(e))L7.call(e,r)&&hy(t,r,e[r]);return t},Dd=(t,e)=>R7(t,F7(e));function fM({refereeParticipantId:t,tournamentRecord:e,participantIds:r,penaltyCode:n,penaltyType:o,extensions:i,penaltyId:s,matchUpId:a,issuedAt:c,notes:l}){if(!e)return{error:ee};if(!r)return{error:It};if(!o)return{error:BR};const d=((e==null?void 0:e.participants)||[]).filter(f=>r.includes(f.participantId));if(!d.length)return{error:Tt};const p=new Date().toISOString(),v=Object.assign(pM({penaltyId:s}),{refereeParticipantId:t,penaltyCode:n,penaltyType:o,matchUpId:a,notes:l,issuedAt:c,createdAt:p});return Array.isArray(i)&&i.forEach(f=>et({element:v,extension:f})),d.forEach(f=>{f.penalties||(f.penalties=[]),f.penalties.push(v)}),Le({topic:kt,payload:{tournamentId:e.tournamentId,participants:d}}),Dd(Md({},B),{penaltyId:v.penaltyId})}function vM({tournamentRecord:t,penaltyId:e}){if(!t)return{error:ee};if(!e)return{error:OA};const r=(t==null?void 0:t.participants)||[],n=[];let o=!1,i;return r.forEach(s=>{let a=!1;s.penalties=(s.penalties||[]).filter(c=>(c.penaltyId===e&&(a=!0,o||(i=c,o=!0)),a&&n.push(s),c.penaltyId!==e))}),i&&Le({topic:kt,payload:{tournamentId:t.tournamentId,participants:n}}),i?Dd(Md({},B),{penalty:i}):{error:Wu}}function mM({tournamentRecord:t}){if(!t)return{error:ee};const r=((t==null?void 0:t.participants)||[]).reduce((n,o)=>{const{participantId:i}=o;return(o.penalties||[]).forEach(s=>{const{penaltyId:a}=s||{};n[a]?n[a].participants.push(i):n[a]=Dd(Md({},s),{participantIds:[i]})}),n},{});return{penalties:Object.values(r)}}function gM({tournamentRecord:t,penaltyId:e,modifications:r}){if(!t)return{error:ee};if(!r)return{error:Z,modifications:r};if(!e)return{error:OA};const n=(t==null?void 0:t.participants)||[],o=Object.keys(pM()).filter(c=>c!=="penaltyId"),i=Object.keys(r).filter(c=>o.includes(c));if(!i.length)return{error:ov};let s;const a=[];return n.forEach(c=>{let l=!1;c.penalties=(c.penalties||[]).map(u=>(u.penaltyId===e&&(l=!0,i.forEach(d=>Object.assign(u,{[d]:r[d]})),s||(s=u)),u)),l&&a.push(c)}),s&&Le({topic:kt,payload:{tournamentId:t.tournamentId,participants:a}}),s?Dd(Md({},B),{penalty:s}):{error:Wu}}var B7=Object.defineProperty,x7=Object.defineProperties,G7=Object.getOwnPropertyDescriptors,_y=Object.getOwnPropertySymbols,k7=Object.prototype.hasOwnProperty,W7=Object.prototype.propertyIsEnumerable,Iy=(t,e,r)=>e in t?B7(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ea=(t,e)=>{for(var r in e||(e={}))k7.call(e,r)&&Iy(t,r,e[r]);if(_y)for(var r of _y(e))W7.call(e,r)&&Iy(t,r,e[r]);return t},Py=(t,e)=>x7(t,G7(e));function q7(t){const{tournamentRecords:e,participantIds:r}=t;let n;for(const o of Object.values(e)){const{tournamentParticipants:i}=Kt({tournamentRecord:o}),s=Jn(i).filter(a=>r.includes(a));s.length&&(n=fM(Py(ea({},t),{penaltyId:t.penaltyId||n,tournamentRecord:o,participantIds:s})).penaltyId)}return n?Py(ea({},B),{penaltyId:n}):{error:Tt}}function H7(t){const{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:Fe};for(const r of Object.values(e)){const n=gM(ea({tournamentRecord:r},t));if(n.error&&n.error!==Wu)return n}return ea({},B)}function Y7(t){const{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:Fe};for(const r of Object.values(e)){const n=vM(ea({tournamentRecord:r},t));if(n.error&&n.error!==Wu)return n}return ea({},B)}function K7({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Fe};const e=[];for(const r of Object.values(t)){const{penalties:n}=mM({tournamentRecord:r});e.push(...n)}return{penalties:e}}const z7={addExtension:Sv,findExtension:td,removeExtension:rd,addEventExtension:oB,linkTournaments:cB,unlinkTournament:uB,unlinkTournaments:lB,getLinkedTournamentIds:bv,addDrawDefinition:DY,getCompetitionParticipants:D7,getParticipants:M7,addParticipant:xY,courtGridRows:GC,setMatchUpStatus:wY,bulkMatchUpStatusUpdate:NY,bulkScheduleMatchUps:mC,addPenalty:q7,removePenalty:Y7,modifyPenalty:H7,getCompetitionPenalties:K7,findParticipant:dM};var Q7=Object.defineProperty,yy=Object.getOwnPropertySymbols,J7=Object.prototype.hasOwnProperty,Z7=Object.prototype.propertyIsEnumerable,Oy=(t,e,r)=>e in t?Q7(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,hM=(t,e)=>{for(var r in e||(e={}))J7.call(e,r)&&Oy(t,r,e[r]);if(yy)for(var r of yy(e))Z7.call(e,r)&&Oy(t,r,e[r]);return t};function _M({removePriorValues:t=!0,tournamentRecord:e,status:r=Nn}){if(!e)return{error:ee};const n=`${$r}.${Ar}`,{timeItem:o}=gd({itemType:n}),i=(o==null?void 0:o.itemValue)||{[r]:{}};return i[r]&&delete i[r].orderOfPlay,Oo({timeItem:{itemValue:i,itemType:n},removePriorValues:t,tournamentRecord:e}),Le({topic:wU,payload:{tournamentId:e.tournamentId}}),hM({},B)}function IM({scheduledDates:t=[],removePriorValues:e,tournamentRecord:r,status:n=Nn,eventIds:o=[]}){if(!r)return{error:ee};const i=`${$r}.${Ar}`,{timeItem:s}=gd({itemType:i}),a=(s==null?void 0:s.itemValue)||{[n]:{}};return a[n].orderOfPlay={published:!0,scheduledDates:t,eventIds:o},Oo({timeItem:{itemValue:a,itemType:i},removePriorValues:e,tournamentRecord:r}),Le({topic:SB,payload:{tournamentId:r.tournamentId,scheduledDates:t,eventIds:o}}),hM({},B)}var X7=Object.defineProperty,Sy=Object.getOwnPropertySymbols,eK=Object.prototype.hasOwnProperty,tK=Object.prototype.propertyIsEnumerable,by=(t,e,r)=>e in t?X7(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,hu=(t,e)=>{for(var r in e||(e={}))eK.call(e,r)&&by(t,r,e[r]);if(Sy)for(var r of Sy(e))tK.call(e,r)&&by(t,r,e[r]);return t};function rK(t){const e=t==null?void 0:t.tournamentRecords;if(!e)return{error:Fe};for(const r of Object.values(e)){const n=_M(hu({tournamentRecord:r},t));if(n.error)return n}return hu({},B)}function nK(t){const e=t==null?void 0:t.tournamentRecords;if(!e)return{error:Fe};for(const r of Object.values(e)){const n=IM(hu({tournamentRecord:r},t));if(n.error)return n}return hu({},B)}const oK={unPublishOrderOfPlay:rK,publishOrderOfPlay:nK};function PM({tournamentRecords:t,extensionName:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Fe};const r=[];let n;for(const o of Object.values(t)){const{extension:i}=hr({name:e,tournamentRecord:o});i&&!n&&(r.push({method:"addExtension",params:{extension:i}}),n=!0);const s=o.events||[];for(const a of s){const{eventId:c}=a,{extension:l}=Po({name:e,event:a});l&&r.push({params:{eventId:c,extension:l},method:"addEventExtension"})}}return{methods:r}}function iK({tournamentRecords:t}){return PM({tournamentRecords:t,extensionName:wn})}var sK=Object.defineProperty,aK=Object.defineProperties,cK=Object.getOwnPropertyDescriptors,Ty=Object.getOwnPropertySymbols,lK=Object.prototype.hasOwnProperty,uK=Object.prototype.propertyIsEnumerable,Ey=(t,e,r)=>e in t?sK(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,dK=(t,e)=>{for(var r in e||(e={}))lK.call(e,r)&&Ey(t,r,e[r]);if(Ty)for(var r of Ty(e))uK.call(e,r)&&Ey(t,r,e[r]);return t},pK=(t,e)=>aK(t,cK(e));function yM({tournamentRecord:t,matchUpFormats:e,categoryType:r,event:n}){if(!t)return{error:ee};if(!n)return{error:Re};let o=[];if(e!=null&&e.length){const u=[];o=e.map(d=>{let p=typeof d=="string"?{matchUpFormat:d}:d;if(!u.includes(p==null?void 0:p.matchUpFormat)&&Br(p==null?void 0:p.matchUpFormat))return u.push(p.matchUpFormat),p}).filter(Boolean)}else{const{policy:u}=us({policyType:va,tournamentRecord:t,event:n});if(u!=null&&u.matchUpFormats)o=u==null?void 0:u.matchUpFormats;else{const{extension:d}=Po({name:wn,event:n});if(d!=null&&d.value)o=Ve([...(d.value.matchUpAverageTimes||[]).map(p=>p.matchUpFormatCodes),...(d.value.matchUpRecoveryTimes||[]).map(p=>p.matchUpFormatCodes)].flat()).map(p=>({matchUpFormat:p}));else return{error:yR}}}const{eventType:i,eventId:s,category:a}=n,c=(a==null?void 0:a.categoryName)||(a==null?void 0:a.ageCategoryCode)||s;return s?{eventMatchUpFormatTiming:o.map(({matchUpFormat:u,description:d})=>{const p=_v({tournamentRecord:t,matchUpFormat:u,categoryName:c,categoryType:r,eventType:i,event:n});return Object.assign({},pK(dK({},p),{description:d,matchUpFormat:u}))})}:{error:Re}}function fK({tournamentRecords:t,matchUpFormats:e,categoryType:r,tournamentId:n,eventId:o}){if(!o)return{error:Re};const i=Object.keys(t).filter(l=>!n||l===n);if(n&&!i.length)return{error:Z};let s,a,c;return i.forEach(l=>{const u=t[l],{event:d}=Ft({tournamentRecord:u,eventId:o});if(!d)return!1;c=!0;const{eventMatchUpFormatTiming:p,error:v}=yM({tournamentRecord:u,matchUpFormats:e,categoryType:r,event:d});v&&(a=v),s=p}),!c&&{error:Pr}||a&&{error:a}||{eventMatchUpFormatTiming:s}}function jd({tournamentRecords:t,schedulingProfile:e}){if(!e)return{valid:!0};if(!Array.isArray(e))return{valid:!1,error:Z};const{venueIds:r,tournamentsMap:n}=vK({tournamentRecords:t});let o,i;const s=e.every(a=>{const{scheduleDate:c,venues:l}=a;return Nr(c)?l.every(u=>{const{venueId:d,rounds:p}=u;return typeof d!="string"?(i="venueId should be a string",!1):Array.isArray(p)?r.includes(d)?!!p.every(f=>{var m,g,h;if(!f)return i="empty round",!1;const{roundSegment:_,tournamentId:I,structureId:P,roundNumber:S,eventId:y,drawId:O}=f,b=(h=(g=(m=n==null?void 0:n[I])==null?void 0:m[y])==null?void 0:g[O])==null?void 0:h[P],E=b==null?void 0:b.includes(S);E||(i="Invalid rounds");const{segmentNumber:T,segmentsCount:N}=_||{},w=!_||lt(T)&&Lr(N)&&T<=N;return w||(i="Invalid segment"),E&&w}):(o=oi,!1):(i="rounds should be an array",!1)}):!1});return!s&&!o&&(o=Z),{valid:!!s,error:o,info:i}}function OM({tournamentRecord:t={},tournamentMap:e={},requireCourts:r}={}){const n=[],o=[],i=[],s=[],a=((t==null?void 0:t.venues)||[]).map(({venueId:l,courts:u})=>(!r||(u==null?void 0:u.length))&&l),c=t==null?void 0:t.tournamentId;return c&&(s.push(c),e[c]={},((t==null?void 0:t.events)||[]).forEach(u=>{const d=u.eventId;o.push(d),e[c][d]={},(u.drawDefinitions||[]).forEach(p=>{const v=p.drawId;n.push(v),e[c][d][v]={};const{structures:f}=Ur({drawDefinition:p});(f||[]).forEach(m=>{var g;const h=m.structureId,{matchUps:_}=Ke({structure:m}),{roundMatchUps:I}=lr({matchUps:_}),P=I&&Object.keys(I).map(S=>parseInt(S));e[c][d][v][h]=P,i.push(h),(g=m.structures)!=null&&g.length&&m.structures.forEach(S=>{i.push(S.structureId),e[c][d][v][S.structureId]=P})})})})),{tournamentMap:e,tournamentIds:s,structureIds:i,venueIds:a,eventIds:o,drawIds:n}}function vK({tournamentRecords:t={}}={}){const e=t&&Object.values(t)||[],r={},{venueIds:n,eventIds:o,drawIds:i,structureIds:s,tournamentIds:a}=e.reduce((c,l)=>{const{tournamentIds:u,tournamentMap:d,structureIds:p,venueIds:v,eventIds:f,drawIds:m}=OM({tournamentRecord:l});return v.forEach(g=>{c.venueIds.includes(g)||c.venueIds.push(g)}),c.tournamentIds.push(...u),c.structureIds.push(...p),c.eventIds.push(...f),c.drawIds.push(...m),Object.assign(r,d),c},{tournamentIds:[],structureIds:[],venueIds:[],eventIds:[],drawIds:[]});return{tournamentsMap:r,tournamentIds:a,structureIds:s,venueIds:n,eventIds:o,drawIds:i}}var mK=Object.defineProperty,wy=Object.getOwnPropertySymbols,gK=Object.prototype.hasOwnProperty,hK=Object.prototype.propertyIsEnumerable,Ny=(t,e,r)=>e in t?mK(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,_K=(t,e)=>{for(var r in e||(e={}))gK.call(e,r)&&Ny(t,r,e[r]);if(wy)for(var r of wy(e))hK.call(e,r)&&Ny(t,r,e[r]);return t};function IK({tournamentRecords:t,matchUpFormat:e,recoveryTimes:r,averageTimes:n,tournamentId:o,eventId:i}){if(typeof t!="object"||!Object.keys(t).length)return{error:Fe};const s=Object.keys(t).filter(c=>!o||o===c);if(o&&!s.includes(o))return{error:Z};let a;for(const c of s){const l=t[c],{event:u}=Ft({tournamentRecord:l,eventId:i});i&&u&&(a=!0);const d=gm({tournamentRecord:l,event:u,matchUpFormat:e,averageTimes:n,recoveryTimes:r});if(d.error)return d}return!i||a?_K({},B):{error:Pr}}function Pm({defaultRecoveryMinutes:t=0,defaultAverageMinutes:e,tournamentRecords:r,tournamentId:n,matchUpFormat:o,categoryName:i,categoryType:s,eventType:a,eventId:c}){if(!Br(o))return{error:xu};const l=Object.keys(r).filter(d=>!n||d===n);let u;return l.forEach(d=>{var p;if(u)return;const v=r[d],f=c&&((p=Ft({tournamentRecord:v,eventId:c}))==null?void 0:p.event);return u=_v({tournamentRecord:v,matchUpFormat:o,categoryName:i,categoryType:s,eventType:a,event:f}),(u==null?void 0:u.averageMinutes)||(u==null?void 0:u.recoveryMinutes)}),{averageMinutes:(u==null?void 0:u.averageMinutes)||e,recoveryMinutes:(u==null?void 0:u.recoveryMinutes)||t,typeChangeRecoveryMinutes:(u==null?void 0:u.typeChangeRecoveryMinutes)||(u==null?void 0:u.recoveryMinutes)||t}}var PK=Object.defineProperty,yK=Object.defineProperties,OK=Object.getOwnPropertyDescriptors,$y=Object.getOwnPropertySymbols,SK=Object.prototype.hasOwnProperty,bK=Object.prototype.propertyIsEnumerable,Ay=(t,e,r)=>e in t?PK(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Uy=(t,e)=>{for(var r in e||(e={}))SK.call(e,r)&&Ay(t,r,e[r]);if($y)for(var r of $y(e))bK.call(e,r)&&Ay(t,r,e[r]);return t},TK=(t,e)=>yK(t,OK(e));function ym({scheduleCompletedMatchUps:t,containedStructureIds:e,tournamentRecords:r,periodLength:n=30,matchUps:o,rounds:i}){if(typeof r!="object")return{error:Fe};if(!Array.isArray(i))return{error:Se,info:Yt("rounds")};const s=[],a=i.sort((v,f)=>(v.sortOrder||0)-(f.sortOrder||0));e=e||Object.assign({},...Object.values(r).map(v=>Sa({tournamentRecord:v}).containedStructures)),o||({matchUps:o}=ho({nextMatchUps:!0,tournamentRecords:r}));let c=0;const l={},u={},d={},p=a.flatMap(v=>{var f;const m=v.periodLength||n,g=e[v.structureId]||[v.structureId],h={tournamentIds:[v.tournamentId],roundNumbers:[v.roundNumber],matchUpIds:v.matchUpIds,eventIds:[v.eventId],drawIds:[v.drawId],structureIds:g};let _=Vi(TK(Uy({},h),{processContext:!0,matchUps:o})).sort(_s);const{segmentNumber:I,segmentsCount:P}=v.roundSegment||{};if(lt(I)&&Lr(_==null?void 0:_.length)&&Lr(P)&&I>0&&I<=P&&P<(_==null?void 0:_.length)&&!((f=v.matchUpIds)!=null&&f.length)){const E=_.length/P,T=E*(I-1);_=_.slice(T,T+E)}const S=r[v.tournamentId],{event:y}=Ft({drawId:v.drawId,tournamentRecord:S}),O=[],b={};for(const E of _){const T=E.matchUpFormat;b[T]||(b[T]=[],O.push(T)),O.push(E)}for(const E of O){const{eventType:T,category:N,categoryType:w}=y||{},{categoryName:$,ageCategoryCode:U}=N||{},{typeChangeRecoveryMinutes:A,recoveryMinutes:C,averageMinutes:M,error:D}=Pm({categoryName:$||U,tournamentId:v.tournamentId,eventId:v.eventId,tournamentRecords:r,matchUpFormat:E,categoryType:w,eventType:T});if(D)return{error:D,round:v};const V=_.filter(({matchUpStatus:W})=>(t||!Rt.includes(W))&&W!==qe).map($t);V.forEach(W=>{d[W]={typeChangeRecoveryMinutes:A,recoveryMinutes:C,averageMinutes:M},l[W]=C,u[W]=M}),s.push(...V),c=Math.max(M||0,c);const R=`${M}|${m}`;return{roundPeriodLength:m,recoveryMinutes:C,averageMinutes:M,matchUpIds:V,hash:R}}});return Uy({scheduledRoundsDetails:p,greatestAverageMinutes:c,recoveryMinutesMap:l,averageMinutesMap:u,orderedMatchUpIds:s,minutesMap:d},B)}function SM({tournamentRecords:t}){const r=Object.keys(t).reduce((i,s)=>{const a=t[s],{tournamentInfo:{startDate:c,endDate:l}}=tl({tournamentRecord:a}),u=c&&new Date(Me(c));(!i.startDate||u&&u<i.startDate)&&(i.startDate=u);const d=l&&new Date(Me(l));return(!i.endDate||d&&d>i.endDate)&&(i.endDate=d),i},{startDate:void 0,endDate:void 0}),n=r.startDate&&Me(r.startDate.toISOString()),o=r.endDate&&Me(r.endDate.toISOString());return!n||!o?{error:vA}:{startDate:n,endDate:o}}var EK=Object.defineProperty,wK=Object.defineProperties,NK=Object.getOwnPropertyDescriptors,Cy=Object.getOwnPropertySymbols,$K=Object.prototype.hasOwnProperty,AK=Object.prototype.propertyIsEnumerable,My=(t,e,r)=>e in t?EK(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Om=(t,e)=>{for(var r in e||(e={}))$K.call(e,r)&&My(t,r,e[r]);if(Cy)for(var r of Cy(e))AK.call(e,r)&&My(t,r,e[r]);return t},UK=(t,e)=>wK(t,NK(e));function Ea({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Fe};const{extension:e}=td({name:Mo,tournamentRecords:t});let r=(e==null?void 0:e.value)||[];if(r.length){const{venueIds:n}=em({tournamentRecords:t,requireCourts:!0}),{eventIds:o,drawIds:i}=bd({tournamentRecords:t}),{updatedSchedulingProfile:s,modifications:a,issues:c}=Rd({schedulingProfile:r,venueIds:n,eventIds:o,drawIds:i});if(a){r=s;const l=rl({tournamentRecords:t,schedulingProfile:r});return l.error?l:{schedulingProfile:r,modifications:a,issues:c}}}return{schedulingProfile:r,modifications:0}}function rl({tournamentRecords:t,schedulingProfile:e}){const r=jd({tournamentRecords:t,schedulingProfile:e});return r.error?r:e?Sv({tournamentRecords:t,extension:{name:Mo,value:e}}):rd({tournamentRecords:t,name:Mo})}function bM({tournamentRecords:t,scheduleDate:e,venueId:r,round:n}){if(!Nr(e))return{error:ar};const o="addSchedulingProfileRound",{extension:i}=td({tournamentRecords:t,name:Mo}),s=(i==null?void 0:i.value)||[];let a=s.find(v=>qn(e,v.scheduleDate));if(!a){const{startDate:v,endDate:f}=SM({tournamentRecords:t}),m=new Date(e);if(m<new Date(v)||m>new Date(f))return{error:ar};a={scheduleDate:e,venues:[]},s.push(a)}let c=a.venues.find(v=>v.venueId===r);c||(c={venueId:r,rounds:[]},a.venues.push(c));const l=["notBeforeTime"],u=v=>Object.keys(v).filter(f=>!l.includes(f)).sort().map(f=>Ki(v[f])?u(v[f]):v[f]).flat().join("|");if(c.rounds.find(v=>u(v)===u(n)))return k({result:{error:lR},stack:o});c.rounds.push(n);const p=rl({tournamentRecords:t,schedulingProfile:s});return p.error?p:Om({},B)}function Rd({schedulingProfile:t,venueIds:e,eventIds:r,drawIds:n}){const o=[],i=t==null?void 0:t.map(a=>{const c=Me(a==null?void 0:a.scheduleDate);if(!c){o.push(`Invalid date: ${a==null?void 0:a.scheduledDate}`);return}const l=((a==null?void 0:a.venues)||[]).map(u=>{const{rounds:d,venueId:p}=u;if(!e.includes(p)){o.push(`Missing venueId: ${p}`);return}const f=d.filter(m=>{const g=r.includes(m.eventId)&&n.includes(m.drawId);return g||o.push(`Invalid eventId: ${m.eventId} or drawId: ${m.drawId}`),g});if(f.length)return{venueId:p,rounds:f}}).filter(Boolean);return l.length&&c&&UK(Om({},a),{venues:l})}).filter(Boolean),s=o.length;return{updatedSchedulingProfile:i,modifications:s,issues:o}}function TM({tournamentRecords:t}){const{schedulingProfile:e}=Ea({tournamentRecords:t,requireCourts:!0});if(e){const{venueIds:r}=em({tournamentRecords:t}),{eventIds:n,drawIds:o}=bd({tournamentRecords:t}),{updatedSchedulingProfile:i,modifications:s}=Rd({schedulingProfile:e,venueIds:r,eventIds:n,drawIds:o});if(s)return rl({tournamentRecords:t,schedulingProfile:i})}return Om({},B)}function _u({matchUps:t=[],schedulingProfile:e}){const r={},n=({eventId:a,drawId:c,structureId:l,roundNumber:u})=>`${a}|${c}|${l}${u}`;e!=null&&e.length&&e.map(({venues:c})=>c.map(({rounds:l})=>l)).flat().forEach(c=>{c.sort((u,d)=>(u.sortOrder||0)-(d.sortOrder||0)).forEach(({eventId:u,drawId:d,structureId:p,roundNumber:v},f)=>{const m=n({eventId:u,drawId:d,structureId:p,roundNumber:v});r[m]=f})});const o=[],i={noScheduledDate:[]};for(const a of t){const c=a.schedule||{},l=c.scheduledDate&&Me(c.scheduledDate)||c.scheduledTime&&Me(c.scheduledTime)||"noScheduledDate";i[l]||(i[l]=[]),i[l].push(a)}const s=Object.keys(i).sort();for(const a of s){const c=i[a],l={noScheduledTime:[]};for(const d of c){const p=d.schedule||{},v=p.scheduledTime&&tt(p.scheduledTime)||"noScheduledTime";l[v]||(l[v]=[]),l[v].push(d)}const u=Object.keys(l).sort();for(const d of u){const p=l[d];p.sort((v,f)=>{const m=r[n(v)]||0,g=r[n(f)]||0;return m-g}),o.push(...p)}}return o}var CK=Object.defineProperty,MK=Object.defineProperties,DK=Object.getOwnPropertyDescriptors,Dy=Object.getOwnPropertySymbols,jK=Object.prototype.hasOwnProperty,RK=Object.prototype.propertyIsEnumerable,jy=(t,e,r)=>e in t?CK(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Il=(t,e)=>{for(var r in e||(e={}))jK.call(e,r)&&jy(t,r,e[r]);if(Dy)for(var r of Dy(e))RK.call(e,r)&&jy(t,r,e[r]);return t},Cp=(t,e)=>MK(t,DK(e));function Sm(t){var e,r,n,o;if(typeof(t==null?void 0:t.tournamentRecords)!="object"||!Object.keys(t==null?void 0:t.tournamentRecords).length)return{error:Fe};const{courts:i,venues:s}=Is(t),a=Ea(t).schedulingProfile,{matchUpFilters:c={},contextFilters:l={}}=t,{sortDateMatchUps:u=!0,courtCompletedMatchUps:d,alwaysReturnCompleted:p,activeTournamentId:v,tournamentRecords:f,withCourtGridRows:m,minCourtGridRows:g,usePublishState:h,status:_=Nn,sortCourtsData:I}=t,P=h&&gd({tournamentRecord:f[v],itemType:`${$r}.${Ar}`}).timeItem,S=(e=P==null?void 0:P.itemValue)==null?void 0:e[_],y=p?yf(Cp(Il({},t),{matchUpFilters:Cp(Il({},c),{matchUpStatuses:[_t]}),contextFilters:l})).completedMatchUps:[];if(h&&(!S||!Object.keys(S).length))return{completedMatchUps:y,dateMatchUps:[],courtsData:[],venues:s};const O=h&&FK({tournamentRecords:f}).drawIds;O!=null&&O.length&&(l.drawIds?l.drawIds=l.drawIds.filter(C=>O.includes(C)):l.drawIds=O),(r=S==null?void 0:S.eventIds)!=null&&r.length&&(c.eventIds&&c.eventIds.length?c.eventIds=c.eventIds.filter(C=>S.eventIds.includes(C)):c.eventIds=S.eventIds),(n=S==null?void 0:S.scheduledDates)!=null&&n.length&&(c.scheduledDates&&c.scheduledDates.length?c.scheduledDates=c.scheduledDates.filter(C=>S.scheduledDates.includes(C)):c.scheduledDates=S.scheduledDates),p&&((o=c.excludeMatchUpStatuses)!=null&&o.length?c.excludeMatchUpStatuses.includes(_t)||c.excludeMatchUpStatuses.push(_t):c.excludeMatchUpStatuses=[_t]);const{completedMatchUps:b,upcomingMatchUps:E,pendingMatchUps:T}=yf(Cp(Il({},t),{matchUpFilters:c,contextFilters:l})),N=[...E||[],...T||[]],w=u?_u({matchUps:N,schedulingProfile:a}):N,$=i.map(C=>{const M=A(C);return Il({surfaceCategory:(C==null?void 0:C.surfaceCategory)||"",matchUps:M},C)}),U={courtsData:$,completedMatchUps:p?y:b,dateMatchUps:w,venues:s};if(m){const{rows:C,courtPrefix:M}=GC({minRowsCount:g,courtsData:$});U.courtPrefix=M,U.rows=C}return U;function A({courtId:C}){const D=(d?w.concat(b||[]):w).filter(V=>{var R,W,x;return((R=V.schedule)==null?void 0:R.courtId)===C||((x=(W=V.schedule)==null?void 0:W.allocatedCourts)==null?void 0:x.map(({courtId:K})=>K).includes(C))});return I?_u({matchUps:D,schedulingProfile:a}):D}}function FK({tournamentRecords:t}){var e,r;const n=[];for(const o of Object.values(t))for(const i of o.events||[]){const{timeItem:s}=yo({itemType:`${$r}.${Ar}`,event:i}),a=(e=s==null?void 0:s.itemValue)==null?void 0:e[Nn];if((r=a==null?void 0:a.drawIds)!=null&&r.length)n.push(...a.drawIds);else{const c=(i.drawDefinitions||[]).map(({drawId:l})=>l).filter(Boolean);n.push(...c)}}return{drawIds:n}}var VK=Object.defineProperty,LK=Object.defineProperties,BK=Object.getOwnPropertyDescriptors,Ry=Object.getOwnPropertySymbols,xK=Object.prototype.hasOwnProperty,GK=Object.prototype.propertyIsEnumerable,Fy=(t,e,r)=>e in t?VK(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,kK=(t,e)=>{for(var r in e||(e={}))xK.call(e,r)&&Fy(t,r,e[r]);if(Ry)for(var r of Ry(e))GK.call(e,r)&&Fy(t,r,e[r]);return t},WK=(t,e)=>LK(t,BK(e));function EM({calculateStartTimeFromCourts:t=!0,defaultRecoveryMinutes:e=0,averageMatchUpMinutes:r=90,remainingScheduleTimes:n,clearScheduleDates:o,tournamentRecords:i,periodLength:s,scheduleDate:a,startTime:c,venueIds:l,endTime:u}){if(typeof i!="object"||!Object.keys(i).length)return{error:Fe};s=s||Id({recoveryMinutes:e,averageMatchUpMinutes:r});const{courts:d,venues:p}=Is({dates:[a],ignoreDisabled:!0,tournamentRecords:i}),v=d.filter(b=>!l||l.includes(b.venueId));c||(c=v.reduce((b,E)=>{var T;const N=(T=E.dateAvailability)==null?void 0:T.find($=>!$.date||qn(a,$.date)),w=(N==null?void 0:N.startTime)||E.startTime;return w&&(!b||je(w)<je(b))?w:b},void 0)),u||(u=v.reduce((b,E)=>{var T;const N=(T=E.dateAvailability)==null?void 0:T.find($=>!$.date||qn(a,$.date)),w=(N==null?void 0:N.endTime)||E.endTime;return w&&(!b||je(w)>je(b))?w:b},void 0));const f=Object.assign({},...Object.values(i).map(b=>(b.events||[]).map(E=>{const{scheduleTiming:T}=bc({tournamentRecord:b,event:E});return{[E.eventId]:{event:E,scheduleTiming:T}}})).flat()),g=Sm({afterRecoveryTimes:!0,sortDateMatchUps:!1,tournamentRecords:i,matchUpFilters:{scheduledDate:a,venueIds:l}}),h=[].concat(...g.dateMatchUps||[],...g.completedMatchUps||[]),_={averageTimes:[{minutes:{default:r}}],recoveryTimes:[{minutes:{default:e}}]},I=h==null?void 0:h.map(({eventId:b,schedule:E,matchUpFormat:T})=>{const{event:N,scheduleTiming:w}=f[b],$=N==null?void 0:N.eventType,U=WK(kK({},w),{defaultTiming:_,matchUpFormat:T}),{averageMinutes:A,recoveryMinutes:C}=Xu({eventType:$,timingDetails:U}),{courtId:M,venueId:D}=E,V=tt(E.scheduledTime),R=sr(V,A);return{recoveryMinutes:C,averageMinutes:A,periodLength:s,startTime:V,endTime:R,courtId:M,venueId:D}}),P={calculateStartTimeFromCourts:t,remainingScheduleTimes:n,averageMatchUpMinutes:r,date:a,clearScheduleDates:o,periodLength:s,startTime:c,endTime:u,bookings:I,courts:v},{scheduleTimes:S}=Zv(P),y=(l==null?void 0:l.length)===1&&l[0]||(p==null?void 0:p.length)===1&&p[0].venueId||void 0,O=h.map($t);return{venueId:y,scheduleTimes:S,dateScheduledMatchUpIds:O}}function bm({matchUpScheduleTimes:t,matchUpDependencies:e,allDateMatchUpIds:r,matchUp:n}){var o;const s=(((o=e==null?void 0:e[n.matchUpId])==null?void 0:o.matchUpIds)||[]).filter(c=>r.includes(c)).filter(c=>!t[c]);return{dependenciesScheduled:!(s!=null&&s.length),remainingDependencies:s}}function ta({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:e,timeAfterRecovery:r,matchUp:n}){var o,i,s,a;const{individualParticipantIds:c}=hd(n);r=r||((o=n.schedule)==null?void 0:o.timeAfterRecovery);const l=v=>{t[v]||(t[v]=[]),t[v]=Ve(t[v].concat(...c))},u=v=>{(!e[v]||r>e[v])&&(e[v]=r)},d=((i=n.winnerTo)==null?void 0:i.matchUpId)||n.winnerMatchUpId;d&&(r&&u(d),l(d));const p=((s=n.loserTo)==null?void 0:s.matchUpId)||n.loserMatchUpId;p&&(r&&u(p),l(p)),(a=n.sidesTo)!=null&&a.length&&n.sidesTo.forEach(({matchUpId:v})=>{v&&(r&&u(v),l(v))})}function nl({individualParticipantProfiles:t,participantId:e}){t[e]||(t[e]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function qK({individualParticipantProfiles:t,recoveryValue:e,participantId:r,scheduleTime:n,drawId:o}){t[r].potentialRecovery[o]||(t[r].potentialRecovery[o]=[]),t[r].potentialRecovery[o].push(e),t[r].potentialBookings[o]||(t[r].potentialBookings[o]=[]),t[r].potentialBookings[o].push({timeAfterRecovery:e,scheduleTime:n})}function uc({individualParticipantProfiles:t,matchUpPotentialParticipantIds:e,matchUpNotBeforeTimes:r,matchUpDependencies:n,averageMatchUpMinutes:o=0,typeChangeRecoveryMinutes:i,recoveryMinutes:s=0,scheduleTime:a,matchUp:c}){var l,u;const d=tt((l=c==null?void 0:c.schedule)==null?void 0:l.endTime),p=d?sr(d,parseInt(s)):sr(a,parseInt(o)+parseInt(s)),v=i&&(d?sr(tt(d),i):sr(a,parseInt(o)+parseInt(i))),f=((u=n==null?void 0:n[c.matchUpId])==null?void 0:u.participantIds)||[],m=(c.roundPosition&&e[c.matchUpId]||[]).flat();f.forEach(g=>{nl({individualParticipantProfiles:t,participantId:g});const _=t[g].priorMatchUpType!==c.matchUpType&&v||p;m.includes(g)?qK({individualParticipantProfiles:t,drawId:c.drawId,recoveryValue:_,participantId:g,scheduleTime:a}):(t[g].timeAfterRecovery=_,t[g].bookings.push({scheduleTime:a,timeAfterRecovery:_}))}),ta({matchUpPotentialParticipantIds:e,matchUpNotBeforeTimes:r,timeAfterRecovery:p,matchUp:c})}function wM({matchUpScheduleTimes:t,matchUpDependencies:e,scheduleTime:r,matchUpId:n,details:o}){var i,s,a,c,l;let u;const d=(s=(i=o.minutesMap)==null?void 0:i[n])==null?void 0:s.recoveryMinutes,v=(((c=(a=o.minutesMap)==null?void 0:a[n])==null?void 0:c.averageMinutes)||0)+(d||0),f=sr(r,v),m=((l=e==null?void 0:e[n])==null?void 0:l.dependentMatchUpIds)||[];if(m.length){const g=m.reduce((h,_)=>{const I=t[_];if(!I)return h;const P={scheduleTime:I,matchUpId:_};return I&&!h.matchUpId||je(I)<je(h.scheduleTime)?P:h},{});g.scheduleTime&&je(f)>je(g.scheduleTime)&&(u=g)}return{scheduledDependent:u}}function HK(t){const{sides:e,matchUpType:r}=t||{};return(e||[]).map(n=>{var o;return r===ot&&(((o=n==null?void 0:n.participant)==null?void 0:o.individualParticipants)||[])||(n==null?void 0:n.participant)&&[n.participant]||[]}).flat()}const Fd="DO_NOT_SCHEDULE";var YK=Object.defineProperty,KK=Object.defineProperties,zK=Object.getOwnPropertyDescriptors,Vy=Object.getOwnPropertySymbols,QK=Object.prototype.hasOwnProperty,JK=Object.prototype.propertyIsEnumerable,Ly=(t,e,r)=>e in t?YK(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ZK=(t,e)=>{for(var r in e||(e={}))QK.call(e,r)&&Ly(t,r,e[r]);if(Vy)for(var r of Vy(e))JK.call(e,r)&&Ly(t,r,e[r]);return t},XK=(t,e)=>KK(t,zK(e));function Tm({averageMatchUpMinutes:t=90,requestConflicts:e={},potentials:r=!0,personRequests:n,scheduleTime:o,scheduleDate:i,matchUp:s}){const a=HK(s).map(({person:v})=>v==null?void 0:v.personId);if(r){const v=((s==null?void 0:s.potentialParticipants)||[]).flat().map(({person:f})=>f==null?void 0:f.personId);a.push(...v)}const c=a.map(v=>{var f;return(f=n[v])==null?void 0:f.map(m=>XK(ZK({},m),{personId:v}))}).filter(Boolean).flat().filter(v=>v.requestType===Fd&&qn(i,v.date)),l=[],u=s==null?void 0:s.matchUpId,d=mt(tt(o),Me(i)),p=tt(cv(d,t).toISOString());for(const v of c){const{requestId:f,startTime:m,endTime:g}=v;(o>m&&o<g||p>m&&p<g)&&(l.push({matchUpId:u,request:v,scheduleTime:o}),e[f]?(e[f].scheduleTimes.includes(o)||e[f].scheduleTimes.push(o),e[f].matchUpIds.includes(u)||e[f].matchUpIds.push(u)):e[f]={request:v,scheduleTimes:[o],matchUpIds:[u]})}return{conflicts:l}}function $f({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUp:r,value:n}){const{matchUpType:o}=r,{individualParticipantIds:i}=hd(r),a=(t[r.matchUpId]||[]).filter(l=>!Gt(l,i)).flat();[...i,...a].forEach(l=>{if(nl({individualParticipantProfiles:e,participantId:l}),!e[l].potentialCounted[r.drawId]){const u=e[l].counters;u[o]?u[o]+=n:n>0&&(u[o]=n),u[en]?u[en]+=n:n>0&&(u[en]=n),a.includes(l)&&(e[l].potentialCounted[r.drawId]=!0)}})}function ez({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:r,greatestAverageMinutes:n,dateScheduledMatchUps:o,matchUpNotBeforeTimes:i,matchUpScheduleTimes:s,matchUpDependencies:a,clearScheduleDates:c,scheduleDate:l,minutesMap:u,matchUps:d}){var p,v;r||(o=d==null?void 0:d.filter(g=>el(g)&&(!l||g.schedule.scheduledDate===l)),r=o.map($t));const f=Array.isArray(c)?c.includes(l):c,m=f?[]:d.filter(({matchUpId:g})=>r.includes(g));for(const g of m){$f({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,scheduleDate:l,matchUp:g,value:1});const h=(p=g.schedule)==null?void 0:p.scheduledTime;if(h){s[g.matchUpId]=h;const _=(v=u==null?void 0:u[g.matchUpId])==null?void 0:v.recoveryMinutes;uc({individualParticipantProfiles:e,matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:i,matchUpDependencies:a,recoveryMinutes:_,averageMatchUpMinutes:n,scheduleDate:l,scheduleTime:h,matchUp:g})}}return{clearDate:f,dateScheduledMatchUpIds:r,dateScheduledMatchUps:o}}function tz({scheduledRoundsDetails:t,greatestAverageMinutes:e,garmanSinglePass:r}){let n,o=[],i,s,a,c=[];for(const l of t.filter(Boolean))n||(n=l.hash),(l.hash===n||r)&&(o=o.concat(l.matchUpIds)),l.hash!==n&&!r&&(n=l.hash,c.push({averageMinutes:i,recoveryMinutes:s,roundPeriodLength:a,matchUpIds:o}),o=l.matchUpIds),i=r?e:l.averageMinutes,s=l.recoveryMinutes,a=l.roundPeriodLength;return o.length&&c.push({averageMinutes:i,recoveryMinutes:s,roundPeriodLength:a,matchUpIds:o}),{groupedRounds:c}}function rz({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:e,dateScheduledMatchUpIds:r,matchUpNotBeforeTimes:n,orderedMatchUpIds:o,clearDate:i,matchUps:s}){const a=o.map(l=>s.find(u=>u.matchUpId===l)).filter(Boolean).filter(l=>{const u=!i&&r.includes(l.matchUpId),d=[qe,Be,_t,gr,Xt,Ge,gt,Ot].includes(l==null?void 0:l.matchUpStatus);return e||!u&&!l.winningSide&&!d}),{matchUpMap:c}=a.reduce((l,u)=>{const{drawId:d,tournamentId:p}=u;return l.matchUpMap[p]||(l.matchUpMap[p]={}),l.matchUpMap[p][d]?l.matchUpMap[p][d].push(u):l.matchUpMap[p][d]=[u],ta({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:n,matchUp:u}),l},{matchUpMap:{}});return{matchUpsToSchedule:a,matchUpMap:c}}var nz=Object.defineProperty,oz=Object.defineProperties,iz=Object.getOwnPropertyDescriptors,By=Object.getOwnPropertySymbols,sz=Object.prototype.hasOwnProperty,az=Object.prototype.propertyIsEnumerable,xy=(t,e,r)=>e in t?nz(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,cz=(t,e)=>{for(var r in e||(e={}))sz.call(e,r)&&xy(t,r,e[r]);if(By)for(var r of By(e))az.call(e,r)&&xy(t,r,e[r]);return t},lz=(t,e)=>oz(t,iz(e));function Em({defaultRecoveryMinutes:t=0,averageMatchUpMinutes:e=90,dateScheduledMatchUps:r,tournamentRecords:n,venueIds:o=[],periodLength:i,scheduleDate:s,matchUps:a}){if(typeof n!="object")return{error:Fe};if(!Array.isArray(a)&&!Array.isArray(r))return{error:ko};i=i||Id({recoveryMinutes:t,averageMatchUpMinutes:e});const c=Object.assign({},...Object.values(n).map(p=>(p.events||[]).map(v=>{const{scheduleTiming:f}=bc({tournamentRecord:p,event:v});return{[v.eventId]:{event:v,scheduleTiming:f}}})).flat()),l={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]};r||(r=a==null?void 0:a.filter(p=>el(p)&&(!s||p.schedule.scheduledDate===s)));const u=r==null?void 0:r.filter(p=>!o.length||o.includes(p.schedule.venueId));return{bookings:u==null?void 0:u.map(({eventId:p,schedule:v,matchUpFormat:f})=>{const{event:m,scheduleTiming:g}=c[p],h=m==null?void 0:m.eventType,_=lz(cz({},g),{defaultTiming:l,matchUpFormat:f}),{averageMinutes:I,recoveryMinutes:P}=Xu({timingDetails:_,eventType:h}),{courtId:S,venueId:y}=v,O=tt(v.scheduledTime),b=sr(O,I);return{recoveryMinutes:P,averageMinutes:I,periodLength:i,startTime:O,courtId:S,endTime:b,venueId:y}}).filter(Boolean),relevantMatchUps:u,dateScheduledMatchUps:r}}function uz({calculateStartTimeFromCourts:t=!0,remainingScheduleTimes:e,defaultRecoveryMinutes:r,averageMatchUpMinutes:n,clearScheduleDates:o,tournamentRecords:i,tournamentRecord:s,periodLength:a,scheduleDate:c,startTime:l,venueIds:u,matchUps:d,endTime:p}){if(s&&!i&&(i={[s.tournamentId]:s}),typeof i!="object"||!Object.keys(i).length)return{error:Fe};a=a||Id({recoveryMinutes:r,averageMatchUpMinutes:n});const{courts:v,venues:f}=Is({dates:[c],ignoreDisabled:!0,tournamentRecords:i}),m=v.filter(y=>!u||u.includes(y.venueId));l=l||Qs({courts:m,scheduleDate:c,startTime:!0}),p=p||Qs({courts:m,scheduleDate:c,endTime:!0});const{bookings:g,dateScheduledMatchUps:h}=Em({defaultRecoveryMinutes:r,averageMatchUpMinutes:n,tournamentRecords:i,scheduleDate:c,periodLength:a,venueIds:u,matchUps:d}),_={calculateStartTimeFromCourts:t,remainingScheduleTimes:e,averageMatchUpMinutes:n,clearScheduleDates:o,date:c,periodLength:a,startTime:l,bookings:g,endTime:p,courts:m},{scheduleTimes:I}=Zv(_),P=(u==null?void 0:u.length)===1&&u[0]||(f==null?void 0:f.length)===1&&f[0].venueId||void 0;return{dateScheduledMatchUpIds:h==null?void 0:h.map($t),dateScheduledMatchUps:h,scheduleTimes:I,venueId:P}}function NM({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,scheduleCompletedMatchUps:r,containedStructureIds:n,matchUpNotBeforeTimes:o,matchUpScheduleTimes:i,matchUpDependencies:s,clearScheduleDates:a,tournamentRecords:c,periodLength:l,scheduleDate:u,useGarman:d,matchUps:p,courts:v,venues:f}){var m;const g={},h=[],_=[];for(const I of f){const{rounds:P=[],venueId:S}=I,{scheduledRoundsDetails:y,greatestAverageMinutes:O,orderedMatchUpIds:b,minutesMap:E}=ym({scheduleCompletedMatchUps:r,containedStructureIds:n,tournamentRecords:c,periodLength:l,matchUps:p,rounds:P});_.push(...b);const{groupedRounds:T}=tz({scheduledRoundsDetails:y,greatestAverageMinutes:O,garmanSinglePass:!0});let N,w,$=[],U;d&&({scheduleTimes:$,dateScheduledMatchUpIds:N,dateScheduledMatchUps:w}=uz({averageMatchUpMinutes:(m=T[0])==null?void 0:m.averageMinutes,scheduleDate:Me(u),venueIds:[I.venueId],clearScheduleDates:a,tournamentRecords:c,periodLength:l,matchUps:p})),{clearDate:U,dateScheduledMatchUpIds:N,dateScheduledMatchUps:w}=ez({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:N,greatestAverageMinutes:O,matchUpNotBeforeTimes:o,matchUpScheduleTimes:i,matchUpDependencies:s,clearScheduleDates:a,scheduleDate:u,minutesMap:E,matchUps:p});const{matchUpsToSchedule:A,matchUpMap:C}=rz({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:r,dateScheduledMatchUpIds:N,matchUpNotBeforeTimes:o,orderedMatchUpIds:b,clearDate:U,matchUps:p}),M=v.filter(D=>D.venueId===S);g[S]={previousRemainingScheduleTimes:[],courtsCount:M.length,greatestAverageMinutes:O,scheduledRoundsDetails:y,dateScheduledMatchUps:w,matchUpsToSchedule:A,scheduleTimes:$,groupedRounds:T,venueCourts:M,minutesMap:E,matchUpMap:C},a||h.push(...N)}return{allDateScheduledMatchUpIds:h,venueScheduledRoundDetails:g,allDateMatchUpIds:_}}function dz(t,e){const r=je(t.scheduleTime),n=je(t.timeAfterRecovery),o=je(e.scheduleTime),i=je(e.timeAfterRecovery),s=r===o||n===i,a=r>o&&r<i,c=o>r&&o<n,l=n>o&&n<i,u=i>r&&i<n;return _e({hasOverlap:s||a||l||c||u,startAisContained:a,endAisContained:l,startBisContained:c,endBisContained:u},!0)}function wm({individualParticipantProfiles:t,matchUpNotBeforeTimes:e,matchUpDependencies:r,scheduleTime:n,matchUp:o,details:i}){var s,a,c,l,u;const d=(((s=r==null?void 0:r[o.matchUpId])==null?void 0:s.participantIds)||[]).flat(),p=((c=(a=i==null?void 0:i.minutesMap)==null?void 0:a[o.matchUpId])==null?void 0:c.averageMinutes)||0,v=((u=(l=i==null?void 0:i.minutesMap)==null?void 0:l[o.matchUpId])==null?void 0:u.recoveryMinutes)||0,f=d.every(I=>{var P;nl({individualParticipantProfiles:t,participantId:I});let S=t[I];if(!S.timeAfterRecovery)return!0;const y=tt((P=o==null?void 0:o.schedule)==null?void 0:P.endTime),O=y?sr(y,parseInt(v)):sr(n,parseInt(p)+parseInt(v));return!!![...Object.keys(S.potentialBookings).filter(N=>N!==o.drawId).map(N=>S.potentialBookings[N]).flat(),...S.bookings].find(N=>dz({scheduleTime:n,timeAfterRecovery:O},N).hasOverlap)}),m=e[o.matchUpId],h=(m?Oc(mt(m),mt(n),!1):0)>=0;return{enoughTime:f&&h}}function Nm({individualParticipantProfiles:t,matchUpPotentialParticipantIds:e,matchUpDailyLimits:r={},matchUp:n}){const{matchUpId:o,matchUpType:i}=n,{enteredIndividualParticipantIds:s}=hd(n),a=(n.roundPosition&&e[o]||[]).flat(),c=Ve(s.concat(...a));return c.forEach(u=>{nl({individualParticipantProfiles:t,participantId:u})}),{participantIdsAtLimit:c.filter(u=>{const d=t[u];if(d)return[i,en].find(p=>{var v;const f=((v=d.counters)==null?void 0:v[p])||0,m=r[p]||0;return f&&m&&f>=m})}),relevantParticipantIds:c}}const pz="deleteDrawDefinitions",fz="autoSchedulingAudit",Gy="deleteEvents";function $M({autoSchedulingAudit:t,tournamentRecords:e}){var r;Le({topic:tc,payload:t});const n=a=>a?Object.values(a).reduce((l,u)=>l+u.length||0,0):0,o=((t==null?void 0:t.schedulingProfile)||[]).reduce((a,c)=>a+c.venues.reduce((l,u)=>l+u.rounds.length,0),0),i={scheduledDatesCount:(r=t.scheduledDates)==null?void 0:r.length,noTimeMatchUpIdsCount:n(t==null?void 0:t.noTimeMatchUpIds),scheduledMatchUpIdsCount:n(t==null?void 0:t.scheduledMatchUpIds),overLimitMatchUpIdsCount:n(t==null?void 0:t.overLimitMatchUpIds),requestConflictsCount:n(t==null?void 0:t.requestConflicts),profileRoundsCount:o},s={itemType:fz,itemValue:i};for(const a of Object.values(e))Oo({tournamentRecord:a,timeItem:s})}var vz=Object.defineProperty,mz=Object.defineProperties,gz=Object.getOwnPropertyDescriptors,ky=Object.getOwnPropertySymbols,hz=Object.prototype.hasOwnProperty,_z=Object.prototype.propertyIsEnumerable,Wy=(t,e,r)=>e in t?vz(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Iz=(t,e)=>{for(var r in e||(e={}))hz.call(e,r)&&Wy(t,r,e[r]);if(ky)for(var r of ky(e))_z.call(e,r)&&Wy(t,r,e[r]);return t},Pz=(t,e)=>mz(t,gz(e));function yz({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:r,schedulingProfileIssues:n,dateSchedulingProfiles:o,containedStructureIds:i,matchUpDependencies:s,matchUpDailyLimits:a,clearScheduleDates:c,schedulingProfile:l,tournamentRecords:u,personRequests:d,periodLength:p,matchUps:v,courts:f,dryRun:m}){var g,h,_,I,P,S,y;const O={},b={},E={},T={},N={},w={},$={},U={},A={},C={};for(const V of o){const R=Me(V==null?void 0:V.scheduleDate),W=(V==null?void 0:V.venues)||[],x={},K={},j=(Y,J)=>{Y.forEach(te=>{const ne=K[te].counters;ne[J]?ne[J]+=1:ne[J]=1,ne[en]?ne[en]+=1:ne[en]=1})};E[R]={},T[R]={},O[R]={},b[R]={},$[R]=[],U[R]=[],A[R]=[],C[R]=[];const L={};v.forEach(Y=>{var J;(J=Y.schedule)!=null&&J.scheduledDate&&qn(R,Me(Y.schedule.scheduledDate))&&ta({matchUpPotentialParticipantIds:x,matchUpNotBeforeTimes:L,matchUp:Y})});const{venueScheduledRoundDetails:F,allDateMatchUpIds:q}=NM({matchUpPotentialParticipantIds:x,individualParticipantProfiles:K,scheduleCompletedMatchUps:r,containedStructureIds:i,matchUpNotBeforeTimes:L,matchUpScheduleTimes:w,matchUpDependencies:s,clearScheduleDates:c,tournamentRecords:u,useGarman:!0,periodLength:p,scheduleDate:R,matchUps:v,courts:f,venues:W}),G=10;let H,Q=0,z=10;for(;!H;){for(const{venueId:Y}of W){let J=0;const te=F[Y];for(;te.courtsCount&&((g=te.scheduleTimes)!=null&&g.length)&&((h=te.matchUpsToSchedule)!=null&&h.length)&&J<=te.courtsCount;){const{scheduleTime:ne,attempts:oe=0}=te.scheduleTimes.shift(),se=te.matchUpsToSchedule.find(ve=>{var X,ie;const{matchUpId:fe,matchUpType:Ee}=ve,{participantIdsAtLimit:re,relevantParticipantIds:ae}=Nm({matchUpPotentialParticipantIds:x,individualParticipantProfiles:K,matchUpDailyLimits:a,matchUp:ve});if(re.length)return U[R].includes(fe)||U[R].push(fe),!1;const{scheduledDependent:me}=wM({matchUpScheduleTimes:w,matchUpDependencies:s,scheduleTime:ne,matchUpId:fe,details:te});if(me)return!1;const{dependenciesScheduled:Oe,remainingDependencies:ce}=bm({matchUpScheduleTimes:w,matchUpDependencies:s,allDateMatchUpIds:q,matchUps:v,matchUp:ve});if(!Oe)return T[R][fe]||(T[R][fe]=[]),T[R][fe].push({scheduleTime:ne,remainingDependencies:ce}),!1;const{enoughTime:Pe}=wm({individualParticipantProfiles:K,matchUpNotBeforeTimes:L,matchUpDependencies:s,scheduleTime:ne,details:te,matchUp:ve});if(!Pe)return E[R][fe]||(E[R][fe]=[]),E[R][fe].push({scheduleTime:ne}),!1;const $e=te.greatestAverageMinutes,{conflicts:ye}=Tm({potentials:e,averageMatchUpMinutes:$e,requestConflicts:C,personRequests:d,scheduleTime:ne,scheduleDate:R,matchUp:ve});if(ye!=null&&ye.length)return N[R]||(N[R]=[]),N[R].push(...ye),!1;j(ae,Ee);const Ae=(ie=(X=te.minutesMap)==null?void 0:X[fe])==null?void 0:ie.recoveryMinutes;return uc({matchUpPotentialParticipantIds:x,individualParticipantProfiles:K,matchUpNotBeforeTimes:L,averageMatchUpMinutes:$e,matchUpDependencies:s,recoveryMinutes:Ae,scheduleDate:R,scheduleTime:ne,matchUp:ve}),w[fe]=ne,!0});te.matchUpsToSchedule=te.matchUpsToSchedule.filter(({matchUpId:ve})=>ve!==(se==null?void 0:se.matchUpId)),se?J+=1:(b[R][Y]||(b[R][Y]=[]),b[R][Y].push({scheduleTime:ne,attempts:oe+1}))}(_=te.matchUpsToSchedule)!=null&&_.length&&(b[R][Y]=(I=b[R][Y])==null?void 0:I.filter(ne=>{const oe=ne.attempts<z;return oe&&te.scheduleTimes.push(ne),!oe})),(!((P=te.scheduleTimes)!=null&&P.length)||!((S=te.matchUpsToSchedule)!=null&&S.length))&&(te.complete=!0)}Q+=1,H=W.every(({venueId:Y})=>F[Y].complete)||Q===G}for(const{venueId:Y}of W){const J=F[Y].matchUpMap;Object.keys(J).forEach(te=>{const ne=u[te];ne&&Object.keys(J[te]).forEach(oe=>{const{drawDefinition:se}=Ho({tournamentRecord:ne,drawId:oe});se&&J[te][oe].forEach(({matchUpId:X})=>{const ie=w[X];if(ie){const fe=ie.split(":").map(Wn).join(":"),Ee=`${Me(R)}T${fe}`;m?$[R].push(X):(bi({drawDefinition:se,scheduledTime:Ee,matchUpId:X}).success&&$[R].push(X),Y&&Oa({tournamentRecord:ne,drawDefinition:se,matchUpId:X,venueId:Y}))}})})}),A[R]=F[Y].matchUpsToSchedule.map($t),O[R][Y]=F[Y].scheduleTimes.sort((te,ne)=>je(te.scheduleTime)-je(ne.scheduleTime))}for(const Y of V.venues)for(const J of Y.rounds){const ne=(((y=J.matchUps)==null?void 0:y.map(({matchUpId:se})=>se))||[]).filter(se=>$[R].includes(se));J.canScheduledMatchUpIds=ne;let oe=Math.round(ne.length/J.matchUpsCount*1e4)/100;(oe===1/0||isNaN(oe))&&(oe=0),J.possibleToSchedulePct=oe,J.matchUpsCount===ne.length&&(J.possibleToSchedule=!0)}}const M=o.map(({scheduleDate:V})=>V),D={timeStamp:Date.now(),overLimitMatchUpIds:U,scheduledMatchUpIds:$,schedulingProfile:l,noTimeMatchUpIds:A,requestConflicts:C,scheduledDates:M};return $M({tournamentRecords:u,autoSchedulingAudit:D}),Pz(Iz({},B),{schedulingProfileModifications:t,schedulingProfileIssues:n,scheduleTimesRemaining:O,dateSchedulingProfiles:o,skippedScheduleTimes:b,recoveryTimeDeferredMatchUpIds:E,dependencyDeferredMatchUpIds:T,matchUpScheduleTimes:w,overLimitMatchUpIds:U,scheduledMatchUpIds:$,noTimeMatchUpIds:A,requestConflicts:C,scheduledDates:M})}function qy({averageMinutes:t,startTime:e,endTime:r,court:n,date:o}){if(!Array.isArray(n.dateAvailability))return{error:Se,stack:"getEarliestCourtTime"};const i=Qs({scheduleDate:o,courts:[n],startTime:!0}),s=Qs({scheduleDate:o,courts:[n],endTime:!0});e=e||i,r=r||s;const a=qc({court:n,date:o}),c=ya({courtDate:a}),l=mt(e),u=mt(r);return{earliestCourtTime:c.reduce((p,v)=>{const f=mt(v.startTime),m=mt(v.endTime);if(f>u||m<l)return p;const g=l>f?l:f;if(Oc(g,m)>=t){const I=tt(g.toISOString());(!p||I<p)&&(p=I)}return p},void 0),courtStartTime:i,courtEndTime:s}}var Oz=Object.defineProperty,Sz=Object.defineProperties,bz=Object.getOwnPropertyDescriptors,Hy=Object.getOwnPropertySymbols,Tz=Object.prototype.hasOwnProperty,Ez=Object.prototype.propertyIsEnumerable,Yy=(t,e,r)=>e in t?Oz(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,wz=(t,e)=>{for(var r in e||(e={}))Tz.call(e,r)&&Yy(t,r,e[r]);if(Hy)for(var r of Hy(e))Ez.call(e,r)&&Yy(t,r,e[r]);return t},Nz=(t,e)=>Sz(t,bz(e));function $z({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:r,schedulingProfileIssues:n,dateSchedulingProfiles:o,containedStructureIds:i,matchUpDependencies:s,matchUpDailyLimits:a,clearScheduleDates:c,tournamentRecords:l,periodLength:u=30,schedulingProfile:d,personRequests:p,matchUps:v,courts:f,dryRun:m}){var g;const h={},_={},I={},P={},S={},y={},O={},b={},E={};for(const w of o){const $=Me(w==null?void 0:w.scheduleDate),U=(w==null?void 0:w.venues)||[],A={},C={},M=(z,Y)=>{z.forEach(J=>{const te=C[J].counters;te[Y]?te[Y]+=1:te[Y]=1,te[en]?te[en]+=1:te[en]=1})};h[$]={},_[$]={},y[$]=[],O[$]=[],b[$]=[],E[$]=[];const D={};v.forEach(z=>{var Y;(Y=z.schedule)!=null&&Y.scheduledDate&&qn($,Me(z.schedule.scheduledDate))&&ta({matchUpPotentialParticipantIds:A,matchUpNotBeforeTimes:D,matchUp:z})});const{allDateScheduledMatchUpIds:V,venueScheduledRoundDetails:R,allDateMatchUpIds:W}=NM({matchUpPotentialParticipantIds:A,individualParticipantProfiles:C,scheduleCompletedMatchUps:r,containedStructureIds:i,matchUpNotBeforeTimes:D,matchUpScheduleTimes:S,matchUpDependencies:s,clearScheduleDates:c,tournamentRecords:l,periodLength:u,scheduleDate:$,matchUps:v,courts:f,venues:U}),x=v.filter(({matchUpId:z})=>V.includes(z)),{bookings:K}=Em({dateScheduledMatchUps:x,tournamentRecords:l,scheduleDate:$,periodLength:u}),{virtualCourts:j}=Jv({scheduleDate:$,periodLength:u,bookings:K,courts:f}),L=j.reduce((z,Y)=>{const{earliestCourtTime:J,courtEndTime:te}=qy({date:$,averageMinutes:0,court:Y});return(!z.startTime||mt(J)<mt(z.startTime))&&(z.startTime=J),(!z.endTime||mt(te)>mt(z.endTime))&&(z.endTime=te),z},{});let F=L.startTime;const q=({courtId:z,booking:Y})=>{var J;return(J=j.find(te=>te.courtId===z))==null?void 0:J.dateAvailability[0].bookings.push(Y)},G=10;let H=0,Q;for(;!Q;){for(const{venueId:z}of U){const Y=R[z],J=Y.matchUpsToSchedule.length,te=[],ne=[];let oe,se=0;for(;!oe;){for(const ve of Y.matchUpsToSchedule){if(ne.length===Y.courtsCount||te.length===Y.courtsCount){oe=!0;break}const{matchUpId:X,matchUpType:ie}=ve,{participantIdsAtLimit:fe,relevantParticipantIds:Ee}=Nm({matchUpPotentialParticipantIds:A,individualParticipantProfiles:C,matchUpDailyLimits:a,matchUp:ve});if(fe.length){O[$].includes(X)||O[$].push(X);continue}const{dependenciesScheduled:re,remainingDependencies:ae}=bm({matchUpScheduleTimes:S,matchUpDependencies:s,allDateMatchUpIds:W,matchUps:v,matchUp:ve});if(!re){_[$][X]||(_[$][X]=[]),_[$][X].push({remainingDependencies:ae});continue}const me=[],Oe=j.reduce((ce,Pe)=>{var $e,ye,Ae,be;if(ne.includes(Pe.courtId))return ce;const{earliestCourtTime:ge}=qy({averageMinutes:Y.greatestAverageMinutes,startTime:F,date:$,court:Pe});if(ce.scheduleTime&&je(ge)>=je(ce.scheduleTime))return ce;const{scheduledDependent:Ne}=wM({matchUpScheduleTimes:S,matchUpDependencies:s,scheduleTime:ge,matchUpId:X,details:Y});if(Ne)return ce;const{enoughTime:Ue}=wm({individualParticipantProfiles:C,matchUpNotBeforeTimes:D,matchUpDependencies:s,scheduleTime:ge,details:Y,matchUp:ve});if(!Ue)return h[$][X]||(h[$][X]=[]),h[$][X].includes(ge)||h[$][X].push(ge),ce;const he=((ye=($e=Y.minutesMap)==null?void 0:$e[X])==null?void 0:ye.averageMinutes)||Y.greatestAverageMinutes,{conflicts:xe}=Tm({potentials:e,averageMatchUpMinutes:he,requestConflicts:E,personRequests:p,scheduleTime:ge,scheduleDate:$,matchUp:ve});if(xe!=null&&xe.length)return me.push(...xe),!1;M(Ee,ie);const De=(be=(Ae=Y.minutesMap)==null?void 0:Ae[X])==null?void 0:be.recoveryMinutes;return uc({matchUpPotentialParticipantIds:A,individualParticipantProfiles:C,matchUpNotBeforeTimes:D,averageMatchUpMinutes:he,matchUpDependencies:s,recoveryMinutes:De,scheduleDate:$,scheduleTime:ge,matchUp:ve}),(!ce.scheduleTime||je(ge)<je(ce.scheduleTime))&&(ce.averageMatchUpMinutes=he,ce.recoveryMinutes=De,ce.scheduleTime=ge,ce.courtName=Pe.courtName,ce.courtId=Pe.courtId),ce},{});if(Oe.scheduleTime){const{averageMatchUpMinutes:ce,recoveryMinutes:Pe,scheduleTime:$e,courtId:ye}=Oe;S[X]=$e,P[X]=ye,te.push(X),ne.push(ye);const Ae=$e,be=sr(Ae,ce);q({courtId:ye,booking:{averageMatchUpMinutes:ce,recoveryMinutes:Pe,periodLength:u,matchUpId:X,startTime:Ae,courtId:ye,endTime:be,venueId:z}}),Y.matchUpsToSchedule=Y.matchUpsToSchedule.filter(Ne=>Ne.matchUpId!==X)}else me!=null&&me.length&&(I[$]||(I[$]=[]),I[$].push(...me))}(ne.length===Y.courtsCount||te.length===Y.courtsCount||!Y.matchUpsToSchedule.length)&&(oe=!0),Y.matchUpsToSchedule.length&&te<Y.courtsCount&&(mt(F)<mt(L.endTime)?F=sr(F,u):(oe=!0,Y.complete=!0)),se+=1,!oe&&se>=J&&(oe=!0)}(g=Y.matchUpsToSchedule)!=null&&g.length||(Y.complete=!0)}H+=1,Q=U.every(({venueId:z})=>R[z].complete)||H===G}for(const{venueId:z}of U){const Y=R[z].matchUpMap;Object.keys(Y).forEach(J=>{const te=l[J];te&&Object.keys(Y[J]).forEach(ne=>{const{drawDefinition:oe}=Ho({tournamentRecord:te,drawId:ne});oe&&Y[J][ne].forEach(({matchUpId:ve})=>{const X=S[ve],ie=P[ve];if(X){const fe=X.split(":").map(Wn).join(":"),Ee=`${Me($)}T${fe}`;m||(bi({drawDefinition:oe,scheduledTime:Ee,matchUpId:ve}),Ps({courtDayDate:$,tournamentRecords:l,tournamentRecord:te,drawDefinition:oe,matchUpId:ve,courtId:ie})),y[$].push(ve)}})})}),b[$]=R[z].matchUpsToSchedule.map($t)}for(const z of w.venues)for(const Y of z.rounds){const te=Y.matchUps.map(({matchUpId:oe})=>oe).filter(oe=>y[$].includes(oe));Y.canScheduledMatchUpIds=te;let ne=Math.round(te.length/Y.matchUpsCount*1e4)/100;(ne===1/0||isNaN(ne))&&(ne=0),Y.possibleToSchedulePct=ne,Y.matchUpsCount===te.length&&(Y.possibleToSchedule=!0)}}const T=o.map(({scheduleDate:w})=>w),N={timeStamp:Date.now(),overLimitMatchUpIds:O,scheduledMatchUpIds:y,schedulingProfile:d,noTimeMatchUpIds:b,requestConflicts:E,scheduledDates:T};return $M({tournamentRecords:l,autoSchedulingAudit:N}),Nz(wz({},B),{schedulingProfileModifications:t,schedulingProfileIssues:n,dateSchedulingProfiles:o,recoveryTimeDeferredMatchUpIds:h,dependencyDeferredMatchUpIds:_,matchUpScheduleTimes:S,overLimitMatchUpIds:O,scheduledMatchUpIds:y,noTimeMatchUpIds:b,requestConflicts:E,scheduledDates:T})}var Az=Object.defineProperty,Ky=Object.getOwnPropertySymbols,Uz=Object.prototype.hasOwnProperty,Cz=Object.prototype.propertyIsEnumerable,zy=(t,e,r)=>e in t?Az(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Mz=(t,e)=>{for(var r in e||(e={}))Uz.call(e,r)&&zy(t,r,e[r]);if(Ky)for(var r of Ky(e))Cz.call(e,r)&&zy(t,r,e[r]);return t};function wa({tournamentRecords:t,requestType:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Fe};const r={};for(const n of Object.values(t)){const{extension:o}=hr({name:ma,tournamentRecord:n}),i=(o==null?void 0:o.value)||[];for(const s of i){const{personId:a,requests:c}=s||{};r[a]||(r[a]=[]);for(const l of c)e&&l.requestType!==e||r[a].push(l)}}return{personRequests:r}}function $m({tournamentRecords:t,personRequests:e}){if(!t)return{error:Fe};for(const r of Object.values(t)){const{participants:n}=r,o=[];for(const i of Object.keys(e))if(uo({tournamentParticipants:n,personId:i})){const s=e[i];s.length&&o.push({personId:i,requests:s})}Object.keys(o).length&&_i({tournamentRecord:r,extension:{name:ma,value:o}})}return Mz({},B)}function Dz({tournamentRecords:t,personId:e,requests:r}){if(!t)return{error:Fe};if(typeof e!="string")return{error:Z};if(!Array.isArray(r))return{error:Z};const{personRequests:n}=wa({tournamentRecords:t}),{mergeCount:o}=AM({personRequests:n,personId:e,requests:r});return o?$m({tournamentRecords:t,personRequests:n}):{error:Z}}function AM({personRequests:t,personId:e,requests:r}){t[e]||(t[e]=[]);const n=r.filter(({requestType:o})=>o).map(o=>{let{date:i,requestType:s,startTime:a,endTime:c}=o;return s===Fd&&(i=Me(i),a=tt(a),c=tt(c),i&&a&&c)?{date:i,startTime:a,endTime:c,requestType:s}:o}).filter(Boolean);for(const o of n)o.requestId=jA(),t[e].push(o);return{mergeCount:n.length}}function jz({tournamentRecords:t,requestType:e,requestId:r,personId:n,date:o}){if(typeof t!="object"||!Object.keys(t).length)return{error:Fe};const{personRequests:i}=wa({tournamentRecords:t}),s=c=>{i[c]=i[c].filter(l=>(!e||l.requestType!==e)&&(!r||l.requestId!==r)&&(!o||l.date!==o)),i[c].length||delete i[c]},a=!e&&!r&&!n&&!o;if(!a)if(n&&i[n])s(n);else for(const c of Object.keys(i))s(c);return a||!Object.keys(i).length?rd({tournamentRecords:t,name:ma}):$m({tournamentRecords:t,personRequests:i})}function Rz({tournamentRecords:t,requests:e,personId:r}){if(!t)return{error:Fe};if(!Array.isArray(e))return{error:Z};const n=e.map(({requestId:a})=>a).filter(Boolean),{personRequests:o}=wa({tournamentRecords:t}),i=a=>{o[a]=o[a].map(c=>{if(!n.includes(c.requestId))return c;const l=e.find(u=>u.requestId===c.requestId);if(l.requestType)return Object.assign(c,l)}).filter(Boolean)};if(r&&o[r])i(r);else for(const a of Object.keys(o))i(a);const s=e.filter(a=>!a.requestId);return s.length&&AM({personRequests:o,personId:r,requests:s}),$m({tournamentRecords:t,personRequests:o})}var Fz=Object.defineProperty,Vz=Object.defineProperties,Lz=Object.getOwnPropertyDescriptors,Qy=Object.getOwnPropertySymbols,Bz=Object.prototype.hasOwnProperty,xz=Object.prototype.propertyIsEnumerable,Jy=(t,e,r)=>e in t?Fz(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Gz=(t,e)=>{for(var r in e||(e={}))Bz.call(e,r)&&Jy(t,r,e[r]);if(Qy)for(var r of Qy(e))xz.call(e,r)&&Jy(t,r,e[r]);return t},kz=(t,e)=>Vz(t,Lz(e));function Am({scheduleAttributes:t=["scheduledDate","scheduledTime"],ignoreMatchUpStatuses:e=Rt,tournamentRecord:r,scheduledDates:n,venueIds:o=[]}){if(typeof r!="object")return{error:ee};if(!Array.isArray(e)||!Array.isArray(o))return{error:Z};o.length&&t.push("venueId");const{matchUps:i}=Vt({matchUpFilters:{scheduledDates:n},tournamentRecord:r}),s=i.filter(l=>!e.includes(l.matchUpStatus)&&el({schedule:l.schedule,scheduleAttributes:t})&&(!(o!=null&&o.length)||o.includes(l.schedule.venueId))).map($t),{matchUps:a}=Vt({tournamentRecord:r,inContext:!1});let c=0;for(const l of a)s.includes(l.matchUpId)&&(l.timeItems=(l.timeItems||[]).filter(u=>![jo,ts,Ec,wc,Nc].includes(u==null?void 0:u.itemType)),c+=1);return kz(Gz({},B),{clearedScheduleCount:c})}var Wz=Object.defineProperty,Zy=Object.getOwnPropertySymbols,qz=Object.prototype.hasOwnProperty,Hz=Object.prototype.propertyIsEnumerable,Xy=(t,e,r)=>e in t?Wz(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Yz=(t,e)=>{for(var r in e||(e={}))qz.call(e,r)&&Xy(t,r,e[r]);if(Zy)for(var r of Zy(e))Hz.call(e,r)&&Xy(t,r,e[r]);return t};function UM({scheduleAttributes:t=["scheduledDate","scheduledTime"],ignoreMatchUpStatuses:e=Rt,tournamentRecords:r,scheduledDates:n,venueIds:o}){const i=Ki(r)&&Object.values(r).map(({tournamentId:s})=>s).filter(Boolean);if(!(i!=null&&i.length))return{error:Fe};for(const s of i){const a=r[s],c=Am({ignoreMatchUpStatuses:e,scheduleAttributes:t,tournamentRecord:a,scheduledDates:n,venueIds:o});if(c.error)return c}return Yz({},B)}function CM({tournamentRecord:t}){var e;if(!t)return{error:ee};const{policy:r}=us({policyType:fv,tournamentRecord:t}),{extension:n}=hr({tournamentRecord:t,name:Zi}),o=(e=n==null?void 0:n.value)==null?void 0:e.dailyLimits,i=r==null?void 0:r.defaultDailyLimits;return{matchUpDailyLimits:o||i}}function MM({tournamentRecords:t,tournamentId:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Fe};const r=Object.keys(t).filter(o=>!e||o===e);let n;return r.forEach(o=>{const i=t[o],{matchUpDailyLimits:s}=CM({tournamentRecord:i});n=s}),{matchUpDailyLimits:n}}function Um({checkPotentialRequestConflicts:t=!0,scheduleCompletedMatchUps:e,clearScheduleDates:r,scheduleDates:n=[],tournamentRecords:o,periodLength:i,dryRun:s,pro:a}){if(!o)return{error:Fe};if(!Array.isArray(n))return{error:Z};const c=Ea({tournamentRecords:o});if(c.error)return c;const{schedulingProfile:l=[],issues:u=[],modifications:d}=c,p=Object.assign({},...Object.values(o).map(y=>Sa({tournamentRecord:y}).containedStructures)),v=n.map(y=>{if(Nr(y))return Me(y)}).filter(Boolean),f=l.map(y=>y.scheduleDate).map(y=>Nr(y)&&Me(y)).filter(y=>y&&(!n.length||v.includes(y)));if(!f.length)return{error:OR};if(r&&!s){const y=Array.isArray(r)?r:void 0;UM({tournamentRecords:o,scheduledDates:y})}const{courts:m}=Is({dates:n,ignoreDisabled:!0,tournamentRecords:o}),{matchUps:g}=ho({matchUpFilters:{matchUpTypes:[ut,ot]},afterRecoveryTimes:!0,nextMatchUps:!0,tournamentRecords:o}),{matchUpDependencies:h}=qr({includeParticipantDependencies:!0,tournamentRecords:o,matchUps:g}),{matchUpDailyLimits:_}=MM({tournamentRecords:o}),{personRequests:I}=wa({requestType:Fd,tournamentRecords:o}),P=l.filter(y=>{const O=Me(y==null?void 0:y.scheduleDate);return f.includes(O)}).sort((y,O)=>new Date(y.scheduleDate).getTime()-new Date(O.scheduleDate).getTime()),S={schedulingProfileModifications:d,checkPotentialRequestConflicts:t,scheduleCompletedMatchUps:e,schedulingProfileIssues:u,dateSchedulingProfiles:P,containedStructureIds:p,matchUpDependencies:h,matchUpDailyLimits:_,clearScheduleDates:r,tournamentRecords:o,schedulingProfile:l,personRequests:I,periodLength:i,matchUps:g,dryRun:s,courts:m};return a?$z(S):yz(S)}function DM({event:t}){return t?ed({event:t,name:wn}):{error:Re}}function Kz({tournamentRecords:t,eventId:e}){if(!t)return{error:Fe};if(typeof e!="string")return{error:Se,info:"missing eventId"};for(const r of Object.values(t)){const{event:n}=Ft({tournamentRecord:r,eventId:e});if(n)return DM({event:n})}return{error:Pr}}function zz(t){Object.assign(t,{inContext:!0});const{matchUp:e,error:r}=ol(t);return{matchUp:de(e,!0,!0),error:r}}function ol({participantsProfile:t,afterRecoveryTimes:e,tournamentRecord:r,contextContent:n,contextProfile:o,drawDefinition:i,nextMatchUps:s,matchUpId:a,inContext:c,eventId:l,drawId:u,event:d}){if(!r)return{error:ee};if(typeof a!="string")return{error:Ut};if(!i||!d){const{matchUps:g}=Vt({tournamentRecord:r}),h=g.find(_=>_.matchUpId===a);if(!h)return{error:kr};({eventId:l,drawId:u}=h),{event:d,drawDefinition:i}=Ft({tournamentRecord:r,eventId:l,drawId:u})}if(!i)return{error:Cn};o&&!n&&(n=Io({tournamentRecord:r,contextProfile:o}));const p={surfaceCategory:(d==null?void 0:d.surfaceCategory)||r.surfaceCategory,indoorOutDoor:(d==null?void 0:d.indoorOutDoor)||r.indoorOutDoor,endDate:(d==null?void 0:d.endDate)||r.endDate,tournamentId:r.tournamentId,eventId:d.eventId,drawId:u},{participants:v=[]}=hs({participantsProfile:t,tournamentRecord:r,contextProfile:o,inContext:c}),{matchUp:f,structure:m}=nt({context:c&&p,tournamentParticipants:v,afterRecoveryTimes:e,contextContent:n,drawDefinition:i,contextProfile:o,nextMatchUps:s,matchUpId:a,inContext:c,event:d});return{matchUp:f,structure:m,drawDefinition:i}}function Cm({tournamentParticipants:t,tournamentRecord:e,drawDefinition:r,participantId:n,matchUpId:o,matchUp:i,event:s}){if(!n)return{error:It};if(!o)return{error:wr};if(t=t||(e==null?void 0:e.participants),t!=null&&t.length){if(!i){const d=nt({tournamentParticipants:t,inContext:!0,drawDefinition:r,matchUpId:o,event:s});if(!d.matchUp)return{error:kr};i=d.matchUp}const c=Vc({matchUp:i});if(c.error)return c;const{checkedInParticipantIds:l,allRelevantParticipantIds:u}=c;if(!u.includes(n))return{error:ao};if(l.includes(n))return{error:_A}}return vr({tournamentRecord:e,drawDefinition:r,matchUpId:o,timeItem:{itemType:pf,itemValue:n}})}function Mm({tournamentParticipants:t,tournamentRecord:e,drawDefinition:r,participantId:n,matchUpId:o,matchUp:i,event:s}){if(!n)return{error:It};if(!o&&!i)return{error:Ut};if(t=t||(e==null?void 0:e.participants),!i){const u=nt({tournamentParticipants:t,inContext:!0,drawDefinition:r,matchUpId:o,event:s});if(u.error)return u;i=u.matchUp}const{matchUpStatus:a,score:c}=i;if(GA.includes(a)||Rt.includes(a)||At({score:c}))return{error:iR};if(t!=null&&t.length){const{checkedInParticipantIds:u,allRelevantParticipantIds:d}=Vc({matchUp:i});if(!d.includes(n))return{error:ao};if(!u.includes(n))return{error:MR};const{sideParticipantIds:p,nestedIndividualParticipantIds:v}=Bv({matchUp:i}),f=p.indexOf(n);[0,1].includes(f)&&(v[f]||[]).forEach(m=>{vr({drawDefinition:r,matchUpId:o,timeItem:{itemType:ff,itemValue:m}})})}return vr({tournamentRecord:e,drawDefinition:r,matchUpId:o,timeItem:{itemType:ff,itemValue:n}})}function jM(t){if(!(t!=null&&t.tournamentRecord))return{error:ee};const{tournamentRecord:e,participantId:r,matchUpId:n,drawDefinition:o,event:i}=t,s=e.participants||[],a=ol({tournamentRecord:e,inContext:!0,drawDefinition:o,matchUpId:n,event:i});if(!a.matchUp)return{error:kr};const c=a.matchUp,{checkedInParticipantIds:l=[]}=Vc({matchUp:c});return l.includes(r)?Mm({tournamentParticipants:s,tournamentRecord:e,drawDefinition:o,participantId:r,matchUpId:n,matchUp:c}):Cm({tournamentParticipants:s,tournamentRecord:e,drawDefinition:o,participantId:r,matchUpId:n,matchUp:c})}function Qz(t){const{tournamentRecords:e}=t,{participantId:r,tournamentId:n,matchUpId:o,drawId:i}=t;if(!e||!n||!r||!o)return{error:Se,stack:"toggleParticipantCheckInState"};const s=e[n],{drawDefinition:a,event:c}=Ho({tournamentRecord:s,drawId:i});return Object.assign(t,{drawDefinition:a,event:c,tournamentRecord:s}),jM(t)}function RM(t){const{tournamentRecords:e}=t;if(!e)return{error:Fe};const{removePriorValues:r,tournamentId:n,courtDayDate:o,matchUpId:i,courtId:s,drawId:a}=t,c=e[n];if(!c)return{error:ee};const{drawDefinition:l,event:u}=Ho({tournamentRecord:c,drawId:a}),d=nt({drawDefinition:l,event:u,matchUpId:i});if(d.error)return d;if(d.matchUp.matchUpType===Qr){const{itemValue:p}=Ii({timeItems:d.matchUp.timeItems||[],itemType:jo}),v=s&&p.filter(m=>m.courtId!==s);return vr({duplicateValues:!1,removePriorValues:r,tournamentRecord:c,drawDefinition:l,matchUpId:i,timeItem:{itemType:jo,itemValue:v}})}else return Ps({tournamentRecord:c,drawDefinition:l,courtDayDate:o,courtId:"",matchUpId:i})}function Jz({tournamentRecords:t}){return PM({extensionName:Zi,tournamentRecords:t})}var Zz=Object.defineProperty,Xz=Object.defineProperties,e8=Object.getOwnPropertyDescriptors,eO=Object.getOwnPropertySymbols,t8=Object.prototype.hasOwnProperty,r8=Object.prototype.propertyIsEnumerable,tO=(t,e,r)=>e in t?Zz(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ji=(t,e)=>{for(var r in e||(e={}))t8.call(e,r)&&tO(t,r,e[r]);if(eO)for(var r of eO(e))r8.call(e,r)&&tO(t,r,e[r]);return t},Pl=(t,e)=>Xz(t,e8(e));const{stageOrder:rO}=Mx;function Dm({schedulingProfile:t,tournamentRecords:e,tournamentRecord:r,withRoundId:n}){if(r&&!e){if(typeof r!="object")return{error:Lu};e={[r.tournamentId]:r}}if(t){const s=jd({tournamentRecords:e,schedulingProfile:t});if(s.error)return s}if(!t){const s=Ea({tournamentRecords:e});if(s.error)return s;t=s.schedulingProfile}if(!t)return{error:Ht};const o={};return{profileRounds:t.map(({venues:s,scheduleDate:a})=>s.map(({rounds:c})=>c.map(l=>{var u;const d=Af(l);return(u=d.roundSegment)!=null&&u.segmentsCount&&(o[d.id]=d.roundSegment.segmentsCount),_e(ji({id:n?d.id:void 0,scheduleDate:a},d))}))).flat(1/0),segmentedRounds:o}}function Af(t){const{containerStructureId:e,roundSegment:r,isRoundRobin:n,tournamentId:o,roundNumber:i,structureId:s,eventId:a,drawId:c}=t,l=n?e:s,u=[o,a,c,l,i].join("|");return _e({id:u,roundSegment:r,tournamentId:o,eventId:a,drawId:c,structureId:l,roundNumber:i})}function nO(t){const e=t.length,r=t.filter(({sides:u})=>u==null?void 0:u.some(({bye:d})=>d)).length||0,n=t.filter(({winningSide:u,matchUpStatus:d})=>u||Rt.includes(d)).length||0,o=t.filter(({schedule:u})=>(u==null?void 0:u.scheduledDate)&&(u==null?void 0:u.scheduledTime)).length||0,i=e-r,s=i===n,a=i-o,c=i-o;return{unscheduledCount:a,incompleteCount:c,scheduledCount:o,completedCount:n,matchUpsCount:e,isScheduled:i===o,isComplete:s,byeCount:r}}function FM({excludeScheduleDateProfileRounds:t,excludeScheduledRounds:e,excludeCompletedRounds:r,inContextMatchUps:n,schedulingProfile:o,tournamentRecords:i,tournamentRecord:s,withSplitRounds:a,matchUpFilters:c,withRoundId:l,context:u}){var d;if(n&&!Array.isArray(n||typeof n[0]!="object"))return{error:Z,inContextMatchUps:n};if(s&&!i){if(typeof s!="object")return{error:Lu};i={[s.tournamentId]:s}}const p=typeof i!="object"||!Object.keys(i).length;if((!n||!o&&(t||r||o||a))&&p)return{error:Fe};const f=Object.values(i||{}).map(({events:S})=>S).flat(),{segmentedRounds:m,profileRounds:g}=t||r||o||a?Dm({tournamentRecords:i,schedulingProfile:o}):{},h=t&&Object.assign({},...g.map(S=>({[S.id]:S}))),_=n||((d=ho({tournamentRecords:i,matchUpFilters:c}))==null?void 0:d.matchUps)||[],I=[];let P=_&&Object.values(_.reduce((S,y)=>{var O,b;const E=Af(y).id,T=m==null?void 0:m[E],N=[...(b=(O=S[E])==null?void 0:O.matchUps)!=null?b:[],y],{containerStructureId:w,stageSequence:$,structureName:U,tournamentId:A,isRoundRobin:C,matchUpType:M,roundNumber:D,roundOffset:V,structureId:R,eventName:W,roundName:x,drawName:K,eventId:j,drawId:L}=y,F=C?w:R;return Pl(ji({},S),{[E]:{id:l?E:void 0,structureId:F,stageSequence:$,segmentsCount:T,structureName:U,tournamentId:A,matchUpType:M,roundNumber:D,roundOffset:V,eventName:W,roundName:x,drawName:K,matchUps:N,eventId:j,drawId:L}})},{})).map(S=>{const{minFinishingSum:y,winnerFinishingPositionRange:O}=o8(S.matchUps),b=S.segmentsCount;if(b){const C=S.matchUps.length/b;return jt(S.matchUps.sort((D,V)=>D.roundPosition-V.roundPosition),C).map((D,V)=>{const{unscheduledCount:R,incompleteCount:W,matchUpsCount:x,isScheduled:K,isComplete:j,byeCount:L}=nO(D),F=oO({matchUps:S.matchUps,tournamentRecords:i,events:f,round:S});return _e(Pl(ji(ji({},S),u),{roundSegment:{segmentsCount:b,segmentNumber:V+1},winnerFinishingPositionRange:O,unscheduledCount:R,incompleteCount:W,minFinishingSum:y,matchUpsCount:x,isScheduled:K,roundTiming:F,isComplete:j,byeCount:L,matchUps:D}))})}const{unscheduledCount:E,incompleteCount:T,matchUpsCount:N,isScheduled:w,isComplete:$,byeCount:U}=nO(S.matchUps),A=oO({matchUps:S.matchUps,tournamentRecords:i,events:f,round:S});return _e(Pl(ji(ji({},S),u),{winnerFinishingPositionRange:O,unscheduledCount:E,incompleteCount:T,minFinishingSum:y,matchUpsCount:N,isScheduled:w,roundTiming:A,isComplete:$,byeCount:U}))}).flat().filter(S=>{if(t){const N=Me(t),w=l?S.id:Af(S).id;if(N&&h[w]&&Me(h[w].scheduleDate)===N)return!1}const{isComplete:y,isScheduled:O}=S,T=(!r||!y)&&(!e||!O);return T||I.push(S),T}).sort(n8)||[];return Pl(ji({},B),{rounds:P,excludedRounds:I})}function oO({round:t,matchUps:e,events:r,tournamentRecords:n}){const o=r.find(p=>p.eventId===t.eventId),{eventType:i,category:s,categoryType:a}=o||{},{categoryName:c,ageCategoryCode:l}=s||{},u=fr(e.map(({matchUpFormat:p})=>p));let d=0;return Object.keys(u).forEach(p=>{const v=u[p],f=Pm({categoryName:c||l,tournamentId:t.tournamentId,eventId:t.eventId,tournamentRecords:n,matchUpFormat:p,categoryType:a,eventType:i});if(f.error)return f;const m=f.averageMinutes*v;isNaN(d)||(d+=m)}),{roundMinutes:d}}function n8(t,e){return t.eventName.localeCompare(e.eventName)||t.eventId.localeCompare(e.eventId)||(rO[t==null?void 0:t.stage]||0)-(rO[e==null?void 0:e.stage]||0)||e.matchUpsCount-t.matchUpsCount||`${t.stageSequence}-${t.roundNumber}-${t.minFinishingSum}`.localeCompare(`${e.stageSequence}-${e.roundNumber}-${e.minFinishingSum}`)}function o8(t){return(t||[]).reduce((e,r)=>{var n,o;const i=(((n=r.finishingPositionRange)==null?void 0:n.winner)||[]).reduce((a,c)=>a+c,0),s=(((o=r.finishingPositionRange)==null?void 0:o.winner)||[]).join("-")||"";return!e.minFinishingSum||i<e.minFinishingSum?{minFinishingSum:i,winnerFinishingPositionRange:s}:e},{minFinishingSum:0,winnerFinishingPositionRange:""})}function i8({tournamentRecords:t,courtAssignments:e,courtDayDate:r}){if(!t)return{error:Fe};if(!Array.isArray(e))return{error:Se,info:Yt("courtAssignments")};const n=e.reduce((s,a)=>{const{tournamentId:c}=a;return s[c]||(s[c]=[]),s[c].push(a),s},{});let o;return Object.keys(n).every(s=>{const a=t[s];if(!a)return o={error:ee},!1;const c=n[s].reduce((u,d)=>{const{drawId:p}=d;return u[p]||(u[p]=[]),u[p].push(d),u},{});Object.keys(c).every(u=>{const{drawDefinition:d}=Ft({tournamentRecord:a,drawId:u});return d?(c[u].every(p=>{const{matchUpId:v,courtId:f}=p,m=Ps({tournamentRecord:a,drawDefinition:d,courtDayDate:r,matchUpId:v,courtId:f});if(m.success)return m==null?void 0:m.success;o={error:JR}}),!0):(o={error:pe},!1)})}),o||B}var s8=Object.defineProperty,a8=Object.defineProperties,c8=Object.getOwnPropertyDescriptors,iO=Object.getOwnPropertySymbols,l8=Object.prototype.hasOwnProperty,u8=Object.prototype.propertyIsEnumerable,sO=(t,e,r)=>e in t?s8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,d8=(t,e)=>{for(var r in e||(e={}))l8.call(e,r)&&sO(t,r,e[r]);if(iO)for(var r of iO(e))u8.call(e,r)&&sO(t,r,e[r]);return t},p8=(t,e)=>a8(t,c8(e));function f8({tournamentRecords:t,competitionMatchUps:e,matchUpDependencies:r,allDateMatchUpIds:n=[],averageMatchUpMinutes:o=90,recoveryMinutes:i=0,recoveryMinutesMap:s,matchUpPotentialParticipantIds:a={},individualParticipantProfiles:c={},matchUpNotBeforeTimes:l={},matchUpDailyLimits:u={},checkPotentialRequestConflicts:d=!0,remainingScheduleTimes:p,clearScheduleDates:v,periodLength:f=30,scheduleDate:m,matchUpIds:g,venueIds:h,startTime:_,endTime:I,dryRun:P}){if(!t)return{error:Fe};if(!g)return{error:_c};if(!Nr(m))return{error:ar};if(isNaN(f)||isNaN(o)||isNaN(i))return{error:Z};e||({matchUps:e}=ho({tournamentRecords:t,nextMatchUps:!0})),r||({matchUpDependencies:r}=qr({includeParticipantDependencies:!0,matchUps:e,tournamentRecords:t})),e.forEach(j=>{var L;(L=j.schedule)!=null&&L.scheduledDate&&qn(m,Me(j.schedule.scheduledDate))&&ta({matchUp:j,matchUpNotBeforeTimes:l,matchUpPotentialParticipantIds:a})});const S=g.map(j=>e.find(L=>L.matchUpId===j)).filter(Boolean),{venueId:y,scheduleTimes:O,dateScheduledMatchUpIds:b}=EM({tournamentRecords:t,remainingScheduleTimes:p,startTime:tt(_),endTime:tt(I),scheduleDate:Me(m),averageMatchUpMinutes:o,clearScheduleDates:v,periodLength:f,venueIds:h}),E={},T=[],N={},w={},$={};e.filter(({matchUpId:j})=>b.includes(j)).forEach(j=>{var L;$f({matchUpPotentialParticipantIds:a,individualParticipantProfiles:c,scheduleDate:m,matchUp:j,value:1});const F=(L=j.schedule)==null?void 0:L.scheduledTime;if(F){N[j.matchUpId]=F;const q=s==null?void 0:s[j.matchUpId];uc({individualParticipantProfiles:c,matchUpPotentialParticipantIds:a,matchUpNotBeforeTimes:l,matchUpDependencies:r,recoveryMinutes:q||i,averageMatchUpMinutes:o,scheduleDate:m,scheduleTime:F,matchUp:j})}});let A=S.filter(j=>{const L=b.includes(j.matchUpId),F=[qe,Be,_t,gr,Xt,Ge].includes(j==null?void 0:j.matchUpStatus);return!L&&!j.winningSide&&!F});const{matchUpMap:C,overLimitMatchUpIds:M,participantIdsAtLimit:D}=A.reduce((j,L)=>{const{drawId:F,tournamentId:q,matchUpType:G}=L,{participantIdsAtLimit:H,relevantParticipantIds:Q}=Nm({individualParticipantProfiles:c,matchUpPotentialParticipantIds:a,matchUpDailyLimits:u,matchUp:L});return H!=null&&H.length?(j.overLimitMatchUpIds.push(L.matchUpId),j.participantIdsAtLimit.push(...H),j):(Q.forEach(z=>{nl({individualParticipantProfiles:c,participantId:z});const Y=c[z].counters;Y[G]?Y[G]+=1:Y[G]=1,Y[en]?Y[en]+=1:Y[en]=1}),j.matchUpMap[q]||(j.matchUpMap[q]={}),j.matchUpMap[q][F]?j.matchUpMap[q][F].push(L):j.matchUpMap[q][F]=[L],ta({matchUp:L,matchUpNotBeforeTimes:l,matchUpPotentialParticipantIds:a}),j)},{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});A=A.filter(({matchUpId:j})=>!M.includes(j));let V=0;const R=(O==null?void 0:O.length)||0,{personRequests:W}=wa({tournamentRecords:t,requestType:Fd});for(;O!=null&&O.length&&A.length&&V<=R;){V++;const{scheduleTime:j}=O.shift(),L=A.find(F=>{const{matchUpId:q}=F,{dependenciesScheduled:G,remainingDependencies:H}=bm({matchUps:e,matchUpScheduleTimes:N,matchUpDependencies:r,allDateMatchUpIds:n,matchUp:F});if(!G)return $[q]||($[q]=[]),$[q].push({scheduleTime:j,remainingDependencies:H}),!1;const{enoughTime:Q}=wm({individualParticipantProfiles:c,matchUpNotBeforeTimes:l,matchUpDependencies:r,scheduleTime:j,matchUp:F});if(!Q)return w[q]||(w[q]=[]),w[q].push({scheduleTime:j}),!1;const{conflicts:z}=Tm({potentials:d,averageMatchUpMinutes:o,requestConflicts:E,personRequests:W,scheduleTime:j,scheduleDate:m,matchUp:F});if(z!=null&&z.length)return!1;const Y=s==null?void 0:s[F.matchUpId];return uc({recoveryMinutes:Y||i,matchUpPotentialParticipantIds:a,individualParticipantProfiles:c,matchUpNotBeforeTimes:l,averageMatchUpMinutes:o,matchUpDependencies:r,scheduleDate:m,scheduleTime:j,matchUp:F}),N[F.matchUpId]=j,!0});A=A.filter(({matchUpId:F})=>F!==(L==null?void 0:L.matchUpId)),L||T.push(j)}A.forEach(j=>{$f({individualParticipantProfiles:c,matchUpPotentialParticipantIds:a,scheduleDate:m,value:-1,matchUp:j})});let x=[];Object.keys(C).forEach(j=>{const L=t[j];L?Object.keys(C[j]).forEach(F=>{const{drawDefinition:q}=Ho({tournamentRecord:L,drawId:F});q&&C[j][F].forEach(({matchUpId:H})=>{const Q=N[H];if(Q){const z=Q.split(":").map(Wn).join(":"),Y=`${Me(m)}T${z}`;P?x.push(H):(bi({drawDefinition:q,matchUpId:H,scheduledTime:Y}).success&&x.push(H),y&&Oa({tournamentRecord:L,drawDefinition:q,matchUpId:H,venueId:y}))}})}):Ct()&&console.log(so)});const K=ud(A);return p8(d8({},B),{requestConflicts:Object.values(E),remainingScheduleTimes:O.map(({scheduleTime:j})=>j),individualParticipantProfiles:c,matchUpNotBeforeTimes:l,participantIdsAtLimit:D,skippedScheduleTimes:T,overLimitMatchUpIds:M,scheduledMatchUpIds:x,noTimeMatchUpIds:K,recoveryTimeDeferred:w,dependencyDeferred:$})}var v8=Object.defineProperty,aO=Object.getOwnPropertySymbols,m8=Object.prototype.hasOwnProperty,g8=Object.prototype.propertyIsEnumerable,cO=(t,e,r)=>e in t?v8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,h8=(t,e)=>{for(var r in e||(e={}))m8.call(e,r)&&cO(t,r,e[r]);if(aO)for(var r of aO(e))g8.call(e,r)&&cO(t,r,e[r]);return t};function _8(t){const e="reorderUpcomingMatchUps",{tournamentRecords:r}=t;if(typeof r!="object"||!Object.keys(r).length)return k({result:{error:Fe},stack:e});const{matchUpsContextIds:n,firstToLast:o}=t;if(!n)return k({result:{error:Se},stack:e});const i=n==null?void 0:n.length;if(!i)return h8({},B);let s=0;return n.forEach((c,l)=>{const{tournamentId:u,drawId:d,matchUpId:p}=c;let v=l+(o?-1:1);v<0&&(v=i-1),v===i&&(v=0);const f=n[v].schedule.scheduledTime,m=a({tournamentId:u,scheduledTime:f,matchUpId:p,drawId:d});if(m.success)s++;else return m}),s===i?B:k({result:{error:QR},stack:e});function a({tournamentId:c,scheduledTime:l,matchUpId:u,drawId:d}){const p=r[c],{drawDefinition:v}=Ho({tournamentRecord:p,drawId:d});return bi({drawDefinition:v,scheduledTime:l,matchUpId:u})}}var I8=Object.defineProperty,P8=Object.defineProperties,y8=Object.getOwnPropertyDescriptors,lO=Object.getOwnPropertySymbols,O8=Object.prototype.hasOwnProperty,S8=Object.prototype.propertyIsEnumerable,uO=(t,e,r)=>e in t?I8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,dO=(t,e)=>{for(var r in e||(e={}))O8.call(e,r)&&uO(t,r,e[r]);if(lO)for(var r of lO(e))S8.call(e,r)&&uO(t,r,e[r]);return t},pO=(t,e)=>P8(t,y8(e));function b8({scheduleCompletedMatchUps:t,tournamentRecords:e,scheduledDate:r,matchUps:n}={}){if(!Array.isArray(n))return{error:Z};if(n.some(({hasContext:m})=>!m))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:qu};let i=Sm({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:10,nextMatchUps:!0,tournamentRecords:e,matchUpFilters:{localPerspective:!0,scheduledDate:r}});if(i.error)return i;const{rows:s}=i,a=[],c=m=>[(m.sides||[]).map(g=>{var h;return[g.participantId,(h=g.participant)==null?void 0:h.individualParticipantIds]}),(m.potentialParticipants||[]).flat().map(g=>[g.participantId,g.individualParticipantIds])].flat(1/0).filter(Boolean),l=s.reduce((m,g)=>{const h=[],_=[];Object.values(g).forEach(P=>{if(Ki(P)&&(P.matchUpId&&(h.push(P.matchUpId),a.push(P)),P.sides)){const S=c(P);_.push(...S)}});const I=Object.values(g).filter(P=>Ki(P)&&!P.matchUpId);return m.concat({matchUpIds:h,availableCourts:I,rowId:g.rowId,participantIds:_})},[]);n.filter(({matchUpStatus:m})=>m!==qe&&(t||!Rt.includes(m))).sort(_s);const u=qr({matchUps:n.concat(a),includeParticipantDependencies:!0,tournamentRecords:e}).matchUpDependencies,d=[],p=[];for(;n.length&&l.length;){const m=l.shift(),g=[];for(;n.length&&m.availableCourts.length;){const h=n.concat(g).map(T=>T.matchUpId),_=n.shift(),{matchUpId:I}=_,P=u[I].matchUpIds.concat(u[I].dependentMatchUpIds),S=h.some(T=>u[I].matchUpIds.includes(T)),y=d.some(T=>u[I].dependentMatchUpIds.includes(T)),O=m.matchUpIds.some(T=>P.includes(T)),b=c(_),E=m.participantIds.some(T=>b.includes(T));if(!O&&!S&&!E&&!y){const T=m.availableCourts.shift();Object.assign(_.schedule,T.schedule),Object.assign(T,_),p.push(_),m.participantIds.push(...b),m.matchUpIds.push(I)}else g.push(_)}n.push(...g),d.push(...m.matchUpIds)}const v=p.map(({matchUpId:m,tournamentId:g,schedule:h,drawId:_})=>({tournamentId:g,matchUpId:m,drawId:_,schedule:pO(dO({},h),{scheduledDate:r})}));i=mC({tournamentRecords:e,matchUpDetails:v});const f=n;return pO(dO({},i),{scheduled:p,notScheduled:f})}var T8=Object.defineProperty,E8=Object.defineProperties,w8=Object.getOwnPropertyDescriptors,fO=Object.getOwnPropertySymbols,N8=Object.prototype.hasOwnProperty,$8=Object.prototype.propertyIsEnumerable,vO=(t,e,r)=>e in t?T8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,mO=(t,e)=>{for(var r in e||(e={}))N8.call(e,r)&&vO(t,r,e[r]);if(fO)for(var r of fO(e))$8.call(e,r)&&vO(t,r,e[r]);return t},gO=(t,e)=>E8(t,w8(e));function A8(t){const e="matchUpScheduleChange",{tournamentRecords:r}=t;if(typeof r!="object"||!Object.keys(r).length)return{error:Fe};const{sourceMatchUpContextIds:n,targetMatchUpContextIds:o,sourceCourtId:i,targetCourtId:s,courtDayDate:a}=t||{},{drawId:c,matchUpId:l,tournamentId:u}=n||{},{drawId:d,matchUpId:p,tournamentId:v}=o||{};if(!l&&!p)return k({result:{error:Se},stack:e});const{matchUps:f}=ho({matchUpFilters:{matchUpIds:[l,p].filter(Boolean),drawIds:[c,d].filter(Boolean)},tournamentRecords:t.tournamentRecords}),m=f.find(({matchUpId:S})=>S===l),g=f.find(({matchUpId:S})=>S===p);let h=0;if(s&&l&&!p){const S=_({tournamentId:u,matchUpId:l,courtId:s,matchUp:m,drawId:c,tournamentRecords:r,sourceCourtId:i,courtDayDate:a});if(S!=null&&S.success&&h++,S.error)return k({result:S,stack:e})}else if(i&&s&&l&&p){const S=_({tournamentId:u,matchUpId:l,courtId:s,matchUp:m,drawId:c,tournamentRecords:r,sourceCourtId:i,courtDayDate:a});if(S.success&&h++,S.error)return k({result:S,stack:e,info:"source"});const y=_({tournamentId:v,sourceCourtId:s,matchUpId:p,matchUp:g,courtId:i,drawId:d,tournamentRecords:r,courtDayDate:a});if(y.success&&h++,y.error)return k({result:y,stack:e,info:"target"})}else return{error:Se};return h?B:k({result:{error:Pc},stack:e});function _(S){const{tournamentRecords:y,tournamentId:O,matchUp:b,drawId:E}=S,T=y[O],{drawDefinition:N}=Ho({tournamentRecord:T,drawId:E});return b.matchUpType===We?I(gO(mO({},S),{tournamentRecord:T,drawDefinition:N})):P(gO(mO({},S),{tournamentRecord:T,drawDefinition:N}))}function I({removePriorValues:S,tournamentRecords:y,tournamentRecord:O,drawDefinition:b,sourceCourtId:E,courtDayDate:T,matchUpId:N,matchUp:w,courtId:$}){const U=[$].concat(w.schedule.allocatedCourts.map(({courtId:A})=>A).filter(A=>A!==E));return Od({removePriorValues:S,tournamentRecords:y,tournamentRecord:O,drawDefinition:b,courtDayDate:T,matchUpId:N,courtIds:U})}function P({tournamentRecords:S,tournamentRecord:y,drawDefinition:O,courtDayDate:b,matchUpId:E,courtId:T}){return Ps({tournamentRecords:S,tournamentRecord:y,drawDefinition:O,courtDayDate:b,matchUpId:E,courtId:T})}}var U8=Object.defineProperty,C8=Object.defineProperties,M8=Object.getOwnPropertyDescriptors,hO=Object.getOwnPropertySymbols,D8=Object.prototype.hasOwnProperty,j8=Object.prototype.propertyIsEnumerable,_O=(t,e,r)=>e in t?U8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,R8=(t,e)=>{for(var r in e||(e={}))D8.call(e,r)&&_O(t,r,e[r]);if(hO)for(var r of hO(e))j8.call(e,r)&&_O(t,r,e[r]);return t},F8=(t,e)=>C8(t,M8(e));function V8(t){const e=jn(t);if(e.error)return e;const{tournamentRecord:r,drawDefinition:n}=e;return eM(F8(R8({},t),{tournamentRecord:r,drawDefinition:n}))}function L8(t){const e=jn(t);if(e.error)return e;const{tournamentRecord:r,drawDefinition:n}=e,{disableNotice:o,scheduledDate:i,matchUpId:s,removePriorValues:a}=t;return hm({removePriorValues:a,tournamentRecord:r,drawDefinition:n,disableNotice:o,scheduledDate:i,matchUpId:s})}function B8(t){const e=jn(t);if(e.error)return e;const{tournamentRecord:r,drawDefinition:n}=e,{disableNotice:o,scheduledTime:i,matchUpId:s,removePriorValues:a}=t;return _m({removePriorValues:a,tournamentRecord:r,drawDefinition:n,disableNotice:o,scheduledTime:i,matchUpId:s})}function x8(t){const e=jn(t);if(e.error)return e;const{tournamentRecord:r,drawDefinition:n}=e,{disableNotice:o,startTime:i,matchUpId:s}=t;return tM({tournamentRecord:r,drawDefinition:n,disableNotice:o,startTime:i,matchUpId:s})}function G8(t){const e=jn(t);if(e.error)return e;const{tournamentRecord:r,drawDefinition:n}=e,{disableNotice:o,endTime:i,matchUpId:s}=t;return rM({tournamentRecord:r,drawDefinition:n,disableNotice:o,endTime:i,matchUpId:s})}function k8(t){const e=jn(t);if(e.error)return e;const{tournamentRecord:r,drawDefinition:n}=e,{disableNotice:o,stopTime:i,matchUpId:s}=t;return nM({tournamentRecord:r,drawDefinition:n,disableNotice:o,stopTime:i,matchUpId:s})}function W8(t){const e=jn(t);if(e.error)return e;const{tournamentRecord:r,drawDefinition:n}=e,{disableNotice:o,resumeTime:i,matchUpId:s}=t;return oM({tournamentRecord:r,drawDefinition:n,disableNotice:o,resumeTime:i,matchUpId:s})}function q8(t){const e=jn(t);if(e.error)return e;const{tournamentRecord:r,drawDefinition:n}=e,{disableNotice:o,participantId:i,officialType:s,matchUpId:a}=t;return iM({tournamentRecord:r,drawDefinition:n,disableNotice:o,participantId:i,officialType:s,matchUpId:a})}function H8(t){const e=jn(t);if(e.error)return e;const{tournamentRecord:r,drawDefinition:n}=e,{matchUpId:o,venueId:i,disableNotice:s,removePriorValues:a}=t;return Oa({removePriorValues:a,tournamentRecord:r,drawDefinition:n,disableNotice:s,matchUpId:o,venueId:i})}function Y8(t){const e=jn(t);if(e.error)return e;const{tournamentRecord:r,drawDefinition:n}=e,{removePriorValues:o,tournamentRecords:i,disableNotice:s,courtDayDate:a,matchUpId:c,courtId:l}=t;return Ps({removePriorValues:o,tournamentRecords:i,tournamentRecord:r,drawDefinition:n,disableNotice:s,courtDayDate:a,matchUpId:c,courtId:l})}function K8(t){const e=jn(t);if(e.error)return e;const{tournamentRecord:r,drawDefinition:n}=e,{removePriorValues:o,tournamentRecords:i,disableNotice:s,courtDayDate:a,matchUpId:c,courtIds:l}=t;return Od({removePriorValues:o,tournamentRecords:i,tournamentRecord:r,drawDefinition:n,disableNotice:s,courtDayDate:a,matchUpId:c,courtIds:l})}function z8(t){const e=jn(t);if(e.error)return e;const{tournamentRecord:r,drawDefinition:n}=e,{removePriorValues:o,tournamentRecords:i,disableNotice:s,courtOrder:a,matchUpId:c,courtId:l}=t;return j5({removePriorValues:o,tournamentRecords:i,tournamentRecord:r,drawDefinition:n,disableNotice:s,courtOrder:a,matchUpId:c,courtId:l})}function jn({tournamentRecords:t,tournamentId:e,drawId:r}){if(!t)return{error:Fe};if(!r)return{error:Mr};if(typeof e!="string"&&(e=cm({tournamentRecords:t,drawId:r}),!e))return{error:so};const n=t[e];if(!n)return{error:ee};const o=Ft({tournamentRecord:n,drawId:r});return o.error?k({stack:"addScheduleItems.getDrawDefinition",result:o}):{drawDefinition:o.drawDefinition,tournamentRecord:n}}const Q8={scheduleMatchUps:f8,scheduleProfileRounds:Um,clearScheduledMatchUps:UM,bulkRescheduleMatchUps:z5,getScheduledRoundsDetails:ym,getMatchUpDependencies:qr,generateVirtualCourts:Jv,generateBookings:Em,proAutoSchedule:b8,proConflicts:iC,matchUpScheduleChange:A8,calculateScheduleTimes:EM,reorderUpcomingMatchUps:_8,bulkUpdateCourtAssignments:i8,removeMatchUpCourtAssignment:RM,toggleParticipantCheckInState:Qz,findMatchUpFormatTiming:Pm,modifyMatchUpFormatTiming:IK,modifyEventMatchUpFormatTiming:e5,getMatchUpFormatTimingUpdate:iK,getEventMatchUpFormatTiming:fK,removeEventMatchUpFormatTiming:Kz,getMatchUpDailyLimitsUpdate:Jz,getMatchUpDailyLimits:MM,setMatchUpDailyLimits:e7,getProfileRounds:Dm,getRounds:FM,assignMatchUpVenue:H8,assignMatchUpCourt:Y8,allocateTeamMatchUpCourts:K8,addMatchUpScheduleItems:V8,addMatchUpScheduledDate:L8,addMatchUpScheduledTime:B8,addMatchUpCourtOrder:z8,addMatchUpStartTime:x8,addMatchUpStopTime:k8,addMatchUpResumeTime:W8,addMatchUpEndTime:G8,addMatchUpOfficial:q8,getSchedulingProfile:Ea,setSchedulingProfile:rl,addSchedulingProfileRound:bM,validateSchedulingProfile:jd,addPersonRequests:Dz,getPersonRequests:wa,modifyPersonRequests:Rz,removePersonRequests:jz};var J8=Object.defineProperty,Z8=Object.defineProperties,X8=Object.getOwnPropertyDescriptors,IO=Object.getOwnPropertySymbols,e9=Object.prototype.hasOwnProperty,t9=Object.prototype.propertyIsEnumerable,PO=(t,e,r)=>e in t?J8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,r9=(t,e)=>{for(var r in e||(e={}))e9.call(e,r)&&PO(t,r,e[r]);if(IO)for(var r of IO(e))t9.call(e,r)&&PO(t,r,e[r]);return t},n9=(t,e)=>Z8(t,X8(e));function jm({tournamentRecord:t,policyDefinitions:e,allowReplacement:r}){if(!t)return{error:ee};if(!e||typeof e!="object")return{error:ku};t.extensions||(t.extensions=[]);const{appliedPolicies:n}=ct({tournamentRecord:t}),o=Object.keys(e).map(i=>{if(!n[i]||r)return n[i]=e[i],i}).filter(Boolean);if(o!=null&&o.length){const s=_i({tournamentRecord:t,extension:{name:Qi,value:n}});if(s.error)return s}return o!=null&&o.length?n9(r9({},B),{applied:o}):{error:pA}}function VM({policyDefinitions:t,allowReplacement:e,event:r}){if(!r)return{error:Re};if(!t)return{error:ku};let n=0;r.extensions||(r.extensions=[]);const{appliedPolicies:o}=ct({event:r});return Object.keys(t).forEach(i=>{(!o[i]||e)&&(o[i]=t[i],n++)}),n&&eo({event:r,extension:{name:Qi,value:o}}),n?B:{error:PR}}function o9({event:t,policyType:e}){if(!e)return{error:Se};if(!t)return{error:Re};let r;if(t.extensions){const{appliedPolicies:n}=ct({event:t});n!=null&&n[e]&&(delete n[e],r=!0,Object.keys(n).length?eo({event:t,extension:{name:Qi,value:n}}):ed({event:t,name:Qi}))}return r?B:{error:Jf}}var i9=Object.defineProperty,yO=Object.getOwnPropertySymbols,s9=Object.prototype.hasOwnProperty,a9=Object.prototype.propertyIsEnumerable,OO=(t,e,r)=>e in t?i9(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,c9=(t,e)=>{for(var r in e||(e={}))s9.call(e,r)&&OO(t,r,e[r]);if(yO)for(var r of yO(e))a9.call(e,r)&&OO(t,r,e[r]);return t};function l9({tournamentRecords:t,policyDefinitions:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Fe};for(const r of Object.values(t)){const n=jm({tournamentRecord:r,policyDefinitions:e,allowReplacement:!0});if(n.error)return n}return c9({},B)}const u9={attachPolicies:l9};var d9=Object.defineProperty,p9=Object.defineProperties,f9=Object.getOwnPropertyDescriptors,SO=Object.getOwnPropertySymbols,v9=Object.prototype.hasOwnProperty,m9=Object.prototype.propertyIsEnumerable,bO=(t,e,r)=>e in t?d9(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Mp=(t,e)=>{for(var r in e||(e={}))v9.call(e,r)&&bO(t,r,e[r]);if(SO)for(var r of SO(e))m9.call(e,r)&&bO(t,r,e[r]);return t},TO=(t,e)=>p9(t,f9(e));function g9({policyDefinitions:t,tournamentRecords:e,scaleAttributes:r,participantId:n,inContext:o,personId:i}){let s=dM({policyDefinitions:t,tournamentRecords:e,participantId:n,inContext:o,personId:i});if(s.error)return s;const{participant:a,tournamentId:c}=s;return s=kn({participant:a,scaleAttributes:r}),s.error?TO(Mp({},s),{tournamentId:c}):Mp(TO(Mp({},B),{tournamentId:c}),s)}var h9=Object.defineProperty,EO=Object.getOwnPropertySymbols,_9=Object.prototype.hasOwnProperty,I9=Object.prototype.propertyIsEnumerable,wO=(t,e,r)=>e in t?h9(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,NO=(t,e)=>{for(var r in e||(e={}))_9.call(e,r)&&wO(t,r,e[r]);if(EO)for(var r of EO(e))I9.call(e,r)&&wO(t,r,e[r]);return t};function P9({scheduleDates:t=[],tournamentRecords:e,periodLength:r=30}={}){if(typeof e!="object")return{error:Lu};if(!Array.isArray(t))return{error:Z};if(!t.every(Nr))return{error:ar};const o=[];let i=0;const s={},{schedulingProfile:a}=Ea({tournamentRecords:e});if(!a)return NO({issues:o},B);const{matchUps:c}=ho({nextMatchUps:!0,tournamentRecords:e});for(const u of a){const{scheduleDate:d,venues:p=[]}=u;if(!(t!=null&&t.length)||t.includes(d)){for(const v of p||[])if(v){const{rounds:f}=v,m=[];let{orderedMatchUpIds:g,scheduledRoundsDetails:h}=ym({tournamentRecords:e,periodLength:r,matchUps:c,rounds:f});const{matchUpDependencies:_}=qr({tournamentRecords:e,matchUps:c}),I=P=>{let S;return h.find((y,O)=>{const b=y.matchUpIds.includes(P);return b&&(S=O),b}),S};if(g.forEach((P,S)=>{var y;const O=g.slice(S+1),b=Dt(O,((y=_==null?void 0:_[P])==null?void 0:y.matchUpIds)||[]);b.length&&m.push({matchUpId:P,shouldBeAfter:b})}),m.length){i+=m.length;const P=m.map(({matchUpId:S,shouldBeAfter:y})=>{const O=I(S),b=Ve(y.map(I));return s[d]||(s[d]={}),s[d][O]||(s[d][O]=[]),b.forEach(E=>{s[d][O].includes(E)||s[d][O].push(E)}),{matchUpId:S,matchUpRoundIndex:O,earlierRoundIndices:b,shouldBeAfter:y}});o.push(...P)}}}}const l={matchUpIdShouldBeAfter:Object.assign({},...o.map(u=>{const{matchUpId:d,shouldBeAfter:p,earlierRoundIndices:v}=u;return{[d]:{earlierRoundIndices:v,shouldBeAfter:p}}}))};return NO({issuesCount:i,profileIssues:l,roundIndexShouldBeAfter:s},B)}function Vd(){return`
    This project would not have been possible without the generous input and patience
    of tournament organizers and directors who worked with early versions of CourtHive/TMX.

    Thanks to Pavel, Ivan, Mladen, Zdenko, Antoina, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. 

    The project would not have even begun without the support of Miro, or the introduction by Sretchko.
    The project would not have succeeded without the enthusiasm of Randy and Bruce.
    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.
    Thanks to Scott and Jake for sanity checks, suggestions, and challenging me.
    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.
    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.
    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.
    Thanks to Shannon for the validation of the approach from his deep domain experience.
    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.

    And a special thanks to my family for putting up with the long days and weeks and months of coding
    and conversations at all hours.
  `}function y9({tournamentParticipants:t=[],possiblyDisablingAction:e,activeDrawPositions:r,positionAssignments:n,returnParticipants:o,appliedPolicies:i,drawDefinition:s,drawPosition:a,validActions:c,structureId:l,structure:u,drawId:d,event:p}){var v,f,m,g;if(r.includes(a))return{};const h=(v=c.find(w=>w.type===Ys))==null?void 0:v.availableParticipantIds,_=(f=i==null?void 0:i[lo])==null?void 0:f.otherFlightEntries,I=(m=i==null?void 0:i[lo])==null?void 0:m.restrictQualifyingAlternates,P=(s.entries||[]).filter(({entryStage:w})=>!I||(u.stage===Ie?w===Ie:w!==Ie)).sort((w,$)=>(w.entryPosition||1/0)-($.entryPosition||1/0)).map(({participantId:w})=>w).filter(Boolean),{allPositionedParticipantIds:S}=QU({drawDefinition:s}),y=n.map(w=>w.participantId).filter(Boolean),O=P.filter(w=>[Ie,ue,it].includes(u.stage)?!S.includes(w):!y.includes(w)),E=(p.entries||[]).filter(w=>w.entryStatus===rn&&LM({restrictQualifyingAlternates:I,structure:u,entry:w})&&([Ie,ue,it].includes(u.stage)?!S.includes(w.participantId):!y.includes(w.participantId))).sort((w,$)=>(w.entryPosition||1/0)-($.entryPosition||1/0)).map(w=>w.participantId);let T=Ve(O.concat(E));if(_){const{flightProfile:w}=ht({event:p}),$=(g=w==null?void 0:w.flights)==null?void 0:g.filter(U=>U.drawId!==d).map(U=>U.drawEntries.filter(A=>A.participantId&&![Vo,Wr,fs].includes(A.entryStatus)&&!P.includes(A.participantId)).map(({participantId:A})=>A)).flat().filter(Boolean);$!=null&&$.length&&T.push(...$)}h!=null&&h.length&&(T=T.filter(w=>!h.includes(w)));const N=o?t==null?void 0:t.filter(w=>T.includes(w.participantId)):void 0;return N==null||N.forEach(w=>{const $=(s.entries||[]).find(U=>U.participantId===w.participantId);w.entryPosition=$==null?void 0:$.entryPosition}),N==null||N.sort((w,$)=>(w.entryPosition||1/0)-($.entryPosition||1/0)),T.length?{validAlternatesAction:_e({payload:{drawId:d,structureId:l,drawPosition:a},willDisableLinks:e,method:D3,availableAlternatesParticipantIds:T,type:J1,availableAlternates:N})}:{}}function LM({restrictQualifyingAlternates:t,structure:e,entry:r}){const{stage:n}=e;if(!r.entryStage||r.entryStage===n||n===Ie&&!t||r.entryStage===ue&&n===Et)return!0}const Rm={[zi]:{policyName:"matchUpActionsDefault",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[],disabledActions:[]}],processCodes:{substitution:["RANKING.IGNORE","RATING.IGNORE"]}}},jl="positionAction",Uf="matchUpAction";function BM({actionType:t=jl,appliedPolicies:e,drawDefinition:r,structure:n}){var o;const i=t===jl&&lo||t===Uf&&zi,s=t===jl&&tC||t===Uf&&Rm,a=(e==null?void 0:e[i])||(s==null?void 0:s[i]),c=(o=r.links)==null?void 0:o.filter(v=>{var f;return((f=v==null?void 0:v.target)==null?void 0:f.structureId)===(n==null?void 0:n.structureId)}),l=(c==null?void 0:c.map(({target:v})=>v.feedProfile))||[],{enabledStructures:u,disabledStructures:d}=a||{},p=d==null?void 0:d.find(v=>{const{stages:f,stageSequences:m,structureTypes:g,feedProfiles:h}=v;return(!(h!=null&&h.length)||Array.isArray(h)&&h.some(_=>l.includes(_)))&&(!(f!=null&&f.length)||Array.isArray(f)&&(f==null?void 0:f.includes(n.stage)))&&(!(g!=null&&g.length)||Array.isArray(g)&&(g==null?void 0:g.includes(n.structureType)))&&(!(m!=null&&m.length)||Array.isArray(m)&&m.includes(n.stageSequence))});return{enabledStructures:u,actionsDisabled:p,actionsPolicy:a}}function $O({activePositionOverrides:t,activeDrawPositions:e,action:r}){return r&&t.includes(r)?!0:!e.length}function xM({enabledStructures:t,drawDefinition:e,structure:r}){var n;if(t===!1)return{};if(!(t!=null&&t.length))return{policyActions:{enabledActions:[],disabledActions:[]}};const{stage:o,stageSequence:i,structureType:s}=r||{},a=(n=e.links)==null?void 0:n.filter(u=>{var d;return((d=u==null?void 0:u.target)==null?void 0:d.structureId)===(r==null?void 0:r.structureId)}),c=(a==null?void 0:a.map(({target:u})=>u.feedProfile))||[];return{policyActions:t.find(u=>{const{stages:d,stageSequences:p,structureTypes:v,feedProfiles:f}=u||{},m=!(d!=null&&d.length)||Array.isArray(d)&&d.includes(o),g=!(p!=null&&p.length)||Array.isArray(p)&&p.includes(i),h=!(v!=null&&v.length)||Array.isArray(v)&&v.includes(s),_=!(f!=null&&f.length)||Array.isArray(f)&&f.some(I=>c.includes(I));if(g&&h&&_&&u&&m)return!0})}}function ir({action:t,policyActions:e}){var r;const n=!(e!=null&&e.enabledActions)||((r=e==null?void 0:e.disabledActions)==null?void 0:r.length)&&e.disabledActions.includes(t);return n?!1:!!(((e==null?void 0:e.enabledActions.length)===0||(e==null?void 0:e.enabledActions.includes(t)))&&!n)}const O9="replaceTieMatchUpParticipantId",S9="assignTieMatchUpParticipantId",AO="removeTieMatchUpParticipantId",b9="substituteParticipant",UO="REMOVE_SUBSTITUTION",T9="REPLACE_PARTICIPANT",E9="REMOVE_PARTICIPANT",CO="setMatchUpStatus",MO="SUBSTITUTION",w9="SCHEDULE",DO="REFEREE",N9="STATUS",jO="START",$9="SCORE",RO="END";function Fm({restrictAdHocRoundParticipants:t=!0,policyDefinitions:e,tournamentParticipants:r=[],inContextDrawMatchUps:n,tournamentRecord:o,drawDefinition:i,participantId:s,matchUpsMap:a,sideNumber:c,matchUpId:l,event:u}){var d,p,v,f,m,g,h,_,I,P,S,y,O,b,E,T,N;if(!i)return{error:pe};if(!l)return{error:Ut};if(c&&![1,2].includes(c))return{error:Z,context:{sideNumber:c}};const w=(d=e==null?void 0:e[lo])==null?void 0:d.otherFlightEntries,{drawId:$}=i,{matchUp:U,structure:A}=nt({drawDefinition:i,matchUpId:l,event:u});if(!U)return{error:kr};const{appliedPolicies:C}=ct({tournamentRecord:o,drawDefinition:i,structure:A,event:u});Object.assign(C,e||{});const{enabledStructures:M}=BM({actionType:Uf,appliedPolicies:C,drawDefinition:i,structure:A}),{policyActions:D}=xM({enabledStructures:M,drawDefinition:i,structure:A});a=a||zt({drawDefinition:i}),n||({matchUps:n}=wt({includeByeMatchUps:!0,tournamentParticipants:r,inContext:!0,drawDefinition:i,matchUpsMap:a,event:u}));const V=n.find(ae=>ae.matchUpId===l),R=c&&((p=V.sides)==null?void 0:p.find(ae=>ae.sideNumber===c)),W=((v=V.sides)==null?void 0:v.map(ae=>{var me;return ae.participantId||((me=ae.participant)==null?void 0:me.participantid)}).filter(Boolean))||[],{assignedPositions:x,allPositionsAssigned:K}=St({structure:A}),{structureId:j}=A||{},L=[];if(!j)return{validActions:L};if(mo({drawDefinition:i,structure:A})){const ae=(A.matchUps||[]).filter(({roundNumber:ge})=>ge===U.roundNumber),me=(i==null?void 0:i.entries.filter(({entryStatus:ge})=>vs.includes(ge)).map(Ze))||[],Oe=ae.map(ge=>(ge.sides||[]).flatMap(Ze)).filter(Boolean),ce=me.filter(ge=>!W.includes(ge)&&(!t||!Oe.includes(ge))),Pe=r==null?void 0:r.filter(ge=>ce==null?void 0:ce.includes(ge.participantId));Pe==null||Pe.forEach(ge=>{const Ne=(i.entries||[]).find(Ue=>Ue.participantId===ge.participantId);ge.entryPosition=Ne==null?void 0:Ne.entryPosition}),ce.length&&L.push({payload:{drawId:$,matchUpId:l,structureId:j,sideNumber:c},method:M_,type:Ys,availableParticipantIds:ce,participantsAvailable:Pe});const $e=(u==null?void 0:u.entries)||[],ye=A9({eventEntries:$e,structure:A});let Ae=Ve(me.concat(ye));if(w){const{flightProfile:ge}=ht({event:u}),Ne=(f=ge==null?void 0:ge.flights)==null?void 0:f.filter(Ue=>Ue.drawId!==$).flatMap(Ue=>Ue.drawEntries.filter(he=>he.participantId&&![Vo,Wr,fs].includes(he.entryStatus)).map(({participantId:he})=>he)).filter(Boolean);Ne!=null&&Ne.length&&Ae.push(...Ne)}Ae=Ae.filter(ge=>!W.includes(ge)&&!ce.includes(ge)&&(!t||!Oe.includes(ge)));const be=r==null?void 0:r.filter(ge=>Ae.includes(ge.participantId));be.forEach(ge=>{const Ne=(i.entries||[]).find(Ue=>Ue.participantId===ge.participantId);ge.entryPosition=Ne==null?void 0:Ne.entryPosition}),be.sort((ge,Ne)=>(ge.entryPosition||1/0)-(Ne.entryPosition||1/0)),Ae.length&&L.push({payload:{drawId:$,matchUpId:l,structureId:j,sideNumber:c},availableParticipantIds:Ae,participantsAvailable:be,method:M_,type:rn})}const F=mi({drawDefinition:i,structure:A}),q=x.filter(ae=>ae.participantId).map(ae=>ae.drawPosition),G=x.filter(ae=>ae.bye).map(ae=>ae.drawPosition),H=U.collectionId,Q=U.matchUpStatus===qe||!H&&((m=U.drawPositions)==null?void 0:m.reduce((ae,me)=>G.includes(me)||ae,!1));if(Q)return{validActions:L,isByeMatchUp:Q};ir({policyActions:D,action:DO})&&L.push({type:DO,payload:{matchUpId:l}});const z=!Bc({matchUpStatus:U.matchUpStatus}),Y=(g=C==null?void 0:C.scoring)==null?void 0:g.structures,J=(Y==null?void 0:Y.stage)&&(Y==null?void 0:Y.stage[A.stage]),te=(J==null?void 0:J.stageSequence)&&J.stageSequence[A.stageSequence],oe=!(((h=C==null?void 0:C.scoring)==null?void 0:h.requireAllPositionsAssigned)||(J==null?void 0:J.requireAllPositionsAssigned)||(te==null?void 0:te.requireAllPositionsAssigned))||K,se=U.sides&&U.sides.filter(ae=>ae==null?void 0:ae.participantId).length===2;let ve;const X=[gt,Ot].includes(U.matchUpStatus),ie=nr({inContextDrawMatchUps:n,drawDefinition:i,matchUpId:l});ve=gi({inContextDrawMatchUps:n,drawDefinition:i,targetData:ie});const Ee=(((_=V==null?void 0:V.drawPositions)==null?void 0:_.length)===2&&V.drawPositions.every(ae=>q.includes(ae))&&((I=V==null?void 0:V.sides)==null?void 0:I.length)===2&&V.sides.every(({participantId:ae})=>ae)||se)&&!(X&&ve),re={type:Ks,method:z1,payload:{drawId:$,matchUpId:l,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(z&&L.push({type:w9,method:CO,payload:{drawId:$,matchUpId:l,schedule:{}}}),ir({policyActions:D,action:Ks})&&(R!=null&&R.participant||!c&&(W!=null&&W.length))&&L.push(re),z&&Ee&&L.push({type:N9}),oe&&Ee){const{matchUpId:ae,matchUpFormat:me}=U,Oe={drawId:$,matchUpId:ae,matchUpFormat:me,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};L.push({info:"set outcome and winningSide",method:CO,type:$9,payload:Oe}),ir({policyActions:D,action:jO})&&L.push({type:jO}),ir({policyActions:D,action:RO})&&L.push({type:RO})}if(H){const ae=V.gender===go&&V.sideNumber&&V.sides.filter(({particiapntId:He})=>He).length===1&&((y=(S=(P=V.sides.find(He=>He.participant))==null?void 0:P.participant)==null?void 0:S.person)==null?void 0:y.sex),me=V.matchUpType,Oe=V.gender,Pe=V.sides.flatMap(He=>{var bt;return((bt=He.participant)==null?void 0:bt.individualParticipants)||He.participant}).filter(Boolean).map(Ze),$e=V.sides.filter(He=>!c||He.sideNumber===c).flatMap(He=>{var bt;return((bt=He.participant)==null?void 0:bt.individualParticipants)||He.participant}).filter(Boolean),ye=$e.map(Ze),be=n.find(He=>He.matchUpId===V.matchUpTieId).sides.map(He=>He.participant.individualParticipants.filter(({participantId:bt,person:Qt})=>!ye.includes(bt)&&(!Oe||Oe===Hs||Qt.sex===Oe||Oe===go&&ae&&Qt.sex!==ae))),ge=c?be[c-1]:be.map((He,bt)=>({participants:He,sideNumber:bt+1})),Ne=c?(O=be[c-1])==null?void 0:O.map(Ze):be.map((He,bt)=>({participants:He==null?void 0:He.map(Ze),sideNumber:bt+1})),Ue=c&&(me===ri&&!ye.length||me===Kr&&ye.length<2)||!c&&(me===ri&&ye.length<2||me===Kr&&ye.length<4),he=Ne.filter(He=>!Pe.includes(He)),xe=ge.filter(({participantId:He})=>he.includes(He));if(Ue&&he.length&&L.push({availableParticipantIds:he,method:S9,availableParticipants:xe,type:Ys,payload:{participantId:void 0,tieMatchUpId:l,drawId:$}}),ye!=null&&ye.length&&(!At(U)||(b=R==null?void 0:R.substitutions)!=null&&b.length)&&L.push({method:AO,type:E9,existingParticipantIds:ye,payload:{participantId:void 0,tieMatchUpId:l,drawId:$}}),(!c&&(ye!=null&&ye.length)||c&&(R!=null&&R.participant))&&L.push({availableParticipantIds:he,method:O9,availableParticipants:xe,type:T9,existingParticipantIds:ye,payload:{existingParticipantId:void 0,participantId:void 0,tieMatchUpId:l,drawId:$}}),ir({policyActions:D,action:UO})&&((E=R==null?void 0:R.substitutions)!=null&&E.length)){const He=((T=R.participant)==null?void 0:T.participantType)===Ce&&[R.participantId]||((N=R.participant)==null?void 0:N.participantType)===we&&R.participant.individualParticipantIds||[],bt=R.substitutions.map(Qt=>Qt.participantId).filter(Qt=>He.includes(Qt));(!s||bt.includes(s))&&L.push({method:AO,type:UO,substitutedParticipantIds:bt,payload:{participantId:void 0,tieMatchUpId:l,drawId:$}})}const De=e==null?void 0:e[zi],Je=De==null?void 0:De.substituteWithoutScore,rt=De==null?void 0:De.substituteAfterCompleted;if(ir({policyActions:D,action:MO})&&W.length===2&&(!c&&(ye!=null&&ye.length)||c&&(R!=null&&R.participant))&&(Je||At(U))&&(rt||!Rt.includes(U.matchUpStatus))&&$e.length&&ge.length){const He=$e.map(Ze);L.push({info:"list of team players available for substitution",method:b9,availableParticipantIds:Ne,existingParticipantIds:He,availableParticipants:ge,existingParticipants:$e,type:MO,payload:{substituteParticipantId:void 0,existingParticipantId:void 0,sideNumber:c,matchUpId:l,drawId:$}})}}return{structureIsComplete:F,validActions:L,isDoubleExit:X}}function A9({eventEntries:t,structure:e}){const r=o=>o.entryStatus===rn&&LM({structure:e,entry:o}),n=(o,i)=>(o.entryPosition||1/0)-(i.entryPosition||1/0);return t.filter(r).sort(n).map(Ze)}function GM({policyDefinitions:t,tournamentRecord:e,drawDefinition:r,participantId:n,sideNumber:o,matchUpId:i,drawId:s,event:a}){if(!e)return{error:ee};if(!s){const{matchUps:l}=Vt({tournamentRecord:e});s=l.reduce((p,v)=>v.matchUpId===i?v.drawId:p,void 0),r=(e.events||[]).map(p=>p.drawDefinitions||[]).flat().reduce((p,v)=>v.drawId===s?v:p,void 0)}const{policyDefinitions:c}=ls({policyTypes:[lo],tournamentRecord:e,drawDefinition:r,event:a});return t=t||c,s?Fm({tournamentParticipants:e.participants,policyDefinitions:t,drawDefinition:r,participantId:n,sideNumber:o,matchUpId:i,drawId:s,event:a}):{error:Cn}}function U9({tournamentRecords:t,participantId:e,tournamentId:r,sideNumber:n,matchUpId:o,eventId:i,drawId:s}={}){if(typeof t!="object"||typeof r!="string"||typeof o!="string"||typeof s!="string")return{error:Z};const a=t[r];if(!a)return{error:ee};const c=Ft({tournamentRecord:a,eventId:i,drawId:s});return c.error?c:GM({drawDefinition:c.drawDefinition,tournamentRecord:a,participantId:e,sideNumber:n,matchUpId:o,drawId:s})}function C9({ignoreDisabled:t=!0,tournamentRecords:e,venueIds:r=[],dates:n=[]}){if(!Array.isArray(n))return{error:Z,dates:n};if(!Array.isArray(r))return{error:Z,venueIds:r};if(!n.every(Nr))return{error:ar};const i=Is({tournamentRecords:e,ignoreDisabled:t,dates:n});if(i.error)return i;const s=i.venues.filter(({venueId:d})=>!(r!=null&&r.length)||r.includes(d)),a=i.courts.reduce((d,p)=>(p.dateAvailability.forEach(({date:v})=>{d.includes(v)||d.push(v)}),d),[]).filter(d=>!n.length||n.includes(d)),c={venueIds:s.map(({venueId:d})=>d)},{matchUps:l}=ho({afterRecoveryTimes:!0,tournamentRecords:e,matchUpFilters:c});return{venuesReport:s.map(d=>M9(a,d,l))}}function M9(t,e,r){const{venueId:n,courts:o,venueName:i}=e,s={};return t.forEach(a=>{let c=0,l=0,u=0;for(const v of o){const f=v.dateAvailability.find(h=>h.date===a),m=f&&ya({courtDate:f}),g=m==null?void 0:m.reduce((h,_)=>{const{startTime:I,endTime:P}=_,S=je(P)-je(I);return h+S},0);g&&(u+=1),c+=g}const d=r.filter(({schedule:v})=>v.venueId===n&&qn(a,v.scheduledDate));d.forEach(({schedule:v})=>{const f=tt(v.scheduledTime),m=sr(f,v.averageMinutes),g=je(m)-je(f);l+=g});const p=c?(l/c*100).toFixed(2):"100";s[a]={scheduledMatchUpsCount:d.length,availableCourts:u,availableMinutes:c,scheduledMinutes:l,percentUtilization:p}}),{venueId:n,venueName:i,venueReport:s}}var D9=Object.defineProperty,j9=Object.defineProperties,R9=Object.getOwnPropertyDescriptors,FO=Object.getOwnPropertySymbols,F9=Object.prototype.hasOwnProperty,V9=Object.prototype.propertyIsEnumerable,VO=(t,e,r)=>e in t?D9(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,L9=(t,e)=>{for(var r in e||(e={}))F9.call(e,r)&&VO(t,r,e[r]);if(FO)for(var r of FO(e))V9.call(e,r)&&VO(t,r,e[r]);return t},B9=(t,e)=>j9(t,R9(e));function x9({tournamentRecords:t}){const e=Object.keys(t);return B9(L9({},B),{tournamentIds:e})}const G9={getParticipantScaleItem:g9,getCompetitionDateRange:SM,getTournamentIds:x9,competitionScheduleMatchUps:Sm,getSchedulingProfileIssues:P9,allCompetitionMatchUps:ho,competitionMatchUps:yf,matchUpActions:U9,getCompetitionVenues:em,getVenuesAndCourts:Is,getVenuesReport:C9,credits:Vd};var k9=Object.defineProperty,LO=Object.getOwnPropertySymbols,W9=Object.prototype.hasOwnProperty,q9=Object.prototype.propertyIsEnumerable,BO=(t,e,r)=>e in t?k9(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,H9=(t,e)=>{for(var r in e||(e={}))W9.call(e,r)&&BO(t,r,e[r]);if(LO)for(var r of LO(e))q9.call(e,r)&&BO(t,r,e[r]);return t};function kM({tournamentRecord:t,courtIds:e,dates:r}){if(!t)return{error:ee};if(!Array.isArray(e))return{info:Yt("courtIds"),error:Se};const n=Array.isArray(r)&&r.length?{dates:r}:!0,o=i=>et({creationTime:!1,element:i,extension:{value:n,name:Zr}});for(const i of t.venues||[])for(const s of i.courts||[])if(e!=null&&e.includes(s.courtId)){const a=o(s);if(a.error)return a}return H9({},B)}var Y9=Object.defineProperty,xO=Object.getOwnPropertySymbols,K9=Object.prototype.hasOwnProperty,z9=Object.prototype.propertyIsEnumerable,GO=(t,e,r)=>e in t?Y9(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Q9=(t,e)=>{for(var r in e||(e={}))K9.call(e,r)&&GO(t,r,e[r]);if(xO)for(var r of xO(e))z9.call(e,r)&&GO(t,r,e[r]);return t};function J9({tournamentRecords:t,courtIds:e,dates:r}){if(!t)return{error:Fe};if(!Array.isArray(e))return{error:Se,info:Yt("courtIds")};for(const n of Object.values(t))kM({tournamentRecord:n,courtIds:e,dates:r});return Q9({},B)}var Z9=Object.defineProperty,kO=Object.getOwnPropertySymbols,X9=Object.prototype.hasOwnProperty,eQ=Object.prototype.propertyIsEnumerable,WO=(t,e,r)=>e in t?Z9(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,tQ=(t,e)=>{for(var r in e||(e={}))X9.call(e,r)&&WO(t,r,e[r]);if(kO)for(var r of kO(e))eQ.call(e,r)&&WO(t,r,e[r]);return t};function WM({tournamentRecord:t,venueIds:e}){if(!t)return{error:ee};if(!Array.isArray(e))return{error:Se,info:Yt("venueIds")};for(const r of t.venues||[])if(e!=null&&e.includes(r.venueId)){const n=et({creationTime:!1,element:r,extension:{name:Zr,value:!0}});if(n.error)return n}return tQ({},B)}var rQ=Object.defineProperty,qO=Object.getOwnPropertySymbols,nQ=Object.prototype.hasOwnProperty,oQ=Object.prototype.propertyIsEnumerable,HO=(t,e,r)=>e in t?rQ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,iQ=(t,e)=>{for(var r in e||(e={}))nQ.call(e,r)&&HO(t,r,e[r]);if(qO)for(var r of qO(e))oQ.call(e,r)&&HO(t,r,e[r]);return t};function sQ({tournamentRecords:t,venueIds:e}){if(!t)return{error:Fe};if(!Array.isArray(e))return{error:Se,info:Yt("venueIds")};for(const r of Object.values(t))WM({tournamentRecord:r,venueIds:e});return iQ({},B)}var aQ=Object.defineProperty,YO=Object.getOwnPropertySymbols,cQ=Object.prototype.hasOwnProperty,lQ=Object.prototype.propertyIsEnumerable,KO=(t,e,r)=>e in t?aQ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,uQ=(t,e)=>{for(var r in e||(e={}))cQ.call(e,r)&&KO(t,r,e[r]);if(YO)for(var r of YO(e))lQ.call(e,r)&&KO(t,r,e[r]);return t};function qM({tournamentRecord:t,courtIds:e,enableAll:r,dates:n}){if(!t)return{error:ee};if(!Array.isArray(e)&&!r)return{error:Se,info:Yt("courtIds")};for(const o of t.venues||[])for(const i of o.courts||[])if(r||e!=null&&e.includes(i.courtId))if(Array.isArray(n)){const{extension:s}=_r({element:i,name:Zr});if(s){let a=s.value;Array.isArray(a.dates)&&(a.dates=a.dates.filter(c=>!n.includes(c))),et({creationTime:!1,element:i,extension:{name:Zr,value:a}})}}else tn({element:i,name:Zr});return uQ({},B)}var dQ=Object.defineProperty,zO=Object.getOwnPropertySymbols,pQ=Object.prototype.hasOwnProperty,fQ=Object.prototype.propertyIsEnumerable,QO=(t,e,r)=>e in t?dQ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,vQ=(t,e)=>{for(var r in e||(e={}))pQ.call(e,r)&&QO(t,r,e[r]);if(zO)for(var r of zO(e))fQ.call(e,r)&&QO(t,r,e[r]);return t};function mQ({tournamentRecords:t,enableAll:e,courtIds:r,dates:n}){if(!t)return{error:Fe};if(!e&&!Array.isArray(r))return{error:Se,info:Yt("courtIds")};for(const o of Object.values(t))qM({tournamentRecord:o,courtIds:r,enableAll:e,dates:n});return vQ({},B)}var gQ=Object.defineProperty,JO=Object.getOwnPropertySymbols,hQ=Object.prototype.hasOwnProperty,_Q=Object.prototype.propertyIsEnumerable,ZO=(t,e,r)=>e in t?gQ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,IQ=(t,e)=>{for(var r in e||(e={}))hQ.call(e,r)&&ZO(t,r,e[r]);if(JO)for(var r of JO(e))_Q.call(e,r)&&ZO(t,r,e[r]);return t};function HM({tournamentRecord:t,venueIds:e,enableAll:r}){if(!t)return{error:ee};if(!Array.isArray(e)&&!r)return{error:Se,info:Yt("venueIds")};for(const n of t.venues||[])(r||e!=null&&e.includes(n.venueId))&&tn({element:n,name:Zr});return IQ({},B)}var PQ=Object.defineProperty,XO=Object.getOwnPropertySymbols,yQ=Object.prototype.hasOwnProperty,OQ=Object.prototype.propertyIsEnumerable,eS=(t,e,r)=>e in t?PQ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,SQ=(t,e)=>{for(var r in e||(e={}))yQ.call(e,r)&&eS(t,r,e[r]);if(XO)for(var r of XO(e))OQ.call(e,r)&&eS(t,r,e[r]);return t};function bQ({tournamentRecords:t,venueIds:e,enableAll:r}){if(!t)return{error:Fe};if(!r&&!Array.isArray(e))return{error:Se,info:Yt("venueIds")};for(const n of Object.values(t))HM({tournamentRecord:n,venueIds:e,enableAll:r});return SQ({},B)}var TQ=Object.defineProperty,tS=Object.getOwnPropertySymbols,EQ=Object.prototype.hasOwnProperty,wQ=Object.prototype.propertyIsEnumerable,rS=(t,e,r)=>e in t?TQ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,NQ=(t,e)=>{for(var r in e||(e={}))EQ.call(e,r)&&rS(t,r,e[r]);if(tS)for(var r of tS(e))wQ.call(e,r)&&rS(t,r,e[r]);return t};function YM({tournamentRecord:t,drawDefinition:e,matchUpId:r,drawId:n}){const o="removeCourtAssignment";if(!r)return{error:Ut};if(!e&&!n)return{error:Mr};let i;if(!e){if(!t)return{error:ee};({drawDefinition:e}=Ft({tournamentRecord:t,drawId:n}))}if(e)({matchUp:i}=nt({drawDefinition:e,matchUpId:r}));else{if(!t)return{error:ee};const{matchUps:s}=Qv({tournamentRecord:t});({matchUp:i}=tU({matchUps:s,matchUpId:r}))}return i?(i.timeItems&&i.timeItems.find(a=>[ts,jo].includes(a.itemType))&&(i.timeItems=i.timeItems.filter(({itemType:a})=>![ts,jo].includes(a)),ze({tournamentId:t==null?void 0:t.tournamentId,context:o,drawDefinition:e,matchUp:i})),NQ({},B)):{error:kr}}function Vm({matchUpsCount:t=0}){const r=`Schedule would be deleted from ${t} ${t===1?"matchUp":"matchUps"}; use { force: true }`;return{error:iF,info:r}}var $Q=Object.defineProperty,nS=Object.getOwnPropertySymbols,AQ=Object.prototype.hasOwnProperty,UQ=Object.prototype.propertyIsEnumerable,oS=(t,e,r)=>e in t?$Q(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,KM=(t,e)=>{for(var r in e||(e={}))AQ.call(e,r)&&oS(t,r,e[r]);if(nS)for(var r of nS(e))UQ.call(e,r)&&oS(t,r,e[r]);return t};function Lm({tournamentRecord:t,venueId:e,force:r}){if(!t)return{error:ee};if(typeof e!="string")return{error:Wo};const n={venueIds:[e]},{matchUps:o}=Vt({tournamentRecord:t,contextFilters:n});if(!o.length||r)for(const s of o){const a=YM({matchUpId:s.matchUpId,drawId:s.drawId,tournamentRecord:t});if(a.error)return a}else return Vm({matchUpsCount:o.length});let i;return t.venues=(t.venues||[]).filter(s=>{if(s.venueId!==e)return!0;i=!0}),i?(Le({payload:{venueId:e,tournamentId:t.tournamentId},topic:_U,key:e}),KM({},B)):{error:oi}}function CQ({tournamentRecord:t,venueIds:e,force:r}){if(!t)return{error:ee};if(!Array.isArray(e))return{error:Z};for(const n of t.venues||[]){const{venueId:o}=n;if(e.includes(o)){const{venueId:i}=n,s=Lm({tournamentRecord:t,venueId:i,force:r});if(s.error)return s}}return KM({},B)}function MQ({tournamentRecords:t,venueId:e,force:r}){if(!t)return{error:Fe};if(typeof e!="string")return{error:Wo};let n;for(const o of Object.values(t)){const i=Lm({tournamentRecord:o,venueId:e,force:r});if(i.error&&i.error!==oi)return i;i.success&&(n=!0)}return TM({tournamentRecords:t}),n?B:{error:oi}}function DQ({tournamentRecord:t,schedulingProfile:e}){return t?Array.isArray(e)?Bd({tournamentRecord:t,schedulingProfile:e}):{error:Z}:{error:ee}}function jQ({tournamentRecord:t,schedulingProfile:e}){return _i({tournamentRecord:t,extension:{name:Mo,value:e}})}function Ld({tournamentRecord:t}){var e;if(!t)return{error:ee};const r=t.tournamentId,{extension:n}=hr({name:Mo,tournamentRecord:t});let o=(n==null?void 0:n.value)||[];if(o.length){const i=(e=t.venues)==null?void 0:e.map(({venueId:d,courts:p})=>(p==null?void 0:p.length)&&d),{eventIds:s,drawIds:a}=bd({tournamentRecords:{[r]:t}}),{updatedSchedulingProfile:c,modifications:l,issues:u}=Rd({schedulingProfile:o,venueIds:i,eventIds:s,drawIds:a});if(l){o=c;const d=jQ({tournamentRecord:t,schedulingProfile:o});return d.error?d:{schedulingProfile:o,modifications:l,issues:u}}}return{schedulingProfile:o,modifications:0}}function Bd({tournamentRecord:t,schedulingProfile:e,requireCourts:r=!0}){if(!e){const{modifications:c,issues:l}=Ld({tournamentRecord:t});return{success:!c,modifications:c,issues:l}}const{venueIds:n,eventIds:o,drawIds:i}=OM({tournamentRecord:t,requireCourts:r}),{modifications:s,issues:a}=Rd({schedulingProfile:e,venueIds:n,eventIds:o,drawIds:i});return{success:!s,modifications:s,issues:a}}function Bm({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:r,venueMatchUps:n,courtId:o}){if(!e&&!Array.isArray(n))return{error:ee};if(!o)return{error:ca};const{schedulingProfile:i}=Ld({tournamentRecord:e});if(Array.isArray(n))return{matchUps:c({matchUps:n,courtId:o})};const{matchUps:s}=Vt({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:r});return{matchUps:c({matchUps:s,courtId:o})};function c({matchUps:l,courtId:u}){const d=l.filter(p=>{var v,f,m;const g=(f=(v=p.schedule)==null?void 0:v.allocatedCourts)==null?void 0:f.map(({courtId:h})=>h);return((m=p.schedule)==null?void 0:m.courtId)===u||(g==null?void 0:g.includes(u))});return _u({matchUps:d,schedulingProfile:i})}}function RQ({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:r,venueId:n}){if(!e)return{error:ee};if(!n)return{error:Wo};const{schedulingProfile:o}=Ld({tournamentRecord:e}),{matchUps:i}=Vt({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:r});return{matchUps:a({matchUps:i,venueId:n})};function a({matchUps:c,venueId:l}){const u=c.filter(d=>{var p,v,f;const m=(v=(p=d.schedule)==null?void 0:p.allocatedCourts)==null?void 0:v.map(({venueId:g})=>g);return((f=d.schedule)==null?void 0:f.venueId)===l||(m==null?void 0:m.includes(l))});return _u({matchUps:u,schedulingProfile:o})}}var FQ=Object.defineProperty,iS=Object.getOwnPropertySymbols,VQ=Object.prototype.hasOwnProperty,LQ=Object.prototype.propertyIsEnumerable,sS=(t,e,r)=>e in t?FQ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,BQ=(t,e)=>{for(var r in e||(e={}))VQ.call(e,r)&&sS(t,r,e[r]);if(iS)for(var r of iS(e))LQ.call(e,r)&&sS(t,r,e[r]);return t};function zM({tournamentRecord:t,drawDefinition:e,disableNotice:r,courtId:n,force:o}){const i=ps({tournamentRecord:t,courtId:n});if(i.error)return i;const s=i.venue,{matchUps:a}=Bm({tournamentRecord:t,courtId:n});if(!a.length||o){for(const c of a){const l=YM({matchUpId:c.matchUpId,drawId:c.drawId,tournamentRecord:t,drawDefinition:e});if(l.error)return l}s.courts=(s.courts||[]).filter(c=>c.courtId!==n),r||Le({topic:ds,payload:{venue:s,tournamentId:t.tournamentId},key:s.venueId})}else return Vm({matchUpsCount:a.length});return BQ({},B)}var xQ=Object.defineProperty,aS=Object.getOwnPropertySymbols,GQ=Object.prototype.hasOwnProperty,kQ=Object.prototype.propertyIsEnumerable,cS=(t,e,r)=>e in t?xQ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,WQ=(t,e)=>{for(var r in e||(e={}))GQ.call(e,r)&&cS(t,r,e[r]);if(aS)for(var r of aS(e))kQ.call(e,r)&&cS(t,r,e[r]);return t};function qQ({tournamentRecords:t,courtId:e,force:r}){if(!t)return{error:Fe};if(typeof e!="string")return{error:ca};let n,o;for(const i of Object.values(t)){if(o=zM({tournamentRecord:i,courtId:e,force:r}),o.error&&o.error!==rv)return o;o.success&&(n=!0)}return n?WQ({},B):o}function Iu(t){return parseInt(t)}function lS({startTime:t,endTime:e}={}){if(!ti.test(t)||!ti.test(e))return!1;const[r,n]=t.split(":").map(Iu),[o,i]=e.split(":").map(Iu);return o<r?!1:!(r===o&&i<n)}function HQ(t,e){const[r,n]=t.startTime.split(":").map(Iu),[o,i]=e.startTime.split(":").map(Iu);return r<o?-1:r>o?1:n<i?-1:n>i?1:0}function QM({dateAvailability:t}){if(!t)return{error:SR};if(!Array.isArray(t))return{error:op};const e="Dates must be formated => YYYY-MM-DD",r="Times must be 24 hour => 00:00";for(const n of t){if(typeof n!="object")return{error:op};const{date:o,startTime:i,endTime:s,bookings:a=[]}=n;if(!i||!s)return{error:op};if(o&&!Tn.test(o))return{error:ar,dateAvailability:{date:o},info:e};if(!ti.test(i))return{error:Rr,dateAvailability:{startTime:i},info:r};if(!ti.test(s))return{error:Rr,dateAvailability:{endTime:s},info:r};if(i===s)return{error:Rr,dateAvailability:{startTime:i,endTime:s},info:"startTime and endTime are equivalent"};if(!lS({startTime:i,endTime:s}))return{error:Rr,dateAvailability:{startTime:i,endTime:s},info:"endTime must be after startTime"};if(a){if(!Array.isArray(a))return{error:cf};for(const c of a){if(typeof c!="object")return{error:cf};const{startTime:l,endTime:u}=c;if(!ti.test(l))return{error:Rr,booking:{startTime:l},info:r};if(!ti.test(u))return{error:Rr,booking:{endTime:u},info:r};if(l===u)return{error:Rr,dateAvailability:{startTime:l,endTime:u},info:"startTime and endTime are equivalent"};if(!lS({startTime:l,endTime:u}))return{error:Rr,dateAvailability:{startTime:l,endTime:u},info:"endTime must be after startTime"}}}}return{valid:!0}}var YQ=Object.defineProperty,KQ=Object.defineProperties,zQ=Object.getOwnPropertyDescriptors,uS=Object.getOwnPropertySymbols,QQ=Object.prototype.hasOwnProperty,JQ=Object.prototype.propertyIsEnumerable,dS=(t,e,r)=>e in t?YQ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,JM=(t,e)=>{for(var r in e||(e={}))QQ.call(e,r)&&dS(t,r,e[r]);if(uS)for(var r of uS(e))JQ.call(e,r)&&dS(t,r,e[r]);return t},ZQ=(t,e)=>KQ(t,zQ(e));function ZM({tournamentRecord:t,dateAvailability:e,disableNotice:r,venueMatchUps:n,courtId:o,force:i}){if(!t)return{error:ee};if(!o)return{error:ca};let s=QM({dateAvailability:e});if(s.error)return s;const{updatedDateAvailability:a,totalMergeCount:c}=XQ(e);if(e=a,s=ps({tournamentRecord:t,courtId:o}),s.error)return s;const{court:l,venue:u}=s,{matchUps:d}=Bm({tournamentRecord:t,venueMatchUps:n,courtId:o});return d!=null&&d.length&&console.log("scheduled court matchUps",d.length),l.dateAvailability=e,r||Le({payload:{venue:u,tournamentId:t.tournamentId},topic:ds,key:u.venueId}),ZQ(JM({},B),{totalMergeCount:c})}function XQ(t){let e=0;const r=t.reduce((o,i)=>{const{date:s,startTime:a,endTime:c,bookings:l}=i;return o[s]||(o[s]=[]),o[s].push({startTime:a,endTime:c,bookings:l}),o},{}),n=[];return Object.keys(r).forEach(o=>{r[o].sort(HQ);const{mergedAvailability:i,mergeCount:s}=eJ(r[o]);n.push(...i.map(a=>JM({date:o},a))),e+=s}),{updatedDateAvailability:n,totalMergeCount:e}}function eJ(t){let e,r,n,o=t.length,i=0;const s=[];for(;t.length&&o;){const c=t.shift(),{startTime:l,endTime:u,bookings:d}=c;if(o-=1,!e)e=l,n=d,r=u;else if(Oc(mt(r),mt(l),!1)>0){const v={startTime:e,endTime:r};n!=null&&n.length&&(v.bookings=n),s.push(v),e=l,n=d,r=u}else d&&(n?n.push(d):n=d),r=u,i+=1}const a={startTime:e,endTime:r};return n!=null&&n.length&&(a.bookings=n),s.push(a),{mergedAvailability:s,mergeCount:i}}const XM=()=>({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfaceDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0});var tJ=Object.defineProperty,rJ=Object.defineProperties,nJ=Object.getOwnPropertyDescriptors,pS=Object.getOwnPropertySymbols,oJ=Object.prototype.hasOwnProperty,iJ=Object.prototype.propertyIsEnumerable,fS=(t,e,r)=>e in t?tJ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,sJ=(t,e)=>{for(var r in e||(e={}))oJ.call(e,r)&&fS(t,r,e[r]);if(pS)for(var r of pS(e))iJ.call(e,r)&&fS(t,r,e[r]);return t},aJ=(t,e)=>rJ(t,nJ(e));function xm({tournamentRecord:t,modifications:e,disableNotice:r,venueMatchUps:n,courtId:o,force:i}){if(!t)return{error:ee};if(!o)return{error:ca};if(!e||typeof e!="object")return{error:Xn};const s=ps({tournamentRecord:t,courtId:o});if(s.error)return s;const{court:a,venue:c}=s,l=Object.keys(XM()).filter(v=>v!=="courtId");if(!Object.keys(e).filter(v=>l.includes(v)).length)return{error:ov};const d=l.filter(v=>!["dateAvailability"].includes(v));if(Object.keys(e).filter(v=>d.includes(v)).forEach(v=>Object.assign(a,{[v]:e[v]})),e.dateAvailability){const v=ZM({dateAvailability:e.dateAvailability,tournamentRecord:t,venueMatchUps:n,disableNotice:r,courtId:o,force:i});if(v.error)return v}return r||Le({payload:{venue:c,tournamentId:t.tournamentId},topic:ds,key:c.venueId}),aJ(sJ({},B),{court:de(a)})}var cJ=Object.defineProperty,vS=Object.getOwnPropertySymbols,lJ=Object.prototype.hasOwnProperty,uJ=Object.prototype.propertyIsEnumerable,mS=(t,e,r)=>e in t?cJ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,dJ=(t,e)=>{for(var r in e||(e={}))lJ.call(e,r)&&mS(t,r,e[r]);if(vS)for(var r of vS(e))uJ.call(e,r)&&mS(t,r,e[r]);return t};function pJ({tournamentRecords:t,modifications:e,disableNotice:r,courtId:n,force:o}){if(!t)return{error:Fe};if(!n)return{error:Se,info:"missing courtId"};let i,s;for(const a of Object.values(t)){const c=xm({tournamentRecord:a,modifications:e,disableNotice:r,courtId:n,force:o});c!=null&&c.error&&(s=c),i=!0}return i?dJ({},B):s}const fJ=()=>({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,addresses:[],contacts:[],courts:[],roles:[]});var vJ=Object.defineProperty,mJ=Object.defineProperties,gJ=Object.getOwnPropertyDescriptors,gS=Object.getOwnPropertySymbols,hJ=Object.prototype.hasOwnProperty,_J=Object.prototype.propertyIsEnumerable,hS=(t,e,r)=>e in t?vJ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,qa=(t,e)=>{for(var r in e||(e={}))hJ.call(e,r)&&hS(t,r,e[r]);if(gS)for(var r of gS(e))_J.call(e,r)&&hS(t,r,e[r]);return t},Rl=(t,e)=>mJ(t,gJ(e));function Gm({tournamentRecord:t,disableNotice:e,venueId:r,courtId:n,court:o}){const{venue:i}=Yo({tournamentRecord:t,venueId:r});if(!i)return{error:oi};i.courts||(i.courts=[]);const s=Rl(qa({},XM()),{venueId:r,courtId:n});if(s.courtId||(s.courtId=ke()),i.courts.reduce((c,l)=>c||l.courtId===s.courtId,void 0))return{error:GR};{const c=((o==null?void 0:o.dateAvailability)||[]).map(l=>{var u;return Rl(qa({},l),{date:Me(l.date),startTime:tt(l.startTime),endTime:tt(l.endTime),bookings:(u=l.bookings)==null?void 0:u.map(({startTime:d,endTime:p,bookingType:v})=>({startTime:tt(d),endTime:tt(p),bookingType:v}))})});for(const l of Object.keys(s))if(o[l])if(l==="dateAvailability"){const u=QM({dateAvailability:c});if(!u.valid&&u.error)return u;s.dateAvailability=c}else s[l]=o[l];return i.courts.push(s),e||Le({payload:{venue:i,tournamentId:t.tournamentId},topic:ds,key:i.venueId}),Rl(qa({},B),{court:de(s),venueId:r})}}function km({courtNameRoot:t="Court",dateAvailability:e=[],venueAbbreviationRoot:r,tournamentRecord:n,courtNames:o=[],courtTimings:i,courtsCount:s,startTime:a,courtIds:c,endTime:l,idPrefix:u,venueId:d,dates:p}){if(!d)return{error:Wo};let v=Yo({tournamentRecord:n,venueId:d});if(v.error)return v;const{venue:f}=v;if(!Pt(s)||!o)return{error:xR};s=s||o.length,v=le(0,s).map(h=>{const _=i==null?void 0:i[h],I=_?p.map(P=>qa({date:yn(P),startTime:a,endTime:l},_)):e;return _&&a&&l&&I.push({startTime:a,endTime:l}),{courtName:o[h]||r&&f.venueAbbreviation&&`${f.venueAbbreviation} ${h+1}`||`${t} ${h+1}`,dateAvailability:I}}).map((h,_)=>{const I=(c==null?void 0:c.pop())||u&&`${u}-${_+1}`;return Gm({disableNotice:!0,tournamentRecord:n,courtId:I,venueId:d,court:h})});const g=v.map(h=>h.court).filter(Boolean);return g.length!==parseInt(s)?{error:"Not all courts could be generated",result:v}:(Le({payload:{venue:f,tournamentId:n.tournamentId},topic:ds,key:f.venueId}),Rl(qa({},B),{courts:de(g)}))}var IJ=Object.defineProperty,PJ=Object.defineProperties,yJ=Object.getOwnPropertyDescriptors,_S=Object.getOwnPropertySymbols,OJ=Object.prototype.hasOwnProperty,SJ=Object.prototype.propertyIsEnumerable,IS=(t,e,r)=>e in t?IJ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,bJ=(t,e)=>{for(var r in e||(e={}))OJ.call(e,r)&&IS(t,r,e[r]);if(_S)for(var r of _S(e))SJ.call(e,r)&&IS(t,r,e[r]);return t},TJ=(t,e)=>PJ(t,yJ(e));function eD({tournamentRecord:t,modifications:e,venueId:r,force:n}){var o,i;if(!t)return{error:ee};if(!e||typeof e!="object")return{error:Xn};if(!r)return{error:Wo};const{matchUps:s}=RQ({tournamentRecord:t,venueId:r}),a=Yo({tournamentRecord:t,venueId:r});if(a.error)return a;const c=a.venue,l=Object.keys(fJ()).filter(g=>g!=="venueId");if(!Object.keys(e).filter(g=>l.includes(g)).length)return{error:ov};const d=l.filter(g=>!["courts","onlineResources"].includes(g));Object.keys(e).filter(g=>d.includes(g)).forEach(g=>Object.assign(c,{[g]:e[g]}));const v=((o=c==null?void 0:c.courts)==null?void 0:o.map(g=>g.courtId))||[],f=((i=e.courts)==null?void 0:i.map(g=>g.courtId))||[],m=v.filter(g=>!f.includes(g));if(m.length){const h=c.courts.filter(_=>m.includes(_.courtId)).map(_=>{var I;return((I=Bm({courtId:_.courtId,tournamentRecord:t,venueMatchUps:s}).matchUps)==null?void 0:I.length)||0}).reduce((_,I)=>_+I);if(!h||n)c.courts=c.courts.filter(_=>f.includes(_.courtId));else return{error:Vm({matchUpsCount:h})}}if(e.courts)for(const g of e.courts){const{courtId:h}=g||{};let _=xm({modifications:g,disableNotice:!0,tournamentRecord:t,venueMatchUps:s,courtId:h,force:n});if(_.error===rv&&(_=Gm({disableNotice:!0,tournamentRecord:t,venueId:r,court:g})),_.error)return _}return Bd({tournamentRecord:t}),Le({payload:{venue:c,tournamentId:t.tournamentId},topic:ds,key:c.venueId}),TJ(bJ({},B),{venue:de(c)})}var EJ=Object.defineProperty,PS=Object.getOwnPropertySymbols,wJ=Object.prototype.hasOwnProperty,NJ=Object.prototype.propertyIsEnumerable,yS=(t,e,r)=>e in t?EJ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,$J=(t,e)=>{for(var r in e||(e={}))wJ.call(e,r)&&yS(t,r,e[r]);if(PS)for(var r of PS(e))NJ.call(e,r)&&yS(t,r,e[r]);return t};function AJ({tournamentRecords:t,modifications:e,venueId:r,force:n}){if(!t)return{error:Fe};if(typeof r!="string")return{error:Wo};let o,i;for(const s of Object.values(t)){const a=eD({tournamentRecord:s,modifications:e,venueId:r,force:n});if(a.success&&(i=!0),a.error&&(o=a.error),a.error&&a.error!==oi)return a}return TM({tournamentRecords:t}),i?$J({},B):{error:o}}var UJ=Object.defineProperty,OS=Object.getOwnPropertySymbols,CJ=Object.prototype.hasOwnProperty,MJ=Object.prototype.propertyIsEnumerable,SS=(t,e,r)=>e in t?UJ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,DJ=(t,e)=>{for(var r in e||(e={}))CJ.call(e,r)&&SS(t,r,e[r]);if(OS)for(var r of OS(e))MJ.call(e,r)&&SS(t,r,e[r]);return t};function jJ(t){const{tournamentRecords:e,venueId:r}=t;if(typeof r!="string"||!r)return{error:Wo};let n;for(const o of Object.values(e)){const{venue:i}=Yo({tournamentRecord:o,venueId:r});if(i){const s=km(DJ({tournamentRecord:o},t));if(s.error)return s;n=!0}}return n?B:{error:oi}}var RJ=Object.defineProperty,FJ=Object.defineProperties,VJ=Object.getOwnPropertyDescriptors,bS=Object.getOwnPropertySymbols,LJ=Object.prototype.hasOwnProperty,BJ=Object.prototype.propertyIsEnumerable,TS=(t,e,r)=>e in t?RJ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,xJ=(t,e)=>{for(var r in e||(e={}))LJ.call(e,r)&&TS(t,r,e[r]);if(bS)for(var r of bS(e))BJ.call(e,r)&&TS(t,r,e[r]);return t},GJ=(t,e)=>FJ(t,VJ(e));function kJ({tournamentRecords:t,disableNotice:e,venue:r,context:n}){if(typeof r!="object")return{error:Z};r.venueId||(r.venueId=ke());let o;for(const i of Object.values(t)){const s=Tc({disableNotice:!0,tournamentRecord:i,context:n,venue:r});if(s!=null&&s.error)return s;o=s.venue}return e||Le({topic:gU,payload:{venue:r}}),_e(GJ(xJ({},B),{venue:o}))}const WJ={disableCourts:J9,disableVenues:sQ,enableCourts:mQ,enableVenues:bQ,deleteCourt:qQ,deleteVenue:MQ,modifyCourt:pJ,modifyVenue:AJ,addCourts:jJ,addVenue:kJ};function qJ({convertExtensions:t,removeExtensions:e}){const r=Bl();return{tournamentId:vn(),tournamentRecords:de(r,t,!1,e)}}function HJ(){var t;const e=Bl(),{extension:r}=td({name:Ji,tournamentRecords:e}),n=((t=r==null?void 0:r.value)==null?void 0:t.tournamentIds)||[];return Object.keys(e).forEach(o=>{n.includes(o)||delete e[o]}),yc(e)}function YJ(t,e=!0){return typeof t!="object"||Array.isArray(t)?{error:Xn}:t!=null&&t.tournamentId?DA(e?de(t):t):{error:Z}}function Dp(t,e=!0){if(typeof t!="object")return{error:Xn};if(Array.isArray(t)){if(!(t.filter(n=>n==null?void 0:n.tournamentId).length===t.length))return{error:Wg};t=Object.assign({},...t.map(n=>({[n.tournamentId]:n})))}else if(t!=null&&t.tournamentId)t={[t.tournamentId]:t};else if(!Object.keys(t).every(n=>t[n].tournamentId===n))return{error:Wg};return yc(e?de(t):t)}var KJ=Object.defineProperty,zJ=Object.defineProperties,QJ=Object.getOwnPropertyDescriptors,ES=Object.getOwnPropertySymbols,JJ=Object.prototype.hasOwnProperty,ZJ=Object.prototype.propertyIsEnumerable,wS=(t,e,r)=>e in t?KJ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ua=(t,e)=>{for(var r in e||(e={}))JJ.call(e,r)&&wS(t,r,e[r]);if(ES)for(var r of ES(e))ZJ.call(e,r)&&wS(t,r,e[r]);return t},NS=(t,e)=>zJ(t,QJ(e));(function(){const t={getState:({convertExtensions:s,removeExtensions:a}={})=>qJ({convertExtensions:s,removeExtensions:a}),version:()=>oo(),reset:()=>(yc({}),e())};return o([z7,u9,G9,oK,Q8,WJ]),t.devContext=s=>(Ls(s),e()),t.getDevContext=s=>Ct(s),t.setState=(s,a,c)=>{Yi(a,c);const l=Dp(s,a);return e(l)},t.setTournamentRecord=(s,a,c)=>{Yi(a,c);const l=YJ(s,a);return e(l)},t.removeTournamentRecord=s=>{const a=iv(s);return e(a)},t.removeUnlinkedTournamentRecords=()=>{const s=HJ();return e(s)},t.executionQueue=(s,a)=>i(s,a),t;function e(s){return s!=null&&s.error?(t.error=s.error,t.success=!1):(t.error=void 0,t.success=!0),t}function r(s,a,c,l){var u,d;delete t.success,delete t.error;const p=Date.now(),v=a(Ua({tournamentRecords:s},c)),f=Date.now()-p,m=Ct(),g={method:l},h=typeof m.result=="object"&&m.result.error;return![void 0,!1].includes(m.perf)&&(isNaN(m.perf)||f>m.perf)&&(g.elapsed=f),(h||m.params&&!Array.isArray(m.params)||Array.isArray(m.params)&&((u=m.params)!=null&&u.includes(l)))&&(g.params=c),(h||!h&&m.result&&!Array.isArray(m.result)||Array.isArray(m.result)&&((d=m.result)!=null&&d.includes(l)))&&(g.result=v),Object.keys(g).length>1&&console.log("ce:",g),v}function n(s,a,c){const l=Bl(),u=vn(),d=(a==null?void 0:a.rollbackOnError)&&de(l,!1,!0),p=r(l,s,Ua({activeTournamentId:u},a),c);p!=null&&p.error&&d&&Dp(d);const v=(p==null?void 0:p.success)&&(a==null?void 0:a.delayNotify)!==!0&&(a==null?void 0:a.doNotNotify)!==!0,f=Ka(),m=Date.now();return f&&(Object.values(l).forEach(g=>{cu({tournamentRecord:g,value:{version:oo(),timeStamp:m}})}),p.modificationsApplied=!0),v&&vi({directives:[{method:s,params:a}],mutationStatus:f,timeStamp:m}),(v||!(p!=null&&p.success)||a!=null&&a.doNotNotify)&&ii(),p}function o(s){s.forEach(a=>{Object.keys(a).forEach(c=>{t[c]=l=>{if(Ct())return n(a[c],l,c);try{return n(a[c],l,c)}catch(u){const d=vn(),p=u.toString();console.log("ERROR",{params:JSON.stringify(l),activeTournamentId:d,methodName:c,error:p})}}})})}function i(s,a){var c;if(!Array.isArray(s))return{error:Z};const l=Bl(),u=vn(),d=a&&de(l,!1,!0);let p;const v=[];for(const g of s){if(typeof g!="object")return{error:Z};const{method:h,params:_}=g;if(!t[h]){const P={error:UA,methodName:h},S=Ct();return(S.result&&!Array.isArray(S.result)||Array.isArray(S.result)&&((c=S.result)!=null&&c.includes(h)))&&console.log("ce:",P),P}const I=r(l,t[h],Ua({activeTournamentId:u},_),h);if(I!=null&&I.error)return d&&Dp(d),NS(Ua({},I),{rolledBack:!!d});v.push(NS(Ua({},I),{methodName:h})),p=Date.now()}const f=Ka();return f&&Object.values(l).forEach(g=>{cu({tournamentRecord:g,value:{version:oo(),timeStamp:p}})}),vi({directives:s,mutationStatus:f,timeStamp:p}),ii(),{success:v.every(g=>g.success),results:v}}})();var XJ=Object.defineProperty,$S=Object.getOwnPropertySymbols,eZ=Object.prototype.hasOwnProperty,tZ=Object.prototype.propertyIsEnumerable,AS=(t,e,r)=>e in t?XJ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,rZ=(t,e)=>{for(var r in e||(e={}))eZ.call(e,r)&&AS(t,r,e[r]);if($S)for(var r of $S(e))tZ.call(e,r)&&AS(t,r,e[r]);return t};function Wm({structureName:t=Nt,structureAbbreviation:e,drawDefinition:r,matchUpType:n,structureId:o}){if(!r)return{error:pe};const i=Mt({stage:Nt,structureAbbreviation:e,structureName:t,matchUps:[],structureId:o,matchUpType:n});return r.structures.push(i),Qe({drawDefinition:r,structureIds:[o]}),rZ({},B)}function ra({targetEntryRound:t=1,finishingPositions:e,sourceRoundNumber:r,sourceStructureId:n,targetStructureId:o,linkType:i=fo}){return!n||!o?{error:ur}:{link:_e({linkType:i,source:{roundNumber:r,structureId:n,finishingPositions:e},target:{feedProfile:zr,roundNumber:t,structureId:o}})}}function qm({idPrefix:t,roundNumber:e,roundPosition:r,uuids:n}){return t?`${t}-${e}-${r}`:(n==null?void 0:n.pop())||ke()}function Pu({includeMatchUpType:t,matchUpType:e,roundNumber:r,matchUps:n,idPrefix:o,isMock:i,uuids:s,nodes:a}){let c=0;const l=[];let u=1;const d=r-1,p=a.length;for(;c<p;){const v=a[c],f=a[c+1];d&&(v.roundNumber=d),f&&d&&(f.roundNumber=d);const m=qm({roundPosition:u,roundNumber:r,idPrefix:o,uuids:s}),g={roundPosition:u,children:[v,f],matchUpId:m};l.push(g);const h={drawPositions:g.children.map(_=>_==null?void 0:_.drawPosition).filter(Boolean),matchUpStatus:pt,matchUpId:g.matchUpId,roundPosition:u,roundNumber:r};t&&(h.matchUpType=e),i&&(h.isMock=!0),n.push(h),u++,c+=2}return{roundNodes:l,matchUps:n}}function Un({finishingPositionOffset:t,finishingPositionLimit:e,qualifyingRoundNumber:r,qualifyingPositions:n,matchUpType:o,roundLimit:i,idPrefix:s,drawSize:a,isMock:c,uuids:l}){if(isNaN(a)||a<2||n&&a<=n)return{matchUps:[],roundsCount:0};if(n&&(!Lr(a)||a%n)){let g=n;for(;g<a;)g=2*g;a=g}const u=!(a%2)&&(!isNaN(n)||!isNaN(r))&&(a/n===Math.round(a/n)||a/r===Math.round(a/r));if(!Lr(a)&&!u)return{matchUps:[],roundsCount:0};const d=le(1,parseInt(a)+1).map(g=>({drawPosition:g}));let p,v=[],f=1;for({roundNodes:p,matchUps:v}=Pu({matchUpType:o,roundNumber:f,idPrefix:s,matchUps:v,isMock:c,nodes:d,uuids:l}),f++,i=i||r||(n>1?a/2/n:void 0);p.length>1;)n&&p.length===n&&(i=f-1),{roundNodes:p,matchUps:v}=Pu({nodes:p,matchUpType:o,roundNumber:f,idPrefix:s,matchUps:v,isMock:c,uuids:l}),f++;const m=f-1;return v=Wc({finishingPositionOffset:t,finishingPositionLimit:e,roundsCount:m,roundLimit:i,matchUps:v}),i?v=v.filter(g=>g.roundNumber<=i):i=f-1,{drawSize:a,matchUps:v,roundsCount:m,roundLimit:i}}var nZ=Object.defineProperty,oZ=Object.defineProperties,iZ=Object.getOwnPropertyDescriptors,US=Object.getOwnPropertySymbols,sZ=Object.prototype.hasOwnProperty,aZ=Object.prototype.propertyIsEnumerable,CS=(t,e,r)=>e in t?nZ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,cZ=(t,e)=>{for(var r in e||(e={}))sZ.call(e,r)&&CS(t,r,e[r]);if(US)for(var r of US(e))aZ.call(e,r)&&CS(t,r,e[r]);return t},lZ=(t,e)=>oZ(t,iZ(e));function tD({qualifyingProfiles:t,appliedPolicies:e,idPrefix:r,isMock:n,uuids:o}){var i;const s="generateQualifyingSTructures",a=[],c=[],l=[],u=(g,h)=>g.stageSequence-h.stageSequence,d=(g,h)=>g.roundTarget-h.roundTarget;let p=0,v=0,f,m=1;for(const g of t.sort(d)){const h=g.structureProfiles||[];m=g.roundTarget||m;let _=1,I=0,P,S,y;for(const O of(h||[]).sort(u)){let b=O.drawSize||Hf(O.participantsCount);const{qualifyingRoundNumber:E,qualifyingPositions:T,structureOptions:N,matchUpFormat:w,structureName:$,matchUpType:U,structureId:A,drawType:C}=O;let M,D,V;if(!lt(b))return k({result:{error:Bu},stack:s});const R=t.length>1?`${m}-`:"",W=h.length>1||R?_:"",x=$||(R||W?`${Ie} ${R}${W}`:Ie);if(C===an){const{structures:K,groupCount:j,maxRoundNumber:L}=zc({structureName:O.structureName||x,structureId:A||(o==null?void 0:o.pop()),qualifyingPositions:T,stage:Ie,structureOptions:N,appliedPolicies:e,stageSequence:_,matchUpType:U,roundTarget:m,idPrefix:r,drawSize:b,isMock:n,uuids:o});I=j,M=L,D=K[0],f=[1]}else({drawSize:b,matchUps:V,roundLimit:M}=Un({qualifyingRoundNumber:E,qualifyingPositions:T,matchUpType:U,idPrefix:r,drawSize:b,isMock:n,uuids:o})),D=Mt({structureName:O.structureName||x,structureId:A||(o==null?void 0:o.pop()),qualifyingRoundNumber:M,stage:Ie,matchUpFormat:w,stageSequence:_,matchUpType:U,roundLimit:M,matchUps:V}),m&&et({element:D,extension:{name:Dn,value:m}}),I=(i=V==null?void 0:V.filter(K=>K.roundNumber===M))==null?void 0:i.length;if(_>1){const{link:K}=ra({sourceStructureId:S,sourceRoundNumber:P,targetStructureId:D.structureId,finishingPositions:y===po?[1]:void 0,linkType:y});l.push(K),p+=b-I}else p+=b;y=C===an?po:fo,S=D.structureId,P=M,c.push(D),_+=1}v+=I,a.push({qualifiersCount:I,finalQualifyingRoundNumber:P,finalQualifyingStructureId:S,finishingPositions:f,roundTarget:m,linkType:y}),I=0,m+=1}return lZ(cZ({qualifiersCount:v,qualifyingDrawPositionsCount:p,qualifyingDetails:a,structures:c},B),{links:l})}function Hm({drawDefinition:t,structureId:e}){const r=Te({drawDefinition:t,structureId:e});if(r.error)return r;const{matchUps:n}=Ke({structure:r.structure});return lr({matchUps:n})}function MS({finishingPositions:t,drawDefinition:e,structureId:r}){const{roundProfile:n}=Hm({drawDefinition:e,structureId:r});return Object.keys(n).reduce((i,s)=>(rD(n[s]).forEach(c=>{t.forEach(l=>{uZ({position:l,rangeDefinition:c})&&(i[l]={roundNumber:s})})}),i),{})}function uZ({position:t,rangeDefinition:e}){if(!Array.isArray(e)||e.reduce((i,s)=>i||isNaN(s),!1))return!1;const[r,n]=e;return le(r,(n||r)+1).includes(t)}function rD(t){var e,r;return[Ve(((e=t==null?void 0:t.finishingPositionRange)==null?void 0:e.loser)||[]),Ve(((r=t==null?void 0:t.finishingPositionRange)==null?void 0:r.winner)||[])]}function dZ(t){return rD(t).map(e=>le(e[0],e[1]&&e[1]+1||e[0]+1))}function xd({drawDefinition:t,structureIds:e}){if(e&&!Array.isArray(e))return{error:Z,context:{structureIds:e}};if(!t)return{error:pe};e=e||(t.structures||[]).filter(s=>s.structureType!==Ie).map(({structureId:s})=>s);const r=e.map(s=>{const{roundProfile:a}=Hm({drawDefinition:t,structureId:s});return Object.values(a).map(dZ).flat()}).flat(),n=r.filter(s=>s.length===1).sort(Bt).flat();return{positionsNotPlayedOff:Ve(r.flat()).filter(s=>!n.includes(s)),positionsPlayedOff:n}}function Ym({excludeRoundNumbers:t=[],playoffPositions:e=[],drawDefinition:r,structureId:n}){if(!r)return{error:pe};if(!n)return{error:ur};if(!e)return{error:Se,info:"missing playoffPositions"};const o=xd({drawDefinition:r});if(o.error)return o;const i=o.positionsPlayedOff,s=e.filter(g=>!i.includes(g)),a=MS({finishingPositions:s,drawDefinition:r,structureId:n}),c=Object.values(a).reduce((g,h)=>g.includes(h.roundNumber)?g:g.concat(h.roundNumber),[]).map(g=>parseInt(g)).filter(g=>!t.includes(parseInt(g))),l=MS({finishingPositions:i,drawDefinition:r,structureId:n}),u=Object.values(l).reduce((g,h)=>g.includes(h.roundNumber)?g:g.concat(h.roundNumber),[]).map(g=>parseInt(g)),d=c.filter(g=>!u.includes(g)).sort(Bt),{roundProfile:p}=Hm({drawDefinition:r,structureId:n}),v=d.map(g=>{const h=p[g].finishingPositionRange.loser,[_,I]=h;return le(_,(I||_)+1)}).flat().sort(Bt),{playoffRoundsRanges:f}=pZ({playoffSourceRounds:d,roundProfile:p}),m=[...d,...u];return{playoffPositionsReturned:v,playedOffSourceRounds:u,playoffRoundsRanges:f,playoffSourceRounds:d,roundProfile:p,sourceRounds:m}}function pZ({playoffSourceRounds:t,roundProfile:e}){return{playoffRoundsRanges:t.map(n=>{const o=e[n].finishingPositionRange.loser,[i,s]=o,a=le(i,(s||i)+1);return{finishingPositionRange:o.join("-"),finishingPositions:a,roundNumber:n}})}}var fZ=Object.defineProperty,yu=Object.getOwnPropertySymbols,nD=Object.prototype.hasOwnProperty,oD=Object.prototype.propertyIsEnumerable,DS=(t,e,r)=>e in t?fZ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,jS=(t,e)=>{for(var r in e||(e={}))nD.call(e,r)&&DS(t,r,e[r]);if(yu)for(var r of yu(e))oD.call(e,r)&&DS(t,r,e[r]);return t},vZ=(t,e)=>{var r={};for(var n in t)nD.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&yu)for(var n of yu(t))e.indexOf(n)<0&&oD.call(t,n)&&(r[n]=t[n]);return r};function dc({drawDefinition:t,structureId:e}){if(!t)return{error:pe};let{structures:r}=Ur({stageSeqence:1,drawDefinition:t,stage:ue});const{positionsNotPlayedOff:n,positionsPlayedOff:o}=xd({drawDefinition:t});({structures:r}=Ur({drawDefinition:t}));const i=r.filter(c=>!e&&c.stage!==Nt||c.structureId===e),s={},a=Er({inContext:!0,drawDefinition:t}).matchUps;for(const c of i){const l=c==null?void 0:c.structureId,u=mZ({playoffPositions:n,drawDefinition:t,structure:c,matchUps:a}),d=u,{error:p}=d,v=vZ(d,["error"]);if(p)return u;s[l]=jS({structureId:l},v)}return e?jS({positionsPlayedOff:o},s[e]):{availablePlayoffProfiles:Object.values(s),availablePlayoffRounds:Object.values(s),positionsPlayedOff:o}}function mZ({playoffPositions:t,drawDefinition:e,structure:r,matchUps:n}){var o,i,s,a,c,l;const u=r==null?void 0:r.structureId,{links:d}=Gc({drawDefinition:e,structureId:u});if(r.structureType===er||r.structures){const _=Xe({structure:r}).positionAssignments.length,I=r.structures.length,P=_/I,S=((o=d.source)==null?void 0:o.flatMap(({source:A})=>(A==null?void 0:A.finishingPositions)||[]))||[],y=le(1,P+1).filter(A=>!S.includes(A)),O=((s=(i=n.find(A=>A.containerStructureId===u&&A.finishingPositionRange))==null?void 0:i.finishingPositionRange)==null?void 0:s.winner)||[0,1],b=d==null?void 0:d.source.map(({target:A})=>A.structureId),{positionsPlayedOff:E,positionsNotPlayedOff:T}=xd({structureIds:b,drawDefinition:e}),N=[...E,...T],w=le(O[0],O[1]+1).filter(A=>!N.includes(A)),$=jt(w,w.length/y.length),U=y.map((A,C)=>{const M=$[C],D=[Math.min(...M||[]),Math.max(...M||[])].join("-");return{finishingPosition:A,finishingPositions:M,finishingPositionRange:D}});return{positionsNotPlayedOff:w,playoffFinishingPositionRanges:U,finishingPositionsAvailable:y,finishingPositionsPlayedOff:S,positionsPlayedOff:E,groupCount:I,groupSize:P}}const p=((a=d==null?void 0:d.source)==null?void 0:a.filter(_=>_.linkCondition!==zn).map(_=>{var I;return(I=_.source)==null?void 0:I.roundNumber}))||[],v=((c=d==null?void 0:d.source)==null?void 0:c.filter(_=>_.linkCondition===zn).map(_=>{var I;return(I=_.source)==null?void 0:I.roundNumber}))||[],{playoffSourceRounds:f,playoffRoundsRanges:m,roundProfile:g,error:h}=Ym({excludeRoundNumbers:p,playoffPositions:t,drawDefinition:e,structureId:u});for(const _ of v){const I=d==null?void 0:d.source.find(b=>b.source.roundNumber===_),P=I==null?void 0:I.target.roundNumber,S=I==null?void 0:I.target.structureId,y=n.filter(({roundNumber:b,structureId:E})=>E===S&&b===P),O=y.filter(({sides:b})=>b.find(E=>E.participantFed&&!E.participantId)).length;if(O===y.length){f.push(_);const b=(l=g[_].finishingPositionRange)==null?void 0:l.loser;if(b){const E=Math.min(...b),T=E+O,N=le(E,T),w={finishingPositionRange:[E,T-1].join("-"),finishingPositions:N,roundNumber:_};m.push(w)}}}return f.sort(Bt),m.sort((_,I)=>_.roundNumber-I.roundNumber),{playoffRounds:f,playoffRoundsRanges:m,error:h}}function gZ({playoffGroups:t,drawDefinition:e,structureId:r}){var n;if(!e)return{error:pe};if(typeof r!="string"||!Array.isArray(t))return{error:Z};const o=t.map(({finishingPositions:c})=>c).flat(),s=(n=dc({drawDefinition:e,structureId:r}).playoffFinishingPositionRanges)==null?void 0:n.filter(c=>o.includes(c.finishingPosition));return{positionRangeMap:s==null?void 0:s.reduce((c,l)=>(c[l.finishingPosition]=l,c),{})}}function hZ({includeMatchUpType:t,drawPosition:e,roundNumber:r,matchUpType:n,idPrefix:o,matchUps:i,isMock:s,uuids:a,nodes:c,fed:l}){const u=c.length,d=e?e-u:void 0,p=le(0,u).map(m=>d?d+m:void 0),v=[];for(let m=0;m<u;m++){const g=p.shift(),h={drawPosition:g,fed:l+1,feed:!0},_=c[m];_.roundNumber=r-1;const I=qm({roundPosition:_.roundPosition,roundNumber:r,idPrefix:o,uuids:a}),P={roundPosition:_.roundPosition,drawPositions:[g],matchUpStatus:pt,roundNumber:r,matchUpId:I};t&&(P.matchUpType=n),s&&(P.isMock=!0),i.push(P);const S={children:[_,h]};v.push(S)}const f=e?e-u:void 0;return{roundNodes:v,matchUps:i,drawPosition:f}}function xo({linkFedFinishingRoundNumbers:t=[],linkFedRoundNumbers:e=[],finishingPositionOffset:r,feedRoundsProfile:n=[],feedRounds:o=0,skipRounds:i=0,feedsFromFinal:s,isConsolation:a,baseDrawSize:c,matchUpType:l,idPrefix:u,drawSize:d,isMock:p,uuids:v,fmlc:f}){c=c||C(d);const m=_Z({drawSize:c}),g=m.length;let h=0;if(n.length)h=n.reduce((M,D)=>M+D,0);else if(d){let M=d-c;n=m.filter(D=>D<=M?(M-=D,!0):!1),h=n.reduce((D,V)=>D+V,0),o=n.length}else i>=g?o=0:s&&(o=g-s,i=0),n=m.filter((M,D)=>s&&!o||o&&D>=i+o||D<i?0:M),h=n.reduce((M,D)=>M+D,0),d=c+h,o=n.length;const _=[...m,...n].sort((M,D)=>D-M),I=_.length,S=[...e.map(M=>M-1),...t.map(M=>I-M)].map(M=>_[M]).reduce((M,D)=>M+D,0);h=h-S;let y=0,O=[],b,E=1,N=le(0,c).map((M,D)=>({drawPosition:D+1+h})),w=h+1;for(const M of m){if({roundNodes:b,matchUps:O}=Pu({matchUpType:l,roundNumber:E,idPrefix:u,matchUps:O,isMock:p,nodes:N,uuids:v}),E++,n.includes(M)){const D=fr(n)[M],V=le(0,D),R=I+1-E,W=t.includes(R)||e.includes(E);for(const x of V)({roundNodes:b,matchUps:O,drawPosition:w}=hZ({drawPosition:!W&&w||void 0,nodes:b,roundIteration:x,matchUpType:l,roundNumber:E,idPrefix:u,matchUps:O,isMock:p,uuids:v,fed:y})),E++,y+=1}N=b}I!==E-1&&console.log("ERROR");const $=c-h;O=Wc({finishingPositionOffset:a?$:r,positionsFed:h,roundsCount:I,matchUps:O,fmlc:f});const A=b!=null&&b.length?b[0]:b;return A&&(A.roundNumber=E-1,A.matchUps=O),{draw:A,matchUps:O,roundsCount:I};function C(M){const D=Yf(M);return D>M?D/2:D}}function _Z({drawSize:t}){const e=Math.ceil(Math.log(t)/Math.log(2));return le(0,e).reverse().map(n=>Math.pow(2,n))}var IZ=Object.defineProperty,PZ=Object.defineProperties,yZ=Object.getOwnPropertyDescriptors,RS=Object.getOwnPropertySymbols,OZ=Object.prototype.hasOwnProperty,SZ=Object.prototype.propertyIsEnumerable,FS=(t,e,r)=>e in t?IZ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,bZ=(t,e)=>{for(var r in e||(e={}))OZ.call(e,r)&&FS(t,r,e[r]);if(RS)for(var r of RS(e))SZ.call(e,r)&&FS(t,r,e[r]);return t},TZ=(t,e)=>PZ(t,yZ(e));function iD(t){const{finishingPositionOffset:e=0,stageSequence:r=1,staggeredEntry:n,structureName:o,stage:i=ue,matchUpType:s,structureId:a,idPrefix:c,drawSize:l,isMock:u,uuids:d}=t,p={finishingPositionOffset:e,matchUpType:s,drawSize:l,idPrefix:c,isMock:u,uuids:d},{matchUps:v}=n?xo(p):Un(p),f=Mt({structureId:a||(d==null?void 0:d.pop()),structureName:o||ue,stageSequence:r,matchUpType:s,matchUps:v,stage:i}),m=[f],g=[];if(l>2){const h=l/2,{matchUps:_}=Un({finishingPositionOffset:e+h,idPrefix:c&&`${c}-c`,drawSize:h,matchUpType:s,isMock:u}),I=t.consolationStructureName||(o?`${o} ${Et}`:Et),P=Mt({structureName:I,matchUps:_,structureId:d==null?void 0:d.pop(),stage:Et,stageSequence:1,matchUpType:s});m.push(P);const S={linkType:Kn,source:{roundNumber:1,structureId:f.structureId},target:{roundNumber:1,feedProfile:_n,structureId:P.structureId}};g.push(S)}return TZ(bZ({},B),{structures:m,links:g})}function sD({consolationStructure:t,roundOffset:e=0,mainStructure:r,roundsCount:n,feedPolicy:o,fmlc:i}){const a=t.matchUps.reduce((u,d)=>(d.drawPositions||[]).filter(Boolean).length&&!u.includes(d.roundNumber)?u.concat(d.roundNumber):u,[]),c=(o==null?void 0:o.roundGroupedOrder)||[],l=o==null?void 0:o.roundFeedProfiles;return le(1+e,n+1+e).map(u=>{const d=l&&l[u-1]?l[u-1]:u%2?_n:ns,p=u-e<=2?u-e:(u-e-2)*2+2,v={linkType:Kn,source:{roundNumber:u,structureId:r.structureId},target:{feedProfile:d,roundNumber:p,structureId:t.structureId}},f=c[u-1];return f&&(v.target.groupedOrder=f),Ct()&&(v.source.structureName=r.structureName,v.target.structureName=t.structureName),u===2&&i&&(v.linkCondition=zn,v.target.feedProfile=_n),a.includes(p)?v:void 0}).filter(Boolean)}var EZ=Object.defineProperty,VS=Object.getOwnPropertySymbols,wZ=Object.prototype.hasOwnProperty,NZ=Object.prototype.propertyIsEnumerable,LS=(t,e,r)=>e in t?EZ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,$Z=(t,e)=>{for(var r in e||(e={}))wZ.call(e,r)&&LS(t,r,e[r]);if(VS)for(var r of VS(e))NZ.call(e,r)&&LS(t,r,e[r]);return t};function aD({finishingPositionOffset:t,structureName:e=ue,stageSequence:r=1,staggeredEntry:n,matchUpType:o,structureId:i,idPrefix:s,drawSize:a,isMock:c,uuids:l}){const u={finishingPositionOffset:t,matchUpType:o,drawSize:a,idPrefix:s,isMock:c,uuids:l},{matchUps:d,roundsCount:p}=n?xo(u):Un(u),v=Mt({structureId:i||(l==null?void 0:l.pop()),matchUps:d,matchUpType:o,stage:ue,structureName:e,stageSequence:r}),f=[v],m=[];if(a>2){const _=[0,2].slice(0,a/16).map((I,P)=>{const S=P+1,{consolationStructure:y}=AZ({structureId:l==null?void 0:l.pop(),idPrefix:s&&`${s}-c${P}`,stageSequence:S,roundOffset:I,matchUpType:o,drawSize:a,isMock:c,index:P,uuids:l});f.push(y);const O=sD({mainStructure:v,consolationStructure:y,roundsCount:2,roundOffset:I});return{consolationStructure:y,links:O}}).map(I=>I.links).flat();if(m.push(..._),a>=4&&a<=16||a>32){const{matchUps:I}=Un({finishingPositionOffset:2,idPrefix:s&&`${s}-p3t4`,drawSize:2,matchUpType:o,isMock:c}),P=Mt({structureId:l==null?void 0:l.pop(),matchUps:I,structureName:it,stageSequence:2,stage:it,matchUpType:o}),S={linkType:Kn,source:{roundNumber:p-1,structureId:v.structureId},target:{roundNumber:1,feedProfile:_n,structureId:P.structureId}};f.push(P),m.push(S)}}return $Z({structures:f,links:m},B)}function AZ({stageSequence:t=1,roundOffset:e=0,matchUpType:r,structureId:n,idPrefix:o,drawSize:i,isMock:s,index:a,uuids:c}){const l=i/(2*Math.pow(2,e)),{matchUps:u,roundsCount:d}=xo({finishingPositionOffset:l,baseDrawSize:l,isConsolation:!0,feedRounds:1,matchUpType:r,idPrefix:o,isMock:s,uuids:c}),p=`${Et} ${a+1}`;return{consolationStructure:Mt({matchUps:u,stage:Et,structureName:p,stageSequence:t,matchUpType:r,structureId:n}),consolationRoundsCount:d}}var UZ=Object.defineProperty,BS=Object.getOwnPropertySymbols,CZ=Object.prototype.hasOwnProperty,MZ=Object.prototype.propertyIsEnumerable,xS=(t,e,r)=>e in t?UZ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,DZ=(t,e)=>{for(var r in e||(e={}))CZ.call(e,r)&&xS(t,r,e[r]);if(BS)for(var r of BS(e))MZ.call(e,r)&&xS(t,r,e[r]);return t};function Fs({finishingPositionOffset:t=0,addNameBaseToAttributeName:e,playoffStructureNameBase:r,finishingPositionNaming:n,finishingPositionLimit:o,playoffAttributes:i,stageSequence:s=1,exitProfile:a="0",exitProfileLimit:c,roundOffsetLimit:l,roundOffset:u=0,drawDefinition:d,staggeredEntry:p,sequenceLimit:v,stage:f=ue,structureId:m,matchUpType:g,idPrefix:h,drawSize:_,isMock:I,uuids:P}){if(!(!i||!c||(i==null?void 0:i[a]))||_<2||v&&s>v)return{};const y=[],O=[],b=[];g=g||(d==null?void 0:d.matchUpType);const E=t+1,T=t+_,N=`${E}-${T}`,w=i==null?void 0:i[a],$=r&&`${r} `||"",U=n==null?void 0:n[N],A=(U==null?void 0:U.name)||(w==null?void 0:w.name)&&(e?`${$}${w==null?void 0:w.name}`:w.name)||`${$}${N}`,C=(U==null?void 0:U.abbreviation)||(w==null?void 0:w.abbreviation),M={idPrefix:h&&`${h}-${A}-RP`,finishingPositionOffset:t,matchUpType:g,drawSize:_,isMock:I,uuids:P},{matchUps:D}=p?xo(M):Un(M),V=Mt({structureId:m||(P==null?void 0:P.pop()),structureAbbreviation:C,stageSequence:s,structureName:A,matchUpType:g,roundOffset:u,matchUps:D,stage:f});y.push(...D),O.push(V);const R=Math.ceil(Math.log(_)/Math.log(2)),W=l?Math.min(l-u,R):!o||E<o?R:0;return _>2&&le(1,W+1).forEach(K=>x(K)),DZ({structureId:V.structureId,matchUps:y,structureName:A,structures:O,links:b},B);function x(K){const j=_/Math.pow(2,K);if(j<2)return;const L=_/Math.pow(2,K)+t;if(L+1>o)return;const{structures:F,structureId:q,matchUps:G,links:H}=Fs({finishingPositionOffset:L,exitProfile:`${a}-${K}`,roundOffset:u+K,stageSequence:s+1,drawSize:j,addNameBaseToAttributeName:e,playoffStructureNameBase:r,finishingPositionNaming:n,finishingPositionLimit:o,playoffAttributes:i,exitProfileLimit:c,roundOffsetLimit:l,drawDefinition:d,sequenceLimit:v,matchUpType:g,idPrefix:h,uuids:P,stage:f}),Q={linkType:Kn,source:{roundNumber:K,structureId:V==null?void 0:V.structureId},target:{roundNumber:1,feedProfile:_n,structureId:q}};return V&&q&&H.push(Q),H!=null&&H.length&&b.push(...H),F!=null&&F.length&&O.push(...F),G!=null&&G.length&&y.push(...G),{structureId:q,childLinks:H,structures:O}}}var jZ=Object.defineProperty,RZ=Object.defineProperties,FZ=Object.getOwnPropertyDescriptors,GS=Object.getOwnPropertySymbols,VZ=Object.prototype.hasOwnProperty,LZ=Object.prototype.propertyIsEnumerable,kS=(t,e,r)=>e in t?jZ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,BZ=(t,e)=>{for(var r in e||(e={}))VZ.call(e,r)&&kS(t,r,e[r]);if(GS)for(var r of GS(e))LZ.call(e,r)&&kS(t,r,e[r]);return t},xZ=(t,e)=>RZ(t,FZ(e));function Ri(t={}){const{finishingPositionOffset:e,policyDefinitions:r,stageSequence:n=1,feedsFromFinal:o,staggeredEntry:i,structureName:s,structureId:a,matchUpType:c,skipRounds:l,feedRounds:u,idPrefix:d,drawSize:p,isMock:v,uuids:f,fmlc:m}=t,g=t.feedPolicy||(r==null?void 0:r[Yl]),h={finishingPositionOffset:e,matchUpType:c,skipRounds:l,drawSize:p,idPrefix:d,isMock:v,uuids:f},{matchUps:_}=i?xo(h):Un(h),I=Mt({structureId:a||(f==null?void 0:f.pop()),structureName:s||ue,stageSequence:n,stage:ue,matchUpType:c,matchUps:_}),P=[I],S=[],y=p/2,{matchUps:O,roundsCount:b}=xo({finishingPositionOffset:y,idPrefix:d&&`${d}-c`,isConsolation:!0,feedsFromFinal:o,baseDrawSize:y,matchUpType:c,feedRounds:u,skipRounds:l,isMock:v,uuids:f,fmlc:m});if(p>2){const E=Mt({matchUps:O,structureId:f==null?void 0:f.pop(),structureName:Et,stage:Et,stageSequence:1,matchUpType:c});P.push(E);const T=sD({consolationStructure:E,mainStructure:I,roundsCount:b,feedPolicy:g,fmlc:m});S.push(...T)}return xZ(BZ({},B),{structures:P,links:S})}var GZ=Object.defineProperty,kZ=Object.defineProperties,WZ=Object.getOwnPropertyDescriptors,WS=Object.getOwnPropertySymbols,qZ=Object.prototype.hasOwnProperty,HZ=Object.prototype.propertyIsEnumerable,qS=(t,e,r)=>e in t?GZ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,YZ=(t,e)=>{for(var r in e||(e={}))qZ.call(e,r)&&qS(t,r,e[r]);if(WS)for(var r of WS(e))HZ.call(e,r)&&qS(t,r,e[r]);return t},KZ=(t,e)=>kZ(t,WZ(e));function cD({compassAttributes:t=Rv,olympicAttributes:e=Fv,requireSequential:r=!0,playoffMatchUpFormat:n,sourceStructureId:o,policyDefinitions:i,stageSequence:s,drawDefinition:a,playoffGroups:c,matchUpType:l,feedPolicy:u,groupCount:d,idPrefix:p,isMock:v,uuids:f}){var m,g;u=u||(i==null?void 0:i[Yl]);const h="processPlayoffGroups";let _=0;const I=[],P=[],S=[],{error:y,positionRangeMap:O}=gZ({structureId:o,drawDefinition:a,playoffGroups:c});if(y)return k({result:{error:y},stack:h});if(!(!O||(c==null?void 0:c.every(E=>{const{finishingPositions:T=[]}=E;if(!T.length)return!1;const N=T.sort().map((w,$)=>(T[$+1]||w)-w).every(w=>w<2);return(!r||N)&&T.every(w=>O[w])}))))return k({context:{validFinishingPositions:Object.values(O)},result:{error:Z},stack:h});for(const E of c){const T=E.finishingPositions,N=O&&T.map(M=>{var D;return(D=O[M])==null?void 0:D.finishingPositions}).flat(),w=E.drawType||Qn,$=d*T.length,U=ia($);N&&(_=Math.min(...N)-1);const A={structureName:E.structureName,idPrefix:p&&`${p}-po`,appliedPolicies:i,structureId:f==null?void 0:f.pop(),finishingPositionOffset:_,stage:it,stageSequence:s,matchUpType:l,drawSize:U,isMock:v,uuids:f},C=({playoffStructures:M,playoffLinks:D})=>{const[V]=M,R=yl({playoffStructureId:V.structureId,finishingPositions:T,sourceStructureId:o});S.push(R),S.push(...D),P.push(...M),I.push({structureId:V.structureId,finishingPositions:T}),_+=$};if(w===Qn){const{matchUps:M}=Un({finishingPositionLimit:_+$,idPrefix:p&&`${p}-po`,finishingPositionOffset:_,matchUpType:l,drawSize:U,isMock:v,uuids:f}),D=Mt({structureName:E.structureName,matchUpFormat:n,structureId:f==null?void 0:f.pop(),stage:it,stageSequence:s,matchUpType:l,matchUps:M});P.push(D);const V=yl({playoffStructureId:D.structureId,finishingPositions:T,sourceStructureId:o});S.push(V),_+=$,I.push({structureId:D.structureId,finishingPositions:T})}else if([Gs,ks,it].includes(w)){const{structureName:M}=E,D={playoffStructureNameBase:M,idPrefix:p&&`${p}-po`,addNameBaseToAttributeName:!0,finishingPositionOffset:_,stage:it,roundOffset:0,stageSequence:s,drawSize:U,isMock:v,uuids:f};w===Gs?Object.assign(D,{roundOffsetLimit:3,playoffAttributes:t}):w===ks&&Object.assign(D,{roundOffsetLimit:2,playoffAttributes:e});const V=Fs(D);if(V.error)return V;if((m=V.links)!=null&&m.length&&S.push(...V.links),(g=V.structures)!=null&&g.length&&P.push(...V.structures),P.sort(yi),V.structureId){const R=yl({playoffStructureId:V.structureId,finishingPositions:T,sourceStructureId:o});S.push(R),I.push({structureId:V.structureId,finishingPositions:T})}_+=$}else if([Ws,jc,sc,ic,oc,ac].includes(w)){const M=[f==null?void 0:f.pop(),f==null?void 0:f.pop()],D={structureName:E.structureName,idPrefix:p&&`${p}-po`,finishingPositionOffset:_,uuids:M,stage:it,matchUpType:l,feedPolicy:u,drawSize:U,isMock:v},V={[Ws]:{fmlc:!0,feedRounds:1},[ac]:{feedRounds:1},[sc]:{feedsFromFinal:3},[ic]:{feedsFromFinal:2},[oc]:{feedsFromFinal:1}};Object.assign(D,V[w]||{});const{structures:R,links:W}=Ri(D),[x]=R,K=yl({playoffStructureId:x.structureId,finishingPositions:T,sourceStructureId:o});S.push(K),S.push(...W),P.push(...R),I.push({structureId:x.structureId,finishingPositions:T}),_+=$}else if([an].includes(w)){const{structures:M,links:D}=zc(KZ(YZ({},A),{structureOptions:E.structureOptions||{groupSize:4}}));C({playoffStructures:M,playoffLinks:D})}else if([Dc].includes(w)){const{structures:M,links:D}=iD(A);C({playoffStructures:M,playoffLinks:D})}else if([Ux].includes(w)){const{structures:M,links:D}=aD(A);C({playoffStructures:M,playoffLinks:D})}else if([sn].includes(w)){const M=Mt({structureName:E.structureName,finishingPosition:La,structureId:f==null?void 0:f.pop(),stage:it,stageSequence:s,matchUps:[],matchUpType:l});C({playoffStructures:[M],playoffLinks:[]})}}return{finishingPositionTargets:I,positionRangeMap:O,structures:P,links:S}}function yl({playoffStructureId:t,finishingPositions:e,sourceStructureId:r}){return{linkType:po,source:{structureId:r,finishingPositions:e},target:{structureId:t,feedProfile:zr,roundNumber:1}}}var zZ=Object.defineProperty,QZ=Object.defineProperties,JZ=Object.getOwnPropertyDescriptors,HS=Object.getOwnPropertySymbols,ZZ=Object.prototype.hasOwnProperty,XZ=Object.prototype.propertyIsEnumerable,YS=(t,e,r)=>e in t?zZ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,KS=(t,e)=>{for(var r in e||(e={}))ZZ.call(e,r)&&YS(t,r,e[r]);if(HS)for(var r of HS(e))XZ.call(e,r)&&YS(t,r,e[r]);return t},eX=(t,e)=>QZ(t,JZ(e));function tX(t){const{drawDefinition:e,structureOptions:r,requireSequential:n}=t,o=Object.assign({structureName:ue},t,{stage:ue}),{structures:i,groupCount:s,groupSize:a}=zc(o);s<1&&console.log(ZR);const c=(r==null?void 0:r.playoffGroups)||[{finishingPositions:[1],structureName:it}],[l]=i,{structures:u,links:d}=cD(KS({sourceStructureId:l.structureId,requireSequential:n,drawDefinition:e,playoffGroups:c,groupCount:s,groupSize:a},t));return i.push(...u),eX(KS({},B),{structures:i,links:d})}function rX({mainStructure:t,consolationStructure:e,deciderStructure:r}){const o=e.matchUps.reduce((u,d)=>(d.drawPositions||[]).filter(Boolean).length&&!u.includes(d.roundNumber)?u.concat(d.roundNumber):u,[]),i=t.matchUps.reduce((u,d)=>!u||d.roundNumber>u?d.roundNumber:u,void 0),s=e.matchUps.reduce((u,d)=>!u||d.roundNumber>u?d.roundNumber:u,void 0),a=o.map((u,d)=>{const v=o.indexOf(u)%2?_n:ns,f=1+d;return{linkType:Kn,source:{roundNumber:f,structureId:t.structureId},target:{feedProfile:v,roundNumber:u,structureId:e.structureId}}}),c={linkType:fo,source:{roundNumber:s,structureId:e.structureId},target:{feedProfile:_n,roundNumber:i,structureId:t.structureId}},l=[{linkType:fo,source:{roundNumber:i,structureId:t.structureId},target:{feedProfile:_n,roundNumber:1,structureId:r.structureId}},{linkType:Kn,source:{roundNumber:i,structureId:t.structureId},target:{feedProfile:_n,roundNumber:1,structureId:r.structureId}}];return[...a,c,...l]}var nX=Object.defineProperty,zS=Object.getOwnPropertySymbols,oX=Object.prototype.hasOwnProperty,iX=Object.prototype.propertyIsEnumerable,QS=(t,e,r)=>e in t?nX(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,sX=(t,e)=>{for(var r in e||(e={}))oX.call(e,r)&&QS(t,r,e[r]);if(zS)for(var r of zS(e))iX.call(e,r)&&QS(t,r,e[r]);return t};function aX({structureName:t,matchUpType:e,idPrefix:r,drawSize:n,isMock:o,uuids:i}){const s=[],{matchUps:a}=xo({linkFedFinishingRoundNumbers:[1],drawSize:n+1,matchUpType:e,idPrefix:r,isMock:o}),c=Mt({structureName:t||ue,structureId:i==null?void 0:i.pop(),stageSequence:1,stage:ue,matchUpType:e,matchUps:a});s.push(c);const l=n/2,{matchUps:u}=xo({finishingPositionOffset:l,idPrefix:r&&`${r}-c`,drawSize:n-1,isConsolation:!0,matchUpType:e,isMock:o,uuids:i}),d=Mt({matchUps:u,structureId:i==null?void 0:i.pop(),structureName:qU,stage:Et,stageSequence:2,matchUpType:e});s.push(d);const{matchUps:p}=Un({idPrefix:r&&`${r}-p1t2`,drawSize:2,matchUpType:e,isMock:o}),v=Mt({matchUps:p,structureId:i==null?void 0:i.pop(),structureName:WU,stageSequence:3,stage:it,matchUpType:e});s.push(v);const f=rX({mainStructure:c,consolationStructure:d,deciderStructure:v});return sX({structures:s,links:f},B)}function cX(t){const{qualifyingRoundNumber:e,finishingPositionOffset:r,qualifyingPositions:n,matchUpType:o,idPrefix:i,drawSize:s,isMock:a,uuids:c}=t;if(!lt(s)||s<2)return{matchUps:[],roundsCount:0};if(Lr(s))return Un(t);const l=lX(s),u=l.shift(),d=le(1,u.participantsCount+1).map(g=>({drawPosition:g}));let p=[],v=1;({matchUps:p}=Pu({roundNumber:v,matchUpType:o,idPrefix:i,matchUps:p,isMock:a,nodes:d,uuids:c})),v++;let f=t.roundLimit||e;for(const g of l){const h=g.participantsCount/2,_=le(1,h+1);n&&h===n&&(f=v-1);const I=_.map(P=>{const S=qm({roundPosition:P,roundNumber:v,idPrefix:i,uuids:c});return{roundPosition:P,roundNumber:v,matchUpId:S}});p.push(...I),v++}const m=v-1;return p=Wc({finishingPositionOffset:r,lucky:!0,roundsCount:m,roundLimit:f,matchUps:p}),f&&(p=p.filter(g=>g.roundNumber<=f)),{matchUps:p,roundsCount:m,roundLimit:f}}function lX(t){const e=parseInt(t);let r=e%2?e+1:e;const n=!!(Math.ceil(r/2)%2),o=[{participantsCount:r,preFeedRound:n}];for(;r>2;){const i=Math.ceil(r/2),s=i===1,a=!!(!s&&i%2);r=!s&&a?i+1:i;const c=!!(r!==2&&Math.ceil(r/2)%2);o.push({participantsCount:r,preFeedRound:c,feedRound:a})}return o}var uX=Object.defineProperty,dX=Object.defineProperties,pX=Object.getOwnPropertyDescriptors,JS=Object.getOwnPropertySymbols,fX=Object.prototype.hasOwnProperty,vX=Object.prototype.propertyIsEnumerable,ZS=(t,e,r)=>e in t?uX(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Vn=(t,e)=>{for(var r in e||(e={}))fX.call(e,r)&&ZS(t,r,e[r]);if(JS)for(var r of JS(e))vX.call(e,r)&&ZS(t,r,e[r]);return t},Ui=(t,e)=>dX(t,pX(e));function lD(t){var e;const{compassAttributes:r=Rv,olympicAttributes:n=Fv,stageSequence:o=1,structureName:i,structureId:s,stage:a=ue,matchUpType:c,drawSize:l,uuids:u}=t,{appliedPolicies:d}=ct(t),p=((e=t.policyDefinitions)==null?void 0:e[Yl])||d[Yl];t.skipRounds=t.skipRounds||l<=4&&(p!=null&&p.feedMainFinal?0:1)||0;const v=()=>{const{matchUps:m}=Un(t),g=Mt({structureName:i||ue,structureId:s||(u==null?void 0:u.pop()),stageSequence:o,matchUpType:c,matchUps:m,stage:a});return Vn({structures:[g],links:[]},B)};return{generators:{[sn]:()=>{const m=Mt({structureName:i||ue,structureId:s||(u==null?void 0:u.pop()),finishingPosition:Ia,stageSequence:o,matchUps:[],matchUpType:c,stage:a});return Vn({structures:[m],links:[]},B)},[Pi]:()=>{const{matchUps:m}=cX(t),g=Mt({structureName:i||ue,structureId:s||(u==null?void 0:u.pop()),stageSequence:o,matchUpType:c,matchUps:m,stage:a});return Vn({structures:[g],links:[]},B)},[Qn]:()=>v(),[Mc]:()=>aX(t),[Gs]:()=>Fs(Ui(Vn({},t),{roundOffsetLimit:3,playoffAttributes:r})),[ks]:()=>Fs(Ui(Vn({},t),{roundOffsetLimit:2,playoffAttributes:n})),[it]:()=>Fs(t),[_a]:()=>{const{matchUps:m}=xo({drawSize:l,uuids:u,matchUpType:c}),g=Mt({structureName:i||ue,structureId:s||(u==null?void 0:u.pop()),stageSequence:o,matchUpType:c,stage:ue,matchUps:m});return Vn({structures:[g],links:[]},B)},[Dc]:()=>iD(t),[Ws]:()=>Ri(Ui(Vn({},t),{feedRounds:1,fmlc:!0})),[kU]:()=>Ri(Ui(Vn({},t),{feedRounds:1})),[Mv]:()=>Ri(Ui(Vn({},t),{feedsFromFinal:1})),[Dv]:()=>Ri(Ui(Vn({},t),{feedsFromFinal:2})),[jv]:()=>Ri(Ui(Vn({},t),{feedsFromFinal:3})),[jc]:()=>Ri(t),[od]:()=>aD(t),[an]:()=>zc(t),[vo]:()=>tX(t)}}}var mX=Object.defineProperty,gX=Object.defineProperties,hX=Object.getOwnPropertyDescriptors,XS=Object.getOwnPropertySymbols,_X=Object.prototype.hasOwnProperty,IX=Object.prototype.propertyIsEnumerable,e0=(t,e,r)=>e in t?mX(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,PX=(t,e)=>{for(var r in e||(e={}))_X.call(e,r)&&e0(t,r,e[r]);if(XS)for(var r of XS(e))IX.call(e,r)&&e0(t,r,e[r]);return t},yX=(t,e)=>gX(t,hX(e));function Km(t={}){var e,r,n,o,i;const{enforceMinimumDrawSize:s=!0,overwriteExisting:a,drawTypeCoercion:c,appliedPolicies:l,staggeredEntry:u,drawDefinition:d,drawSize:p,isMock:v,uuids:f}=t,m="generateDrawStructuresAndLinks";let g=t.drawType||Qn;const h=[],_=[];let{tieFormat:I,matchUpType:P}=t;P=P||ut;const S=(e=d==null?void 0:d.structures)==null?void 0:e.filter(({stage:q})=>q===Ie);S&&h.push(...S);const y=S==null?void 0:S.map(({structureId:q})=>q),O=(r=d==null?void 0:d.structures)==null?void 0:r.find(({stage:q,stageSequence:G})=>q===ue&&G===1),b=(n=d==null?void 0:d.links)==null?void 0:n.filter(q=>q.target.structureId===(O==null?void 0:O.structureId)&&(y==null?void 0:y.includes(q.source.structureId))),E=(q,G)=>{var H;if(q.linkType===po&&(G!=null&&G.structures)){const Q=q.source.finishingPositions||[];return G.structures.length*Q.length}else if(q.linkType===fo&&((H=G==null?void 0:G.matchUps)!=null&&H.length)){const Q=q.source.roundNumber;return G.matchUps.filter(({roundNumber:Y})=>Y===Q).length}},T=S==null?void 0:S.map(q=>{var G,H,Q;const z=b==null?void 0:b.find(oe=>oe.target.structureId===q.structureId),Y=((H=(G=Xe({structure:q}))==null?void 0:G.positionAssignments)==null?void 0:H.length)||0;if(!z)return Y;const J=z==null?void 0:z.source.structureId,te=(Q=d.structures)==null?void 0:Q.find(oe=>oe.structureId===J),ne=E(z,te)||0;return Y-ne}).filter(Boolean).reduce((q,G)=>q+G,0),N=b==null?void 0:b.map(q=>{const G=q.source.structureId,H=S==null?void 0:S.find(Q=>Q.structureId===G);return E(q,H)}).filter(Boolean).reduce((q,G)=>q+G,0),w=!!(O&&!((o=O==null?void 0:O.matchUps)!=null&&o.length));if(S!=null&&S.length&&!w)return{error:zg};const $=!(S!=null&&S.length)&&t.qualifyingProfiles,U=($==null?void 0:$.length)&&tD({idPrefix:t.idPrefix,qualifyingProfiles:$,appliedPolicies:l,matchUpType:P,isMock:v,uuids:f});if(U!=null&&U.error)return U;const{qualifyingDrawPositionsCount:A,qualifyingDetails:C,qualifiersCount:M}=U||{qualifyingDrawPositionsCount:T,qualifiersCount:N};A&&(U!=null&&U.structures&&h.push(...U.structures),U!=null&&U.links&&_.push(...U.links)),Object.assign(t,_e({drawSize:p,matchUpType:P,tieFormat:I}));const D=g!==sn&&(isNaN(p)||p<2||!u&&![_a,Pi].includes(g)&&([vo,an].includes(g)&&p<3||![an,vo].includes(g)&&!Lr(p)));if(D&&!A)return k({context:{drawSize:p,invalidDrawSize:D},result:{error:af},stack:m});const V=HU.includes(g);if(parseInt(p)<4&&V){if(c)g=Qn;else if(s)return k({context:{enforceMinimumDrawSize:s,invalidDrawSize:D,drawSize:p,drawType:g},result:{error:af},stack:m})}const{generators:R,error:W}=lD(t);if(W)return{error:W};const x=R[g];if(!x)return{error:oA};const K=x==null?void 0:x();if(K.error)return K;const{structures:j,links:L}=K;if(j!=null&&j.length){const q=j.find(({stage:G,stageSequence:H})=>G===ue&&H===1);if(O&&q){if(w){const G=q.structureId;if(q.structureId=O.structureId,L!=null&&L.length)for(const H of L)H.source.structureId===G&&(H.source.structureId=O.structureId),H.target.structureId===G&&(H.target.structureId=O.structureId)}else if(!a)return{error:zg}}h.push(...j)}h.sort(yi),L!=null&&L.length&&_.push(...L);const F=K.structures.find(({stage:q,stageSequence:G})=>q===ue&&G===1);for(const q of C||[]){const{finalQualifyingRoundNumber:G,finalQualifyingStructureId:H,roundTarget:Q,finishingPositions:z,linkType:Y}=q,J=F&&((i=ra({targetStructureId:F.structureId,sourceStructureId:H,sourceRoundNumber:G,finishingPositions:z,targetEntryRound:Q,linkType:Y}))==null?void 0:i.link);if(J!=null&&J.error)return J;J&&_.push(J)}return b&&_.push(...b),yX(PX({},B),{qualifyingResult:{qualifyingDrawPositionsCount:A,qualifiersCount:M},structures:h,links:_})}function Ti({provisionalPositioning:t,drawDefinition:e,stageSequence:r,structureId:n,stage:o}){var i,s,a,c,l,u,d,p;if(!e)return{error:pe};const{entryProfile:v}=Cc({drawDefinition:e}),f=((a=(s=(i=v==null?void 0:v[o])==null?void 0:i.stageSequence)==null?void 0:s[r])==null?void 0:a.qualifiersCount)||((c=v==null?void 0:v[o])==null?void 0:c.qualifiersCount)||0,m={};if(!n)return{qualifiersCount:f,roundQualifiersCounts:m};const{structure:g}=Te({drawDefinition:e,structureId:n}),h=(l=e.links)==null?void 0:l.filter(P=>{var S;return((S=P==null?void 0:P.target)==null?void 0:S.structureId)===(g==null?void 0:g.structureId)});let _=0;if(h!=null&&h.length)for(const P of h){const S=(u=Te({structureId:P.source.structureId,drawDefinition:e}))==null?void 0:u.structure;if(S.stage===Ie){const y=P.source.roundNumber,O=P.target.roundNumber;let b=0;if(S.structureType===er){const E=((d=S.structures)==null?void 0:d.length)||0,T=((p=P.source.finishingPositions)==null?void 0:p.length)||0;b=E*T}else{const E=Ke({matchUpFilters:{roundNumbers:[y]},provisionalPositioning:t,structure:S,afterRecoveryTimes:!1,inContext:!1}).matchUps;b=(E==null?void 0:E.length)||0}m[O]||(m[O]=0),m[O]+=b,_+=b}}const I=Object.keys(m);if(I.length<=1){const P=I[0]||1;m[P]=Math.max(m[P]||0,f)}return _=Math.max(_,f),{qualifiersCount:_,roundQualifiersCounts:m}}function pc({stage:t,drawDefinition:e}){var r;const{entryProfile:n}=Cc({drawDefinition:e});return((r=n==null?void 0:n[t])==null?void 0:r.drawSize)||0}function OX({provisionalPositioning:t,drawDefinition:e,stageSequence:r,stage:n}){const o=pc({stage:n,drawDefinition:e}),{qualifiersCount:i}=Ti({provisionalPositioning:t,drawDefinition:e,stageSequence:r,stage:n});return o&&o-i}function Gd({tieFormat:t,uuids:e,isMock:r}){const{collectionDefinitions:n}=t||{};return{tieMatchUps:(n||[]).map(i=>kd({collectionDefinition:i,uuids:e,isMock:r})).filter(Boolean).flat()}}function kd({collectionDefinition:t,matchUpsLimit:e,isMock:r,uuids:n}){const{matchUpCount:o,matchUpType:i,collectionId:s,processCodes:a}=t||{};return le(0,e||o||0).map(l=>{const u=l+1;return{sides:[{sideNumber:1},{sideNumber:2}],matchUpId:(n==null?void 0:n.pop())||ke(),matchUpStatus:pt,collectionPosition:u,collectionId:s,processCodes:a,matchUpType:i,isMock:r}})}var SX=Object.defineProperty,bX=Object.defineProperties,TX=Object.getOwnPropertyDescriptors,t0=Object.getOwnPropertySymbols,EX=Object.prototype.hasOwnProperty,wX=Object.prototype.propertyIsEnumerable,r0=(t,e,r)=>e in t?SX(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Wd=(t,e)=>{for(var r in e||(e={}))EX.call(e,r)&&r0(t,r,e[r]);if(t0)for(var r of t0(e))wX.call(e,r)&&r0(t,r,e[r]);return t},NX=(t,e)=>bX(t,TX(e));function fc({stageSequence:t=1,drawDefinition:e,drawSize:r,stage:n}){if(!e)return{error:pe};if(!Fc({drawDefinition:e,stage:n}))return{error:Go};const o=KU({drawDefinition:e,stage:n}),{qualifiersCount:i}=Ti({drawDefinition:e,stageSequence:t,stage:n}),s=o+i;if(r<s)return{error:Ll};const{entryProfile:a}=Uc({attributes:[{[n]:{drawSize:r}}],drawDefinition:e});return Qe({drawDefinition:e}),NX(Wd({},B),{entryProfile:a})}function $X({alternatesCount:t,drawDefinition:e,stage:r}){var n;return e?Fc({drawDefinition:e,stage:r})?(Uc({attributes:[{[r]:{alternates:t}}],drawDefinition:e}),t||(e.entries=((n=e.entries)==null?void 0:n.filter(o=>o.entryStatus!==rn))||[]),Qe({drawDefinition:e}),Wd({},B)):{error:Go}:{error:pe}}function AX({wildcardsCount:t=0,drawDefinition:e,stageSequence:r,stage:n}){if(!e)return{error:pe};if(!Fc({drawDefinition:e,stage:n}))return{error:Go};const o=pc({drawDefinition:e,stage:n}),{qualifiersCount:i}=Ti({drawDefinition:e,stageSequence:r,stage:n}),s=Bx({drawDefinition:e,stage:n}),a=KU({drawDefinition:e,stage:n});return t<s?{error:Object.assign(Ll,{message:"Number of Wildcards cannot be less than number of Wildcards already entered"})}:a+t+i>o?{error:Ll,info:"Total stage Entries cannot be greater than drawPositions"}:(Uc({attributes:[{[n]:{wildcardsCount:t}}],drawDefinition:e}),Qe({drawDefinition:e}),Wd({},B))}function zm({qualifiersCount:t=0,drawDefinition:e,stage:r}){return e?Fc({drawDefinition:e,stage:r})?r!==ue?{error:Ll,info:"qualifiersCount can only be set for main stage"}:(Uc({attributes:[{[r]:{qualifiersCount:t}}],drawDefinition:e}),Qe({drawDefinition:e}),Wd({},B)):{error:Go}:{error:pe}}var UX=Object.defineProperty,CX=Object.defineProperties,MX=Object.getOwnPropertyDescriptors,n0=Object.getOwnPropertySymbols,DX=Object.prototype.hasOwnProperty,jX=Object.prototype.propertyIsEnumerable,o0=(t,e,r)=>e in t?UX(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,RX=(t,e)=>{for(var r in e||(e={}))DX.call(e,r)&&o0(t,r,e[r]);if(n0)for(var r of n0(e))jX.call(e,r)&&o0(t,r,e[r]);return t},FX=(t,e)=>CX(t,MX(e));function Qm(t={}){var e;const{modifyOriginal:r=!0,stageSequence:n=1,isMock:o}=t,i="generateDrawTypeAndModifyDrawDefinition";if(!t.drawDefinition)return k({result:{error:pe},stack:i});const s=r?t.drawDefinition:de(t.drawDefinition,!1,!0);let{tieFormat:a,matchUpType:c}=t;if(a){const P=cr({tieFormat:a});if(P.error)return P}a=ln(a||((e=Zt({drawDefinition:s}))==null?void 0:e.tieFormat)),c=c||s.matchUpType||ut,t.tieFormat=a,t.matchUpType=c;const l=pc({drawDefinition:s,stage:ue});t.drawSize=t.drawSize||l,!l&&t.drawSize&&fc({drawSize:t.drawSize,drawDefinition:s,stageSequence:n,stage:ue});const u=zt({drawDefinition:s}).drawMatchUps.map($t),d=Km(t);if(d.error)return k({result:d,stack:i});const{structures:p,links:v,qualifyingResult:f}=d;s.structures=p,s.links=v;const m=Math.max(t.qualifiersCount||0,(f==null?void 0:f.qualifiersCount)||0);if(f!=null&&f.qualifyingDrawPositionsCount&&!pc({stage:Ie,drawDefinition:s})){const S=fc({drawSize:f.qualifyingDrawPositionsCount,stage:Ie,drawDefinition:s});if(S.error)return S}if(m){const P=zm({qualifiersCount:m,drawDefinition:s,stage:ue});if(P.error)return P}const g=t.drawSize||l;Object.assign(t,_e({drawSize:g,matchUpType:c,tieFormat:a}));const{matchUps:h,matchUpsMap:_}=wt({drawDefinition:s});a&&h.forEach(P=>{if(!u.includes(P.matchUpId)){const{tieMatchUps:S}=Gd({tieFormat:a,isMock:o});Object.assign(P,{tieMatchUps:S,matchUpType:c})}});const{inContextDrawMatchUps:I}=zs({drawDefinition:s,matchUpsMap:_});return Qe({drawDefinition:s}),FX(RX({inContextDrawMatchUps:I,drawDefinition:s,matchUpsMap:_},B),{structures:p,matchUps:h,links:v})}function VX({targetParticipantIds:t,policyAttributes:e,idCollections:r,participants:n}){if(!Array.isArray(e))return{error:dA};if(!Array.isArray(n))return{error:Ic};const o={};return t.forEach(i=>{const s=n.find(c=>c.participantId===i),{values:a}=uD({policyAttributes:e,idCollections:r,participants:n,participant:s});a&&a.forEach(c=>{o[c]||(o[c]=[]),o[c].includes(i)||o[c].push(i)})}),o}function uD({policyAttributes:t,idCollections:e,participants:r,participant:n}){if(!Array.isArray(t))return{error:dA};if(!n)return{error:Vs};const o=[];return t.forEach(a=>{const{directive:c,groupings:l,key:u,significantCharacters:d}=a||{};if(u){const p=u.split(".");s({value:n,keys:p,significantCharacters:d})}else if(c){const p=a==null?void 0:a.includeIds,v=((e==null?void 0:e[c])||[]).filter(f=>!p||p.includes(f));v!=null&&v.length&&(r!=null&&r.length)&&v.forEach(f=>{var m;const g=r.find(h=>h.participantId===f);if((m=g==null?void 0:g.individualParticipantIds)!=null&&m.includes(n.participantId)){const h=g==null?void 0:g.participantId;o.push(h)}})}else l&&Object.keys(l).forEach(p=>{l[p].includes(n.participantId)&&o.push(p)})}),{values:Ve(o)};function s({value:a,keys:c=[],significantCharacters:l}){for(const[d,p]of c.entries())if(a!=null&&a[p])if(Array.isArray(a[p])){const v=a[p],f=c.slice(d);v.forEach(m=>s({value:m,keys:f,significantCharacters:l}))}else a=a[p],u({value:a,index:d});function u({value:d,index:p}){if(d&&p===c.length-1&&["string","number"].includes(typeof d)){const v=l?d.slice(0,l):d;o.push(v)}}}}var LX=Object.defineProperty,BX=Object.defineProperties,xX=Object.getOwnPropertyDescriptors,i0=Object.getOwnPropertySymbols,GX=Object.prototype.hasOwnProperty,kX=Object.prototype.propertyIsEnumerable,s0=(t,e,r)=>e in t?LX(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,WX=(t,e)=>{for(var r in e||(e={}))GX.call(e,r)&&s0(t,r,e[r]);if(i0)for(var r of i0(e))kX.call(e,r)&&s0(t,r,e[r]);return t},qX=(t,e)=>BX(t,xX(e));function a0({candidatePositionAssignments:t,participantsWithGroupings:e,policyAttributes:r,idCollections:n}){const o=Object.assign({},...e.map(i=>({[i.participantId]:i})));return t.map(i=>{const s=o[i.participantId],{values:a}=uD({participants:e,policyAttributes:r,idCollections:n,participant:s});return qX(WX({},i),{values:a})})}function dD({participantIdGroups:t,positionAssignments:e,groupsToAvoid:r}){return Object.assign({},...e.filter(n=>n==null?void 0:n.participantId).map(n=>{const{drawPosition:o,participantId:i}=n,s=t?t[i]||[]:[],a=!!r.some(c=>s.includes(c));return{[o]:{participantGroups:s,includesGroupsToAvoid:a}}}))}function HX(t){const{unfilledPositions:e,chunkedDrawPositions:r}=t,n=dD(t);return r.map(s=>{const a=e.filter(d=>s.includes(d)),c=i(a),u=a.filter(d=>!c.includes(d)).filter(d=>{var p;const v=c0(d);return!((p=n[v])!=null&&p.includesGroupsToAvoid)});return{unassigned:a,unpaired:c,pairedNoConflict:u}});function i(s){return s.filter(c=>!a(c));function a(c){const l=c0(c);return!s.includes(l)}}}function YX(t){const{unfilledPositions:e,chunkedDrawPositions:r}=t,n=dD(t);return r.map(o=>{const i=e.filter(l=>o.includes(l)),s=i.length===o.length?i:[],a=o.filter(l=>{var u;return(u=n[l])==null?void 0:u.includesGroupsToAvoid}).length;return{unassigned:i,unpaired:s,pairedNoConflict:a?[]:i,conflictsCount:a}})}function c0(t){return Number(t%2?t+1:t-1)}function KX({allGroups:t,participantId:e}){return Object.keys(t).filter(r=>t[r].includes(e))}function zX({selectedParticipantGroups:t,participantIdGroups:e,positionAssignments:r,drawPositionChunks:n,unfilledPositions:o,isRoundRobin:i}){const s=n.map(a=>i?YX({groupsToAvoid:t,chunkedDrawPositions:a,participantIdGroups:e,positionAssignments:r,unfilledPositions:o}):HX({groupsToAvoid:t,chunkedDrawPositions:a,participantIdGroups:e,positionAssignments:r,unfilledPositions:o}));if(i){const a=s.map(u=>u.map(d=>d.unassigned).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length).sort((u,d)=>(d.length||0)-(u.length||0)),c=s.map(u=>u.map(d=>d.unpaired).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length),l=s.map(u=>u.map(d=>d.pairedNoConflict).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length).sort((u,d)=>(d.length||0)-(u.length||0));return{unassigned:a,unpaired:c,pairedNoConflict:l}}else{const a=s.map(u=>u.map(d=>d.unassigned).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length),c=s.map(u=>u.map(d=>d.unpaired).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length),l=s.map(u=>u.map(d=>d.pairedNoConflict).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length);return{unassigned:a,unpaired:c,pairedNoConflict:l}}}function pD({participantIds:t,positionAssignments:e}){const r=e.map(n=>n.participantId);return t.filter(n=>!r.includes(n))}function QX({groupKey:t,allGroups:e,largestFirst:r=!0,targetParticipantIds:n,useSpecifiedGroupKey:o=!1}){var i;const s=Object.assign({},...Object.keys(e).map(d=>[d,e[d].filter(p=>n.includes(p))]).filter(d=>d[1].length).map(([d,p])=>({[d]:p}))),a=Object.keys(s).reduce((d,p)=>s[p].length>d?s[p].length:d,0),c=Object.keys(s).filter(d=>s[d].length===a),l=pr(r?c:Object.keys(s));return t=o&&((i=s[t])!=null&&i.length)?t:l,{participantId:t&&s[t]?pr(s[t]):pr(n),groupKey:t}}function JX({drawPositionGroups:t,positionAssignments:e}){const r=Object.assign({},...e.map(n=>({[n.drawPosition]:n})));return t.map(n=>n.filter(Boolean).map(o=>r[o]).filter(Boolean).filter(o=>!o.participantId&&!o.bye).map(o=>o.drawPosition)).flat().filter(Boolean)}function ZX({candidatePositionAssignments:t,unseededParticipantIds:e,participantIdGroups:r,drawPositionChunks:n,drawPositionGroups:o,pairedPriority:i,allGroups:s,groupKey:a}){const c=o.reduce((E,T)=>T.length>E?T.length:E,0),l=c<=2,u=pD({positionAssignments:t,participantIds:e}),d=JX({positionAssignments:t,drawPositionGroups:o}),{participantId:p,groupKey:v}=QX({targetParticipantIds:u,useSpecifiedGroupKey:l,allGroups:s,groupKey:a}),f=KX({participantId:p,allGroups:s}),m=zX({positionAssignments:t,isRoundRobin:l,selectedParticipantGroups:f,participantIdGroups:r,drawPositionChunks:n,unfilledPositions:d,largestGroupSize:c,allGroups:s}),{unassigned:g,unpaired:h,pairedNoConflict:_}=m,I=(_==null?void 0:_.length)&&_[0],P=(h==null?void 0:h.length)&&h[0],S=i&&I?I:P,y=i?P:I,O=(S==null?void 0:S.length)&&S||(y==null?void 0:y.length)&&y;let b;if(O!=null&&O.length){const E=rr(O);b=rr(E)}else{const E=rr(g[0]);b=rr(E)}return{newGroupKey:v,selectedParticipantId:p,targetDrawPosition:b}}function Ou({isRoundRobin:t,groupedParticipants:e}){const r=[];return t?e.forEach(n=>{const o=n.map(a=>a.drawPosition),{uniqueMatchUpGroupings:i}=CC({drawPositions:o}),s=Object.assign({},...n.map(a=>({[a.drawPosition]:a})));i.forEach(a=>{Gt(s[a[0]].values||[],s[a[1]].values||[])&&(r.push(a),n.conflict=!0)})}):e.forEach(n=>{var o,i;Gt(((o=n[0])==null?void 0:o.values)||[],((i=n[1])==null?void 0:i.values)||[])&&(r.push(n),n.conflict=!0)}),r}function XX({positionedParticipants:t,potentialDrawPositions:e,avoidanceConflicts:r,drawPositionGroups:n,isRoundRobin:o}){return r.map(i=>{const s=i.map(c=>c.drawPosition);return i.filter(c=>e.includes(c.drawPosition)).map(c=>{const u=e.filter(d=>!(s!=null&&s.includes(d))).filter(d=>{const p=n.find(I=>I.includes(d)).find(I=>I!==d),v=t.find(I=>I.drawPosition===p),m=Ou({isRoundRobin:o,groupedParticipants:[[c,v]]}),h=[t.find(I=>I.drawPosition===d),v],_=Ou({isRoundRobin:o,groupedParticipants:[h]});return!m.length&&!_.length});if(u.length)return{drawPosition:c.drawPosition,possibleDrawPositions:u}}).filter(Boolean)}).flat(1)}var eee=Object.defineProperty,tee=Object.defineProperties,ree=Object.getOwnPropertyDescriptors,l0=Object.getOwnPropertySymbols,nee=Object.prototype.hasOwnProperty,oee=Object.prototype.propertyIsEnumerable,u0=(t,e,r)=>e in t?eee(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,fD=(t,e)=>{for(var r in e||(e={}))nee.call(e,r)&&u0(t,r,e[r]);if(l0)for(var r of l0(e))oee.call(e,r)&&u0(t,r,e[r]);return t},iee=(t,e)=>tee(t,ree(e));function d0(t){const{initialPositionAssignments:e,participantsWithGroupings:r,opponentsToPlaceCount:n,unseededByePositions:o,drawPositionGroups:i,policyAttributes:s,idCollections:a,allGroups:c}=t,l=[];let u;const d=Math.min(...(i||[]).map(I=>I==null?void 0:I.length).filter(Boolean)),p=d>2,v=de(e,!1,!0).filter(I=>!I.qualifier),f=e.filter(I=>!I.participantId&&(!I.bye||(o==null?void 0:o.includes(I.drawPosition)))).map(I=>I.drawPosition);le(0,n).forEach(()=>{const{newGroupKey:I,selectedParticipantId:P,targetDrawPosition:S}=ZX(iee(fD({},t),{candidatePositionAssignments:v,allGroups:c,groupKey:u}));u=I,v.forEach(y=>{y.drawPosition===S&&(y.participantId=P)})});let m=a0({candidatePositionAssignments:v,participantsWithGroupings:r,policyAttributes:s,idCollections:a}),g=jt(m,d),h=Ou({groupedParticipants:g,isRoundRobin:p}),_=0;for(;_<20&&h.length;){const I=XX({positionedParticipants:m,potentialDrawPositions:f,avoidanceConflicts:h,drawPositionGroups:i,isRoundRobin:p});if(I.length){const P=see({candidatePositionAssignments:v,swapOptions:I});P.error&&console.log({result:P}),m=a0({candidatePositionAssignments:v,participantsWithGroupings:r,policyAttributes:s,idCollections:a}),g=jt(m,d),h=Ou({groupedParticipants:g,isRoundRobin:p}),_++}else _=20}return v.forEach(I=>{if(I.bye&&I.participantId){const P=qg;l.push(P)}if(I.qualifier&&I.participantId){const P=qg;l.push(P)}}),{positionAssignments:v,conflicts:h.length,groupedParticipants:g,errors:l}}function see({candidatePositionAssignments:t,swapOptions:e}){const r=rr(e);if(!r)return{error:{message:"No swap options"}};const n=r.drawPosition,o=rr(r.possibleDrawPositions),i=t.find(l=>l.drawPosition===n),s=t.find(l=>l.drawPosition===o),a={participantId:s.participantId,qualifier:s.qualifier,bye:s.bye},c={participantId:i.participantId,qualifier:i.qualifier,bye:i.bye};return Object.assign(i,a),Object.assign(s,c),fD({},B)}var aee=Object.defineProperty,p0=Object.getOwnPropertySymbols,cee=Object.prototype.hasOwnProperty,lee=Object.prototype.propertyIsEnumerable,f0=(t,e,r)=>e in t?aee(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,jp=(t,e)=>{for(var r in e||(e={}))cee.call(e,r)&&f0(t,r,e[r]);if(p0)for(var r of p0(e))lee.call(e,r)&&f0(t,r,e[r]);return t};function uee({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:r,unseededByePositions:n,tournamentRecord:o,drawDefinition:i,seedBlockInfo:s,participants:a,matchUpsMap:c,structureId:l,avoidance:u,entries:d,event:p}){var v;if(!u)return{error:_R};const{candidatesCount:f=1,policyAttributes:m,targetDivisions:g}=u;let{roundsToSeparate:h}=u;const _="randomUnseededSeparation";let{structure:I}=Te({drawDefinition:i,structureId:l});const{matchUps:P}=Ke({provisionalPositioning:t,matchUpsMap:c,structure:I,event:p});if(g&&Lr(g)&&!h){const x=Lj(g),K=P.reduce((j,L)=>L.roundNumber>j?L.roundNumber:j,0);h=K<x?1:K-x+1}let{positionAssignments:S}=St({structure:I});const y=kv({participantsProfile:{convertExtensions:!0},participants:a}),O=S.filter(x=>!x.participantId),b=S.map(x=>x.drawPosition),E=I.structureType===er,T=E?{structure:I,matchUps:P,allDrawPositions:b,roundsToSeparate:h}:{matchUps:P,allDrawPositions:b,roundsToSeparate:h},{drawPositionGroups:N,drawPositionChunks:w}=E?dee(T):pee(T),$={};$.groupParticipants=a.filter(x=>x.participantType===dr).map(x=>x.participantId),$.teamParticipants=a.filter(x=>x.participantType===Ye).map(x=>x.participantId),$.pairParticipants=a.filter(x=>x.participantType===we).map(x=>x.participantId);const U=VX({targetParticipantIds:e,policyAttributes:m,idCollections:$,participants:a}),A=Object.assign({},...e.map(x=>{const K=Object.keys(U).filter(j=>U[j].includes(x));return{[x]:K}}));let C=pD({participantIds:e,positionAssignments:S});if(C.length>O.length)return{error:yA};let M;const D=C.length,V=le(0,f).map(()=>d0({initialPositionAssignments:S,participantsWithGroupings:y,unseededParticipantIds:e,opponentsToPlaceCount:D,pairedPriority:!1,unseededByePositions:n,participantIdGroups:A,drawPositionChunks:w,drawPositionGroups:N,policyAttributes:m,idCollections:$,allGroups:U}));if(M=V.reduce((x,K)=>!x||(K.conflicts||0)<(x.conflicts||0)?K:x,void 0),!M||M.conflicts){const x=le(0,f).map(()=>d0({initialPositionAssignments:S,participantsWithGroupings:y,unseededParticipantIds:e,opponentsToPlaceCount:D,pairedPriority:!0,unseededByePositions:n,participantIdGroups:A,drawPositionChunks:w,drawPositionGroups:N,policyAttributes:m,idCollections:$,allGroups:U,entries:d}));M=V.concat(...x).filter(j=>{var L;return!((L=j.errors)!=null&&L.length)}).reduce((j,L)=>!j||(L.conflicts||0)<(j.conflicts||0)?L:j,void 0)}if(!M)return{error:nv};const R=(((v=Xe({structure:I}))==null?void 0:v.positionAssignments)||[]).filter(x=>x.participantId).map(x=>x.participantId),W=M.positionAssignments.filter(x=>!R.includes(x.participantId));for(const x of W)if(x.bye){const K=Dr(jp({tournamentRecord:o,drawDefinition:i,seedBlockInfo:s,structureId:l,matchUpsMap:c,event:p},x));if(K.error)return k({result:K,stack:_})}else{const K=un(jp({automaticPlacement:!0,inContextDrawMatchUps:r,tournamentRecord:o,drawDefinition:i,seedBlockInfo:s,structureId:l,matchUpsMap:c,event:p},x));if(K.error)return k({result:K,stack:_,context:{assignment:x}})}return jp({},B)}function dee(t){const{structure:{structures:e}}=t,r=e.map(n=>n.positionAssignments.map(o=>o.drawPosition));return{drawPositionGroups:r,drawPositionChunks:[r]}}function pee({allDrawPositions:t,roundsToSeparate:e,matchUps:r}){const n=r.filter(p=>p.roundNumber===1).map(p=>p.drawPositions),o=n.flat().sort(Bt),i=Math.max(...o),s=t.filter(p=>p>i),a=o.length,l=le(a===2?1:2,a).filter(p=>p===Yf(p)),d=l.slice(0,e||l.length).reverse().map(p=>jt(o,p));return s.length&&console.log({fedDrawPositions:s}),{drawPositionGroups:n,drawPositionChunks:d}}var fee=Object.defineProperty,v0=Object.getOwnPropertySymbols,vee=Object.prototype.hasOwnProperty,mee=Object.prototype.propertyIsEnumerable,m0=(t,e,r)=>e in t?fee(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,gee=(t,e)=>{for(var r in e||(e={}))vee.call(e,r)&&m0(t,r,e[r]);if(v0)for(var r of v0(e))mee.call(e,r)&&m0(t,r,e[r]);return t};function hee({provisionalPositioning:t,inContextDrawMatchUps:e,unseededByePositions:r,multipleStructures:n,tournamentRecord:o,candidatesCount:i,drawDefinition:s,seedBlockInfo:a,participants:c,matchUpsMap:l,structureId:u,structure:d,event:p}){var v,f;const m="positionUnseededParticipants";d||({structure:d}=Te({drawDefinition:s,structureId:u})),u||({structureId:u}=d);const{positionAssignments:g}=St({structure:d}),{seedAssignments:h}=cn({provisionalPositioning:t,drawDefinition:s,structure:d,event:p}),_=h.map($=>$.participantId).filter(Boolean),{stage:I,stageSequence:P}=d,S=I===Ie?(f=(v=Lt({element:d,name:Dn}))==null?void 0:v.extension)==null?void 0:f.value:void 0,O=ms({provisionalPositioning:t,drawDefinition:s,stageSequence:P,entryStatuses:vs,structureId:u,roundTarget:S,stage:I}),E=O.filter($=>!_.includes($.participantId)).map($=>$.participantId),T=g.filter($=>!$.participantId&&!$.bye&&!$.qualifier).map($=>$.drawPosition);if(!n&&E.length>T.length)return k({result:{error:yA},context:{unseededParticipantsCount:E.length,unfilledDrawPositionsCount:T.length},stack:m});const{appliedPolicies:N}=ct({tournamentRecord:o,drawDefinition:s,event:p});let{avoidance:w}=N||{};if(d.stage===it){const $=O.reduce((U,A)=>(U[A.groupingValue]||(U[A.groupingValue]=[]),U[A.groupingValue].push(A.participantId),U),{});Object.keys($).length&&(w||(w={policyName:"Playoff Avoidance"}),w.policyAttributes||(w.policyAttributes=[]),w.policyAttributes.push({groupings:$}))}return w&&c?uee({provisionalPositioning:t,unseededParticipantIds:E,inContextDrawMatchUps:e,unseededByePositions:r,tournamentRecord:o,candidatesCount:i,drawDefinition:s,seedBlockInfo:a,participants:c,matchUpsMap:l,structureId:u,avoidance:w,entries:O}):_ee({provisionalPositioning:t,unseededParticipantIds:E,inContextDrawMatchUps:e,unfilledDrawPositions:T,multipleStructures:n,tournamentRecord:o,drawDefinition:s,seedBlockInfo:a,structureId:u,matchUpsMap:l,event:p})}function _ee({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:r,unfilledDrawPositions:n,multipleStructures:o,tournamentRecord:i,drawDefinition:s,seedBlockInfo:a,matchUpsMap:c,structureId:l,event:u}){const d=tr(n);for(const p of e){const v=d.pop();if(!o||v){const f=un({automaticPlacement:!0,provisionalPositioning:t,inContextDrawMatchUps:r,tournamentRecord:i,drawDefinition:s,seedBlockInfo:a,participantId:p,drawPosition:v,matchUpsMap:c,structureId:l,event:u});if(f!=null&&f.error&&console.log("!!!!!",{result:f}),f!=null&&f.error)return k({result:f,stack:"randomUnseededDistribution"})}}return gee({},B)}var Iee=Object.defineProperty,Pee=Object.defineProperties,yee=Object.getOwnPropertyDescriptors,g0=Object.getOwnPropertySymbols,Oee=Object.prototype.hasOwnProperty,See=Object.prototype.propertyIsEnumerable,h0=(t,e,r)=>e in t?Iee(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,bee=(t,e)=>{for(var r in e||(e={}))Oee.call(e,r)&&h0(t,r,e[r]);if(g0)for(var r of g0(e))See.call(e,r)&&h0(t,r,e[r]);return t},Tee=(t,e)=>Pee(t,yee(e));function Eee({provisionalPositioning:t,drawDefinition:e,structure:r,event:n}){const{positionAssignments:o}=St({structure:r}),{seedAssignments:i}=cn({provisionalPositioning:t,drawDefinition:e,structure:r,event:n}),s=Object.assign({},...i.filter(a=>a.participantId).map(a=>({[a.participantId]:a})));return o.map(a=>s[a.participantId]?Tee(bee({},a),{seedNumber:s[a.participantId].seedNumber,seedValue:s[a.participantId].seedValue}):"").filter(Boolean)}function wee({orderedSortedFirstRoundSeededDrawPositions:t,validSeedBlocks:e,byesToPlace:r}){const n=[];e.forEach(i=>{if(r-n.length>i.drawPositions.length)n.push(...i.drawPositions);else{const a=Cf(jt(i.drawPositions,2));let c,l=t[n.length];for(;c=Ra(a,l);)n.push(c),l=t[n.length]}});const o=n.map(i=>Array.isArray(i)?tr(i):i).flat(1/0);return Bj(r)&&e.map(s=>s.seedNumbers[0]).includes(r)?t:o}function Ra(t,e){if(Array.isArray(t)&&t.length!==2)return t.pop();if(!Array.isArray(t[0]))return t.includes(e)?t.indexOf(e)?t.pop():t.shift():Math.round(Math.random())?t.pop():t.shift();const r=t[0].flat(1/0).length,n=t[1].flat(1/0).length;if(r===n){const o=t[0].flat(1/0).includes(e)?t[0]:t[1];return Ra(e?o:t[Math.round(Math.random())],e)}return r<n?Ra(t[1],e):Ra(t[0],e)}function Cf(t){const e=Math.floor(t.length/2);return t.length>2?[Cf(t.slice(0,e)),Cf(t.slice(e))]:t}function Nee({provisionalPositioning:t,relevantMatchUps:e,appliedPolicies:r,drawDefinition:n,seedBlockInfo:o,byesToPlace:i,structure:s,event:a}){var c;o||(o=ys({provisionalPositioning:t,appliedPolicies:r,drawDefinition:n,structure:s,event:a}));let{validSeedBlocks:l,isFeedIn:u,isLucky:d,isContainer:p}=o;(c=r==null?void 0:r.seeding)!=null&&c.containerByesIgnoreSeeding&&(l=[]);const v=Eee({provisionalPositioning:t,drawDefinition:n,structure:s,event:a}),f=Ve([].concat(...e.map(y=>y.drawPositions))),m=v.filter(y=>f.includes(y.drawPosition)),g=(y,O)=>Xs(y.seedValue)-Xs(O.seedValue),_=l.reduce((y,O)=>{const b=m.filter(E=>{var T;return(T=O.drawPositions)==null?void 0:T.includes(E.drawPosition)}).sort(g);return y.concat(...b)},[]).map(y=>y.drawPosition),I=wee({orderedSortedFirstRoundSeededDrawPositions:_,validSeedBlocks:l,byesToPlace:i}),P=_0({orderedSeedDrawPositions:_,relevantMatchUps:e}).slice(0,v.length),S=_0({orderedSeedDrawPositions:I,relevantMatchUps:e}).slice(0,v.length);return{strictSeedOrderByePositions:P,blockSeedOrderByePositions:S,positionedSeeds:v,isContainer:p,isFeedIn:u,isLucky:d}}function _0({orderedSeedDrawPositions:t,relevantMatchUps:e}){const n=e.map(i=>i.drawPositions).map(i=>i==null?void 0:i.sort((s,a)=>s-a)).filter(i=>(i==null?void 0:i[0])+1===(i==null?void 0:i[1]));return t.map(i=>n.find(s=>s==null?void 0:s.includes(i))).filter(Boolean).map(i=>i==null?void 0:i.reduce((s,a)=>t.includes(a)?s:a,void 0)).filter(Boolean)}function $ee({provisionalPositioning:t,seedOrderByePositions:e,appliedPolicies:r,drawDefinition:n,seedLimit:o,structure:i,isFeedIn:s,isLucky:a,event:c}){var l,u;const d=(l=r==null?void 0:r.seeding)==null?void 0:l.seedingProfile,p=i.stage===Ie,{positionAssignments:v}=St({structure:i}),f=v.filter(D=>D.participantId).map(D=>D.drawPosition),m={isCollectionMatchUp:!1},{matchUps:g,roundMatchUps:h}=Ke({provisionalPositioning:t,matchUpFilters:m,structure:i}),_=(h==null?void 0:h[1])||[],I=i.structureType===er?g:_,P=Ve([].concat(...I.map(D=>D.drawPositions))),S=Math.min(...P)-1,y=f.filter(D=>P.includes(D)),O=D=>{const V=Math.ceil(D.length/2),R=[D.slice(0,V),D.slice(V)],W=R.map(H=>[].concat(...H.flat(1/0)).length),x=Math.min(...W.flat(1/0)),K=Math.max(...W.flat(1/0)),j=W.indexOf(K),L=x!==K,F=tr(R),[q,G]=!x||L?[R[j],R[1-j]]:[F[0],F[1]];return{greaterHalf:q,lesserHalf:G}},b=D=>{const{greaterHalf:V,lesserHalf:R}=O(D),{greaterHalf:W,lesserHalf:x}=O(V),j=tr(W.flat(1/0)).pop(),L=W.flat().filter(q=>q!==j);return{newlyFilteredChunks:[...R,...x,L],drawPosition:j}},E=D=>!e.includes(D),T=D=>!y.includes(D),N=D=>{let R=jt(D.sort(Bt),Math.ceil(D.length/4)).map(K=>K.filter(T));const W=[].concat(...R.flat(1/0)).length,x=[];for(let K=0;K<W;K++){const{newlyFilteredChunks:j,drawPosition:L}=b(R);x.push(L),R=j}return x},{validSeedBlocks:w}=ys({provisionalPositioning:t,allPositions:!0,appliedPolicies:r,drawDefinition:n,structure:i,event:c}),$=w.map(D=>{var V;return(V=D.drawPositions)==null?void 0:V.map(R=>R+S)});let U;if(s){const D=P.length,{seedBlocks:V}=wd({cluster:Qc(d)===Uv,participantsCount:D});U=V.map(W=>W.map(x=>x+S)).map(N).filter(W=>W.length)}else p?U=$.map(D=>D.filter(T)):U=$.map(N).filter(D=>D.length);const A=I.map(D=>D.drawPositions).map(D=>D==null?void 0:D.sort((V,R)=>V-R)).filter(D=>(D==null?void 0:D[0])+1===(D==null?void 0:D[1])),C=D=>A.reduce((V,R)=>R.includes(D)?R.reduce((W,x)=>x!==D?x:W,void 0):V,void 0);let M=U.map(D=>D.map(C)).flat(1/0).filter(T).filter(E).filter(Boolean);if(p&&!i.structures){const D=o%4,V=M.slice(0,D),R=(u=h[i.roundLimit])==null?void 0:u.length,W=jt(M.slice(D),R).map(tr).flat();M=V.concat(W)}return{unseededByePositions:M}}function Aee({provisionalPositioning:t,drawDefinition:e,matchUpsMap:r,structure:n,event:o}){var i;const s={isCollectionMatchUp:!1},{matchUps:a,roundMatchUps:c}=Ke({afterRecoveryTimes:!1,provisionalPositioning:t,drawDefinition:e,matchUpFilters:s,matchUpsMap:r,structure:n,event:o}),l=(c==null?void 0:c[1])||[],u=(n==null?void 0:n.structureType)===er,d=u?a:l,p=u?((i=n==null?void 0:n.structures)==null?void 0:i.length)||0:a.length,{structureId:v,stage:f,stageSequence:m}=n,g=ms({entryStatuses:Ko,provisionalPositioning:t,drawDefinition:e,stageSequence:m,structureId:v,stage:f}),{qualifiersCount:h}=Ti({provisionalPositioning:t,drawDefinition:e,stageSequence:m,structureId:v,stage:f}),_=g.length+h,{positionAssignments:I,unassignedPositions:P}=St({structure:n}),S=P.map(N=>N.drawPosition),y=I.filter(N=>N.bye).length,O=I.filter(N=>N.bye).map(N=>N.drawPosition),b=d.map(N=>N.drawPositions).filter(N=>N==null?void 0:N.reduce((w,$)=>!O.includes($)&&w,!0)).flat(1/0).filter(N=>S.includes(N));let T=I.length-_;return T>p&&n.stageSequence===1&&n.stage!==Et&&(T=p),{placedByes:y,byesCount:T,relevantMatchUps:d,placedByePositions:O,roundMatchUps:c,positionsToAvoidDoubleBye:b}}var Uee=Object.defineProperty,Cee=Object.defineProperties,Mee=Object.getOwnPropertyDescriptors,I0=Object.getOwnPropertySymbols,Dee=Object.prototype.hasOwnProperty,jee=Object.prototype.propertyIsEnumerable,P0=(t,e,r)=>e in t?Uee(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,y0=(t,e)=>{for(var r in e||(e={}))Dee.call(e,r)&&P0(t,r,e[r]);if(I0)for(var r of I0(e))jee.call(e,r)&&P0(t,r,e[r]);return t},Ree=(t,e)=>Cee(t,Mee(e));function O0({provisionalPositioning:t,tournamentRecord:e,appliedPolicies:r,drawDefinition:n,seedBlockInfo:o,matchUpsMap:i,structureId:s,structure:a,seedLimit:c,seedsOnly:l,event:u}){var d;a||({structure:a}=Te({drawDefinition:n,structureId:s})),s||({structureId:s}=a);const p=!(a.structures||a.stage===Ie),{byesCount:v,placedByes:f,relevantMatchUps:m}=Aee({provisionalPositioning:t,drawDefinition:n,matchUpsMap:i,structure:a,event:u}),g=v-f;if(g<=0)return y0({},B);const{strictSeedOrderByePositions:h,blockSeedOrderByePositions:_,isFeedIn:I,isLucky:P}=Nee({provisionalPositioning:t,relevantMatchUps:m,appliedPolicies:r,drawDefinition:n,seedBlockInfo:o,byesToPlace:g,structure:a,event:u}),S=[er,nd].includes(a.structureType)&&((d=r==null?void 0:r.seeding)==null?void 0:d.containerByesIgnoreSeeding),y=p&&(_!=null&&_.length)?_:h;let{unseededByePositions:O}=$ee({provisionalPositioning:t,seedOrderByePositions:y,ignoreSeededByes:S,appliedPolicies:r,drawDefinition:n,seedLimit:c,structure:a,isFeedIn:I,isLucky:P,event:u});const b=w=>w%2,E=(w,$)=>(w||[]).every(U=>b(U)?$!==U+1:$!==U-1);let T=[].concat(...y);if(!l)for(;O.length;){const w=O.find($=>E(T,$));w?(T.push(w),O=O.filter($=>$!==w)):(T.push(...O),O=[])}S&&(T=tr(T),Ct({ignoreSeededByes:S})&&console.log({byePositions:T}));const N=T.slice(0,g);for(const w of N){const $=Dr({provisionalPositioning:t,tournamentRecord:e,drawDefinition:n,seedBlockInfo:o,drawPosition:w,matchUpsMap:i,structureId:s,structure:a,event:u});if($!=null&&$.error)return $}return Ree(y0({},B),{unseededByePositions:O,byeDrawPositions:N})}var Fee=Object.defineProperty,Vee=Object.defineProperties,Lee=Object.getOwnPropertyDescriptors,S0=Object.getOwnPropertySymbols,Bee=Object.prototype.hasOwnProperty,xee=Object.prototype.propertyIsEnumerable,b0=(t,e,r)=>e in t?Fee(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Gee=(t,e)=>{for(var r in e||(e={}))Bee.call(e,r)&&b0(t,r,e[r]);if(S0)for(var r of S0(e))xee.call(e,r)&&b0(t,r,e[r]);return t},kee=(t,e)=>Vee(t,Lee(e));function Wee(t){let{structure:e,structureId:r}=t;e||({structure:e}=Te(t)),r||({structureId:r}=e);let n="positionQualifiers";const o=[];if(e.stage===Et)return k({result:{error:Go},stack:n});const{unplacedRoundQualifierCounts:i,positionAssignments:s,roundDrawPositions:a}=qee(t);for(const c of Object.keys(i)){const l=s.filter(u=>a[c].includes(u.drawPosition)&&!u.participantId&&!u.qualifier&&!u.bye).map(u=>u.drawPosition);if(i[c]>l)return k({result:{error:LR},context:{unfilledDrawPositions:l},stack:n});le(0,i[c]).forEach(()=>{const u=rr(l);o.push(u),s.forEach(d=>{d.drawPosition===u&&(d.qualifier=!0,delete d.participantId,delete d.bye)})})}return kee(Gee({},B),{qualifierDrawPositions:o})}function qee({drawDefinition:t,structure:e,structureId:r}){e||({structure:e}=Te({drawDefinition:t,structureId:r})),r||({structureId:r}=e);const{positionAssignments:n}=St({structure:e}),{stage:o,stageSequence:i}=e,{qualifiersCount:s,roundQualifiersCounts:a}=Ti({drawDefinition:t,stageSequence:i,structureId:r,stage:o}),c=Object.keys(a),{matchUps:l}=Ke({structure:e}),{roundProfile:u}=lr({matchUps:l}),d=Object.assign({},...c.filter(g=>u[g]).map(g=>{var h;return{[g]:(h=u[g])==null?void 0:h.drawPositions.filter(Boolean)}})),p=n.filter(g=>g.qualifier).map(g=>g.drawPosition),v=s-p.length,f=p.length;return{unplacedRoundQualifierCounts:Object.assign({},...c.map(g=>{const h=n.filter(_=>{var I,P;return _.qualifier&&((P=(I=d[g])==null?void 0:I.drawPositions)==null?void 0:P.includes(_.drawPosition))}).map(_=>_.drawPosition);return{[g]:a[g]-h.length}})),unplacedQualifiersCount:v,placedQualifiersCount:f,roundQualifiersCounts:a,positionAssignments:n,roundDrawPositions:d,qualifiersCount:s}}var Hee=Object.defineProperty,Yee=Object.defineProperties,Kee=Object.getOwnPropertyDescriptors,T0=Object.getOwnPropertySymbols,zee=Object.prototype.hasOwnProperty,Qee=Object.prototype.propertyIsEnumerable,E0=(t,e,r)=>e in t?Hee(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,vD=(t,e)=>{for(var r in e||(e={}))zee.call(e,r)&&E0(t,r,e[r]);if(T0)for(var r of T0(e))Qee.call(e,r)&&E0(t,r,e[r]);return t},mD=(t,e)=>Yee(t,Kee(e));function w0({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:r,appliedPolicies:n,validSeedBlocks:o,drawDefinition:i,seedingProfile:s,seedBlockInfo:a,participants:c,groupsCount:l,structureId:u,matchUpsMap:d,structure:p,event:v}){let f=0;const m=[],g=[];if(p||({structure:p}=Te({drawDefinition:i,structureId:u})),u||({structureId:u}=p),n||(n=ct({drawDefinition:i}).appliedPolicies),!o){const h=ys({provisionalPositioning:t,appliedPolicies:n,drawDefinition:i,structure:p,event:v});h.error&&g.push(h.error),o=h.validSeedBlocks}return l=l||o.length,le(0,l).forEach(()=>{if(f<l){const h=Jee({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:r,validSeedBlocks:o,drawDefinition:i,seedingProfile:s,seedBlockInfo:a,participants:c,structureId:u,matchUpsMap:d,event:v});h!=null&&h.success&&(f++,m.push(...h.seedPositions)),h.error&&g.push({seedPositionError:h.error})}}),g.length?{error:g}:mD(vD({},B),{seedPositions:m})}function Jee({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:n,seedingProfile:o,seedBlockInfo:i,participants:s,structureId:a,matchUpsMap:c,event:l}){const{unplacedSeedParticipantIds:u,unfilledPositions:d}=$d({provisionalPositioning:t,randomize:!0,drawDefinition:n,seedBlockInfo:i,structureId:a,event:l}),{appliedPolicies:p}=ct({drawDefinition:n}),{avoidance:v}=p||{};v&&s&&(u==null?void 0:u.length)>2;const f=[];for(const m of u){const g=d.pop();if(!g)return{error:hc};f.push(g);const h=un({automaticPlacement:!0,provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:n,seedingProfile:o,participantId:m,seedBlockInfo:i,drawPosition:g,matchUpsMap:c,structureId:a,event:l});if(!h.success)return h}return mD(vD({},B),{seedPositions:f})}var Zee=Object.defineProperty,Xee=Object.defineProperties,ete=Object.getOwnPropertyDescriptors,N0=Object.getOwnPropertySymbols,tte=Object.prototype.hasOwnProperty,rte=Object.prototype.propertyIsEnumerable,$0=(t,e,r)=>e in t?Zee(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,A0=(t,e)=>{for(var r in e||(e={}))tte.call(e,r)&&$0(t,r,e[r]);if(N0)for(var r of N0(e))rte.call(e,r)&&$0(t,r,e[r]);return t},nte=(t,e)=>Xee(t,ete(e));function il({applyPositioning:t=!0,provisionalPositioning:e,inContextDrawMatchUps:r,multipleStructures:n,placeByes:o=!0,tournamentRecord:i,appliedPolicies:s,candidatesCount:a,drawDefinition:c,seedingProfile:l,participants:u,structureId:d,matchUpsMap:p,seedLimit:v,seedsOnly:f,drawType:m,event:g}){var h;const _=[];t||(DF(),c=de(c,!1,!0));const I=A=>(t||ip(),k({result:A,stack:"automatedPositioning"})),P=A=>(t||ip(),A);let S=Te({drawDefinition:c,structureId:d});if(S.error)return I(S);const{structure:y}=S;s||(s=(h=ct({drawDefinition:c,structure:y,event:g}))==null?void 0:h.appliedPolicies);const{qualifiersCount:O}=Ti({stageSequence:y.stageSequence,provisionalPositioning:e,stage:y.stage,drawDefinition:c,structureId:d}),b=vs,E=ms({stageSequence:y.stageSequence,provisionalPositioning:e,stage:y.stage,drawDefinition:c,entryStatuses:b,structureId:d});if(!(E!=null&&E.length)&&!O)return P(A0({},B));p=p||zt({drawDefinition:c}),r||({matchUps:r}=wt({includeByeMatchUps:!0,inContext:!0,drawDefinition:c,matchUpsMap:p}));let T=[];const N=ys({provisionalPositioning:e,appliedPolicies:s,drawDefinition:c,structure:y,event:g});if(N.error)return N;const{validSeedBlocks:w}=N;if(_.push({validSeedBlocks:w}),Qc(y.seedingProfile||l)===Cv){let A=o&&O0({provisionalPositioning:e,tournamentRecord:i,appliedPolicies:s,drawDefinition:c,seedBlockInfo:N,matchUpsMap:p,structure:y,seedLimit:v,seedsOnly:f,event:g});if(A!=null&&A.error||(T=A.unseededByePositions,_.push({action:"positionByes",unseededByePositions:T}),A=w0({seedingProfile:y.seedingProfile||l,provisionalPositioning:e,inContextDrawMatchUps:r,tournamentRecord:i,appliedPolicies:s,validSeedBlocks:w,drawDefinition:c,seedBlockInfo:N,participants:u,matchUpsMap:p,structure:y,event:g}),A.error))return I(A);_.push({action:"positionSeedBlocks",seedPositions:A.seedPositions})}else{if(m!==Pi){let C=w0({seedingProfile:y.seedingProfile||l,provisionalPositioning:e,inContextDrawMatchUps:r,tournamentRecord:i,appliedPolicies:s,validSeedBlocks:w,drawDefinition:c,seedBlockInfo:N,participants:u,matchUpsMap:p,structure:y,event:g});if(C.error)return I(C);_.push({action:"positionSeedBlocks",seedPositions:C.seedPositions})}const A=o&&O0({provisionalPositioning:e,inContextDrawMatchUps:r,tournamentRecord:i,appliedPolicies:s,drawDefinition:c,seedBlockInfo:N,matchUpsMap:p,structure:y,seedLimit:v,seedsOnly:f,event:g});if(A!=null&&A.error)return console.log("positionByes",{result:A}),I(A);T=A.unseededByePositions,_.push({action:"positionByes",byeDrawPositions:A.byeDrawPositions,unseededByePositions:T})}const $={};if(!f){let A=Wee({inContextDrawMatchUps:r,tournamentRecord:i,appliedPolicies:s,validSeedBlocks:w,drawDefinition:c,seedBlockInfo:N,participants:u,matchUpsMap:p,structure:y});if(A.error||(A.conflicts&&($.qualifierConflicts=A.conflicts),_.push({action:"positionQualifiers",qualifierDrawPositions:A.qualifierDrawPositions}),A=hee({provisionalPositioning:e,inContextDrawMatchUps:r,unseededByePositions:T,multipleStructures:n,tournamentRecord:i,appliedPolicies:s,validSeedBlocks:w,candidatesCount:a,drawDefinition:c,seedBlockInfo:N,participants:u,matchUpsMap:p,structure:y,event:g}),A.error))return I(A);A.conflicts&&($.unseededConflicts=A.conflicts),_.push({action:"positionUnseededParticipants"})}const{positionAssignments:U}=Xe({drawDefinition:c,structure:y});return Qe({drawDefinition:c,structureIds:[d]}),t||ip(),nte(A0({positionAssignments:U,conflicts:$},B),{positioningReport:_})}var ote=Object.defineProperty,ite=Object.defineProperties,ste=Object.getOwnPropertyDescriptors,U0=Object.getOwnPropertySymbols,ate=Object.prototype.hasOwnProperty,cte=Object.prototype.propertyIsEnumerable,C0=(t,e,r)=>e in t?ote(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,lte=(t,e)=>{for(var r in e||(e={}))ate.call(e,r)&&C0(t,r,e[r]);if(U0)for(var r of U0(e))cte.call(e,r)&&C0(t,r,e[r]);return t},ute=(t,e)=>ite(t,ste(e));function dte({applyPositioning:t=!0,tournamentRecord:e,drawDefinition:r,seedingProfile:n,structureId:o,placeByes:i,seedsOnly:s,event:a}){if(!a)return{error:Pr};if(!r)return{error:Cn};const c=e==null?void 0:e.participants;return il({tournamentRecord:e,applyPositioning:t,drawDefinition:r,seedingProfile:n,participants:c,structureId:o,placeByes:i,seedsOnly:s})}function qd({applyPositioning:t=!0,provisionalPositioning:e,candidatesCount:r=1,tournamentRecord:n,drawDefinition:o,seedingProfile:i,structureId:s,placeByes:a,seedsOnly:c,event:l}){if(!l)return{error:Pr};if(!o)return{error:Cn};if(!mi({drawDefinition:o,structureId:s})&&!e)return{error:rA};const{playoffStructures:d}=NC({drawDefinition:o,structureId:s}),p=[],v=n==null?void 0:n.participants;if(d)for(const f of d){const{structureId:m}=f,g=il({structureId:m,provisionalPositioning:e,applyPositioning:t,candidatesCount:r,drawDefinition:o,seedingProfile:i,participants:v,placeByes:a,seedsOnly:c});if(g.error)return g;g.positionAssignments&&p.push({positionAssignments:g.positionAssignments,structureId:m})}return ute(lte({},B),{structurePositionAssignments:p})}var pte=Object.defineProperty,M0=Object.getOwnPropertySymbols,fte=Object.prototype.hasOwnProperty,vte=Object.prototype.propertyIsEnumerable,D0=(t,e,r)=>e in t?pte(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,j0=(t,e)=>{for(var r in e||(e={}))fte.call(e,r)&&D0(t,r,e[r]);if(M0)for(var r of M0(e))vte.call(e,r)&&D0(t,r,e[r]);return t};function mte(t){var e,r,n;const o="generateAndPopulateRRplayoffStructures";if(!t.playoffGroups)return k({result:{error:Se},info:"playoffGroups required",stack:o});const{sourceStructureId:i,requireSequential:s,drawDefinition:a,playoffGroups:c,groupCount:l,groupSize:u,event:d}=t,{structures:p=[],links:v=[],finishingPositionTargets:f,positionRangeMap:m,error:g}=cD(j0({requireSequential:s,sourceStructureId:i,playoffGroups:c,groupCount:l,groupSize:u},t));if(g)return{error:g};const h=f==null?void 0:f.map(({finishingPositions:T})=>T).flat().map(T=>m[T].finishingPositions).flat();a.structures.push(...p),a.links.push(...v);const{matchUps:_,matchUpsMap:I}=wt({includeByeMatchUps:!0,inContext:!0,drawDefinition:a}),P=p.map(({structureId:T})=>T),S=_.filter(({structureId:T})=>P.includes(T)).map($t),y=(e=I==null?void 0:I.drawMatchUps)==null?void 0:e.filter(({matchUpId:T})=>S.includes(T));if(y.length){const T=(r=Zt({drawDefinition:a,event:d}))==null?void 0:r.tieFormat;T&&y.forEach(N=>{const{tieMatchUps:w}=Gd({isMock:t.isMock,tieFormat:T});Object.assign(N,{tieMatchUps:w,matchUpType:Qr})})}const{positionAssignments:O}=Xe({structureId:i,drawDefinition:a}),b={};O.forEach(T=>{var N;const w=_r({element:T,name:Do}),$=(N=w==null?void 0:w.extension)==null?void 0:N.value,U=$==null?void 0:$.groupOrder;U&&(b[U]||(b[U]=[]),b[U].push(T.participantId))});const E=qd({provisionalPositioning:t.provisionalPositioning,structureId:i,applyPositioning:!0,event:t.event,drawDefinition:a});return E.error&&((n=E.error)==null?void 0:n.code)!==rA.code?k({result:E,stack:o}):j0({structures:p,links:v,positionsPlayedOff:h,drawDefinition:a},B)}var gte=Object.defineProperty,hte=Object.defineProperties,_te=Object.getOwnPropertyDescriptors,R0=Object.getOwnPropertySymbols,Ite=Object.prototype.hasOwnProperty,Pte=Object.prototype.propertyIsEnumerable,F0=(t,e,r)=>e in t?gte(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Rp=(t,e)=>{for(var r in e||(e={}))Ite.call(e,r)&&F0(t,r,e[r]);if(R0)for(var r of R0(e))Pte.call(e,r)&&F0(t,r,e[r]);return t},yte=(t,e)=>hte(t,_te(e));function Jm(t){var e,r;const n="genPlayoffStructure";if(!t.drawDefinition)return k({result:{error:pe},stack:n});const o=dc(t);if(o.error)return k({result:o,stack:n});const{structureId:i,addNameBaseToAttributeName:s,playoffStructureNameBase:a,tournamentRecord:c,playoffAttributes:l,playoffPositions:u,exitProfileLimit:d,roundProfiles:p,roundNumbers:v,idPrefix:f,isMock:m,event:g,uuids:h}=t,_=de(t.drawDefinition,!1,!0),{structure:I}=Te({structureId:i,drawDefinition:_});if(!I)return k({result:{error:xr}});if(I.structureType===er||I.structures)return mte(yte(Rp(Rp({sourceStructureId:I.structureId},t),o),{drawDefinition:_}));const{playoffRoundsRanges:P,playoffRounds:S}=o,{playoffPositionsReturned:y,error:O,playoffSourceRounds:b,playoffRoundsRanges:E}=Ym(t);if(O)return k({result:{error:O},stack:n});const T=(p==null?void 0:p.length)&&Object.assign({},...p),N=v||typeof p=="object"&&p.map(q=>Object.keys(q)).flat(),w=Array.isArray(N)&&N.map(q=>!isNaN(q)&&parseInt(q)).filter(Boolean);if(w){if(!Array.isArray(w))return k({result:{error:Z},context:{validRoundNumbers:w},stack:n});w.forEach(q=>{if(!(S!=null&&S.includes(q)))return k({result:{error:Z},context:{roundNumber:q},stack:n})})}u&&u.forEach(q=>{if(!y.includes(q))return k({result:{error:Z},context:{playoffPosition:q},stack:n})});const $=w||b,U=w?P:E,A=[],C=[];for(const q of $){const G=U==null?void 0:U.find(oe=>oe.roundNumber===q);if(!G)return k({result:{error:Z},context:{roundNumber:q},stack:n});const H=G.finishingPositions.length,Q=Math.min(...G.finishingPositions)-1,z=2,Y=(T==null?void 0:T[q])&&z+T[q]-1,J=Fs({exitProfile:`0-${q}`,addNameBaseToAttributeName:s,playoffStructureNameBase:a,finishingPositionOffset:Q,playoffAttributes:l,exitProfileLimit:d,stage:it,drawDefinition:_,roundOffset:0,sequenceLimit:Y,stageSequence:z,drawSize:H,idPrefix:f,isMock:m,uuids:h});if(J.error)return k({result:J,stack:n});const{structures:te,links:ne}=J;if(te!=null&&te.length&&A.push(...te),ne!=null&&ne.length&&C.push(...ne),J.structureId){const oe={linkType:Kn,source:{structureId:i,roundNumber:q},target:{structureId:J.structureId,feedProfile:_n,roundNumber:1}};C.push(oe)}}if(!A.length)return k({result:{error:Z},info:"No structures generated",stack:n});_.structures.push(...A),_.links.push(...C);const{matchUps:M,matchUpsMap:D}=wt({includeByeMatchUps:!0,inContext:!0,drawDefinition:_}),V=A.map(({structureId:q})=>q),R=M.filter(({structureId:q})=>V.includes(q)).map($t),W=(e=D==null?void 0:D.drawMatchUps)==null?void 0:e.filter(({matchUpId:q})=>R.includes(q));if(W.length){const q=(r=Zt({drawDefinition:_,event:g}))==null?void 0:r.tieFormat;q&&W.forEach(G=>{const{tieMatchUps:H}=Gd({tieFormat:q,isMock:m});Object.assign(G,{tieMatchUps:H,matchUpType:We})})}M.filter(q=>Ds({matchUp:q})&&q.structureId===i).forEach(q=>{const{matchUpId:G,score:H,winningSide:Q}=q,z=nr({inContextDrawMatchUps:M,drawDefinition:_,matchUpId:G,structure:I}),Y=RC({inContextDrawMatchUps:M,tournamentRecord:c,drawDefinition:_,matchUpsMap:D,winningSide:Q,targetData:z,matchUpId:G,structure:I,matchUp:q,score:H,event:g});Y.error&&console.log(Y.error)});const K=[],j=zs({inContextDrawMatchUps:M,drawDefinition:_,matchUpsMap:D}).goesToMap,{structure:L}=Te({drawDefinition:t.drawDefinition,structureId:i}),{matchUps:F}=Ke({structure:L});return F.forEach(q=>{var G,H;const Q=j.loserMatchUpIds[q.matchUpId];if(Q&&q.loserMatchUpId!==Q){q.loserMatchUpId=Q;const Y={tournamentId:c==null?void 0:c.tournamentId,eventId:(G=t.event)==null?void 0:G.eventId,context:n,matchUp:q};K.push(Y)}const z=j.winnerMatchUpIds[q.matchUpId];if(z&&q.winnerMatchUpId!==z){q.winnerMatchUpId=z;const Y={tournamentId:c==null?void 0:c.tournamentId,eventId:(H=t.event)==null?void 0:H.eventId,context:n,matchUp:q};K.push(Y)}}),Rp({structures:A,matchUpModifications:K,links:C,drawDefinition:_},B)}var Ote=Object.defineProperty,V0=Object.getOwnPropertySymbols,Ste=Object.prototype.hasOwnProperty,bte=Object.prototype.propertyIsEnumerable,L0=(t,e,r)=>e in t?Ote(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Tte=(t,e)=>{for(var r in e||(e={}))Ste.call(e,r)&&L0(t,r,e[r]);if(V0)for(var r of V0(e))bte.call(e,r)&&L0(t,r,e[r]);return t};function gD({drawDefinition:t,drawSize:e}){if(!t)return{error:pe};const r=fc({stage:Nt,stageSequence:1,drawDefinition:t,drawSize:e});return r.error?r:(Qe({drawDefinition:t}),Tte({},B))}var Ete=Object.defineProperty,B0=Object.getOwnPropertySymbols,wte=Object.prototype.hasOwnProperty,Nte=Object.prototype.propertyIsEnumerable,x0=(t,e,r)=>e in t?Ete(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,$te=(t,e)=>{for(var r in e||(e={}))wte.call(e,r)&&x0(t,r,e[r]);if(B0)for(var r of B0(e))Nte.call(e,r)&&x0(t,r,e[r]);return t};function hD(t={}){var e,r,n,o,i;const{drawType:s=Qn,attachConsolation:a=!0,applyPositioning:c=!0,tournamentRecord:l,staggeredEntry:u,automated:d,placeByes:p,isMock:v,event:f}=t;let{drawDefinition:m}=t;if(!m)return{error:pe};const g=(e=Kt({tournamentRecord:l,inContext:!0}))==null?void 0:e.tournamentParticipants,h=Nt,_=ms({stageSequence:1,drawDefinition:m,stage:h}),I=[an,Mc,vo].includes(s)?_.length:ia(_.length);if(!u&&s===_a&&_.length<2||s===an&&_.length<3)return{error:af};let{tieFormat:P,matchUpType:S}=t;if(P){const D=cr({tieFormat:P});if(D.error)return D}P=ln(P||((r=Zt({drawDefinition:m}))==null?void 0:r.tieFormat)),S=S||m.matchUpType||ut;const{structures:y}=Ur({stageSequence:1,drawDefinition:m,stage:h});if(y.length>1)return{error:Hi};if((o=(n=y==null?void 0:y[0])==null?void 0:n.matchUps)!=null&&o.length)return{error:Hi};const b=(i=y==null?void 0:y[0])==null?void 0:i.structureId;Object.assign(t,_e({structureName:t.structureName||Nt,structureId:b,matchUpType:S,tieFormat:P,drawSize:I,stage:h}));const E=lD(t);if(E.error)return E;const T=E.generators[s];if(!T)return{error:oA};const N=T==null?void 0:T();if(N.error)return N;let{structures:w,links:$}=N;const U=w.map(D=>Ke({structure:D}).matchUps).flat();P&&U.forEach(D=>{const{tieMatchUps:V}=Gd({tieFormat:P,isMock:v});Object.assign(D,{tieMatchUps:V,matchUpType:S})}),(!c||!a)&&(m=de(m,!1,!0)),$.length&&m.links.push(...$);const A=w.map(({structureId:D})=>D),C=m.structures.map(({structureId:D})=>D);m.structures=m.structures.map(D=>A.includes(D.structureId)?w.find(({structureId:V})=>V===D.structureId):D);const M=w.filter(({structureId:D})=>!C.includes(D));return M.length&&m.structures.push(...M),d&&il({seedingProfile:t.seedingProfile,participants:g,applyPositioning:c,tournamentRecord:l,drawDefinition:m,structureId:b,placeByes:p,event:f}),a&&Qe({drawDefinition:m}),$te({links:$,structures:w},B)}var Ate=Object.defineProperty,Ute=Object.defineProperties,Cte=Object.getOwnPropertyDescriptors,G0=Object.getOwnPropertySymbols,Mte=Object.prototype.hasOwnProperty,Dte=Object.prototype.propertyIsEnumerable,k0=(t,e,r)=>e in t?Ate(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,jte=(t,e)=>{for(var r in e||(e={}))Mte.call(e,r)&&k0(t,r,e[r]);if(G0)for(var r of G0(e))Dte.call(e,r)&&k0(t,r,e[r]);return t},Rte=(t,e)=>Ute(t,Cte(e));function Zm(t){var e,r,n;if(!t.drawDefinition)return{error:pe};const o="generateQualifyingStructure";let i=t.drawSize||Hf(t.participantsCount);const{qualifyingRoundNumber:s,qualifyingPositions:a,targetStructureId:c,structureOptions:l,appliedPolicies:u,drawDefinition:d,structureName:p,structureId:v,roundTarget:f,drawType:m,idPrefix:g,isMock:h,uuids:_}=t;let I,P,S,y,O,b=0,E,T=1;if(!lt(i))return k({result:{error:Bu},stack:o});const N=Te({structureId:c,drawDefinition:d});if(N.error)return k({context:{targetStructureId:c},result:N,stack:o});const w=N.structure,$=w.matchUpType;if(w.stage===Ie)if(w.stageSequence>1)T=w.stageSequence-1;else{let D=c,V=2,R;for(;!R&&D;){w.stageSequence=V;const W=(r=(e=d.links.find(x=>x.source.structureId===D))==null?void 0:e.target)==null?void 0:r.structureId;if(D=W,V+=1,!W)R=!0;else{const x=Te({structureId:W,drawDefinition:d});if(x.error)return k({context:{targetTargetStructureId:W},result:x,stack:o});x.structure.stage!==Ie&&(R=!0)}}}const U=f?`${f}-`:"",A=`${T}`,C=p||(U||A?`${Ie} ${U}${A}`:Ie);if(m===an){const{maxRoundNumber:D,structures:V,groupCount:R}=zc({structureName:p||C,structureId:v||(_==null?void 0:_.pop()),stage:Ie,structureOptions:l,appliedPolicies:u,stageSequence:T,matchUpType:$,roundTarget:f,idPrefix:g,drawSize:i,isMock:h,uuids:_});b=R,I=D,S=V[0],E=[1]}else({drawSize:i,matchUps:O,roundLimit:I,roundsCount:P}=Un({qualifyingRoundNumber:s,qualifyingPositions:a,matchUpType:$,idPrefix:g,drawSize:i,isMock:h,uuids:_})),I||(I=P),S=Mt({structureName:p||C,structureId:v||(_==null?void 0:_.pop()),qualifyingRoundNumber:I,stage:Ie,stageSequence:T,matchUpType:$,roundLimit:I,matchUps:O}),f&&et({element:S,extension:{name:Dn,value:f}}),b=(n=O==null?void 0:O.filter(D=>D.roundNumber===I))==null?void 0:n.length;const M=m===an?po:fo;return{link:y}=ra({sourceStructureId:S.structureId,sourceRoundNumber:I,targetStructureId:c,finishingPositions:E,linkType:M}),Rte(jte({qualifyingDrawPositionsCount:i,qualifiersCount:b},B),{structure:S,link:y})}var Fte=Object.defineProperty,W0=Object.getOwnPropertySymbols,Vte=Object.prototype.hasOwnProperty,Lte=Object.prototype.propertyIsEnumerable,q0=(t,e,r)=>e in t?Fte(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Bte=(t,e)=>{for(var r in e||(e={}))Vte.call(e,r)&&q0(t,r,e[r]);if(W0)for(var r of W0(e))Lte.call(e,r)&&q0(t,r,e[r]);return t};function Xm({tournamentRecord:t,drawDefinition:e,structure:r,eventId:n,link:o}){var i;if(!e)return{error:pe};if(!r)return{error:aa};if(!o)return{error:sA};const s=o.target.structureId,a=Te({drawDefinition:e,structureId:s});if(a.error)return k({stack:"attachQualifyingStructure",context:{targetStructureId:s},result:a});e.structures.push(r),e.links.push(o);const c=((i=Ke({structure:r}))==null?void 0:i.matchUps)||[];return pi({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,matchUps:c,eventId:n}),Qe({drawDefinition:e,structureIds:[r.structureId]}),Bte({},B)}var xte=Object.defineProperty,Gte=Object.defineProperties,kte=Object.getOwnPropertyDescriptors,H0=Object.getOwnPropertySymbols,Wte=Object.prototype.hasOwnProperty,qte=Object.prototype.propertyIsEnumerable,Y0=(t,e,r)=>e in t?xte(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ws=(t,e)=>{for(var r in e||(e={}))Wte.call(e,r)&&Y0(t,r,e[r]);if(H0)for(var r of H0(e))qte.call(e,r)&&Y0(t,r,e[r]);return t},Ns=(t,e)=>Gte(t,kte(e));function Hte({matchUps:t,matchUpType:e}){var r;if(!t)return{error:ko};let n=0,o=[],i=[];e&&(t=t.filter(U=>U.matchUpType===e));const s=Ve(t.map(({matchUpType:U})=>U));if(s.length>1)if(s.includes(We))t=t.filter(U=>U.matchUpType===We);else if(s.includes(ut))t=t.filter(U=>U.matchUpType===ut);else if(s.includes(ot))t=t.filter(U=>U.matchUpType===ot);else return{};if(!Array.isArray(t)||!t.length)return{};const a=(U,A)=>parseInt(U)-parseInt(A),c=Ve(t.map(U=>U.drawPositions).flat().filter(Boolean)).sort(a),u=le(1,Math.max(...c)+1).filter(U=>!c.includes(U)).sort(a),{roundMatchUps:d}=lr({matchUps:t}),p=d[1],v=d[2]||[],[f]=p||[{}],m=f.drawId,g=f.structureId,h=Math.max(...Object.keys(d)),_=((r=d[h])==null?void 0:r.length)||0,I=Math.ceil(Math.log(_)/Math.log(2)),P=le(1,I+1).map(U=>{const A=Math.pow(2,U-1),C=h+I-U+1;return le(1,A+1).map(M=>({drawId:m,structureId:g,matchUpId:ke(),drawPositions:[],sides:[],roundNumber:C,roundPosition:M,finishingRound:U}))});I&&(t=t.concat(...P.flat()));const y=p.map(U=>U.drawPositions).flat(1/0),b=v.map(U=>U.drawPositions).flat(1/0).filter(U=>!y.includes(U)).sort(a),E=v.filter(U=>{var A;return(A=U.drawPositions)==null?void 0:A.reduce((C,M)=>b.includes(M)||C,void 0)}).map(U=>{var A,C;const M=(A=U.drawPositions)==null?void 0:A.reduce((R,W)=>b.includes(W)?W:R,void 0),D=(C=U.drawPositions)==null?void 0:C.indexOf(M),V=U.sides[D];return{[M]:V}});if(u!=null&&u.length&&(b==null?void 0:b.length)===(u==null?void 0:u.length)){const U=b.map((D,V)=>[D,u[V]].sort(a)),A=Object.assign({},...E),C=de(p[0].finishingRound,!1,!0),M=de(p[0].finishingPositionRange,!1,!0);i=U.map((D,V)=>{const R=Math.max(...D||[])/2;return{sides:D==null?void 0:D.map(x=>A[x]||{bye:!0,drawPosition:x}),drawId:m,structureId:g,roundPosition:R,drawPositions:D,roundNumber:1,finishingRound:C,matchUpId:ke(),matchUpStatus:"BYE",sideNumber:V+1,finishingPositionRange:M}}),t=t.concat(...i)}const T=h+I;return le(1,T+1).forEach(U=>{const A=[],C=$({matchUps:t,roundNumber:U}),D=$({matchUps:t,roundNumber:U-1}).map(Yte).filter(Boolean),V=(C==null?void 0:C.length)===(o==null?void 0:o.length),R=(C==null?void 0:C.length)===(o==null?void 0:o.length)/2;U===1&&C.forEach(W=>{const x=W.drawPositions||[],{matchUpId:K,structureId:j}=W,L=[Ns(ws({},W.sides[0]),{drawPosition:x[0],matchUpId:K,structureId:j}),Ns(ws({},W.sides[1]),{drawPosition:x[1],matchUpId:K,structureId:j})],F=Ns(ws({},W),{children:L});A.push(F)}),V?(n++,C.forEach((W,x)=>{const K=W.drawPositions||[],{matchUpId:j,structureId:L}=W,F=K.filter(Boolean).reduce((Q,z)=>y.includes(z)?Q:z,void 0),q=W.sides.filter(Boolean).reduce((Q,z)=>z.participantId&&!D.includes(z.participantId)?z:Q,void 0),G=[Ns(ws({},q),{drawPosition:F,feedRoundNumber:n,sides:W.sides,matchUpId:j,structureId:L}),o[x]],H=Ns(ws({},W),{children:G});A.push(H)})):R&&C.forEach((W,x)=>{const K=[o[x*2],o[x*2+1]],j=Ns(ws({},W),{children:K});A.push(j)}),o=A}),{hierarchy:o[0],missingMatchUps:i,maxRound:h,finalRound:T,matchUps:t};function $({matchUps:U,roundNumber:A}){return U.filter(C=>C.roundNumber===A).sort((C,M)=>C.roundPosition-M.roundPosition)}}function Yte(t){if(t.matchUpStatus===qe)return t.sides.reduce((e,r)=>r.participantId||e,void 0);if(t.winningSide)return t.sides.reduce((e,r)=>r.sideNumber===t.winningSide?r.participantId:e,void 0)}function _D(t){var e,r;const{structure:n,link:o}=Zm(t),i=t.drawDefinition;return Xm({tournamentId:(e=t.tournamentRecord)==null?void 0:e.tournamentId,eventId:((r=t.event)==null?void 0:r.eventId)||t.eventId,drawDefinition:i,structure:n,link:o})}var Kte=Object.defineProperty,Su=Object.getOwnPropertySymbols,ID=Object.prototype.hasOwnProperty,PD=Object.prototype.propertyIsEnumerable,K0=(t,e,r)=>e in t?Kte(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,zte=(t,e)=>{for(var r in e||(e={}))ID.call(e,r)&&K0(t,r,e[r]);if(Su)for(var r of Su(e))PD.call(e,r)&&K0(t,r,e[r]);return t},Qte=(t,e)=>{var r={};for(var n in t)ID.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&Su)for(var n of Su(t))e.indexOf(n)<0&&PD.call(t,n)&&(r[n]=t[n]);return r};function yD(t){return OD(t)}function OD({matchUpModifications:t,tournamentRecord:e,drawDefinition:r,structures:n,links:o=[],event:i}){if(!r)return{error:pe};if(!Array.isArray(n)||!Array.isArray(o))return{error:Z};const s="attachStructures",a=m=>{var g;return[m.source.structureId,m.source.roundNumber||((g=m.source.finishingPositions)==null?void 0:g.join("|")),m.target.roundNumber].join("|")},c=r.links.map(a);if(o.some(m=>{const g=a(m);return c.includes(g)}))return k({result:{error:oF},info:"playoff structure exists",stack:s});o.length&&r.links.push(...o);const u=n.map(({structureId:m})=>m),d=r.structures.map(({structureId:m})=>m);r.structures=r.structures.map(m=>u.includes(m.structureId)?n.find(({structureId:g})=>g===m.structureId):m);const p=n.filter(({structureId:m})=>!d.includes(m));p.length&&r.structures.push(...p),zs({drawDefinition:r});const v=n.map(m=>{var g;return((g=Ke({structure:m}))==null?void 0:g.matchUps)||[]}).flat();pi({tournamentId:e==null?void 0:e.tournamentId,eventId:i==null?void 0:i.eventId,drawDefinition:r,matchUps:v});const f=n.map(({structureId:m})=>m);if(Qe({drawDefinition:r,structureIds:f}),t!=null&&t.length){const m={};t.forEach(h=>{var _;const I=(_=h.matchUp)==null?void 0:_.matchUpId;I&&(m[I]=h)});const g=h=>{h.matchUps.forEach(_=>{if(m[_.matchUpId]){const I=m[_.matchUpId].matchUp,{tieMatchUps:P}=I,S=Qte(I,["tieMatchUps"]);if(Object.assign(_,S),P!=null&&P.length){const y={};P.forEach(O=>m[O.matchUpId]=O),_.tieMatchUps.forEach(O=>Object.assign(O,y[O.matchUpId]))}m[_.matchUpId].matchUp=_,ze(m[_.matchUpId])}})};r.structures.forEach(h=>{if(d.includes(h.structureId))if(h.structures)for(const _ of h.structures)g(_);else g(h)})}return zte({},B)}function Hd(t){var e,r;const{structures:n,links:o,matchUpModifications:i,error:s}=Jm(t);if(s)return{error:s};const a=t.drawDefinition;return yD({tournamentId:(e=t.tournamentRecord)==null?void 0:e.tournamentId,eventId:((r=t.event)==null?void 0:r.eventId)||t.eventId,matchUpModifications:i,drawDefinition:a,structures:n,links:o})}var Jte=Object.defineProperty,Zte=Object.defineProperties,Xte=Object.getOwnPropertyDescriptors,z0=Object.getOwnPropertySymbols,ere=Object.prototype.hasOwnProperty,tre=Object.prototype.propertyIsEnumerable,Q0=(t,e,r)=>e in t?Jte(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,J0=(t,e)=>{for(var r in e||(e={}))ere.call(e,r)&&Q0(t,r,e[r]);if(z0)for(var r of z0(e))tre.call(e,r)&&Q0(t,r,e[r]);return t},rre=(t,e)=>Zte(t,Xte(e));function SD({tournamentRecord:t,matchUpIds:e=[],drawDefinition:r,structureId:n,event:o}){var i;if(typeof r!="object")return{error:pe};if(typeof n!="string")return{error:ur};if(!Array.isArray(e))return{error:Z};const s=(i=r.structures)==null?void 0:i.find(p=>p.structureId===n);if(!s)return{error:xr};const a=s==null?void 0:s.matchUps,c=a.find(p=>!!p.roundPosition);if(s.structures||c||s.finishingPosition===di)return{error:Hi};const l=a.filter(({matchUpId:p})=>e.includes(p)),u=ud(l),d=l.map(({drawPositions:p})=>p).flat();if(d.length){s.positionAssignments=s.positionAssignments.filter(({drawPosition:f})=>!d.includes(f)).sort((f,m)=>f.drawPosition-m.drawPosition),s.matchUps=s.matchUps.filter(({matchUpId:f})=>!u.includes(f));const p=Object.assign({},...s.positionAssignments.map(({drawPosition:f},m)=>({[f]:m+1})));s.positionAssignments=s.positionAssignments.map(f=>rre(J0({},f),{drawPosition:p[f.drawPosition]}));const v=f=>{var m;return f.drawPositions=((m=f.drawPositions)==null?void 0:m.map(g=>p[g]))||[]};s.matchUps.forEach(v),Oi({tournamentId:t==null?void 0:t.tournamentId,matchUpIds:u,action:"deleteAdHocMatchUps",eventId:o==null?void 0:o.eventId,drawDefinition:r}),Qe({structureIds:[n],eventId:o==null?void 0:o.eventId,drawDefinition:r})}return J0({},B)}var nre=Object.defineProperty,ore=Object.defineProperties,ire=Object.getOwnPropertyDescriptors,Z0=Object.getOwnPropertySymbols,sre=Object.prototype.hasOwnProperty,are=Object.prototype.propertyIsEnumerable,X0=(t,e,r)=>e in t?nre(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,cre=(t,e)=>{for(var r in e||(e={}))sre.call(e,r)&&X0(t,r,e[r]);if(Z0)for(var r of Z0(e))are.call(e,r)&&X0(t,r,e[r]);return t},lre=(t,e)=>ore(t,ire(e));function bD({drawDefinition:t,structureDetails:e}){if(!Ki(e))return{error:Z};if(!t)return{error:pe};const r=Object.assign({},...e.map(o=>{if(!Ki(o))return;const{structureId:i,structureName:s}=o||{};if(!(!i||!s))return{[i]:s}}).filter(Boolean));if(!Object.values(r).length)return{error:Se};let n=0;for(const o of t.structures||[]){const i=r[o.structureId];i&&(o.structureName=i,n+=1)}return lre(cre({},B),{modificationsApplied:n})}var ure=Object.defineProperty,dre=Object.defineProperties,pre=Object.getOwnPropertyDescriptors,eb=Object.getOwnPropertySymbols,fre=Object.prototype.hasOwnProperty,vre=Object.prototype.propertyIsEnumerable,tb=(t,e,r)=>e in t?ure(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,mre=(t,e)=>{for(var r in e||(e={}))fre.call(e,r)&&tb(t,r,e[r]);if(eb)for(var r of eb(e))vre.call(e,r)&&tb(t,r,e[r]);return t},gre=(t,e)=>dre(t,pre(e));function TD({tournamentRecord:t,drawDefinition:e,structureId:r,event:n}){var o;if(typeof r!="string")return{error:Z};if(!e)return{error:pe};if(!r)return{error:ur};const i=e.structures||[],s=i.find(({stage:m,stageSequence:g})=>m===ue&&g===1),a=r===s.structureId,c=i.find(({stage:m})=>m===Ie);if(a&&!c)return{error:Jj};const l=[],u=[r],d=m=>{var g;return(g=e.links)==null?void 0:g.map(h=>h.source.structureId===m&&h.target.structureId!==s.structureId&&h.target.structureId).filter(Boolean)},p=i.map(({structureId:m})=>m),v=Object.assign({},...p.map(m=>({[m]:d(m)})));for(;u.length;){const m=u.pop(),{structure:g}=Te({structureId:m,drawDefinition:e}),{matchUps:h}=Ke({structure:g}),_=ud(h);l.push(..._),(!a||m!==r)&&(e.links=((o=e.links)==null?void 0:o.filter(P=>P.source.structureId!==m&&P.target.structureId!==m))||[],e.structures=i.filter(P=>P.structureId!==m));const I=v[m];I!=null&&I.length&&u.push(...I)}const{matchUps:f}=wt({drawDefinition:e});return f.forEach(m=>{l.includes(m.winnerMatchUpId)&&delete m.winnerMatchUpId,l.includes(m.loserMatchUpId)&&delete m.loserMatchUpId}),a&&(s.positionAssignments=[],s.seedAssignments=[],s.matchUps=[],s.extensions&&(s.extensions=[])),Oi({tournamentId:t==null?void 0:t.tournamentId,matchUpIds:l,action:"removeStructure",eventId:n==null?void 0:n.eventId,drawDefinition:e}),Qe({drawDefinition:e,eventId:n==null?void 0:n.eventId}),gre(mre({},B),{removedMatchUpIds:l})}var hre=Object.defineProperty,rb=Object.getOwnPropertySymbols,_re=Object.prototype.hasOwnProperty,Ire=Object.prototype.propertyIsEnumerable,nb=(t,e,r)=>e in t?hre(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ED=(t,e)=>{for(var r in e||(e={}))_re.call(e,r)&&nb(t,r,e[r]);if(rb)for(var r of rb(e))Ire.call(e,r)&&nb(t,r,e[r]);return t};function eg({participantIdPairings:t,addToStructure:e=!0,tournamentRecord:r,matchUpIds:n=[],drawDefinition:o,matchUpsCount:i,roundNumber:s,structureId:a,newRound:c}){var l,u,d,p;if(typeof o!="object")return{error:pe};if(!a&&((l=o.structures)==null?void 0:l.length)===1&&(a=(d=(u=o.structures)==null?void 0:u[0])==null?void 0:d.structureId),typeof a!="string")return{error:ur};if(t&&!Array.isArray(t)||i&&!lt(i)||n&&!Array.isArray(n)||!t&&!i)return{error:Z,info:"matchUpsCount or pairings error"};const v=(p=o==null?void 0:o.structures)==null?void 0:p.find(I=>I.structureId===a);let f;const g=(v==null?void 0:v.matchUps).reduce((I,P)=>(P.roundPosition&&(f=!0),P.roundNumber>I?P.roundNumber:I),0);if(v.structures||f||v.finishingPosition===di)return{error:Hi};if(s&&s-1>g)return{error:Z,info:"roundNumber error"};const h=s||(c?g+1:g||1);t=t||le(0,i).map(()=>({participantIds:[]}));const _=t.map(I=>{const S=((I==null?void 0:I.participantIds)||[]).concat([void 0,void 0]).slice(0,2).map((y,O)=>_e({sideNumber:O+1,participantId:y}));return{matchUpId:n.pop()||ke(),roundNumber:h,matchUpStatus:pt,sides:S}});if(e){const I=tg({tournamentRecord:r,drawDefinition:o,structureId:a,matchUps:_});if(I.error)return I}return ED({matchUpsCount:_.length,matchUps:_},B)}function tg({tournamentRecord:t,drawDefinition:e,structureId:r,matchUps:n}){var o,i,s,a,c,l;if(typeof e!="object")return{error:pe};if(!r&&((o=e.structures)==null?void 0:o.length)===1&&(r=(s=(i=e.structures)==null?void 0:i[0])==null?void 0:s.structureId),typeof r!="string")return{error:ur};if(!Array.isArray(n))return{error:Z,info:Yt("matchUps")};const u=(a=e.structures)==null?void 0:a.find(m=>m.structureId===r);if(!u)return{error:xr};const p=(u==null?void 0:u.matchUps).find(m=>!!m.roundPosition);if(u.structures||p||u.finishingPosition===di)return{error:Hi};if(u.structures||p||u.finishingPosition===di)return{error:Hi};const v=((l=(c=Vt({tournamentRecord:t,inContext:!1}))==null?void 0:c.matchUps)==null?void 0:l.map($t))||[],f=n.map($t);return Gt(v,f)?{error:nF,info:"One or more matchUpIds already present in tournamentRecord"}:(u.matchUps.push(...n),pi({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,matchUps:n}),Qe({drawDefinition:e,structureIds:[r]}),ED({},B))}const Pre={generateAndPopulatePlayoffStructures:Jm,attachPlayoffStructures:yD,addPlayoffStructures:Hd,renameStructures:bD,generateQualifyingStructure:Zm,attachQualifyingStructure:Xm,addQualifyingStructure:_D,getAvailablePlayoffRounds:dc,getAvailablePlayoffProfiles:dc,getSourceRounds:Ym,getDrawStructures:Ur,getPositionsPlayedOff:xd,getQualifiersCount:Ti,removeStructure:TD,generateAdHocMatchUps:eg,deleteAdHocMatchUps:SD,addAdHocMatchUps:tg,addVoluntaryConsolationStage:gD,addVoluntaryConsolationStructure:Wm,generateVoluntaryConsolation:hD,buildDrawHierarchy:Hte,generateDrawTypeAndModifyDrawDefinition:Qm,generateDrawStructuresAndLinks:Km};function rg({participantCount:t}){if(!t)return{error:Z};const e=ia(t);return e?{drawSize:e}:k({result:{error:Z},stack:"getEliminationDrawSize",context:{participantCount:t}})}function ng({requireParticipantCount:t=!0,drawSizeProgression:e=!1,policyDefinitions:r,participantCount:n,tournamentRecord:o,drawDefinition:i,drawSize:s,event:a}={}){const c="getSeedsCount";if(!r){const m=ls({tournamentRecord:o,drawDefinition:i,event:a});if(m.error)return k({result:m,stack:c});r=m.policyDefinitions}const l=lt(n);if(n&&!l)return k({result:{error:Z},context:{participantCount:n},stack:c});if(t&&!l)return k({result:{error:CR},stack:c});if(isNaN(s))if(n)({drawSize:s}=rg({participantCount:n}));else return k({result:{error:Bu},stack:c});if((t&&n||s)>s)return{error:IA};const d=r[fa];if(!d)return{error:IR};const p=d.seedsCountThresholds;return p?(d.drawSizeProgression!==void 0&&(e=d.drawSizeProgression),{seedsCount:p.filter(m=>e?m.drawSize<=s:s===m.drawSize).reduce((m,g)=>n>=g.minimumParticipantCount?g.seedsCount:m,0)}):{error:oR}}var yre=Object.defineProperty,Ore=Object.defineProperties,Sre=Object.getOwnPropertyDescriptors,ob=Object.getOwnPropertySymbols,bre=Object.prototype.hasOwnProperty,Tre=Object.prototype.propertyIsEnumerable,ib=(t,e,r)=>e in t?yre(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ere=(t,e)=>{for(var r in e||(e={}))bre.call(e,r)&&ib(t,r,e[r]);if(ob)for(var r of ob(e))Tre.call(e,r)&&ib(t,r,e[r]);return t},wre=(t,e)=>Ore(t,Sre(e));function wD({requireParticipantCount:t=!0,enforcePolicyLimits:e=!0,drawSizeProgression:r,participantCount:n,appliedPolicies:o,drawDefinition:i,seedingProfile:s,structureId:a,seedsCount:c}){var l,u,d,p,v;const f=Te({drawDefinition:i,structureId:a});if(f.error)return f;const m=f.structure,{positionAssignments:g}=St({structure:m}),h=g.length;if(c>h)return{error:nR};const _=(l=m.structures)==null?void 0:l.length,I=(p=(d=(u=m.structures)==null?void 0:u[0])==null?void 0:d.matchUps)==null?void 0:p.reduce((O,{roundNumber:b})=>Math.max(b,O),0),P=lt(s==null?void 0:s.groupSeedingThreshold)&&s.groupSeedingThreshold,S=(v=Nd({roundRobinGroupsCount:_,roundsCount:I,drawSize:h}))==null?void 0:v.seedGroups,{seedsCount:y}=ng({policyDefinitions:o,requireParticipantCount:t,drawSizeProgression:r,participantCount:n,drawSize:h});return o!=null&&o[fa]&&c>y&&e&&y&&(c=y),m.seedLimit=c,m.seedAssignments=le(1,c+1).map(O=>{const b=S==null?void 0:S.find(N=>N.includes(O)),E=b&&Math.min(...b),T=P&&O>=P?E:O;return{participantId:void 0,seedNumber:O,seedValue:T}}),Qe({drawDefinition:i,structureIds:[a]}),wre(Ere({},B),{seedLimit:c})}function Nre({positionAssignments:t,participantFactors:e}){if(!e||!t)return{error:Se};let r=de(e,!1,!0);const n=t.map(({drawPosition:f})=>f),o=t.filter(f=>!f.participantId&&!f.bye&&!f.qualifier).map(Gx);let i,s=!0;for(;s;)({drawPositionResolutions:i,remainingPreferences:s,participantPreferences:r}=$re({participantPreferences:r,drawPositionResolutions:i}));const a=Object.keys(i).map(f=>parseInt(f));let c=o.filter(f=>!a.includes(f)),l=Object.keys(r);const d=le(1,((f,m)=>Math.log(m)/Math.log(f))(2,(n==null?void 0:n.length)||0)+1).map(f=>Math.pow(2,f)),p={};for(const f of d){const m=jt(n,f).filter(_=>Gt(_,c)),g={};if(l.forEach(_=>{m.forEach(I=>{const P=I.join("|");Gt(I,e[_].preferences)&&(g[P]||(g[P]=[]),g[P].push(_))})}),tr(Object.keys(g)).forEach(_=>{const I=g[_].filter(P=>l.includes(P));for(;I.length;){const P=rr(I),S=_.split("|").map(y=>parseInt(y)).filter(y=>c.includes(parseInt(y)));if(S.length){const y=rr(S);c=c.filter(b=>b!==y),l=l.filter(b=>b!==P),i[y]=P;const O=_.split("|").length;p[O]||(p[O]=0),p[O]+=1}}}),!c.length)break}const v={chunkResolution:p};return l.length&&(l.forEach(f=>{const m=rr(c);m&&(i[m]=f)}),v.randomAssignment=l.length),{drawPositionResolutions:i,report:v}}function $re({participantPreferences:t,drawPositionResolutions:e={}}){const r=Object.keys(t).reduce((s,a)=>{const l=t[a].preferences[0];return l&&(s[l]||(s[l]=[]),s[l].push(a)),s},{}),n=Math.min(...Object.values(r).filter(s=>s.length).map(s=>s.length)),o=Object.keys(r).filter(s=>r[s].length&&n&&r[s].length===n);o.forEach(s=>{const a=r[s],c=rr(a);e[s]=c,delete t[c]});let i;return Object.values(t).forEach(s=>{s.preferences=s.preferences.filter(a=>{const c=!o.includes(a.toString());return c&&(i=!0),c})}),{drawPositionResolutions:e,remainingPreferences:i,participantPreferences:t}}var Are=Object.defineProperty,Ure=Object.defineProperties,Cre=Object.getOwnPropertyDescriptors,sb=Object.getOwnPropertySymbols,Mre=Object.prototype.hasOwnProperty,Dre=Object.prototype.propertyIsEnumerable,ab=(t,e,r)=>e in t?Are(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,jre=(t,e)=>{for(var r in e||(e={}))Mre.call(e,r)&&ab(t,r,e[r]);if(sb)for(var r of sb(e))Dre.call(e,r)&&ab(t,r,e[r]);return t},Rre=(t,e)=>Ure(t,Cre(e));function og(t){const{participantIdAttributeName:e="participantId",isQualifierPosition:r,positionActionName:n,tournamentRecord:o,drawDefinition:i,participantId:s,drawPosition:a,structureId:c,event:l}=t,u="positionParticipantAction";if(!i)return{error:pe};let{inContextDrawMatchUps:d,matchUpsMap:p}=t;p||(p=zt({drawDefinition:i}),Object.assign(t,{matchUpsMap:p})),d||({matchUps:d}=wt({includeByeMatchUps:!0,inContext:!0,drawDefinition:i,matchUpsMap:p}),Object.assign(t,{inContextDrawMatchUps:d}));const{positionAssignments:v}=Xe({drawDefinition:i,structureId:c}),f=v.find(_=>_.drawPosition===a);if(f!=null&&f.participantId){const _=f.participantId;let I=un({inContextDrawMatchUps:d,tournamentRecord:o,drawDefinition:i,participantId:s,drawPosition:a,structureId:c,matchUpsMap:p,event:l});return I.success?h({removedParticipantId:_}):k({result:I,stack:u})}let m=ba({inContextDrawMatchUps:d,tournamentRecord:o,drawDefinition:i,drawPosition:a,structureId:c,matchUpsMap:p,event:l});if(m.error)return k({result:m,stack:u});const g=m.participantId;if(m=un({inContextDrawMatchUps:d,isQualifierPosition:r,tournamentRecord:o,drawDefinition:i,participantId:s,drawPosition:a,structureId:c,matchUpsMap:p,event:l}),!m.success)return k({result:m,stack:u});return h({removedParticipantId:g});function h({removedParticipantId:_}){const{structure:I}=Te({drawDefinition:i,structureId:c});Ed({drawPositions:[a],structure:I});const P={[e]:s,name:n,drawPosition:a,structureId:c};return Kc({drawDefinition:i,positionAction:P}),k({result:Rre(jre({},B),{context:{removedParticipantId:_},stack:u})})}}function ND({alternateParticipantId:t,tournamentRecord:e,drawDefinition:r,drawPosition:n,structureId:o}){return og({positionActionName:"alternateDrawPositionAssignment",participantIdAttributeName:"alternateParticipantid",participantId:t,tournamentRecord:e,drawDefinition:r,drawPosition:n,structureId:o})}var Fre=Object.defineProperty,cb=Object.getOwnPropertySymbols,Vre=Object.prototype.hasOwnProperty,Lre=Object.prototype.propertyIsEnumerable,lb=(t,e,r)=>e in t?Fre(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Bre=(t,e)=>{for(var r in e||(e={}))Vre.call(e,r)&&lb(t,r,e[r]);if(cb)for(var r of cb(e))Lre.call(e,r)&&lb(t,r,e[r]);return t};function $D({structurePositionAssignments:t,provisionalPositioning:e,tournamentRecord:r,drawDefinition:n,event:o}){var i;if(!n)return{error:pe};if(!Array.isArray(t))return{error:Z};const s="setPositionAssignments";for(const c of t){const{structureId:l,positionAssignments:u}=c;if(!u)continue;const d=Te({drawDefinition:n,structureId:l});if(d.error)return d;const p=d.structure;if(!p)return{error:xr};if(p.structures)return{error:Hi,info:"cannot be Round Robin group container"};const v=(i=p.positionAssignments)==null?void 0:i.map(({drawPosition:h})=>h),f=u==null?void 0:u.map(({drawPosition:h})=>h);if(Dt(v,f).length!==v.length)return k({result:{error:Z},info:"drawPositions do not match",stack:s});const m=zt({drawDefinition:n}),{matchUps:g}=wt({includeByeMatchUps:!0,inContext:!0,drawDefinition:n,matchUpsMap:m});for(const h of u||[]){const{drawPosition:_,participantId:I,bye:P,qualifier:S}=h;if(P){const y=Dr({tournamentRecord:r,drawDefinition:n,drawPosition:_,matchUpsMap:m,structureId:l,structure:p,event:o});if(y!=null&&y.error)return y}else if(S)u.forEach(y=>{y.drawPosition===_&&(y.qualifier=!0,delete y.participantId,delete y.bye)});else if(I){const y=un({provisionalPositioning:e,automaticPlacement:!0,inContextDrawMatchUps:g,tournamentRecord:r,drawDefinition:n,participantId:I,drawPosition:_,matchUpsMap:m,structureId:l,event:o});if(y!=null&&y.error)return y}}Lo({tournamentId:r==null?void 0:r.tournamentId,drawDefinition:n,source:s,structure:p,event:o})}const a=t.map(({structureId:c})=>c);return Qe({eventId:o==null?void 0:o.eventId,tournamentRecord:r,drawDefinition:n,structureIds:a}),Bre({},B)}function Yd({drawDefinition:t,stages:e}){return((t==null?void 0:t.structures)||[]).filter(n=>!(e!=null&&e.length)||e.includes(n.stage)).map(n=>{const{positionAssignments:o}=Xe({structure:n});return Jn(o)}).flat()}function Vr({entries:t=[]}={}){const e=t.filter(Boolean).reduce((n,o)=>{const{entryStage:i,entryStatus:s}=o,a=`_${i||ue}${s||""}`;return n[a]||(n[a]=[]),n[a].push(o),n},{}),r=n=>isNaN(n)?1/0:n;return Object.keys(e).map(n=>e[n].sort((o,i)=>r(o.entryPosition)-r(i.entryPosition)).map((o,i)=>{const s=i+1;return Object.assign(o,{entryPosition:s})})).flat()}function Zo(t){return[fs,Wr].includes(t)}var xre=Object.defineProperty,ub=Object.getOwnPropertySymbols,Gre=Object.prototype.hasOwnProperty,kre=Object.prototype.propertyIsEnumerable,db=(t,e,r)=>e in t?xre(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Fp=(t,e)=>{for(var r in e||(e={}))Gre.call(e,r)&&db(t,r,e[r]);if(ub)for(var r of ub(e))kre.call(e,r)&&db(t,r,e[r]);return t};function Mf({autoEntryPositions:t=!0,ignoreAssignment:e,tournamentRecord:r,drawDefinition:n,participantIds:o,entryStatus:i,entryStage:s,extension:a,eventSync:c,drawId:l,stage:u,event:d}){var p,v,f,m,g,h,_,I,P,S,y,O;if(!o||!Array.isArray(o))return{error:ao,method:"modifyEntriesStatus",participantIds:o};if(!n&&!d)return{error:Re};if(i&&!Rx.includes(i))return{error:lf};if(s&&!Av.includes(s))return{error:Go};const b="modifyEntriesStatus",E=[];if(!i&&!a)return k({result:{error:Se},info:"Missing entryStatus",stack:b});if(a&&!on({extension:a,rquiredAttributes:["name"]}))return k({result:{error:Z},info:"Invalid extension",context:{extension:a},stack:b});const T=[];(p=d.drawDefinitions)==null||p.forEach(x=>{const K=Yd({stages:u&&[u],drawDefinition:x});T.push(...K)});const N=(r==null?void 0:r.participants)||[];if(!o.every(x=>{const{participantType:K}=uo({tournamentParticipants:N,participantId:x});return!([we,Ye].includes(K)&&Zo(i))&&!(K===Ce&&[mr,gn].includes(d.eventType)&&[rn,...vp].includes(i))}))return{error:lf};const{flightProfile:$}=ht({event:d}),U=(v=$==null?void 0:$.flights)==null?void 0:v.find(x=>x.drawId===l),A=(x=[])=>{const K=x.filter(F=>!u||!F.entryStage||u===F.entryStage).filter(({participantId:F})=>o.includes(F)),j=F=>T.includes(F.participantId)&&!(vp.includes(F.entryStatus)&&vp.includes(i));return K.every(F=>j(F)&&!e?!1:(i&&(F.entryStatus=i,delete F.entryPosition),s&&(F.entryStage=s,delete F.entryPosition),a&&(a.value?et({element:F,extension:a}):tn({element:F,name:a.name})),!0))?Fp({},B):{error:la}},C=({flight:x,drawDefinition:K})=>{d.entries=Vr({entries:d.entries||[]}),x&&(x.drawEntries=Vr({entries:x.drawEntries})),K&&(K.entries=Vr({entries:K.entries}))},M=({flight:x,drawDefinition:K})=>{const j="updateDrawEntries";if(x){const L=A(x.drawEntries);if(L.error)return k({result:L,stack:j})}if(K){const L=A(K.entries);if(L.error)return k({result:L,stack:j});E.includes(K.drawId)||E.push(K.drawId)}return Fp({},B)},D=((f=d.entries)==null?void 0:f.find(({entryPosition:x})=>!isNaN(x)))||((m=U==null?void 0:U.drawEntries)==null?void 0:m.find(({entryPosition:x})=>!isNaN(x)))||((g=n==null?void 0:n.entries)==null?void 0:g.find(({entryPosition:x})=>!isNaN(x)));if(t&&!D&&C({flight:U,drawDefinition:n}),U||n){const x=M({flight:U,drawDefinition:n});if(x.error)return k({result:x,stack:b})}const V=((h=d.drawDefinitions)==null?void 0:h.map(({drawId:x})=>x))||[],R=((_=$==null?void 0:$.flights)==null?void 0:_.filter(x=>!V.includes(x.drawId)))||[];for(const x of R){const K=M({flight:x});if(K.error)return k({result:K,stack:b})}const W=((I=$==null?void 0:$.flights)==null?void 0:I.length)===1&&((P=d.drawDefinitions)==null?void 0:P.length)<=((S=$==null?void 0:$.flights)==null?void 0:S.length);if(!U&&!n&&jx.includes(i))return{error:VR};if(!U&&!n||i===Vo||c&&W){const x=A(d.entries);if(x.error)return k({result:x,stack:b});let K;if(i===Vo&&((y=$==null?void 0:$.flights)==null||y.every(j=>{const L=A(j.drawEntries);return L.error?(K=L.error,!1):(j.drawEntries=j.drawEntries.filter(({participantId:F})=>!o.includes(F)),!0)}),(O=d.drawDefinitions)==null||O.every(j=>{var L;const F=A(j.entries);return F.error?(K=F.error,!1):(j.entries=(L=j.entries)==null?void 0:L.filter(({participantId:q})=>!o.includes(q)),!0)})),K)return k({result:{error:K},stack:b})}t&&C({flight:U,drawDefinition:n});for(const x of d.drawDefinitions||[])E.length&&!E.includes(x.drawId)||Qe({tournamentId:r.tournamentId,eventId:d.eventId,drawDefinition:x});return Fp({},B)}function AD({stage:t,drawDefinition:e}){return!!(t===Nt||Fc({stage:t,drawDefinition:e})&&pc({stage:t,drawDefinition:e}))}var Wre=Object.defineProperty,pb=Object.getOwnPropertySymbols,qre=Object.prototype.hasOwnProperty,Hre=Object.prototype.propertyIsEnumerable,fb=(t,e,r)=>e in t?Wre(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Yre=(t,e)=>{for(var r in e||(e={}))qre.call(e,r)&&fb(t,r,e[r]);if(pb)for(var r of pb(e))Hre.call(e,r)&&fb(t,r,e[r]);return t};function UD({entryStatus:t=Cr,drawDefinition:e,stageSequence:r,stage:n}){if(t===rn)return Fx({stage:n,drawDefinition:e})?Object.assign({positionsAvailable:1/0},B):{error:FR};const o=OX({drawDefinition:e,stageSequence:r,stage:n}),i=Vx({drawDefinition:e,stageSequence:r,stage:n}),s=eu({entryStatus:qs,drawDefinition:e,stageSequence:r,stage:n}),a=eu({entryStatus:Cr,drawDefinition:e,stageSequence:r,stage:n}),c=s+a,l=c>=o,u=o-c;return n!==Nt&&l?{error:Kg}:t===qs?s<i?Yre({},B):{error:Kg}:Object.assign({positionsAvailable:u},B)}var Kre=Object.defineProperty,zre=Object.defineProperties,Qre=Object.getOwnPropertyDescriptors,vb=Object.getOwnPropertySymbols,Jre=Object.prototype.hasOwnProperty,Zre=Object.prototype.propertyIsEnumerable,mb=(t,e,r)=>e in t?Kre(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,bu=(t,e)=>{for(var r in e||(e={}))Jre.call(e,r)&&mb(t,r,e[r]);if(vb)for(var r of vb(e))Zre.call(e,r)&&mb(t,r,e[r]);return t},Xre=(t,e)=>zre(t,Qre(e));function Df({entryStatus:t=Cr,entryStageSequence:e,entryStage:r=ue,ignoreStageSpace:n,drawDefinition:o,entryPosition:i,participantId:s,participant:a,roundTarget:c,extensions:l,extension:u}){const d="addDrawEntry";if(!o)return{error:pe};if(!r)return{error:cA};if(!AD({stage:r,drawDefinition:o}))return k({result:{error:Go},stack:d});const p=UD({stageSequence:e,stage:r,drawDefinition:o,entryStatus:t});if(!n&&!p.success)return{error:p.error};if(u&&!on({extension:u}))return k({result:{error:Z},info:"Invalid extension",context:{extension:u},stack:d});if(s=s||(a==null?void 0:a.participantId),!s)return k({result:{error:It},stack:d});const v=t===Fo&&Wi({participantId:s,drawDefinition:o,entryStatus:t}),f=r===Nt&&Wi({participantId:s,drawDefinition:o,entryStage:r}),m=t!==Fo&&r!==Nt&&Wi({drawDefinition:o,participantId:s});if(m||v||f)return k({context:{invalidEntry:m,invalidLuckyLoser:v,invalidVoluntaryConsolation:f},result:{error:tv},stack:d});const g=_e(Xre(bu({},a),{entryStageSequence:e,participantId:s,entryPosition:i,entryStatus:t,entryStage:r,extensions:l}));return u&&et({element:g,extension:u}),c&&et({extension:{name:"roundEntry",value:c},element:g}),o.entries.push(g),Qe({drawDefinition:o}),bu({},B)}function CD({entryStatus:t=Cr,autoEntryPositions:e=!0,ignoreStageSpace:r,drawDefinition:n,participantIds:o,stageSequence:i,stage:s=ue,roundTarget:a}){if(!s)return{error:cA};if(!n)return{error:pe};if(!Array.isArray(o))return{error:Jr};if(!AD({stage:s,drawDefinition:n}))return{error:Go};const c=UD({drawDefinition:n,stageSequence:i,entryStatus:t,stage:s});if(!r&&!c.success)return{error:c.error};const l=c.positionsAvailable||0;if(!r&&s!==Nt&&l<o.length)return{error:IA};const u=o.reduce((d,p)=>{const v=t===Fo&&Wi({participantId:p,drawDefinition:n,entryStatus:t}),f=s===Nt&&Wi({entryStage:s,drawDefinition:n,participantId:p});return t!==Fo&&s!==Nt&&Wi({drawDefinition:n,participantId:p})||v||f?d.concat(p):d},[]);return o.filter(d=>d&&!u.includes(d)).forEach(d=>{const p=Object.assign({participantId:d},{entryStage:s,entryStatus:t,entryStageSequence:i});a&&et({element:p,extension:{name:Dn,value:a}}),n.entries.push(p)}),e&&(n.entries=Vr({entries:n.entries})),Qe({drawDefinition:n}),u!=null&&u.length?bu({info:"some participantIds could not be added",participantIdsNotAdded:u},B):bu({},B)}var ene=Object.defineProperty,gb=Object.getOwnPropertySymbols,tne=Object.prototype.hasOwnProperty,rne=Object.prototype.propertyIsEnumerable,hb=(t,e,r)=>e in t?ene(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,nne=(t,e)=>{for(var r in e||(e={}))tne.call(e,r)&&hb(t,r,e[r]);if(gb)for(var r of gb(e))rne.call(e,r)&&hb(t,r,e[r]);return t};function MD({autoEntryPositions:t=!0,entryStageSequence:e,ignoreStageSpace:r,drawDefinition:n,participantIds:o,entryStatus:i,roundTarget:s,entryStage:a,extension:c,drawId:l,event:u}){if(!(o!=null&&o.length))return{error:co};if(!u)return{error:Pr};if(!l)return{error:Mr};const d=(u.entries||[]).map(Ze);if(o.filter(m=>!d.includes(m)).length)return{error:fR};if(n){const m=CD({stageSequence:e,autoEntryPositions:t,stage:a,ignoreStageSpace:r,drawDefinition:n,participantIds:o,entryStatus:i,roundTarget:s,extension:c});if(m.error)return m}const{flightProfile:v}=ht({event:u}),f=v==null?void 0:v.flights.find(m=>m.drawId===l);return f!=null&&f.drawEntries&&(o.forEach(m=>{const g=i===Fo&&Vp({participantId:m,entryStatus:i,flight:f}),h=a===Nt&&Vp({participantId:m,entryStage:a,flight:f});!(i!==Fo&&a!==Nt&&Vp({flight:f,participantId:m}))&&!g&&!h&&f.drawEntries.push({participantId:m,entryStatus:i,entryStage:a})}),t&&(f.drawEntries=Vr({entries:f.drawEntries}))),nne({},B)}function Vp({participantId:t,entryStatus:e,entryStage:r,flight:n}){var o;const i=(o=n.drawEntries)==null?void 0:o.find(s=>s.participantId===t&&(!e||e===s.entryStatus)&&(!r||r===s.entryStage));return t&&i}var one=Object.defineProperty,ine=Object.defineProperties,sne=Object.getOwnPropertyDescriptors,_b=Object.getOwnPropertySymbols,ane=Object.prototype.hasOwnProperty,cne=Object.prototype.propertyIsEnumerable,Ib=(t,e,r)=>e in t?one(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,lne=(t,e)=>{for(var r in e||(e={}))ane.call(e,r)&&Ib(t,r,e[r]);if(_b)for(var r of _b(e))cne.call(e,r)&&Ib(t,r,e[r]);return t},une=(t,e)=>ine(t,sne(e));function Kd({autoEntryPositions:t=!0,tournamentParticipants:e,tournamentRecord:r,participantIds:n,event:o}){var i,s;const a="removeEventEntries";if(!(o!=null&&o.eventId))return{error:Re};if(!Array.isArray(n))return k({result:{error:co},stack:a});if(n=n==null?void 0:n.filter(Boolean),!(n!=null&&n.length))return k({result:{error:co},stack:a});const{eventId:c}=o;if(e||(e=Kt({participantFilters:{participantIds:n},tournamentRecord:r,withEvents:!0,withDraws:!0}).tournamentParticipants),e==null?void 0:e.every(p=>{const v=p.events.find(m=>m.eventId===c),f=(v==null?void 0:v.drawIds)||[];return p.draws.filter(m=>f.includes(m.drawId)&&m.positionAssignments).length}))return k({result:{error:la},stack:a});const u=[];o.entries=(o.entries||[]).filter(p=>{const v=!n.includes(p==null?void 0:p.participantId);return v||u.push(p.participantId),v}),t&&(o.entries=Vr({entries:o.entries}));const{flightProfile:d}=ht({event:o});return(i=d==null?void 0:d.flights)==null||i.forEach(p=>{p.drawEntries=(p.drawEntries||[]).filter(v=>!n.includes(v.participantId))}),(s=o.drawDefinitions)==null||s.forEach(p=>{p.entries=(p.entries||[]).filter(v=>!n.includes(v.participantId))}),une(lne({},B),{participantIdsRemoved:u})}var dne=Object.defineProperty,pne=Object.defineProperties,fne=Object.getOwnPropertyDescriptors,Pb=Object.getOwnPropertySymbols,vne=Object.prototype.hasOwnProperty,mne=Object.prototype.propertyIsEnumerable,yb=(t,e,r)=>e in t?dne(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,gne=(t,e)=>{for(var r in e||(e={}))vne.call(e,r)&&yb(t,r,e[r]);if(Pb)for(var r of Pb(e))mne.call(e,r)&&yb(t,r,e[r]);return t},hne=(t,e)=>pne(t,fne(e));function Uo(t){var e;const{entryStatus:r=Cr,autoEntryPositions:n=!0,participantIds:o=[],entryStageSequence:i,ignoreEventGender:s,entryStage:a=ue,tournamentRecord:c,ignoreStageSpace:l,drawDefinition:u,roundTarget:d,extensions:p,extension:v,drawId:f,event:m}=t,g="addEventEntries";if(!m)return{error:Re};if(!(o!=null&&o.length))return k({result:{error:co},stack:g});if(!(m!=null&&m.eventId))return{error:Pr};const h=[],_=[];if(p&&(!Array.isArray(p)||!p.every(on))||v&&!on({extension:v}))return k({result:{error:Z},context:_e({extension:v,extensions:p}),info:"Invalid extension(s)",stack:g});const I=!!c,P=[];let S;const y=((e=c==null?void 0:c.participants)==null?void 0:e.filter(N=>{var w,$,U;if(!o.includes(N.participantId))return!1;const A=m.eventType===ut&&N.participantType===Ce&&!Zo(r),C=m.eventType===ot&&N.participantType===we;return A&&(!m.gender||s||[go,Hs].includes(m.gender)||m.gender===((w=N.person)==null?void 0:w.sex))||C&&!Zo(r)||m.eventType===ot&&N.participantType===Ce&&Zo(r)?!0:A&&m.gender&&!s&&![go,Hs].includes(m.gender)&&m.gender!==(($=N.person)==null?void 0:$.sex)?(P.push({participantId:N.participantId,sex:(U=N.person)==null?void 0:U.sex}),!1):m.eventType===Ye&&(N.participantType===Ye||Zo(r)&&N.participantType===Ce)}).map(N=>N.participantId))||[],O=o.filter(N=>!I||y.includes(N));m.entries||(m.entries=[]);const b=m.entries.map(N=>{var w;return N.participantId||((w=N.participant)==null?void 0:w.participantId)});if(O.forEach(N=>{if(!b.includes(N)){const w=_e({participantId:N,entryStatus:r,entryStage:a,extensions:p});v&&et({element:w,extension:v}),d&&et({extension:{name:Dn,value:d},element:w}),i&&(w.entryStageSequence=i),_.push(w.participantId),m.entries.push(w)}}),f&&!Zo(a)){const N=MD({participantIds:O,autoEntryPositions:n,entryStageSequence:i,ignoreStageSpace:l,drawDefinition:u,entryStatus:r,roundTarget:d,entryStage:a,extension:v,drawId:f,event:m});N.error&&(S=N.error)}if([ot,Ye].includes(m.eventType)){const N=(m.entries||[]).map(C=>C.participantId),w=(m.entries||[]).filter(C=>Zo(C.entryStatus)).map(C=>C.participantId),U=((c==null?void 0:c.participants)||[]).filter(C=>N.includes(C.participantId)&&[we,Ye].includes(C.participantType)).map(C=>C.individualParticipantIds).flat(1/0),A=w.filter(C=>U.includes(C));A.length&&(h.push(...A),Kd({participantIds:A,autoEntryPositions:!1,tournamentRecord:c,event:m}))}if(O.length!==o.length)return k({result:{error:Jr},context:{misMatchedGender:P,gender:m.gender},stack:g});n&&(m.entries=Vr({entries:m.entries||[]}));const T=_.length-h.length;return k({result:hne(gne({},B),{addedEntriesCount:T}),stack:g,info:S})}var _ne=Object.defineProperty,Ine=Object.defineProperties,Pne=Object.getOwnPropertyDescriptors,Ob=Object.getOwnPropertySymbols,yne=Object.prototype.hasOwnProperty,One=Object.prototype.propertyIsEnumerable,Sb=(t,e,r)=>e in t?_ne(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,jf=(t,e)=>{for(var r in e||(e={}))yne.call(e,r)&&Sb(t,r,e[r]);if(Ob)for(var r of Ob(e))One.call(e,r)&&Sb(t,r,e[r]);return t},Sne=(t,e)=>Ine(t,Pne(e));function DD({addIndividualParticipantsToEvents:t,individualParticipantIds:e,groupingParticipantId:r,tournamentRecord:n,suppressErrors:o}){const i="removeIndividualParticipantIds";if(!n)return k({result:{error:ee},stack:i});if(!r||!e)return k({result:{error:Se},stack:i});const a=(n.participants||[]).find(d=>d.participantId===r);if(!a)return k({result:{error:Tt},stack:i});if(![Ye,dr].includes(a.participantType))return k({result:{participantType:a.participantType,error:bn},stack:i});const c=jD({individualParticipantIds:e,groupingParticipant:a,tournamentRecord:n,suppressErrors:o}),{removed:l,error:u}=c;if(u)return k({result:c,stack:i});if(t)for(const d of n.events||[]){const p=(d.entries||[]).map(({participantId:v})=>v).filter(Boolean);if(p.includes(r)){const v=l.filter(f=>!p.includes(f));Uo({participantIds:v,entryStatus:Wr,tournamentRecord:n,event:d})}}return l&&Le({topic:kt,payload:{tournamentId:n.tournamentId,participants:[a]}}),jf(jf({},B),c)}function jD({individualParticipantIds:t=[],groupingParticipant:e,tournamentRecord:r,suppressErrors:n,mappedMatchUps:o,participants:i}){let s=[];if(!e)return{removed:s};let a=[],c=[];i||({participants:i,mappedMatchUps:o}=Os({withMatchUps:!0,tournamentRecord:r,withEvents:!0}));const u=i.find(({participantId:v})=>v===e.participantId).events.map(({eventId:v})=>v),d=(e.individualParticipantIds||[]).filter(v=>{var f;const m=t==null?void 0:t.includes(v),g=m&&((f=i.find(_=>_.participantId===v))==null?void 0:f.matchUps.filter(({eventId:_})=>u.includes(_)).map(({matchUpId:_})=>o[_]).filter(({winningSide:_,score:I})=>_||At({score:I}))),h=m&&!(g!=null&&g.length);if(m&&!h&&c.push(v),h){s.push(v);for(const _ of r.events||[])for(const I of _.drawDefinitions||[]){const{extension:P}=Lt({element:I,name:En});let S=P==null?void 0:P.value[e.participantId];S&&(S=S.filter(O=>O.participantId!==v),et({element:I,extension:P}),xc({drawDefinition:I}));const y=Er({drawDefinition:I,inContext:!1}).matchUps||[];for(const O of y){const b=O.sides||[];for(const E of b)(E.lineUp||[]).find(w=>w.participantId===v)&&(E.lineUp=E.lineUp.filter(w=>w.participantId!==v),ze({tournamentId:r==null?void 0:r.tournamentId,drawDefinition:I,matchUp:O}))}}}else a.push(v);return!h});e.individualParticipantIds=d;const p={groupingParticipantId:e.participantId,cannotRemove:c,notRemoved:a,removed:s};return c.length&&!n&&Sne(jf({},p),{cannotRemove:c,error:Xf})||p}function ig({individualParticipantIds:t=[],groupingTypes:e=[Ye,dr],participantRole:r=xt,tournamentRecord:n}){if(!n)return{error:ee};const o=n.participants||[],{participants:i,mappedMatchUps:s}=Os({withMatchUps:!0,tournamentRecord:n,withEvents:!0});let a=0;return o.filter(c=>(c.participantRole===r||!c.participantRole)&&e.includes(c.participantType)).forEach(c=>{const{removed:l}=jD({groupingParticipant:c,individualParticipantIds:t,tournamentRecord:n,mappedMatchUps:s,participants:i});l&&a++}),a?B:{error:UR}}var bne=Object.defineProperty,Tne=Object.defineProperties,Ene=Object.getOwnPropertyDescriptors,bb=Object.getOwnPropertySymbols,wne=Object.prototype.hasOwnProperty,Nne=Object.prototype.propertyIsEnumerable,Tb=(t,e,r)=>e in t?bne(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Eb=(t,e)=>{for(var r in e||(e={}))wne.call(e,r)&&Tb(t,r,e[r]);if(bb)for(var r of bb(e))Nne.call(e,r)&&Tb(t,r,e[r]);return t},$ne=(t,e)=>Tne(t,Ene(e));function Na({addIndividualParticipantsToEvents:t,tournamentRecord:e,participantIds:r}){var n,o;if(!e)return{error:ee};if(!(r!=null&&r.length))return{error:co};const i=((n=e.participants)==null?void 0:n.length)||0;if(!i)return Eb({},B);const s=(o=e.events||[])==null?void 0:o.filter(({eventType:f})=>f===yt).map(f=>{var m;return(m=f==null?void 0:f.drawDefinitions)==null?void 0:m.map(({drawId:g})=>g)}).flat(1/0),{tournamentParticipants:a}=Kt({participantFilters:{participantIds:r},tournamentRecord:e,withDraws:!0}),c=()=>{const{matchUps:f}=Vt({matchUpFilters:{drawIds:s,matchUpTypes:[ot]},tournamentRecord:e}),m=f.map(({sides:g})=>g.map(({participantId:h})=>h)).flat().filter(Boolean);return Dt(m,r)},l=(s==null?void 0:s.length)&&c(),u=a.filter(f=>{var m;return(m=f.draws)==null?void 0:m.filter(g=>(!(s!=null&&s.length)||!(s!=null&&s.includes(g.drawId)))&&g.positionAssignments).length});if(l!=null&&l.length||u.length)return{error:la};const d={},p={};for(const f of e.events||[]){const m=Kd({tournamentParticipants:a,tournamentRecord:e,participantIds:r,event:f});if(m.error)return m;d[f.eventId]=m.participantIdsRemoved}e.participants=e.participants.filter(f=>{const m=r.includes(f.participantId)||f.participantType===we&&f.individualParticipantIds.some(g=>r.includes(g));if(!m&&f.participantType===yt&&f.individualParticipantIds.some(g=>r.includes(g))&&(f.individualParticipantIds=f.individualParticipantIds.filter(g=>!r.includes(g))),m&&t&&[we,Ye].includes(f.participantType))for(const g of f.individualParticipantIds||[])r.includes(g)||(p[f.participantId]||(p[f.participantId]=[]),p[f.participantId].push(g));return!m});const v=i-e.participants.length;if(ig({individualParticipantIds:r,tournamentRecord:e}),t)for(const f of e.events||[]){const g=d[f.eventId].map(h=>p[h]||[]).flat();Uo({participantIds:g,entryStatus:Wr,tournamentRecord:e,event:f})}return v&&Le({payload:{participantIds:r,tournamentId:e.tournamentId},topic:hU}),v?$ne(Eb({},B),{participantsRemovedCount:v}):{error:Xf}}function RD({selected:t=!0,drawDefinition:e,entryStatuses:r,drawId:n,event:o,stage:i}){var s;let a=o.entries||[];if(n){const{flightProfile:l}=ht({event:o}),u=(s=l==null?void 0:l.flights)==null?void 0:s.find(d=>d.drawId===n);u?a=u.drawEntries:a=e==null?void 0:e.entries}const c=a.filter(l=>(!(r!=null&&r.length)||!l.entryStatus||r.includes(l.entryStatus))&&(!i||!l.entryStage||l.entryStage===i)&&(!t||Ko.includes(l.entryStatus)));return{entries:a,stageEntries:c}}var Ane=Object.defineProperty,Une=Object.defineProperties,Cne=Object.getOwnPropertyDescriptors,wb=Object.getOwnPropertySymbols,Mne=Object.prototype.hasOwnProperty,Dne=Object.prototype.propertyIsEnumerable,Nb=(t,e,r)=>e in t?Ane(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,jne=(t,e)=>{for(var r in e||(e={}))Mne.call(e,r)&&Nb(t,r,e[r]);if(wb)for(var r of wb(e))Dne.call(e,r)&&Nb(t,r,e[r]);return t},Rne=(t,e)=>Une(t,Cne(e));function FD({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:r,participantId:n,drawId:o,stage:i,event:s}){const a="destroyGroupEntry";if(!e)return{error:ee};if(!n)return k({result:{error:It},stack:a});if(!s)return{error:Re};if(![mr,yt].includes(s.eventType))return k({result:{error:ni},stack:a});const c=e.participants||[],l=c.find(_=>_.participantId===n);if(!l)return k({result:{error:Tt},stack:a});if(![we,yt].includes(l.participantType)||l.participantType===yt&&s.eventType!==yt||l.participantType===we&&s.eventType!==mr)return{error:bn};const d=(s.entries||[]).find(_=>_.participantId===n);if(!d)return{error:PA};const{stageEntries:p}=RD({entryStatusees:Ko,selected:!1,drawDefinition:r,drawId:o,event:s,stage:i}),v=p.map(Ze),f=c.filter(({participantId:_})=>v.includes(_)).map(({individualParticipantIds:_})=>_).flat().filter(Boolean),m=l.individualParticipantIds.filter(_=>Pn(_,f).length===1);let g=Kd({participantIds:[n],tournamentRecord:e,drawDefinition:r,drawId:o,event:s});if(g.error||m.length&&(g=Uo({participantIds:m,entryStatus:Wr,entryStage:d.entryStage,tournamentRecord:e,drawDefinition:r,drawId:o,event:s}),g.error))return g;let h;return t&&Na({tournamentRecord:e,participantIds:[n]}).success&&(h=!0),Rne(jne({},B),{participantRemoved:h})}var Fne=Object.defineProperty,Tu=Object.getOwnPropertySymbols,VD=Object.prototype.hasOwnProperty,LD=Object.prototype.propertyIsEnumerable,$b=(t,e,r)=>e in t?Fne(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ab=(t,e)=>{for(var r in e||(e={}))VD.call(e,r)&&$b(t,r,e[r]);if(Tu)for(var r of Tu(e))LD.call(e,r)&&$b(t,r,e[r]);return t},Vne=(t,e)=>{var r={};for(var n in t)VD.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&Tu)for(var n of Tu(t))e.indexOf(n)<0&&LD.call(t,n)&&(r[n]=t[n]);return r};function BD({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:r,participantId:n,drawId:o,event:i}){return FD({removeGroupParticipant:t,individualEntryStatus:Wr,tournamentRecord:e,drawDefinition:r,participantId:n,drawId:o,event:i})}function Lne(t){if(!t.tournamentRecord)return{error:ee};const e=t,{participantIds:r}=e,n=Vne(e,["participantIds"]);let o=0;const i=[];for(const s of r){const a=FD(Ab({participantId:s},n));a.success&&(o+=1),a.error&&i.push(a.error)}return o?Ab({destroyedCount:o},B):{error:i}}function Eu(t){const{tournamentRecord:e,replaceWithBye:r,drawDefinition:n,destroyPair:o,entryStatus:i,matchUpsMap:s,drawId:a}=t,c="removeDrawPositionAssignment",l=ba(t);if(l.error)return k({result:l,stack:c});const{participantId:u}=l,{drawPosition:d,event:p,structureId:v}=t;if([rn,Vo].includes(i)&&u){const{tournamentRecord:g}=t,{participant:h}=qo({tournamentRecord:g,participantId:u}),{participantType:_,individualParticipantIds:I}=h||{};if(o&&_===we){const P=BD({tournamentRecord:g,drawDefinition:n,participantId:u,event:p});if(P.error)return k({result:P,stack:c});Mf({participantIds:I,tournamentRecord:g,drawDefinition:n,entryStatus:i,drawId:a,event:p})}else Mf({participantIds:[u],tournamentRecord:g,drawDefinition:n,entryStatus:i,drawId:a,event:p})}if(r){const g=Dr({tournamentRecord:e,drawDefinition:n,drawPosition:d,structureId:v,matchUpsMap:s,event:p});if(g.error)return k({result:g,stack:c})}const{structure:f}=Te({drawDefinition:n,structureId:v});return Ed({structure:f,drawPositions:[d]}),Kc({drawDefinition:n,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:r,drawPosition:d,entryStatus:i,structureId:v}}),l}var Bne=Object.defineProperty,xne=Object.defineProperties,Gne=Object.getOwnPropertyDescriptors,Ub=Object.getOwnPropertySymbols,kne=Object.prototype.hasOwnProperty,Wne=Object.prototype.propertyIsEnumerable,Cb=(t,e,r)=>e in t?Bne(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Co=(t,e)=>{for(var r in e||(e={}))kne.call(e,r)&&Cb(t,r,e[r]);if(Ub)for(var r of Ub(e))Wne.call(e,r)&&Cb(t,r,e[r]);return t},qne=(t,e)=>xne(t,Gne(e));function xD({tournamentRecord:t,drawDefinition:e,drawPositions:r,structureId:n,event:o}){const i="swapDrawPositionAssignments";if(!e)return{error:pe};if(!n)return{error:ur};if((r==null?void 0:r.length)!==2)return{error:Z,drawPositions:r};let s=zt({drawDefinition:e});const{matchUps:a}=wt({includeByeMatchUps:!0,inContext:!0,drawDefinition:e,matchUpsMap:s}),{structure:c}=Te({drawDefinition:e,structureId:n});if(!c)return{error:xr};let l;if(c.structureType===er?l=Kne({inContextDrawMatchUps:a,tournamentRecord:t,drawDefinition:e,drawPositions:r,matchUpsMap:s,structure:c,event:o}):l=Hne({inContextDrawMatchUps:a,tournamentRecord:t,drawDefinition:e,drawPositions:r,matchUpsMap:s,structure:c,event:o}),l.error)return l;if(Ed({structure:c,drawPositions:r}),Kc({drawDefinition:e,positionAction:{name:"swapDrawPositionAssignments",drawPositions:r,structureId:n}}),Lo({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,source:i,structure:c,event:o}),o.eventType===gn){const d=Ke({matchUpFilters:{matchUpTypes:[Qr]},inContext:!0,structure:c}).matchUps.filter(v=>{var f;return(f=v.drawPositions)==null?void 0:f.some(m=>r.includes(m))}),p=Ke({structure:c,matchUpFilters:{matchUpTypes:[Qr]}}).matchUps;d.forEach(v=>{(v.sides||[]).forEach(f=>{var m;const g=f==null?void 0:f.drawPosition;if(r.includes(g)){const h=f.participantId,_=p.find(({matchUpId:P})=>P===v.matchUpId),I=(m=v==null?void 0:v.sides)==null?void 0:m.reduce((P,S,y)=>S.drawPosition===g?y:P,void 0);um({inContextTargetMatchUp:v,drawPositionSideIndex:I,teamParticipantId:h,tournamentRecord:t,drawDefinition:e,matchUp:_,event:o})}})})}return Qe({drawDefinition:e,structureIds:[n]}),Co({},B)}function Hne({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:r,drawPositions:n,matchUpsMap:o,structure:i,event:s}){const a=i==null?void 0:i.positionAssignments.filter(l=>n==null?void 0:n.includes(l.drawPosition));return a?a.filter(({bye:l})=>l).length===2?Co({},B):a.filter(({qualifier:l})=>l).length===2?Co({},B):a.some(({bye:l})=>l)?GD({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:r,assignments:a,matchUpsMap:o,structure:i,event:s}):Yne({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:r,assignments:a,matchUpsMap:o,structure:i,event:s}):{error:Z,structure:i,info:"Missing positionAssignments"}}function GD({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:r,assignments:n,matchUpsMap:o,structure:i,event:s}){const a=n.find(({bye:f})=>f),c=n.find(({participantId:f})=>f),l=a.drawPosition,{participantId:u,drawPosition:d}=c,{structureId:p}=i;let v=Eu({drawPosition:l,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:r,structureId:p,matchUpsMap:o});return v.error||(v=Eu({drawPosition:d,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:r,structureId:p,matchUpsMap:o}),v.error)||(v=Dr({drawPosition:d,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:r,structureId:p,matchUpsMap:o,event:s}),v=un({drawPosition:l,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:r,structureId:p,participantId:u,matchUpsMap:o,event:s}),v.error)?v:Co({},B)}function Yne({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:r,assignments:n,matchUpsMap:o,structure:i,event:s}){const a=Object.assign({},...n.map((c,l)=>{const{drawPosition:u}=c,d=qne(Co({},n[1-l]),{drawPosition:u});return{[u]:d}}));return i.positionAssignments=i.positionAssignments.map(c=>a[c.drawPosition]||c),mm({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:r,matchUpsMap:o,assignments:n,structure:i,event:s}),Co({},B)}function Kne({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:r,drawPositions:n,matchUpsMap:o,structure:i,event:s}){var a;const c=(a=i.structures)==null?void 0:a.reduce((u,d)=>{const p=d==null?void 0:d.positionAssignments.filter(v=>n==null?void 0:n.includes(v.drawPosition));return p&&u.push(...p),u},[]);if(c.filter(({bye:u})=>u).length===2)return Co({},B);if(c.filter(({qualifier:u})=>u).length===2)return Co({},B);if(mm({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:r,matchUpsMap:o,assignments:c,structure:i,event:s}),c.some(({bye:u})=>u))GD({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:r,assignments:c,matchUpsMap:o,structure:i,event:s});else{const u=de(c,!1,!0);c.forEach((d,p)=>{const v=u[1-p].participantId;d.qualifier=u[1-p].qualifier,d.participantId=v})}return Co({},B)}var zne=Object.defineProperty,Mb=Object.getOwnPropertySymbols,Qne=Object.prototype.hasOwnProperty,Jne=Object.prototype.propertyIsEnumerable,Db=(t,e,r)=>e in t?zne(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Zne=(t,e)=>{for(var r in e||(e={}))Qne.call(e,r)&&Db(t,r,e[r]);if(Mb)for(var r of Mb(e))Jne.call(e,r)&&Db(t,r,e[r]);return t};function kD({tournamentRecord:t,drawDefinition:e,drawPosition:r,structureId:n,subOrder:o,event:i}){if(!e)return{error:pe};if(!n)return{error:ur};if(!r)return{error:hc};const{structure:s}=Te({drawDefinition:e,structureId:n});let a=s;s.structureType===er&&(a=s.structures.find(m=>m.positionAssignments.find(g=>g.drawPosition===r)));const c=a.positionAssignments,l=c.find(m=>m.drawPosition===r);l&&et({element:l,extension:{name:xs,value:o}});const p=((i==null?void 0:i.eventType)===We||e.matchUpType===We||(i==null?void 0:i.tieFormat)||(e==null?void 0:e.tieFormat)||(s==null?void 0:s.tieFormat))&&{matchUpTypes:[We]},{matchUps:v}=Ke({structure:a,afterRecoveryTimes:!1,inContext:!0,matchUpFilters:p,event:i}),f=(s==null?void 0:s.matchUpFormat)||e.matchUpFormat;return r1({positionAssignments:c,tournamentRecord:t,drawDefinition:e,matchUpFormat:f,matchUps:v,event:i}),Qe({drawDefinition:e,structureIds:[n]}),Zne({},B)}const Xne={setSubOrder:kD,clearDrawPosition:ba,assignDrawPosition:un,setPositionAssignments:$D,automatedPositioning:il,assignDrawPositionBye:Dr,swapDrawPositionAssignments:xD,alternateDrawPositionAssignment:ND,resolveDrawPositions:Nre,initializeStructureSeedAssignments:wD,getNextSeedBlock:$d};function WD({drawDefinition:t,event:e,matchUpId:r}){if(!t)return{error:pe};if(!r)return{error:Ut};const{matchUp:n}=nt({drawDefinition:t,event:e,matchUpId:r});return n?tn({element:n,name:zu}):{error:kr}}function eoe({maxIterations:t=5e3,valueSortedPairings:e,pairingValues:r,deltaObjects:n}){const o=Object.assign({},...e.map(p=>({[p.pairing]:p.value})));let i=jb({rankedMatchUpValues:o,valueSortedPairings:e,deltaObjects:n}),s=i;const a=Object.keys(r);let c=0,l,u=a.length;do u-=1,l=a.length*u*e.length/2;while(l>t&&u>2);let d=[];return a.forEach(p=>{r[p].slice(0,u).forEach(f=>{const m=na(p,f.opponent);if(!d.includes(m)){const g=jb({stipulated:[[p,f.opponent]],rankedMatchUpValues:o,valueSortedPairings:e,deltaObjects:n});g.maxDelta<s.maxDelta&&(s=g),g.value<i.value&&(i=g),d.push(m),c+=1}})}),{candidate:i,deltaCandidate:s,candidatesCount:c,iterations:l}}function jb({rankedMatchUpValues:t,valueSortedPairings:e,stipulated:r=[],deltaObjects:n}){const o=[].concat(...r),i=[];let s=0;r.filter(Boolean).forEach(c=>{const l=na(...c),u=t[l];i.push({participantIds:c,value:u}),s+=t[l]}),e.forEach(c=>{const l=c.pairing.split("|");if(!l.reduce((d,p)=>o.includes(p)||d,!1)){o.push(...l);let d=c.value;s+=d,i.push({participantIds:l,value:d})}}),i.sort((c,l)=>c.value-l.value);const a=i.reduce((c,l)=>{const u=na(...l.participantIds),d=n[u];return d>c?d:c},0);return{value:s,participantIdPairings:i,maxDelta:a}}function na(t,e){return[t,e].sort().join("|")}var toe=Object.defineProperty,roe=Object.defineProperties,noe=Object.getOwnPropertyDescriptors,Rb=Object.getOwnPropertySymbols,ooe=Object.prototype.hasOwnProperty,ioe=Object.prototype.propertyIsEnumerable,Fb=(t,e,r)=>e in t?toe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,soe=(t,e)=>{for(var r in e||(e={}))ooe.call(e,r)&&Fb(t,r,e[r]);if(Rb)for(var r of Rb(e))ioe.call(e,r)&&Fb(t,r,e[r]);return t},aoe=(t,e)=>roe(t,noe(e));const coe=50,loe=60,Lp=0,uoe=5e3;function doe({maxIterations:t=uoe,generateMatchUps:e=!0,tournamentParticipants:r,tournamentRecord:n,addToStructure:o,drawDefinition:i,participantIds:s,adHocRatings:a,structureId:c,matchUpIds:l,eventType:u,structure:d}){if(!(s!=null&&s.length))return{error:co};const{encounters:p}=voe({matchUps:d.matchUps}),v={};for(const O of p)v[O]||(v[O]=0),v[O]+=coe;const f=r==null?void 0:r.filter(({participantType:O})=>O===Ye);if(f)for(const O of f){const b=O.individualParticipantIds||[],{uniquePairings:E}=Vb({participantIds:b});for(const T of E)v[T]||(v[T]=0),v[T]+=loe}const{uniquePairings:m,possiblePairings:g,deltaObjects:h}=Vb({participantIds:s}),_={tournamentParticipants:r,possiblePairings:g,drawDefinition:i,participantIds:s,uniquePairings:m,maxIterations:t,adHocRatings:a,deltaObjects:h,valueObjects:v,eventType:u,structure:d},{candidatesCount:I,participantIdPairings:P,iterations:S}=foe(_);if(!I)return{error:nv};let y;if(e){const O=eg({participantIdPairings:P,tournamentRecord:n,addToStructure:o,drawDefinition:i,newRound:!0,structureId:c,matchUpIds:l});if(O.error)return O;y=O.matchUps}return aoe(soe({},B),{participantIdPairings:P,candidatesCount:I,iterations:S,matchUps:y})}function poe({tournamentParticipants:t,adHocRatings:e,eventType:r,pairing:n}){return n.split("|").map(o=>{var i;if(r===mr){const s=(i=t==null?void 0:t.find(a=>a.participantId===o))==null?void 0:i.individualParticipantIds;return s?s==null?void 0:s.map(a=>e[a||Lp]):Lp*2}else return e[o]||Lp})}function foe({tournamentParticipants:t,adHocRatings:e={},possiblePairings:r,uniquePairings:n,maxIterations:o,deltaObjects:i,valueObjects:s,eventType:a}){n.forEach(f=>{const m=poe({tournamentParticipants:t,adHocRatings:e,eventType:a,pairing:f}),g=Math.abs(m[0]-m[1])+1;i[f]=Math.abs(m[0]-m[1]),s[f]||(s[f]=0),s[f]+=Math.pow(g,2)});const c=n.map(f=>({pairing:f,value:s[f]})).sort((f,m)=>f.value-m.value),{pairingValues:l}=moe({possiblePairings:r,valueObjects:s}),{candidate:u,candidatesCount:d,iterations:p}=eoe({valueSortedPairings:c,maxIterations:o,pairingValues:l,deltaObjects:i}),{participantIdPairings:v}=u;return{candidatesCount:d,participantIdPairings:v,iterations:p}}function Vb({participantIds:t}){const e={},r=[];t.forEach(o=>{e[o]=t.filter(i=>i!==o),e[o].forEach(i=>{const s=na(i,o);r.includes(s)||r.push(s)})});const n=Object.assign({},...r.map(o=>({[o]:0})));return{uniquePairings:r,possiblePairings:e,deltaObjects:n}}function voe({matchUps:t}){let e=[];for(const r of t){const n=r.sides.map(Ze);if(n.length===2){const o=na(...n);e.includes(o)||e.push(o)}}return{encounters:e}}function moe({possiblePairings:t,valueObjects:e}){let r={};for(const o of Object.keys(t)){let i=t[o].map(s=>n(o,s));r[o]=i.sort((s,a)=>s.value-a.value)}function n(o,i){let s=na(o,i);return{opponent:i,value:e[s]}}return{pairingValues:r}}function qD({tournamentParticipants:t,restrictEntryStatus:e,tournamentRecord:r,generateMatchUps:n,addToStructure:o,drawDefinition:i,participantIds:s,maxIterations:a,structureId:c,matchUpIds:l,scaleName:u,event:d}){var p,v,f;if(typeof i!="object"||i.drawType&&i.drawType!==sn)return{error:Bi};if(!Array.isArray(i.entries)||s&&!Array.isArray(s))return{error:Z,info:"Missing Entries"};const{eventType:m}=d||{},g=i.entries.filter(({entryStatus:P})=>!e||Ko.includes(P)).map(Ze);if(s){const P=s.filter(S=>!g.includes(S));if(P!=null&&P.length)return{error:ao,invalidParticipantIds:P}}else s=g;if(!c){const P=(v=(p=i.structures)==null?void 0:p.filter(S=>S.stageSequence===1))==null?void 0:v.reduce((S,y)=>{const O=rs[y.stage];return mo({drawDefinition:i,structure:y})&&O>(rs[S==null?void 0:S.stage]||1)?y:S},void 0);c=P==null?void 0:P.structureId}const h=(f=i.structures)==null?void 0:f.find(P=>P.structureId===c);if(!h)return{error:xr};if(!mo({drawDefinition:i,structure:h}))return{error:Bi};const I={};for(const P of s){const S=t==null?void 0:t.find(O=>O.participantId===P);let y=Lb({eventType:m,participant:S});!y&&u&&(y=Lb({scaleValue:y,eventType:m,participant:S})),y&&(I[P]=y)}return doe({tournamentParticipants:t,tournamentRecord:r,generateMatchUps:n,addToStructure:o,drawDefinition:i,participantIds:s,maxIterations:a,adHocRatings:I,structureId:c,matchUpIds:l,structure:h,eventType:m})}function Lb({scaleName:t="dynamic",eventType:e,participant:r}){var n;const i=r&&kn({scaleAttributes:{eventType:e||Yn,scaleType:xi,scaleName:t},participant:r});return(n=i==null?void 0:i.scaleItem)==null?void 0:n.scaleValue}function HD({drawDefinition:t,matchUpId:e,outcome:r,matchUp:n}){var o,i;if(!n&&!t)return{error:pe};if(!r)return{error:Se,info:"missing outcome"};if(!n&&!e)return{error:wr};if(!n){const a=nt({drawDefinition:t,matchUpId:e});if(a.error)return a;n=a.matchUp}return typeof r!="object"||!((o=r.score)!=null&&o.scoreStringSide1)||!((i=r.score)!=null&&i.scoreStringSide2)?{error:Z}:et({element:n,extension:{name:zu,value:r}})}function goe({matchUps:t}){if(!t)return{error:ko};const e=t.map(o=>o.drawPositions).flat();Ct()&&t.forEach(o=>{var i;if(!Array.isArray(o.drawPositions)){console.log("drawPositions not an array",o);return}(i=o.drawPositions)==null||i.forEach(s=>{Bb(s)||console.log("invalid drawPosition",o)})});const r=e==null?void 0:e.every(Bb),n=t.find(o=>!Array.isArray(o.drawPositions));return r&&!n}function Bb(t){return t!==null&&(t===void 0||!isNaN(t))}function YD({drawDefinition:t,matchUpId:e,event:r}){if(!t)return{error:pe};const{matchUp:n}=nt({drawDefinition:t,matchUpId:e,event:r});return et({extension:{name:Bs,value:!0},element:n})}function KD({tournamentRecord:t,drawDefinition:e,matchUpId:r,event:n}){if(!e)return{error:pe};const{matchUp:o}=nt({drawDefinition:e,matchUpId:r,event:n});return(o==null?void 0:o.matchUpType)!==Qr?{error:Gr}:Jc({enableAutoCalc:!0,tournamentRecord:t,drawDefinition:e,matchUpId:r,event:n})}var hoe=Object.defineProperty,xb=Object.getOwnPropertySymbols,_oe=Object.prototype.hasOwnProperty,Ioe=Object.prototype.propertyIsEnumerable,Gb=(t,e,r)=>e in t?hoe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Poe=(t,e)=>{for(var r in e||(e={}))_oe.call(e,r)&&Gb(t,r,e[r]);if(xb)for(var r of xb(e))Ioe.call(e,r)&&Gb(t,r,e[r]);return t};function zD({drawDefinition:t,finishingOrder:e}){var r;if(!t)return{error:pe};const n="setOrderOfFinish";if(!Array.isArray(e))return k({result:{error:Z},info:Yt("finishingOrder"),stack:n});const{completedMatchUps:o,matchUpsMap:i}=gs({inContext:!0,drawDefinition:t}),s=o.map($t),a=e.map($t),{matchUpTypes:c,roundNumbers:l,structureIds:u,matchUpTieIds:d}=o.filter(({matchUpId:I})=>a.includes(I)).reduce((I,P)=>{const{matchUpTieId:S,matchUpType:y,roundNumber:O,structureId:b}=P;return I.matchUpTypes.includes(y)||I.matchUpTypes.push(y),I.roundNumbers.includes(O)||I.roundNumbers.push(O),I.structureIds.includes(b)||I.structureIds.push(b),I.matchUpTieIds.includes(S)||I.matchUpTieIds.push(S),I},{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(c.length>1||d.length>1||l.length>1||u.length>1)return k({result:{error:Z},info:"matchUpType, structureId and roundNumber must be equivalent",stack:n});let p,v;const f={},m=[],g=[];if(!e.every(({orderOfFinish:I,matchUpId:P})=>(m.push(P),I&&g.push(I),f[P]=I,p=s.includes(P),v=I===void 0||lt(I)&&Math.floor(I)>0,p&&v)))return k({result:{error:p?Z:Ya},info:!p&&"matchUps must be completed"||!v&&"orderOfFinish must be integer > 0 or undefined"||void 0,stack:n});const _=o.filter(I=>I.structureId===u[0]&&I.roundNumber===l[0]&&I.matchUpType===c[0]&&I.matchUpTieId===d[0]&&!m.includes(I.matchUpId));for(const I of _){const{orderOfFinish:P}=I||{};if(P){if(!lt(P))return k({result:{error:Z},context:{orderOfFinish:P},matchUp:I,stack:n});g.push(P)}}if(tA(g).length!==g.length||Math.max(...g)>g.length)return k({result:{error:Z},info:"Values not unique or greater than expected number of values",stack:n});if(u.length){const I=kc({matchUpFilters:{matchUpIds:a},structureId:u[0],drawDefinition:t,matchUpsMap:i});if(I.error)return k({result:I,stack:n});(r=I.completedMatchUps)==null||r.forEach(P=>P.orderOfFinish=f[P.matchUpId])}return Poe({},B)}var yoe=Object.defineProperty,Ooe=Object.defineProperties,Soe=Object.getOwnPropertyDescriptors,kb=Object.getOwnPropertySymbols,boe=Object.prototype.hasOwnProperty,Toe=Object.prototype.propertyIsEnumerable,Wb=(t,e,r)=>e in t?yoe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,qb=(t,e)=>{for(var r in e||(e={}))boe.call(e,r)&&Wb(t,r,e[r]);if(kb)for(var r of kb(e))Toe.call(e,r)&&Wb(t,r,e[r]);return t},Eoe=(t,e)=>Ooe(t,Soe(e));function QD({tournamentRecord:t,drawDefinition:e,matchUpId:r,event:n,uuids:o}){var i;if(!t)return{error:ee};if(typeof r!="string")return{error:Ut};const s="resetTieFormat";let a=ol({tournamentRecord:t,matchUpId:r});if(a.error)return a;const{matchUp:c,structure:l}=a;if(!c.tieMatchUps)return{error:Gr,info:"Must be a TEAM matchUp"};if(!c.tieFormat)return qb({},B);const u=(i=Zt({structure:l,drawDefinition:e,event:n}))==null?void 0:i.tieFormat;if(!u)return{error:Ht,info:"No inherited tieFormat"};const d=[],p=[],v=[],f=[];for(const m of u.collectionDefinitions){const{matchUpCount:g,collectionId:h}=m;p.push(h);const _=(c.tieMatchUps||[]).filter(I=>I.collectionId===h);if(_.length>g)_.sort((I,P)=>(I.matchUpStatus===pt?1:0)-(P.matchUpStatus===pt?1:0)),f.push(..._.slice(0,g)),d.push(..._.slice(3).map($t));else if(f.push(..._),_.length<g){const I=g-_.length,P=kd({collectionDefinition:m,matchUpsLimit:I,uuids:o});v.push(...P)}}for(const m of c.tieMatchUps||[])p.includes(m.collectionId)||d.push(m.matchUpId);return v.length&&(f.push(...v),pi({tournamentId:t==null?void 0:t.tournamentId,eventId:n.eventId,matchUps:v,drawDefinition:e})),d.length&&Oi({tournamentId:t==null?void 0:t.tournamentId,matchUpIds:d,eventId:n==null?void 0:n.eventId,drawDefinition:e}),c.tieMatchUps=f,c.tieFormatId=void 0,c.tieFormat=void 0,ze({tournamentId:t==null?void 0:t.tournamentId,structureId:l.structureId,eventId:n.eventId,context:s,drawDefinition:e,matchUp:c}),Eoe(qb({},B),{newMatchUps:v,deletedMatchUpIds:d})}var woe=Object.defineProperty,Hb=Object.getOwnPropertySymbols,Noe=Object.prototype.hasOwnProperty,$oe=Object.prototype.propertyIsEnumerable,Yb=(t,e,r)=>e in t?woe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Aoe=(t,e)=>{for(var r in e||(e={}))Noe.call(e,r)&&Yb(t,r,e[r]);if(Hb)for(var r of Hb(e))$oe.call(e,r)&&Yb(t,r,e[r]);return t};function JD(t){var e;const{tournamentRecord:r,drawDefinition:n,matchUpId:o,event:i}=t,s="resetScorecard";if(!n)return k({result:{error:pe},stack:s});if(!o)return k({result:{error:Ut},stack:s});if(typeof o!="string")return k({result:{error:Z,matchUpId:o},stack:s});const a=zt({drawDefinition:n});let{matchUps:c}=wt({includeByeMatchUps:!0,nextMatchUps:!0,inContext:!0,drawDefinition:n,matchUpsMap:a});const l=a.drawMatchUps.find(g=>g.matchUpId===o),u=c.find(g=>g.matchUpId===o);if(!l||!c)return{error:kr};if(!l.matchUpType===We)return{error:Gr};const d=nr({inContextDrawMatchUps:c,drawDefinition:n,matchUpId:o}),p=u.structureId,{structure:v}=Te({drawDefinition:n,structureId:p});if(Object.assign(t,{inContextDrawMatchUps:c,inContextMatchUp:u,matchUpsMap:a,targetData:d,structure:v,matchUp:l}),gi(t))return{error:hA};for(const g of l.tieMatchUps){const h=Jc({matchUpId:g.matchUpId,matchUpTieId:o,winningSide:void 0,removeScore:!0,tournamentRecord:r,drawDefinition:n,event:i});if(h.error)return k({result:h,stack:s})}let m=to({event:t.event,removeScore:!0,tournamentRecord:r,drawDefinition:n,matchUpsMap:a,matchUpId:o});if(m.error)return k({result:m,stack:s});if(t.tiebreakReset&&!m.tieFormatRemoved){const g=(e=Zt({drawDefinition:n,structure:v,event:i}))==null?void 0:e.tieFormat;if(g){const{matchUpCountDifference:h,descendantDifferences:_,ancestorDifferences:I,valueDifference:P}=_d({descendant:l.tieFormat,ancestor:g});if(_.collectionIds.length===1&&!I.collectionIds.length&&!I.groupsCount&&h===1&&P===1){const S=QD({tournamentRecord:r,drawDefinition:n,matchUpId:o,event:i});if(S.error)return S}}}return Aoe({},B)}const Uoe={resetScorecard:JD,setMatchUpStatus:Jc,setMatchUpFormat:Ad,updateTieMatchUpScore:to,isValidMatchUpFormat:Br,disableTieAutoCalc:YD,enableTieAutoCalc:KD,addFinishingRounds:Wc,addMatchUpTimeItem:vr,resetMatchUpTimeItems:BW,checkInParticipant:Cm,checkOutParticipant:Mm,getCheckedInParticipantIds:Vc,addMatchUpScheduleItems:Sd,addMatchUpScheduledDate:rm,addMatchUpScheduledTime:bi,addMatchUpStartTime:om,addMatchUpEndTime:im,addMatchUpStopTime:sm,addMatchUpResumeTime:am,addMatchUpTimeModifiers:tm,addGoesTo:zs,setOrderOfFinish:zD,setDelegatedOutcome:HD,removeDelegatedOutcome:WD,drawMatic:qD,addMatchUpOfficial:fC,findMatchUp:tG,getRoundMatchUps:lr,validDrawPositions:goe,validateScore:Wv};var Coe=Object.defineProperty,Kb=Object.getOwnPropertySymbols,Moe=Object.prototype.hasOwnProperty,Doe=Object.prototype.propertyIsEnumerable,zb=(t,e,r)=>e in t?Coe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,joe=(t,e)=>{for(var r in e||(e={}))Moe.call(e,r)&&zb(t,r,e[r]);if(Kb)for(var r of Kb(e))Doe.call(e,r)&&zb(t,r,e[r]);return t};function Rf({drawDefinition:t,policyDefinitions:e}){if(!t)return{error:pe};if(!e||typeof e!="object")return{error:ku};t.extensions||(t.extensions=[]);const{appliedPolicies:r}=ct({drawDefinition:t}),n=Object.keys(e).every(o=>r[o]?!1:(r[o]=e[o],!0));if(n){const i=et({element:t,extension:{name:Qi,value:r}});if(i.error)return i}return Qe({drawDefinition:t}),n?joe({},B):{error:pA}}const Roe={attachPolicies:Rf};var Foe=Object.defineProperty,Voe=Object.defineProperties,Loe=Object.getOwnPropertyDescriptors,Qb=Object.getOwnPropertySymbols,Boe=Object.prototype.hasOwnProperty,xoe=Object.prototype.propertyIsEnumerable,Jb=(t,e,r)=>e in t?Foe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Zb=(t,e)=>{for(var r in e||(e={}))Boe.call(e,r)&&Jb(t,r,e[r]);if(Qb)for(var r of Qb(e))xoe.call(e,r)&&Jb(t,r,e[r]);return t},Goe=(t,e)=>Voe(t,Loe(e));function ZD({excludedMatchUpStatuses:t=[],includeEventParticipants:e,includeQualifyingStage:r,finishingRoundLimit:n,policyDefinitions:o,roundNumberLimit:i,tournamentRecord:s,drawDefinition:a,matchUpsLimit:c,requirePlay:l,requireLoss:u,allEntries:d,winsLimit:p,event:v}){var f,m,g,h;if(!a)return{error:pe};const _=[ue,it];r&&_.push(Ie);const I=e?((f=Si({contextFilters:{stages:_},matchUpFilters:{matchUpTypes:[v.eventType]},tournamentRecord:s,inContext:!0,event:v}))==null?void 0:f.matchUps)||[]:((m=Er({contextFilters:{stages:_},matchUpFilters:{matchUpTypes:[v.eventType]},tournamentRecord:s,inContext:!0,drawDefinition:a}))==null?void 0:m.matchUps)||[],S=ms({stage:Nt,drawDefinition:a}).map(({participantId:W})=>W),y={},O={},b={},E={};o=o||ls({policyTypes:[dh],tournamentRecord:s,drawDefinition:a,event:v});const T=o[dh];t=t.length&&t||(T==null?void 0:T.excludedMatchUpStatuses)||[],e=e!==void 0?e:T==null?void 0:T.includeEventParticipants,d=d!==void 0?d:T==null?void 0:T.allEntries,n=n||(T==null?void 0:T.finishingRoundLimit),i=i||(T==null?void 0:T.roundNumberLimit),c=c||(T==null?void 0:T.matchUpsLimit),l===void 0&&(l=(T==null?void 0:T.requirePlay)!==void 0?T.requirePlay:!0),u===void 0&&(u=(T==null?void 0:T.requireLoss)!==void 0?T.requireLoss:!0),p=p||(T==null?void 0:T.winsLimit);for(const W of I){if(l&&![1,2].includes(W.winningSide)&&W.matchUpStatus!==gt||!isNaN(n)&&W.finishingRound>=n||!isNaN(i)&&W.finishingRound<=i)continue;const x=(g=W.sides)==null?void 0:g.find(({sideNumber:j})=>j===3-W.winningSide),K=(h=W.sides)==null?void 0:h.find(({sideNumber:j})=>j===W.winningSide);if(W.sides.forEach(j=>{var L;const F=(L=j==null?void 0:j.participant)==null?void 0:L.participantId;F&&(b[F]=j.participant,W.matchUpStatus===gt&&!l&&(O[F]=j.participant,y[F]||(y[F]=0),t.includes(W.matchUpStatus)||(y[F]+=1)))}),x!=null&&x.participant){const j=x.participant.participantId;O[j]=x.participant,y[j]||(y[j]=0),t.includes(W.matchUpStatus)||(y[j]+=1)}if(K!=null&&K.participant){const j=K.participant.participantId;E[j]||(E[j]=0),E[j]+=1,y[j]||(y[j]=0),t.includes(W.matchUpStatus)||(y[j]+=1)}}const N=(s==null?void 0:s.participants)&&!l&&!u&&d,w=N&&(e&&v?v.entries:a.entries).filter(W=>![Vo,Wr].includes(W.entryStatus)).map(({participantId:W})=>W),$=Object.keys(O),U=N?s==null?void 0:s.participants.filter(({participantId:W})=>w.includes(W)):u&&Object.values(O)||Object.values(b),A=W=>!u||$.includes(W),C=W=>!l||(y[W]||0)>=0,M=W=>isNaN(p)||(E[W]||0)<=p,D=W=>!c||y[W]<=c,V=W=>!S.includes(W),R=U.filter(({participantId:W})=>A(W)&&C(W)&&M(W)&&D(W)&&V(W)).map(W=>{var x;return Goe(Zb({},W),{individualParticipants:(x=W.individualParticipantIds)==null?void 0:x.map(K=>{var j;return(j=s.participants)==null?void 0:j.find(L=>L.participantId===K)})})});return Zb({eligibleParticipants:R,losingParticipantIds:$},B)}function koe({provisionalPositioning:t,drawDefinition:e,seedBlockInfo:r,structureId:n,event:o}){if(!e)return{error:pe,nextUnfilledDrawPositions:[]};if(!n)return{error:ur,nextUnfilledDrawPositions:[]};const i=Te({drawDefinition:e,structureId:n});if(i.error)return i;const{positionAssignments:s=[]}=St({structure:i.structure}),{unfilledPositions:a}=$d({provisionalPositioning:t,randomize:!0,drawDefinition:e,seedBlockInfo:r,structureId:n,event:o}),c=s.filter(l=>!l.participantId&&!l.bye&&!l.qualifier).map(l=>l.drawPosition);return a!=null&&a.length?{nextUnfilledDrawPositions:a}:{nextUnfilledDrawPositions:c}}function XD({tournamentParticipants:t,drawDefinition:e,event:r}){if(!e)return{error:pe};const n=wt({tournamentParticipants:t,inContext:!0,drawDefinition:e,event:r}),o=de(n.matchUps,!1,!0),i=Ve(o.reduce((a,c)=>a.concat(...c.sides.map(l=>l.participantId).filter(Boolean)),[])),s=Object.assign({},...i.map(a=>{const c=o.filter(l=>l.sides.map(d=>d.participantId).filter(Boolean).includes(a));return{[a]:c}}));return{participantIds:i,participantIdMatchUps:s}}function e2({byeAdvancements:t=!1,tournamentParticipants:e,drawDefinition:r}){if(!r)return{error:pe};const{participantIds:n,participantIdMatchUps:o}=XD({tournamentParticipants:e,drawDefinition:r}),i=n.map(s=>{const c=o[s].filter(p=>[_t,qe].includes(p.matchUpStatus)||p.winningSide),l=c.map(p=>{const v=p.sides.find(g=>g.bye),f=p.sides.find(g=>g.participantId===s).sideNumber;return(p.winningSide||t&&v&&f)===f?p.finishingPositionRange.winner:p.finishingPositionRange.loser}),u=p=>Math.abs(p[0]-p[1]),d=l.reduce((p,v)=>p&&u(p)<u(v)?p:v,void 0);return{[s]:{relevantMatchUps:c,finishingPositionRanges:l,finishingPositionRange:d}}});return Object.assign({},...i)}function Ff({finishingPosition:t,targetRoundNumber:e,drawDefinition:r,structureId:n,linkType:o}){const{links:i}=Gc({drawDefinition:r,structureId:n})||{},a=((i==null?void 0:i.target)||[]).filter(({linkType:l})=>l===o).filter(({target:l})=>!e||e===l.roundNumber).map(l=>{const u=l.source.structureId,{structure:d}=Te({structureId:u,drawDefinition:r});if(!(t&&d.finishingPosition!==t))return l}).filter(Boolean);return{sourceStructureIds:a.map(({source:l})=>l.structureId),relevantLinks:a}}function Woe({tournamentParticipants:t,returnParticipants:e,drawPosition:r,participant:n,drawId:o,event:i}){var s;const a=((s=i==null?void 0:i.entries)==null?void 0:s.filter(({entryStatus:c})=>[Wr,fs].includes(c)).map(({participantId:c})=>c))||[];if(a.length){const c=n.individualParticipantIds,l=e?t.filter(({participantId:p})=>a.includes(p)):void 0,u=e?t.filter(({participantId:p})=>c.includes(p)):void 0;return{validModifyAssignedPairAction:_e({payload:{participantId:n.participantId,replacementIndividualParticipantId:void 0,existingIndividualParticipantId:void 0,drawPosition:r,drawId:o},method:F3,availableIndividualParticipantIds:a,availableIndividualParticipants:l,existingIndividualParticipantIds:c,existingIndividualParticipants:u,type:Q1},!1,!1,!0)}}return{}}function qoe({tournamentParticipants:t=[],sourceStructuresComplete:e,possiblyDisablingAction:r,isWinRatioFedStructure:n,activeDrawPositions:o,positionAssignments:i,drawDefinition:s,drawPosition:a,structureId:c,structure:l,drawId:u,event:d}){var p,v,f,m,g;if(o.includes(a)||n&&!e)return{};const{sourceStructureIds:h,targetStructureIds:_}=((p=s.links)==null?void 0:p.reduce((y,O)=>{var b,E;const T=(b=O.source)==null?void 0:b.structureId,N=(E=O.target)==null?void 0:E.structureId;return y.sourceStructureIds.includes(T)||y.sourceStructureIds.push(T),y.targetStructureIds.includes(N)||y.targetStructureIds.push(N),y},{sourceStructureIds:[],targetStructureIds:[]}))||{},I=[];let P=((v=s.links)==null?void 0:v.filter(y=>{var O;return((O=y.target)==null?void 0:O.structureId)===l.structureId}))||[];for(const y of P){const O=(f=y==null?void 0:y.source)==null?void 0:f.structureId,{structure:b}=Te({structureId:O,drawDefinition:s}),E=(b==null?void 0:b.finishingPosition)===di&&((h==null?void 0:h.length)!==1||(_==null?void 0:_.length)!==1),T={};if(E){const{matchUps:U}=Ke({drawDefinition:s,structure:l,event:d}),{initialRoundNumber:A}=is({drawPosition:a,matchUps:U}),C=(m=s.links)==null?void 0:m.find(D=>{var V;return((V=D.target)==null?void 0:V.structureId)===(l==null?void 0:l.structureId)&&D.target.roundNumber===A}),M=(g=C==null?void 0:C.source)==null?void 0:g.roundNumber;T.roundNumbers=[M]}const{completedMatchUps:N}=kc({structureId:O,inContext:!0,matchUpFilters:T,drawDefinition:s}),w=i.map(U=>U.participantId).filter(Boolean);(N==null?void 0:N.filter(({matchUpType:U})=>(d==null?void 0:d.eventType)!==yt||U===yt).map(({winningSide:U,sides:A})=>A[1-(U-1)]).map(Ze).filter(U=>U&&!w.includes(U))).forEach(U=>{I.includes(U)||I.push(U)})}const S=t==null?void 0:t.filter(y=>I==null?void 0:I.includes(y.participantId));return S==null||S.forEach(y=>{const O=(s.entries||[]).find(b=>b.participantId===y.participantId);y.entryPosition=O==null?void 0:O.entryPosition}),I!=null&&I.length?{validLuckyLosersAction:{type:X1,method:j3,availableLuckyLosers:S,availableLuckyLoserParticipantIds:I,willDisableLinks:r,payload:{drawId:u,structureId:c,drawPosition:a}}}:{}}function Hoe({positionSourceStructureIds:t,unassignedParticipantIds:e,possiblyDisablingAction:r,provisionalPositioning:n,tournamentParticipants:o,isWinRatioFedStructure:i,positionAssignments:s,returnParticipants:a,appliedPolicies:c,drawDefinition:l,isByePosition:u,drawPosition:d,structureId:p,event:v}){var f,m,g;const{drawId:h}=l,_=[];let I,P,S=[];const y=(m=(f=c==null?void 0:c[fa])==null?void 0:f.validSeedPositions)==null?void 0:m.ignore;if(y||({unplacedSeedParticipantIds:I,unplacedSeedAssignments:P,unfilledPositions:S}=$d({provisionalPositioning:n,randomize:!0,drawDefinition:l,structureId:p,event:v})),S!=null&&S.length||(S=s.filter(O=>!O.participantId&&!O.bye&&!O.qualifier).map(O=>O.drawPosition)),u||_.push({payload:{drawId:h,structureId:p,drawPosition:d,isPositionAction:!0},willDisableLinks:r,method:B3,type:If}),i&&y){const O=s.map(w=>w.participantId).filter(Boolean),b={structureIds:t},{completedMatchUps:E}=gs({inContext:!0,matchUpFilters:b,drawDefinition:l}),T=Ve((g=(E||[]).filter(({matchUpType:w})=>(v==null?void 0:v.eventType)!==yt||w===yt))==null?void 0:g.map(({sides:w})=>w.map(Ze)).flat().filter(w=>w&&!O.includes(w))),N=a?o==null?void 0:o.filter(w=>T==null?void 0:T.includes(w.participantId)):void 0;return N==null||N.forEach(w=>{const $=(l.entries||[]).find(U=>U.participantId===w.participantId);w.entryPosition=$==null?void 0:$.entryPosition}),N!=null&&N.length&&_.push(_e({payload:{drawId:h,structureId:p,drawPosition:d},willDisableLinks:r,method:D_,type:Ys,availableParticipantIds:T,participantsAvailable:N})),{validAssignmentActions:_}}if(S.includes(d)||u){let O;if(P!=null&&P.length){const E=P.filter(T=>I==null?void 0:I.includes(T.participantId));E.sort(Yoe),O=E.map(T=>T.participantId)}else O=e;const b=a?o==null?void 0:o.filter(E=>O.includes(E.participantId)):void 0;b!=null&&b.length&&_.push(_e({payload:{drawId:h,structureId:p,drawPosition:d},willDisableLinks:r,method:D_,type:Ys,availableParticipantIds:O,participantsAvailable:b}))}return{validAssignmentActions:_}}function Yoe(t,e){return t.bye||Xs(t.seedValue)<Xs(e.seedValue)||t.seedValue&&!e.seedValue?-1:(t.seedNumber||0)-(e.seedNumber||0)}function Koe({drawPositionInitialRounds:t,tournamentParticipants:e,positionAssignments:r,returnParticipants:n,appliedPolicies:o,drawDefinition:i,drawPosition:s,structureId:a,drawId:c}){var l,u,d;const p=[],v=[],f=[],m=[],g=r.map(b=>b.participantId).filter(Boolean),h=o==null?void 0:o[lo],_=!(h!=null&&h.disableRoundRestrictions)&&t[s],I=h==null?void 0:h.requireCompletedStructures,{sourceStructureIds:P,relevantLinks:S}=Ff({targetRoundNumber:_,linkType:fo,drawDefinition:i,structureId:a})||{};P!=null&&P.length&&m.push(...P);const{sourceStructureIds:y,relevantLinks:O}=Ff({targetRoundNumber:_,linkType:po,drawDefinition:i,structureId:a})||{};y!=null&&y.length&&m.push(...y);for(const b of S){const E=(l=i.structures)==null?void 0:l.find(N=>N.structureId===b.source.structureId);if((E==null?void 0:E.stage)!==Ie)continue;const T=mi({structureId:b.source.structureId,drawDefinition:i});if(!I||T){const N=E.qualifyingRoundNumber,{matchUps:w}=Ke({matchUpFilters:{roundNumbers:[N]},afterRecoveryTimes:!1,tournamentParticipants:e,hasWinningSide:!0,inContext:!0,structure:E});for(const $ of w){const U=$.sides.find(C=>(C==null?void 0:C.sideNumber)===$.winningSide),A=$.matchUpStatus===qe&&((u=$.sides)==null?void 0:u.find(({participantId:C})=>C));if(U||A){const{participantId:C,participant:M}=U||A||{};C&&!g.includes(C)&&(M&&n&&v.push(M),p.push(C))}}}}for(const b of O){const E=(d=i.structures)==null?void 0:d.find(N=>N.structureId===b.source.structureId);if((E==null?void 0:E.stage)!==Ie)continue;const T=mi({structureId:b.source.structureId,drawDefinition:i});if(!I||T){const{positionAssignments:N}=Xe({structure:E}),w=N.map($=>{var U;const A=$.participantId,C=(U=Lt({element:$,name:Do}).extension)==null?void 0:U.value;return C?{participantId:A,groupOrder:C==null?void 0:C.groupOrder}:{}}).filter(({groupOrder:$,participantId:U})=>$===1&&!g.includes(U)).map(({participantId:$})=>$);if(p.push(...w),n){const $=e.filter(({participantId:U})=>w.includes(U));v.push(...$)}}}return p.length&&f.push(_e({payload:{qualifyingParticipantId:void 0,drawPosition:s,structureId:a,drawId:c},method:C3,type:zv,qualifyingParticipantIds:p,qualifyingParticipants:n?v:void 0})),{validAssignmentActions:f,sourceStructureIds:m}}var zoe=Object.defineProperty,Qoe=Object.defineProperties,Joe=Object.getOwnPropertyDescriptors,Xb=Object.getOwnPropertySymbols,Zoe=Object.prototype.hasOwnProperty,Xoe=Object.prototype.propertyIsEnumerable,eT=(t,e,r)=>e in t?zoe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,eie=(t,e)=>{for(var r in e||(e={}))Zoe.call(e,r)&&eT(t,r,e[r]);if(Xb)for(var r of Xb(e))Xoe.call(e,r)&&eT(t,r,e[r]);return t},tie=(t,e)=>Qoe(t,Joe(e));function rie({onlyAssignedPositions:t=!0,possiblyDisablingAction:e,tournamentParticipants:r,inactiveDrawPositions:n,activeDrawPositions:o,positionAssignments:i,returnParticipants:s,byeDrawPositions:a,drawDefinition:c,isByePosition:l,drawPosition:u,structureId:d,structure:p,drawId:v,event:f}){if(o.includes(u))return{};const m=T=>!t||T.participantId||T.qualifier||T.bye,g=n==null?void 0:n.filter(T=>T!==u&&!(l&&a.includes(T))),h=(i==null?void 0:i.filter(T=>m(T)&&(g==null?void 0:g.includes(T.drawPosition))))||[],_=h.map(({drawPosition:T})=>T),{matchUps:I}=Ke({afterRecoveryTimes:!1,inContext:!0,drawDefinition:c,structure:p,event:f}),P=I.filter(({drawPositions:T})=>Gt(T,_)),S=Object.assign({},...P.map(T=>{var N;return(N=T.sides)==null?void 0:N.filter(({sourceDrawPositionRange:w})=>w).map(({drawPosition:w,sourceDrawPositionRange:$})=>({[w]:$}))}).flat()),y=h.map(T=>T.participantId).filter(Boolean),O=(r||[]).filter(T=>y.includes(T.participantId)),b=Object.assign({},...O.map(T=>({[T.participantId]:T}))),E=h.map(T=>{const N=b==null?void 0:b[T.participantId],w=S[T.drawPosition];return _e(tie(eie({},T),{participant:s?de(N,!1,!0):void 0,sourceDrawPositionRange:w}))});return E.length?{validSwapAction:{payload:{drawId:v,structureId:d,drawPositions:[u]},willDisableLinks:e,method:R3,type:eC,availableAssignments:E}}:{}}function t2(t){const{policyDefinitions:e,tournamentParticipants:r=[],returnParticipants:n=!0,provisionalPositioning:o,tournamentRecord:i,drawDefinition:s,drawPosition:a,event:c}=t;if(!c)return{error:Re};if(!s)return{error:pe};if(!t.structureId)return{error:ur};let l=Te({structureId:t.structureId,drawDefinition:s});if(l.error)return l;const u=l.containingStructure||l.structure,d=u.structureId;if(l=Yc({tournamentRecord:i,drawDefinition:s,structureId:d}),a===void 0&&!l.isAdHoc)return{error:hc};if(l.isAdHoc)return Fm(t);if(l.error)return l;const{drawPositionInitialRounds:p,qualifyingDrawPositions:v,inactiveDrawPositions:f,activeDrawPositions:m,byeDrawPositions:g}=l,{appliedPolicies:h}=ct({tournamentRecord:i,drawDefinition:s,structure:u,event:c});Object.assign(h,e||{});const{actionsPolicy:_,enabledStructures:I,actionsDisabled:P}=BM({actionType:jl,appliedPolicies:h,drawDefinition:s,structure:u}),S=(_==null?void 0:_.activePositionOverrides)||[],{sourceStructureIds:y}=Ff({finishingPosition:Ia,targetRoundNumber:1,linkType:po,drawDefinition:s,structureId:d})||{};let O;y!=null&&y.length&&(O=y.reduce((H,Q)=>mi({structureId:Q,drawDefinition:s})&&H,!0));const b=y.length,E=y.length&&!O,{policyActions:T}=xM({enabledStructures:I,drawDefinition:s,structure:u}),N=![Ie,ue].includes(u.stage)||u.stageSequence!==1,{drawId:w}=s,$=[],{assignedPositions:U,positionAssignments:A}=St({structure:u}),C=U.find(H=>H.drawPosition===a),M=A.map(H=>H.drawPosition);if(!(M!=null&&M.includes(a)))return{error:sa};const{stage:D,stageSequence:V}=u,R=[D];D===Et&&R.push(ue),D===ue&&R.push(Et);const W=ms({entryStatuses:vs,provisionalPositioning:o,drawDefinition:s,stageSequence:V,structureId:d,stages:R}),x=Yd({drawDefinition:s,stages:R}),K=W.filter(H=>!x.includes(H.participantId)).map(H=>H.participantId),j=g.includes(a),L=v.includes(a),F=m.includes(a);if(P)return{info:"Actions Disabled for structure",isByePosition:j,isActiveDrawPosition:F,isDrawPosition:!0,hasPositionAssigned:!!C,validActions:[]};if(ir({policyActions:T,action:Ys})&&!F&&!E&&(!C||j)){const{validAssignmentActions:H}=Hoe({positionSourceStructureIds:y,unassignedParticipantIds:K,possiblyDisablingAction:N,isWinRatioFedStructure:b,tournamentParticipants:r,positionAssignments:A,activeDrawPositions:m,returnParticipants:n,appliedPolicies:h,drawDefinition:s,isByePosition:j,drawPosition:a,structureId:d,structure:u,event:c});H==null||H.forEach(Q=>$.push(Q))}if(ir({policyActions:T,action:zv})){const{validAssignmentActions:H}=Koe({drawPositionInitialRounds:p,isWinRatioFedStructure:b,tournamentParticipants:r,isQualifierPosition:L,positionAssignments:A,activeDrawPositions:m,returnParticipants:n,appliedPolicies:h,drawDefinition:s,drawPosition:a,structureId:d,structure:u,drawId:w});H==null||H.forEach(Q=>$.push(Q))}const{participantId:q}=C||{},G=q&&r.find(H=>H.participantId===q);if(C){ir({policyActions:T,action:j_})&&!F&&($.push({type:j_,method:C_,payload:{drawId:w,structureId:d,drawPosition:a},willDisableLinks:N}),j||$.push({type:Z1,method:M3,payload:{drawId:w,structureId:d,drawPosition:a},willDisableLinks:N}),ir({policyActions:T,action:If})&&!j&&$.push({type:If,method:C_,payload:{drawId:w,structureId:d,drawPosition:a,replaceWithBye:!0},willDisableLinks:N}));const H=u.stage===Ie||u.stage===ue&&u.stageSequence===1;if(!j&&$O({activePositionOverrides:S,activeDrawPositions:m,action:Rs})&&ir({policyActions:T,action:Rs})&&uu({drawDefinition:s,structureId:d,drawPosition:a})&&H){const{seedAssignments:Q}=cn({drawDefinition:s,structure:u,event:c}),{seedNumber:z,seedValue:Y}=Q.find(J=>J.participantId===q)||{};$.push({type:Rs,method:x3,participant:G,seedNumber:z,payload:{drawId:w,structureId:d,participantId:q,seedValue:Y}})}if(!j&&$O({activePositionOverrides:S,activeDrawPositions:m,action:Cl})&&ir({policyActions:T,action:Cl})&&uu({drawDefinition:s,structureId:d,drawPosition:a})&&H){const{seedAssignments:Q}=cn({drawDefinition:s,structure:u,event:c}),{seedNumber:z}=Q.find(Y=>Y.participantId===q)||{};$.push({type:Cl,method:L3,participant:G,seedNumber:z,payload:{drawId:w,structureId:d,participantId:q}})}if(!j&&q){if(ir({policyActions:T,action:Ks})){const Q={type:Ks,method:z1,participant:G,payload:{drawId:w,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};$.push(Q)}if(ir({policyActions:T,action:ou})){const Q={type:ou,method:V3,participant:G,payload:{participantId:q,otherName:void 0}};$.push(Q)}}if(ir({policyActions:T,action:eC})){const{validSwapAction:Q}=rie({possiblyDisablingAction:N,tournamentParticipants:r,inactiveDrawPositions:f,activeDrawPositions:m,positionAssignments:A,returnParticipants:n,byeDrawPositions:g,drawDefinition:s,isByePosition:j,drawPosition:a,structureId:d,structure:u,drawId:w});Q&&$.push(Q)}}if(ir({policyActions:T,action:J1})&&!E){const{validAlternatesAction:H}=y9({possiblyDisablingAction:N,tournamentParticipants:r,positionAssignments:A,activeDrawPositions:m,returnParticipants:n,appliedPolicies:h,drawDefinition:s,drawPosition:a,validActions:$,structureId:d,structure:u,drawId:w,event:c});H&&$.push(H)}if(ir({policyActions:T,action:X1})&&!E){const{validLuckyLosersAction:H}=qoe({sourceStructuresComplete:O,possiblyDisablingAction:N,isWinRatioFedStructure:b,tournamentParticipants:r,activeDrawPositions:m,positionAssignments:A,returnParticipants:n,appliedPolicies:h,drawDefinition:s,drawPosition:a,structureId:d,structure:u,drawId:w});H&&$.push(H)}if((G==null?void 0:G.participantType)===we&&ir({policyActions:T,action:Q1})){const{validModifyAssignedPairAction:H}=Woe({tournamentParticipants:r,positionAssignment:C,returnParticipants:n,drawDefinition:s,drawPosition:a,participant:G,structureId:d,structure:u,drawId:w,event:c});H&&$.push(H)}return{hasPositionAssigned:!!C,isActiveDrawPosition:F,isDrawPosition:!0,isByePosition:j,validActions:$}}function nie(t){return Object.assign(t,{inContext:!0}),gs(t)}function oie(t){const{structure:e}=Te(t);return Object.assign(t,{structure:e,inContext:!0}),Ke(t)}function iie(t){return Object.assign(t,{inContext:!0}),wt(t)}const sie={allPlayoffPositionsFilled:AC,isCompletedStructure:mi,getAllStructureMatchUps:Ke,getStructureMatchUps:kc,allStructureMatchUps:oie,allDrawMatchUps:iie,drawMatchUps:nie,getEliminationDrawSize:rg,getParticipantIdMatchUps:XD,getParticipantIdFinishingPositions:e2,getEligibleVoluntaryConsolationParticipants:ZD,structureActions:TH,matchUpActions:Fm,positionActions:t2,getStructureSeedAssignments:cn,getNextUnfilledDrawPositions:koe,getExitProfiles:Vv,getValidGroupSizes:vm,getSeedingThresholds:GH,getSeedBlocks:wd,getSeedGroups:Nd,getMatchUpContextIds:xW,getMatchUpParticipantIds:Bv,getMatchUpScheduleDetails:$v,generateTieMatchUpScore:Lc,matchUpDuration:FU,credits:Vd};var aie=Object.defineProperty,tT=Object.getOwnPropertySymbols,cie=Object.prototype.hasOwnProperty,lie=Object.prototype.propertyIsEnumerable,rT=(t,e,r)=>e in t?aie(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,uie=(t,e)=>{for(var r in e||(e={}))cie.call(e,r)&&rT(t,r,e[r]);if(tT)for(var r of tT(e))lie.call(e,r)&&rT(t,r,e[r]);return t};function r2({validation:t=!0,tournamentRecord:e,drawDefinition:r,participantId:n,structureId:o,seedValue:i,event:s}){if(!r)return{error:pe};if(!o)return{error:ur};const{structure:a}=Te({drawDefinition:r,structureId:o});if(!a)return{error:xr};if(!(!t||Pt(i)||[void 0,""].includes(i)||typeof i=="string"&&i.split("-").every(p=>Pt(p)&&p>0)))return{error:Z};const{seedAssignments:l}=cn({drawDefinition:r,structure:a,event:s}),u=l.map(p=>p.seedNumber),d=l.find(p=>p.participantId===n);if(d){const p=typeof i=="string"?i.includes("-")&&i.split("-").map(v=>parseInt(v)).join("-")||i>0&&parseInt(i)||"":i>0&&parseInt(i)||"";d.seedValue=p}else{const p=Math.max(0,...u)+1;a.seedAssignments.push({seedNumber:p,seedValue:i,participantId:n})}return t1({tournamentId:e==null?void 0:e.tournamentId,structureIds:[o],eventId:s==null?void 0:s.eventId,drawDefinition:r,structure:a}),uie({},B)}var die=Object.defineProperty,nT=Object.getOwnPropertySymbols,pie=Object.prototype.hasOwnProperty,fie=Object.prototype.propertyIsEnumerable,oT=(t,e,r)=>e in t?die(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,vie=(t,e)=>{for(var r in e||(e={}))pie.call(e,r)&&oT(t,r,e[r]);if(nT)for(var r of nT(e))fie.call(e,r)&&oT(t,r,e[r]);return t};function mie({autoEntryPositions:t=!0,drawDefinition:e,participantId:r,stages:n}){return e?r?Yd({drawDefinition:e,stages:n}).includes(r)?{error:la}:(e!=null&&e.entries&&(e.entries=e.entries.filter(s=>s.participantId!==r)),t&&(e.entries=Vr({entries:e.entries})),Qe({drawDefinition:e}),vie({},B)):{error:It}:{error:pe}}const gie={setStageAlternatesCount:$X,setStageWildcardsCount:AX,setStageQualifiersCount:zm,modifySeedAssignment:r2,setStageDrawSize:fc,addDrawEntries:CD,addDrawEntry:Df,removeEntry:mie,assignSeed:ss},hie={generateQualifyingLink:ra},_ie=()=>({matchUpType:void 0,drawName:void 0,drawId:void 0,structures:[],entries:[],links:[]}),Iie=["drawId","structures"];function iT(t,e=!0){return t?typeof t!="object"?{error:Xn}:t.drawId?Pie(t)?e?de(t):t:{error:Bi}:{error:Mr,method:"setState"}:{error:pe}}function Pie(t){const e=Object.keys(t);return Iie.reduce((r,n)=>e.includes(n)?r:!1,!0)}function n2({drawId:t=ke(),matchUpType:e,drawType:r}={}){const n=_ie();return Object.assign(n,{drawId:t,drawType:r,matchUpType:e})}var yie=Object.defineProperty,Oie=Object.defineProperties,Sie=Object.getOwnPropertyDescriptors,sT=Object.getOwnPropertySymbols,bie=Object.prototype.hasOwnProperty,Tie=Object.prototype.propertyIsEnumerable,aT=(t,e,r)=>e in t?yie(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ol=(t,e)=>{for(var r in e||(e={}))bie.call(e,r)&&aT(t,r,e[r]);if(sT)for(var r of sT(e))Tie.call(e,r)&&aT(t,r,e[r]);return t},cT=(t,e)=>Oie(t,Sie(e));let jr,lT=[];const rPe=function(){const t={getState:({convertExtensions:o,removeExtensions:i}={})=>({drawDefinition:de(jr,o,!1,i)}),version:()=>oo(),reset:()=>(jr=void 0,Ol({},B)),newDrawDefinition:({drawId:o,drawType:i}={})=>(jr=n2({drawId:o,drawType:i}),Object.assign({drawId:jr.drawId,drawDefinition:de(jr)},B)),setDrawDescription:({description:o}={})=>jr?(jr.description=o,Qe({drawDefinition:jr}),Object.assign({drawId:jr.drawId},B)):{error:pe}};function e(o){return o!=null&&o.error?(t.error=o.error,t.success=!1):(t.error=void 0,t.success=!0,jr=o,t.drawId=o.drawId),t}return r([hie,sie,A1,gie,Roe,Uoe,Xne,Pre]),t.devContext=o=>(Ls(o),t),t.setParticipants=(o=[])=>(lT=o,t),t.setState=(o,i,s)=>{Yi(i,s);const a=iT(o);return e(a)},t;function r(o){o.forEach(i=>{Object.keys(i).forEach(s=>{t[s]=a=>{if(Ct())return n({params:a,governor:i,governorMethod:s});try{return n({params:a,governor:i,governorMethod:s})}catch(c){const l=c.toString();console.log("ERROR",{params:JSON.stringify(a),drawId:jr==null?void 0:jr.drawId,method:s,error:l})}}})})}function n({params:o,governor:i,governorMethod:s}){delete t.success,delete t.error;const a=(o==null?void 0:o.rollbackOnError)&&de(jr,!1,!0),c={};o=cT(Ol(Ol({},o),c),{tournamentParticipants:lT,drawDefinition:jr});const l=i[s](o);if(l!=null&&l.error)return a&&iT(a),cT(Ol({},l),{rolledBack:!!a});const u=(l==null?void 0:l.success)&&(o==null?void 0:o.delayNotify)!==!0&&(o==null?void 0:o.doNotNotify)!==!0;return u&&vi(),(u||!(l!=null&&l.success)||o!=null&&o.doNotNotify)&&ii(),l}}();var Eie=Object.defineProperty,uT=Object.getOwnPropertySymbols,wie=Object.prototype.hasOwnProperty,Nie=Object.prototype.propertyIsEnumerable,dT=(t,e,r)=>e in t?Eie(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,$ie=(t,e)=>{for(var r in e||(e={}))wie.call(e,r)&&dT(t,r,e[r]);if(uT)for(var r of uT(e))Nie.call(e,r)&&dT(t,r,e[r]);return t};function oa({tieFormat:t,orderMap:e}){const r=ln(t);return r.collectionDefinitions.forEach(n=>{const o=e[n.collectionId];o&&(n.collectionOrder=o)}),r.collectionDefinitions.sort((n,o)=>n.collectionOrder-o.collectionOrder),r}function o2({tournamentRecord:t,drawDefinition:e,structureId:r,matchUpId:n,orderMap:o,eventId:i,matchUp:s,event:a}){if(typeof o!="object")return{error:Z,orderMap:o};if(i&&(a!=null&&a.tieFormat))pT({tournamentRecord:t,event:a,orderMap:o});else if(n){const c=e&&nt({drawDefinition:e,matchUpId:n});if(c!=null&&c.error)return c;if(s=c.matchUp,!s)return{error:wr};s!=null&&s.tieFormat&&(s.tieFormat=oa({tieFormat:s.tieFormat,orderMap:o}),ze({tournamentId:t==null?void 0:t.tournamentId,eventId:a==null?void 0:a.eventId,drawDefinition:e,matchUp:s}))}else if(r){const c=Te({drawDefinition:e,structureId:r});if(c.error)return c;const l=c.structure;if(l!=null&&l.tieFormat)l.tieFormat=oa({tieFormat:l.tieFormat,orderMap:o}),i2({eventId:a==null?void 0:a.eventId,tournamentRecord:t,drawDefinition:e,structure:l,orderMap:o}),Qe({drawDefinition:e,structureIds:[l.structureId]});else if(e.tieFormat)Vf({structureIds:[r],tournamentRecord:t,drawDefinition:e,orderMap:o,event:a});else if(a!=null&&a.tieFormat)pT({structureIds:[r],tournamentRecord:t,orderMap:o,event:a});else return{error:Ht}}else if(e!=null&&e.tieFormat)Vf({tournamentRecord:t,drawDefinition:e,orderMap:o,event:a});else return{error:Ht};return $ie({},B)}function pT({tournamentRecord:t,structureIds:e,orderMap:r,event:n}){const o=oa({tieFormat:n.tieFormat,orderMap:r});e!=null&&e.length||(n.tieFormat=o);for(const i of n.drawDefinitions||[])Vf({tournamentRecord:t,drawDefinition:i,structureIds:e,orderMap:r,event:n})}function Vf({tournamentRecord:t,drawDefinition:e,structureIds:r,orderMap:n,event:o}){const i=e.tieFormat||o.tieFormat,s=oa({tieFormat:i,orderMap:n});r!=null&&r.length||(e.tieFormat=s);const a=[];for(const c of e.structures||[])r!=null&&r.length&&!r.includes(c.structureId)||((c.tieFormat||r!=null&&r.includes(c.structureId))&&(c.tieFormat=oa({tieFormat:c.tieFormat||e.tieFormat||o.tieFormat,orderMap:n})),i2({eventId:o==null?void 0:o.eventId,tournamentRecord:t,drawDefinition:e,structure:c,orderMap:n}),a.push(c.structureId));Qe({drawDefinition:e,structureIds:a})}function i2({tournamentRecord:t,drawDefinition:e,structure:r,orderMap:n,eventId:o}){var i;const s=(i=Ke({matchUpFilters:{matchUpTypes:[We]},structure:r}))==null?void 0:i.matchUps;for(const a of s)a.tieFormat&&(a.tieFormat=oa({tieFormat:a.tieFormat,orderMap:n}),ze({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,eventId:o,matchUp:a}))}var Aie=Object.defineProperty,Uie=Object.defineProperties,Cie=Object.getOwnPropertyDescriptors,fT=Object.getOwnPropertySymbols,Mie=Object.prototype.hasOwnProperty,Die=Object.prototype.propertyIsEnumerable,vT=(t,e,r)=>e in t?Aie(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,jie=(t,e)=>{for(var r in e||(e={}))Mie.call(e,r)&&vT(t,r,e[r]);if(fT)for(var r of fT(e))Die.call(e,r)&&vT(t,r,e[r]);return t},Rie=(t,e)=>Uie(t,Cie(e));function $a({drawDefinition:t,structureId:e,matchUpId:r,structure:n,matchUp:o,eventId:i,event:s}){let a;if(e=(n==null?void 0:n.structureId)||e,r=(o==null?void 0:o.matchUpId)||r,(r||e)&&!t)return{error:pe};if(i&&s)a=Eo(s);else if(r){if(!o||!n){const c=nt({drawDefinition:t,matchUpId:r});if(c.error)return c;n||(n=c.structure),o||(o=c.matchUp)}a=Va({item:o,drawDefinition:t,structure:n,event:s})||Va({item:n,drawDefinition:t,structure:n,event:s})||Eo(t)||Eo(s)}else if(t&&e){if(!n){const c=Te({drawDefinition:t,structureId:e});if(c.error)return c;n=c==null?void 0:c.structure}a=Va({item:n,drawDefinition:t,structure:n,event:s})||Eo(t)||Eo(s)}else a=Eo(t)||Eo(s);return a?Rie(jie({},B),{tieFormat:a,matchUp:o,structure:n}):{error:Gu}}function zd({drawDefinition:t,auditData:e}){const{extension:r}=_r({name:Xi,element:t}),n={name:Xi,value:Array.isArray(r==null?void 0:r.value)?r.value.concat(e):[e]};et({element:t,extension:n})}var Fie=Object.defineProperty,Vie=Object.defineProperties,Lie=Object.getOwnPropertyDescriptors,wu=Object.getOwnPropertySymbols,s2=Object.prototype.hasOwnProperty,a2=Object.prototype.propertyIsEnumerable,mT=(t,e,r)=>e in t?Fie(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Bie=(t,e)=>{for(var r in e||(e={}))s2.call(e,r)&&mT(t,r,e[r]);if(wu)for(var r of wu(e))a2.call(e,r)&&mT(t,r,e[r]);return t},xie=(t,e)=>Vie(t,Lie(e)),Gie=(t,e)=>{var r={};for(var n in t)s2.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&wu)for(var n of wu(t))e.indexOf(n)<0&&a2.call(t,n)&&(r[n]=t[n]);return r};function sg({updateInProgressMatchUps:t=!0,tieFormatComparison:e,tournamentRecord:r,drawDefinition:n,tieFormatName:o,collectionId:i,structureId:s,matchUpId:a,eventId:c,matchUp:l,event:u}){var d,p,v,f,m;let g=!l&&$a({drawDefinition:n,structureId:s,matchUpId:a,eventId:c,event:u});if(g.error)return g;const{structure:h}=g;l=l||g.matchUp;const _=g.tieFormat,I=ln(_);if(g=cr({tieFormat:I}),g.error)return g;const P=(d=I==null?void 0:I.collectionDefinitions)==null?void 0:d.find(A=>A.collectionId===i);if(!P)return{error:Ht,collectionId:i};const S="removeCollectionDefinition";I.collectionDefinitions=I.collectionDefinitions.filter(A=>A.collectionId!==i),P.collectionGroupNumber&&(I.collectionDefinitions=I.collectionDefinitions.map(A=>Gie(A,["collectionGroupNumber"])),I.collectionGroups=I.collectionGroups.filter(({groupNumber:A})=>A!==P.collectionGroupNumber));const{aggregateValue:y,valueGoal:O}=Pa(I);I.winCriteria=_e({aggregateValue:y,valueGoal:O});const b=_.winCriteria.valueGoal,E=_.winCriteria.aggregateValue;(b&&b!==O||y&&!E)&&(o?I.tieFormatName=o:delete I.tieFormatName);let T=[];a&&l?T=[l]:s&&h?T=(p=Ke({matchUpFilters:{matchUpTypes:[We]},structure:h}))==null?void 0:p.matchUps:n?T=(v=Er({matchUpFilters:{matchUpTypes:[We]},drawDefinition:n}))==null?void 0:v.matchUps:u&&(T=(f=Si({matchUpFilters:{matchUpTypes:[We]},drawDefinition:n}))==null?void 0:f.matchUps);const N=(T||[]).filter(A=>{var C;const D=A.tieMatchUps.filter(R=>R.collectionId===i).some(At),V=e&&A.tieFormat?(C=_d({descendant:A.tieFormat,ancestor:I}))==null?void 0:C.different:!1;return t&&!D||!A.winningSide&&A.matchUpStatus!==_t&&(t||A.matchUpStatus!==dn&&!At(A)&&!V)});if(!N.length)return{error:Pc};if(a&&l&&t){const A=l.tieMatchUps.filter(C=>C.collectionId===i);for(const C of A){let M=Jc({matchUpId:C.matchUpId,tieMatchUpId:l.matchUpId,winningSide:void 0,removeScore:!0,tournamentRecord:r,drawDefinition:n,event:u});if(M.error||(M=nt({drawDefinition:n,matchUpId:a}),M.error))return M;l=M.matchUp}}const w=[];for(const A of N){for(const C of(A==null?void 0:A.sides)||[])C.lineUp=(C.lineUp||[]).map(M=>({participantId:M.participantId,collectionAssignments:((M==null?void 0:M.collectionAssignments)||[]).filter(D=>D.collectionId!==i)}));if(A.tieMatchUps=(A.tieMatchUps||[]).filter(C=>{const M=C.collectionId===i;return M&&w.push(C.matchUpId),!M}),A.tieFormat&&(A.tieFormat=ln(I)),t){const C=to({matchUpId:A.matchUpId,exitWhenNoValues:!0,tournamentRecord:r,drawDefinition:n,event:u});if(C.error)return C}ze({tournamentId:r==null?void 0:r.tournamentId,eventId:u==null?void 0:u.eventId,drawDefinition:n,context:S,matchUp:A})}w.length&&Oi({tournamentId:r==null?void 0:r.tournamentId,matchUpIds:w,eventId:u==null?void 0:u.eventId,drawDefinition:n});const $=_e(I);if(g=cr({tieFormat:$}),g.error)return g;if(c)u.tieFormat=$;else if(a)l.tieFormat=$;else if(h)h.tieFormat=$;else if(n)n.tieFormat=$;else if(!l||!n)return{error:pe};Qe({drawDefinition:n,eventId:u==null?void 0:u.eventId});const{appliedPolicies:U}=ct({tournamentRecord:r});if((m=U==null?void 0:U.audit)!=null&&m[Xi]){const A=_e({drawId:n==null?void 0:n.drawId,action:S,collectionId:i,structureId:s,matchUpId:a,eventId:c});zd({drawDefinition:n,auditData:A})}return xie(Bie({},B),{tieFormat:$,targetMatchUps:N,deletedMatchUpIds:w})}function Nu({matchUp:t,updateInProgressMatchUps:e}){return!t.winningSide&&![Rt].includes(t.matchUpStatus)&&(e||t.matchUpStatus!==dn&&!At(t))}var kie=Object.defineProperty,Wie=Object.defineProperties,qie=Object.getOwnPropertyDescriptors,gT=Object.getOwnPropertySymbols,Hie=Object.prototype.hasOwnProperty,Yie=Object.prototype.propertyIsEnumerable,hT=(t,e,r)=>e in t?kie(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Kie=(t,e)=>{for(var r in e||(e={}))Hie.call(e,r)&&hT(t,r,e[r]);if(gT)for(var r of gT(e))Yie.call(e,r)&&hT(t,r,e[r]);return t},zie=(t,e)=>Wie(t,qie(e));function Bp(t,e){const r=Object.keys(t);return Dt(r,Object.keys(e)).length===r.length}function Qie({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:r,structure:n,tieFormat:o,eventId:i,matchUp:s,event:a}){var c;const l="updateTieFormat";let u=0,d=0;const p=o==null?void 0:o.collectionDefinitions.reduce((_,I)=>(_[I.collectionId]=(_[I.collectionId]||0)+I.matchUpCount,_),{}),v=({tieFormat:_})=>{const I=_==null?void 0:_.collectionDefinitions.reduce((P,S)=>(P[S.collectionId]=(P[S.collectionId]||0)+S.matchUpCount,P),{});return Bp(p,I)},{drawDefaultTieFormat:f,eventDefaultTieFormat:m}=$a({drawDefinition:r,event:a});if(a&&i){for(const _ of a.drawDefinitions||[])g({drawDefinition:_});a.tieFormat=o,d+=1}else if(s){if(!s.tieMatchUps)return k({result:{error:Gr},stack:l});const _=fr((c=s.tieMatchUps)==null?void 0:c.map(({collectionId:I})=>I));if(Bp(p,_))if(Nu({matchUp:s,updateInProgressMatchUps:t}))s.tieFormat=o,d+=1;else return k({result:{error:gA},info:"matchUp is IN_PROGRESS or COMPLETE"});else return k({context:{collectionMap:p,matchUpMap:_},result:{error:Xo},info:"on matchUp",stack:l});ze({tournamentId:e==null?void 0:e.tournamentId,eventId:a==null?void 0:a.eventId,context:l,drawDefinition:r,matchUp:s})}else if(n){const I=h({inheritedTieFormat:f||m,structure:n});u+=I,n.tieFormat=o,d+=1,Qe({structureIds:[n.structureId],eventId:a==null?void 0:a.eventId,drawDefinition:r})}else if(r)g({drawDefinition:r}),r.tieFormat=o,d+=1;else return{error:pe};return zie(Kie({},B),{modifiedCount:d,modifiedStructuresCount:u,tieFormat:o});function g({drawDefinition:_}){const I=[];for(const P of _.structures||[]){if(P.tieFormat)continue;const y=h({inheritedTieFormat:m,structure:P});y&&(u+=y,I.push(P.structureId))}return Qe({structureIds:I,eventId:a==null?void 0:a.eventId,drawDefinition:_}),I.length}function h({inheritedTieFormat:_,structure:I}){var P,S;let y=0;const O=((P=Ke({matchUpFilters:{matchUpTypes:[We]},structure:I}))==null?void 0:P.matchUps)||[];for(const b of O){let E=!1;const T=fr((S=b.tieMatchUps)==null?void 0:S.map(({collectionId:N})=>N));if(Bp(p,T))b.tieFormat&&v(b)&&Nu({matchUp:b,updateInProgressMatchUps:t})&&(b.tieFormat=ln(o),E=!0);else if(_)b.tieFormat=_,E=!0;else return k({result:{error:Gu},stack:l});E&&(y+=1,ze({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:r,context:l,eventId:i,matchUp:b}))}return y}}var _T=Object.getOwnPropertySymbols,Jie=Object.prototype.hasOwnProperty,Zie=Object.prototype.propertyIsEnumerable,Xie=(t,e)=>{var r={};for(var n in t)Jie.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&_T)for(var n of _T(t))e.indexOf(n)<0&&Zie.call(t,n)&&(r[n]=t[n]);return r};function ag({updateInProgressMatchUps:t=!1,tournamentRecord:e,collectionOrder:r,collectionName:n,drawDefinition:o,matchUpFormat:i,tieFormatName:s,matchUpCount:a,collectionId:c,matchUpType:l,structureId:u,matchUpId:d,category:p,eventId:v,gender:f,event:m,collectionValueProfile:g,collectionValue:h,matchUpValue:_,scoreValue:I,setValue:P}){var S;if(i&&!Br(i))return{error:Z};if(n&&typeof n!="string")return{error:Z};if(f&&!Object.values(ZU).includes(f))return{error:Z};if(p&&typeof p!="object")return{error:Z};const y="modifyCollectionDefinition",O={collectionValueProfile:g,collectionValue:h,matchUpValue:_,scoreValue:I,setValue:P};if(!Object.values(O).filter(Boolean).length&&!r&&!n&&!a&&!i)return k({result:{error:Se},stack:y});if(Object.values(O).filter(Boolean).length>1)return k({result:{error:Z,info:"Only one value assignment allowed per collectionDefinition"},stack:y});let b=$a({drawDefinition:o,structureId:u,matchUpId:d,eventId:v,event:m});if(b.error)return k({result:b,stack:y});const{matchUp:E,structure:T,tieFormat:N}=b,w=ln(N),$=w.collectionDefinitions.find(R=>R.collectionId===c);if(!$)return k({result:{error:Ht},stack:y});const U=h||_||I||P;if(U||g){if(U){if(!lt(U))return{error:Z,value:U}}else if(g){const R=xA({matchUpCount:$.matchUpCount,collectionValueProfile:g});if(R.errors)return k({result:{error:Z,info:R.errors},stack:y})}$.collectionValue=void 0,$.matchUpValue=void 0,$.scoreValue=void 0,$.setValue=void 0,Object.assign($,O)}if((I||P)&&$.collectionGroupNumber){const R=$.collectionGroupNumber;w.collectionDefinitions=w.collectionDefinitions.map(W=>{const x=W,{collectionGroupNumber:K}=x,j=Xie(x,["collectionGroupNumber"]);return K===R?j:W}),w.collectionGroups=w.collectionGroups.filter(({groupNumber:W})=>W!==R)}const{aggregateValue:A,valueGoal:C}=Pa(w);w.winCriteria=_e({aggregateValue:A,valueGoal:C});const M=N.winCriteria.valueGoal,D=N.winCriteria.aggregateValue;(M&&M!==C||A&&!D)&&delete w.tieFormatName,s&&(w.tieFormatName=s),r&&($.collectionOrder=r),n&&($.collectionName=n),i&&($.matchUpFormat=i),l&&($.matchUpType=l),p&&($.category=p),f&&($.gender=f);const V=_e(w);if(b=cr({tieFormat:V}),b.error)return k({result:b,stack:y});if(b=Qie({tieFormat:V,updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:o,structureId:u,structure:T,eventId:v,matchUp:E,event:m}),!b.error){const{appliedPolicies:R}=ct({tournamentRecord:e});if((S=R==null?void 0:R.audit)!=null&&S[Xi]){const W=_e({drawId:o==null?void 0:o.drawId,collectionDefinition:$,action:y,structureId:u,matchUpId:d,eventId:v});zd({drawDefinition:o,auditData:W})}}return k({result:b,stack:y})}var ese=Object.defineProperty,tse=Object.defineProperties,rse=Object.getOwnPropertyDescriptors,IT=Object.getOwnPropertySymbols,nse=Object.prototype.hasOwnProperty,ose=Object.prototype.propertyIsEnumerable,PT=(t,e,r)=>e in t?ese(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ise=(t,e)=>{for(var r in e||(e={}))nse.call(e,r)&&PT(t,r,e[r]);if(IT)for(var r of IT(e))ose.call(e,r)&&PT(t,r,e[r]);return t},sse=(t,e)=>tse(t,rse(e));function cg({updateInProgressMatchUps:t=!0,collectionDefinition:e,tournamentRecord:r,drawDefinition:n,tieFormatName:o,structureId:i,matchUpId:s,matchUp:a,eventId:c,uuids:l,event:u}){var d;const{valid:p,errors:v}=BA({collectionDefinition:e});if(!p)return{error:Z,errors:v};const f="addCollectionDefinition";let m=!a&&$a({drawDefinition:n,structureId:i,matchUpId:s,eventId:c,event:u});if(m!=null&&m.error)return{error:m.error};const{structure:g}=m;a=a||m.matchUp;const h=m.tieFormat,_=ln(h);if(m=cr({tieFormat:_}),m!=null&&m.error)return{error:m.error};if(!e.collectionId)e.collectionId=ke();else if(_.collectionDefinitions.map(({collectionId:$})=>$).includes(e.collectionId))return{collectionId:e.collectionId,error:XR};_.collectionDefinitions.push(e),_.collectionDefinitions.sort((w,$)=>(w.collectionOrder||0)-($.collectionOrder||0)).forEach((w,$)=>w.collectionOrder=$+1);const{aggregateValue:I,valueGoal:P}=Pa(_);_.winCriteria=_e({aggregateValue:I,valueGoal:P});const S=h.winCriteria.valueGoal,y=h.winCriteria.aggregateValue;(S&&S!==P||I&&!y)&&(o?_.tieFormatName=o:delete _.tieFormatName);const O=[],b=[];let E=[];const T=_e(_);if(m=cr({tieFormat:T}),m!=null&&m.error)return{error:m.error};if(c){u.tieFormat=T;for(const w of u.drawDefinitions||[])if(!w.tieFormat)for(const $ of w.structures||[]){if($.tieFormat)continue;const U=xp({updateInProgressMatchUps:t,collectionDefinition:e,structure:$,uuids:l});b.push(...U.newMatchUps),E.push(...U.targetMatchUps),O.push($.structureId)}Sl({structureIds:O,modifiedMatchUps:E,eventId:u==null?void 0:u.eventId,tournamentRecord:r,drawDefinition:n,addedMatchUps:b,stack:f})}else if(i&&g){g.tieFormat=T;const w=xp({updateInProgressMatchUps:t,collectionDefinition:e,structure:g,uuids:l});b.push(...w.newMatchUps),E=w.targetMatchUps,Sl({modifiedMatchUps:E,structureIds:[i],eventId:u==null?void 0:u.eventId,tournamentRecord:r,drawDefinition:n,addedMatchUps:b,stack:f})}else if(s&&a){if(!Nu({matchUp:a,updateInProgressMatchUps:t}))return{error:gA};a.tieFormat=T;const w=kd({collectionDefinition:e,uuids:l});Array.isArray(a.tieMatchUps)||(a.tieMatchUps=[]),a.tieMatchUps.push(...w),b.push(...w),Sl({modifiedMatchUps:[a],eventId:u==null?void 0:u.eventId,tournamentRecord:r,drawDefinition:n,addedMatchUps:b,stack:f})}else if(n){n.tieFormat=T;for(const w of n.structures||[]){const $=xp({updateInProgressMatchUps:t,collectionDefinition:e,structure:w,uuids:l});O.push(i),b.push(...$.newMatchUps),E.push(...$.targetMatchUps)}Sl({structureIds:O,modifiedMatchUps:E,eventId:u==null?void 0:u.eventId,tournamentRecord:r,drawDefinition:n,addedMatchUps:b,stack:f})}else return{error:pe};const{appliedPolicies:N}=ct({tournamentRecord:r});if((d=N==null?void 0:N.audit)!=null&&d[Xi]){const w=_e({drawId:n==null?void 0:n.drawId,collectionDefinition:e,action:f,structureId:i,matchUpId:s,eventId:c});zd({drawDefinition:n,auditData:w})}return sse(ise({},B),{tieFormat:T,targetMatchUps:E,addedMatchUps:b})}function xp({updateInProgressMatchUps:t,collectionDefinition:e,structure:r,uuids:n}){var o;const i=[],a=((o=Ke({matchUpFilters:{matchUpTypes:[We]},structure:r}))==null?void 0:o.matchUps).filter(c=>Nu({matchUp:c,updateInProgressMatchUps:t})&&!c.tieFormat);for(const c of a){const l=kd({collectionDefinition:e,uuids:n});Array.isArray(c.tieMatchUps)||(c.tieMatchUps=[]),c.tieMatchUps.push(...l),i.push(...l)}return{newMatchUps:i,targetMatchUps:a}}function Sl({modifiedStructureIds:t,tournamentRecord:e,modifiedMatchUps:r,drawDefinition:n,addedMatchUps:o,eventId:i,stack:s}){pi({tournamentId:e==null?void 0:e.tournamentId,matchUps:o,drawDefinition:n,eventId:i}),r==null||r.forEach(a=>{ze({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:n,context:s,matchUp:a,eventId:i})}),Qe({structureIds:t,drawDefinition:n,eventId:i})}var ase=Object.defineProperty,cse=Object.defineProperties,lse=Object.getOwnPropertyDescriptors,yT=Object.getOwnPropertySymbols,use=Object.prototype.hasOwnProperty,dse=Object.prototype.propertyIsEnumerable,OT=(t,e,r)=>e in t?ase(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,pse=(t,e)=>{for(var r in e||(e={}))use.call(e,r)&&OT(t,r,e[r]);if(yT)for(var r of yT(e))dse.call(e,r)&&OT(t,r,e[r]);return t},fse=(t,e)=>cse(t,lse(e));function c2({tournamentRecord:t,drawDefinition:e,structureId:r,matchUpId:n,structure:o,eventId:i,drawId:s,event:a}){var c,l,u,d,p;if(!t)return{error:ee};if(!s&&!a&&!r&&!n)return k({result:{error:Se},stack:"getTieFormat"});i&&!a&&(a=(c=t.events)==null?void 0:c.find(_=>_.eventId===i));const v=ol({tournamentRecord:t,drawDefinition:e,matchUpId:n,drawId:s,event:a});if(n&&(v!=null&&v.error))return v;if(!e&&(v!=null&&v.drawDefinition)&&(e=v==null?void 0:v.drawDefinition),o=o||(v==null?void 0:v.structure),!o&&r&&!n){if(!e)return{error:Mr};const _=Te({drawDefinition:e,structureId:r});if(_.error)return _;o=_.structure}const f=((o==null?void 0:o.tieFormat)||(o==null?void 0:o.tieFormatId))&&((l=Zt({structure:o,drawDefinition:e,event:a}))==null?void 0:l.tieFormat),m=((e==null?void 0:e.tieFormat)||(e==null?void 0:e.tieFormatId))&&((u=Zt({drawDefinition:e,event:a}))==null?void 0:u.tieFormat),g=(d=Zt({event:a}))==null?void 0:d.tieFormat,h=(p=Zt({matchUp:v==null?void 0:v.matchUp,drawDefinition:e,structure:o,event:a}))==null?void 0:p.tieFormat;return fse(pse({},B),{structureDefaultTieFormat:f,eventDefaultTieFormat:g,drawDefaultTieFormat:m,tieFormat:h})}function vse({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:r,targetMatchUps:n,tieFormat:o,event:i}){for(const s of n){const a=!!s.tieFormat;a&&(s.tieFormat=ln(o));let c;if(t){const l=to({matchUpId:s.matchUpId,exitWhenNoValues:!0,tournamentRecord:e,drawDefinition:r,event:i});if(l.error)return l;c=l.score}a&&!c&&ze({tournamentId:e==null?void 0:e.tournamentId,context:"updateTargetTeamMatchUps",eventId:i==null?void 0:i.eventId,matchUp:s,drawDefinition:r})}}function mse({updateInProgressMatchUps:t,drawDefinition:e,structureId:r,structure:n,matchUpId:o,matchUp:i}){var s,a;let c=[];return o&&i?c=[i]:r&&n?c=(s=Ke({matchUpFilters:{matchUpTypes:[We]},structure:n}))==null?void 0:s.matchUps:e&&(c=(a=Er({matchUpFilters:{matchUpTypes:[We]},drawDefinition:e}))==null?void 0:a.matchUps),{targetMatchUps:c.filter(u=>!u.winningSide&&u.matchUpStatus!==_t&&(t||u.matchUpStatus!==dn&&!At(u)))}}var gse=Object.defineProperty,ST=Object.getOwnPropertySymbols,hse=Object.prototype.hasOwnProperty,_se=Object.prototype.propertyIsEnumerable,bT=(t,e,r)=>e in t?gse(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ise=(t,e)=>{for(var r in e||(e={}))hse.call(e,r)&&bT(t,r,e[r]);if(ST)for(var r of ST(e))_se.call(e,r)&&bT(t,r,e[r]);return t};function l2({updateInProgressMatchUps:t,originalValueGoal:e,tournamentRecord:r,wasAggregateValue:n,tieFormatName:o,drawDefinition:i,structureId:s,structure:a,tieFormat:c,matchUpId:l,matchUp:u,eventId:d,event:p}){const{aggregateValue:v,valueGoal:f}=Pa(c);c.winCriteria=_e({aggregateValue:v,valueGoal:f}),(e&&e!==f||v&&!n)&&(o?c.tieFormatName=o:delete c.tieFormatName);const{targetMatchUps:m}=mse({updateInProgressMatchUps:t,drawDefinition:i,structureId:s,structure:a,matchUpId:l,matchUp:u});vse({updateInProgressMatchUps:t,tournamentRecord:r,drawDefinition:i,targetMatchUps:m,tieFormat:c,event:p});const g=_e(c),h=cr({tieFormat:g});if(h.error)return h;if(d)p.tieFormat=g;else if(l)u.tieFormat=c;else if(a)a.tieFormat=g;else if(i)i.tieFormat=g;else if(!u||!i)return{error:pe};return Qe({drawDefinition:i,eventId:p==null?void 0:p.eventId}),Ise({},B)}var Pse=Object.defineProperty,yse=Object.defineProperties,Ose=Object.getOwnPropertyDescriptors,$u=Object.getOwnPropertySymbols,u2=Object.prototype.hasOwnProperty,d2=Object.prototype.propertyIsEnumerable,TT=(t,e,r)=>e in t?Pse(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Sse=(t,e)=>{for(var r in e||(e={}))u2.call(e,r)&&TT(t,r,e[r]);if($u)for(var r of $u(e))d2.call(e,r)&&TT(t,r,e[r]);return t},bse=(t,e)=>yse(t,Ose(e)),Tse=(t,e)=>{var r={};for(var n in t)u2.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&$u)for(var n of $u(t))e.indexOf(n)<0&&d2.call(t,n)&&(r[n]=t[n]);return r};function p2({updateInProgressMatchUps:t=!0,collectionGroupNumber:e,tournamentRecord:r,drawDefinition:n,tieFormatName:o,structureId:i,matchUpId:s,matchUp:a,eventId:c,event:l}){var u;if(!e)return{error:Se};if(isNaN(e))return{error:Z};const d="removeCollectionGroup";let p=!a&&c2({tournamentRecord:r,drawDefinition:n,structureId:i,matchUpId:s,eventId:c,event:l});if(p.error)return k({result:p,stack:d});const{structure:v}=p;a=a||p.matchUp;const f=p.tieFormat,m=f.winCriteria.valueGoal,g=f.winCriteria.aggregateValue,h=ln(f);if(p=cr({tieFormat:h}),p.error)return k({result:p,stack:d});const _=[];if(h.collectionDefinitions=h.collectionDefinitions.map(I=>{const P=I,{collectionGroupNumber:S}=P,y=Tse(P,["collectionGroupNumber"]);return S!==e?I:(_.push(I.collectionId),y)}),h.collectionGroups=h.collectionGroups.filter(({groupNumber:I})=>I!==e),p=l2({updateInProgressMatchUps:t,originalValueGoal:m,wasAggregateValue:g,tournamentRecord:r,drawDefinition:n,tieFormatName:o,structureId:i,structure:v,tieFormat:h,matchUpId:s,matchUp:a,eventId:c,event:l}),!p.error){const{appliedPolicies:I}=ct({tournamentRecord:r});if((u=I==null?void 0:I.audit)!=null&&u[Xi]){const P=_e({drawId:n==null?void 0:n.drawId,collectionGroupNumber:e,action:d,structureId:i,matchUpId:s,eventId:c});zd({drawDefinition:n,auditData:P})}}return k({result:bse(Sse({},p),{modifiedCollectionIds:_}),stack:d})}var Ese=Object.defineProperty,wse=Object.defineProperties,Nse=Object.getOwnPropertyDescriptors,ET=Object.getOwnPropertySymbols,$se=Object.prototype.hasOwnProperty,Ase=Object.prototype.propertyIsEnumerable,wT=(t,e,r)=>e in t?Ese(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Use=(t,e)=>{for(var r in e||(e={}))$se.call(e,r)&&wT(t,r,e[r]);if(ET)for(var r of ET(e))Ase.call(e,r)&&wT(t,r,e[r]);return t},Cse=(t,e)=>wse(t,Nse(e));function f2({updateInProgressMatchUps:t=!0,tournamentRecord:e,groupDefinition:r,drawDefinition:n,collectionIds:o,tieFormatName:i,structureId:s,matchUpId:a,matchUp:c,eventId:l,event:u}){const d="addCollectionGroup";if(!Array.isArray(o))return k({result:{error:Se},stack:d});let p=!c&&$a({tournamentRecord:e,drawDefinition:n,structureId:s,matchUpId:a,eventId:l,event:u});if(p.error)return k({result:p,stack:d});const{structure:v}=p;c=c||p.matchUp;const f=p.tieFormat,m=f.winCriteria.valueGoal,g=ln(f);if(p=cr({tieFormat:g}),p.error)return k({result:p,stack:d});for(const I of g.collectionDefinitions){const{collectionId:P,collectionGroupNumber:S}=I;if(S&&o.includes(P))return k({result:{error:Z,info:"collectionIds cannot be part of other collectionGroups"},stack:d})}const _=(g.collectionGroups||[]).reduce((I,P)=>P.groupNumber>I?P.groupNumber:I,0)+1;return r.groupNumber=_,g.collectionDefinitions=g.collectionDefinitions.map(I=>o.includes(I.collectionId)?Cse(Use({},I),{collectionGroupNumber:_}):I),g.collectionGroups=[...g.collecitonGroups||[],r],l2({updateInProgressMatchUps:t,originalValueGoal:m,tournamentRecord:e,drawDefinition:n,tieFormatName:i,structureId:s,structure:v,tieFormat:g,matchUpId:a,matchUp:c,eventId:l,event:u})}var Mse=Object.defineProperty,Dse=Object.defineProperties,jse=Object.getOwnPropertyDescriptors,NT=Object.getOwnPropertySymbols,Rse=Object.prototype.hasOwnProperty,Fse=Object.prototype.propertyIsEnumerable,$T=(t,e,r)=>e in t?Mse(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Gp=(t,e)=>{for(var r in e||(e={}))Rse.call(e,r)&&$T(t,r,e[r]);if(NT)for(var r of NT(e))Fse.call(e,r)&&$T(t,r,e[r]);return t},kp=(t,e)=>Dse(t,jse(e));function v2({updateInProgressMatchUps:t=!1,tieFormatComparison:e,modifiedTieFormat:r,tournamentRecord:n,drawDefinition:o,structureId:i,matchUpId:s,eventId:a,uuids:c,event:l}){const u="updateTieFormat";if(!cr(r))return{error:Xo};let d=$a({drawDefinition:o,structureId:i,matchUpId:s,eventId:a,event:l});if(d.error)return k({result:d,stack:u});const{matchUp:p,tieFormat:v}=d,f=ln(v),m=f.collectionDefinitions.map(({collectionId:y})=>y),g=[],h=[],_=[];r.collectionDefinitions.forEach(y=>{var O;_.push(y.collectionId),m.includes(y.collectionId)?(O=_d({descendent:r,ancestor:f}))!=null&&O.different&&g.push(y):h.push(y)});const I=m.filter(y=>!_.includes(y)),P=r.tieFormatName;let S;for(const y of g){const O=ag(kp(Gp({updateInProgressMatchUps:t},y),{tournamentRecord:n,drawDefinition:o,tieFormatName:P,structureId:i,matchUpId:s,eventId:a,event:l}));if(O.error)return k({result:O,stack:u});O.tieFormat&&(S=O.tieFormat)}for(const y of h){const O=cg({updateInProgressMatchUps:t,collectionDefinition:y,tournamentRecord:n,drawDefinition:o,tieFormatName:P,structureId:i,matchUpId:s,matchUp:p,eventId:a,uuids:c,event:l});if(O.error)return k({result:O,stack:u});O.tieFormat&&(S=O.tieFormat)}for(const y of I){const O=sg({updateInProgressMatchUps:t,tieFormatComparison:e,tournamentRecord:n,drawDefinition:o,tieFormatName:P,collectionId:y,structureId:i,matchUpId:s,eventId:a,matchUp:p,event:l});if(O.error)return k({result:O,stack:u});O.tieFormat&&(S=O.tieFormat)}return S.collectionDefinitions=S.collectionDefinitions.sort((y,O)=>(y.collectionOrder||1/0)-(O.collectionOrder||1/0)).map((y,O)=>kp(Gp({},y),{collectionOrder:O+1})),kp(Gp({},B),{processedTieFormat:S})}const Vse={modifyCollectionDefinition:ag,orderCollectionDefinitions:o2,removeCollectionDefinition:sg,addCollectionDefinition:cg,removeCollectionGroup:p2,calculateWinCriteria:Pa,addCollectionGroup:f2,modifyTieFormat:v2};var Lse=Object.defineProperty,AT=Object.getOwnPropertySymbols,Bse=Object.prototype.hasOwnProperty,xse=Object.prototype.propertyIsEnumerable,UT=(t,e,r)=>e in t?Lse(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Gse=(t,e)=>{for(var r in e||(e={}))Bse.call(e,r)&&UT(t,r,e[r]);if(AT)for(var r of AT(e))xse.call(e,r)&&UT(t,r,e[r]);return t};function Ei({matchUp:t}){const{extension:e}=_r({name:Ju,element:t});if(!e)return{error:Ht};const{history:r=[],undoHistory:n=[]}=e.value;return Gse({history:r,undoHistory:n},B)}var kse=Object.defineProperty,Wse=Object.defineProperties,qse=Object.getOwnPropertyDescriptors,Au=Object.getOwnPropertySymbols,m2=Object.prototype.hasOwnProperty,g2=Object.prototype.propertyIsEnumerable,CT=(t,e,r)=>e in t?kse(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Wp=(t,e)=>{for(var r in e||(e={}))m2.call(e,r)&&CT(t,r,e[r]);if(Au)for(var r of Au(e))g2.call(e,r)&&CT(t,r,e[r]);return t},qp=(t,e)=>Wse(t,qse(e)),Hp=(t,e)=>{var r={};for(var n in t)m2.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&Au)for(var n of Au(t))e.indexOf(n)<0&&g2.call(t,n)&&(r[n]=t[n]);return r};function Hse({matchUp:t,updateScore:e}){var r;const n=((r=Ei({matchUp:t}))==null?void 0:r.history)||[];if(!Array.isArray(n))return{error:Z,info:"history is not an array"};const{matchUpFormat:o}=t;if(!o)return{error:Qf};if(!Br(o))return{error:lA};const i=Ir(o),{bestOf:s,finalSetFormat:a,setFormat:c}=i,l=["0","15","30","40","A","G"],u={sets:[]};let d,p=[0,0],v=1,f=[],m=0,g,h=0;const _=T=>[1,2].includes(T),I=()=>(m+=1,{winningSide:void 0,side1Score:0,side2Score:0,setNumber:m,games:[]}),P=()=>({winningSide:void 0,points:[]}),S=()=>({winningSide:void 0,side1Score:"",side2Score:"",shots:[]});let y=S(),O=P(),b=I(),E=0;for(const T of n){E+=1,g=u.sets.length+1===s;const N=g&&a?a:c,{tiebreakAt:w,setTo:$,NoAD:U,tiebbreakFormat:A}=N,C=b.side1Score===w&&b.side1Score===b.side2Score,M=!!N.tiebreakSet,D=M?N.tiebreakSet:A,{tiebreakTo:V,NoAD:R}=D||{},W=()=>{d=void 0,p=[0,0],v=3-v,b.side1TiebreakScore=0,b.side2TiebreakScore=0,b.side1PointScore="",b.side2PointScore="",h=0},x=L=>{b.winningSide=L;const F=b,q=Hp(F,["s"]);u.sets.push(q),y=S(),O=P(),b=I(),W()},K=L=>{O.winningSide=L;const F=O,q=Hp(F,["g"]);b.games.push(q),y=S(),O=P(),W();const G=`side${L}Score`;b[G]+=1},j=L=>{y.winningSide=L;const F=y,q=Hp(F,["p"]);O.points.push(q),y=S(),h=0;const G=()=>p.reduce((Y,J)=>Y+J)%4/4>.5?v:3-v,H=L-1;if(C||M){p[H]+=1,d=G(),b[`side${L}TiebreakScore`]=p[H],b[`side${3-L}TiebreakScore`]=p[1-H];const Q=R?1:2;if(p[H]>=V&&p[H]>=p[1-H]+Q)return K(L),{gameCompleted:!0}}else if(p[1-H]===4&&p[H]===3?p[1-H]-=1:p[H]+=1,b.side1PointScore=l[p[0]],b.side2PointScore=l[p[1]],p[H]===5||p[H]===4&&p[1-H]<3||U&&p[H]===4)return K(L),{gameCompleted:!0}};if(_(T.srv)&&(v=T.srv),["p","s","g","o"].includes(T.u)&&f.push(T.u),T.shotOutcome&&(y.shots.push(T),T.shotType==="SERVE"&&["OUT","NET"].includes(T.shotOutcome)&&(h+=1),h===2)){const F=3-v;j(F)}if(_(T.p)||lt(T.pointNumber)){const L=T.winningSide||T.p,F=j(L);if(F!=null&&F.gameCompleted)continue}if(_(T.g)||lt(T.gameNumber)){const L=T.winningSide||T.g;O.winningSide=L;const F=`side${L}Score`,q=`side${3-L}Score`;if(f.length&&(f.includes("p"),f=[]),K(L),b[F]===$&&b[F]-b[q]>=(U?1:2)&&(x(L),g))break}if(_(T.s)||lt(T.setNumber)){const L=T.winningSide||T.s;if(x(L),f.length&&(f.includes("p"),f.includes("g"),f=[]),g)break}}return E!==n.length&&console.log({error:"Match completed with excess history"}),(b.side1Score||b.side2Score||b.games.length||b.side1TiebreakScore||b.side2TiebreakScore)&&u.sets.push(b),u.scoreStringSide1=xn(qp(Wp({},u),{matchUpFormat:o})),u.scoreStringSide2=xn(qp(Wp({},u),{matchUpFormat:o,reversed:!0})),v=d||v,e&&(t.score=u),qp(Wp({},B),{servingSide:v,score:u})}function wi({matchUp:t,history:e,undoHistory:r}){return et({element:t,extension:{value:{history:e,undoHistory:r},name:Ju}})}function Yse({matchUp:t,sideNumber:e}){if(![1,2].includes(e))return{error:fA};const{history:r=[]}=Ei({matchUp:t});return r.push({srv:e}),wi({matchUp:t,history:r})}function Kse({matchUp:t}){return wi({matchUp:t})}function zse({matchUp:t,point:e}){if(!e)return{error:Se};if(typeof e!="object")return{error:Z,context:{point:e}};const{history:r=[]}=Ei({matchUp:t});return r.push(e),wi({matchUp:t,history:r})}function Qse({matchUp:t,game:e}){if(typeof e!="object")return{error:Z,context:{game:e}};const{history:r=[]}=Ei({matchUp:t});return r.push(e),wi({matchUp:t,history:r})}function Jse({matchUp:t,shot:e}){if(typeof e!="object")return{error:Se};const{history:r=[]}=Ei({matchUp:t});return r.push(e),wi({matchUp:t,history:r})}function Zse({matchUp:t,set:e}){if(typeof e!="object")return{error:Se};const{history:r=[]}=Ei({matchUp:t});return r.push(e),wi({matchUp:t,history:r})}function Xse({matchUp:t}){const{history:e=[],undoHistory:r=[]}=Ei({matchUp:t});return r.length&&e.push(r.pop()),wi({matchUp:t,history:e,undoHistory:r})}function eae({matchUp:t}){const{history:e=[],undoHistory:r=[]}=Ei({matchUp:t});return r.push(e.pop()),wi({matchUp:t,history:e,undoHistory:r})}const tae={scoreboard:()=>{},addPoints:()=>{},addPoint:()=>{}},rae={calculateHistoryScore:Hse,setServingSide:Yse,clearHistory:Kse,addPoint:zse,addGame:Qse,addShot:Jse,addSet:Zse,redo:Xse,undo:eae,umo:tae};var nae=Object.defineProperty,MT=Object.getOwnPropertySymbols,oae=Object.prototype.hasOwnProperty,iae=Object.prototype.propertyIsEnumerable,DT=(t,e,r)=>e in t?nae(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,sae=(t,e)=>{for(var r in e||(e={}))oae.call(e,r)&&DT(t,r,e[r]);if(MT)for(var r of MT(e))iae.call(e,r)&&DT(t,r,e[r]);return t};function Lf(t){var e;const{matchUp:r,sideNumber:n,setNumber:o,isTiebreakValue:i,isPointValue:s}=t||{};let{matchUpFormat:a}=t||{};if(!r)return{error:wr};a=a||(r==null?void 0:r.matchUpFormat);const c=Ir(a),l=!!(r!=null&&r.winningSide),u=(e=r.score)==null?void 0:e.sets,d=u==null?void 0:u.length,p=o&&o-1,v=!!(u!=null&&u.find((F,q)=>F.setNumber===o&&q===p)),f=(u==null?void 0:u.filter(F=>F==null?void 0:F.winningSide))||[],m=(f==null?void 0:f.length)||0,g=o&&(u==null?void 0:u.slice(o))||[],h=!!(d&&o&&(g!=null&&g.reduce((F,q)=>(!q||!q.side1Score&&!q.side2Score&&!q.side1TiebreakScore&&!q.side2TiebreakScore&&!q.side1PointScore&&!q.side2PointScore)&&F,!0))),_=o<=d&&u.find(F=>F.setNumber===o),I=_&&nu({setObject:_,matchUpScoringFormat:c}),{isCompletedSet:P,sideGameScores:S,sideTiebreakScores:y}=I||{},O=!!(_&&!P&&h||o&&o===d+1&&!l),b=[1,2].includes(n),E=b?n-1:0,T=_&&b&&(!i&&!s&&S[E]!==void 0&&S[E]||i&&y[E]!==void 0&&y[E]),N=!!T,w=f==null?void 0:f.map(F=>nu({setObject:F,matchUpScoringFormat:c}).isValidSetOutcome).reduce((F,q)=>F&&q,!0),$=f.reduce((F,q)=>{const{winningSide:G}=q,H=G-1;return F[H]++,F},[0,0]),U=r==null?void 0:r.winningSide,A=U&&U-1,C=1-A,M=$[A],D=$[C],V=Math.max(...$),R=fr($)[V],{bestOf:W}=c||{},x=W&&Math.ceil(W/2)||1,K=V===x&&R===1&&$.indexOf(V)+1||void 0,j=M>D&&U===K;return sae({completedSetsHaveValidOutcomes:w,validMatchUpWinningSide:j,calculatedWinningSide:K,matchUpScoringFormat:c,validMatchUpOutcome:K&&w&&j,isLastSetWithValues:h,completedSetsCount:m,isCompletedMatchUp:l,isValidSideNumber:b,hasExistingValue:N,existingValue:T,isExistingSet:v,isActiveSet:O},I)}const aae={tallyParticipantResults:vv,matchUpIsComplete:Ds,analyzeMatchUp:Lf,getMatchUpType:VU,scoreHasValue:At};let qi={},wo;function jT(t,e=!0){if(!t)return{error:Se};if(typeof t!="object")return{error:Xn};if(t.matchUpId)wo=t.matchUpId,qi[wo]=e?de(t):t;else if(Array.isArray(t))for(const r of t.reverse())r.matchUpId&&(qi[r.matchUpId]=e?de(r):r,wo||(wo=r.matchUpId));else for(const r of Object.values(t))r.matchUpId&&(qi[r.matchUpId]=e?de(r):r,wo||(wo=r.matchUpId));return e?de(t):t}function cae(){return qi[wo]}function lae(){return Object.values(qi)}function uae(){wo=void 0,qi={}}function dae({convertExtensions:t,removeExtensions:e}={}){return de(qi[wo],t,!1,e)}var pae=Object.defineProperty,fae=Object.defineProperties,vae=Object.getOwnPropertyDescriptors,RT=Object.getOwnPropertySymbols,mae=Object.prototype.hasOwnProperty,gae=Object.prototype.propertyIsEnumerable,FT=(t,e,r)=>e in t?pae(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Yp=(t,e)=>{for(var r in e||(e={}))mae.call(e,r)&&FT(t,r,e[r]);if(RT)for(var r of RT(e))gae.call(e,r)&&FT(t,r,e[r]);return t},VT=(t,e)=>fae(t,vae(e));(function(){const t={getState:()=>dae(),version:()=>oo(),reset:()=>(uae(),Yp({},B))};function e(o){return o!=null&&o.error?(t.error=o.error,t.success=!1):(t.error=void 0,t.success=!0,t.drawId=o.drawId),t}return r([Vse,rae,aae,A1]),t.devContext=o=>(Ls(o),t),t.setState=(o,i,s)=>{Yi(i,s);const a=jT(o);return e(a)},t;function r(o){o.forEach(i=>{Object.keys(i).forEach(s=>{t[s]=a=>{if(Ct())return n({params:a,governor:i,governorMethod:s});try{return n({params:a,governor:i,governorMethod:s})}catch(c){const l=c.toString();console.log("ERROR",{error:l,method:s,params:JSON.stringify(a)})}}})})}function n({params:o,governor:i,governorMethod:s}){delete t.success,delete t.error;const a=(o==null?void 0:o.matchUp)||cae(),c=(o==null?void 0:o.matchUps)||lae(),l=(o==null?void 0:o.rollbackOnError)&&de(a,!1,!0);o=VT(Yp({},o),{matchUpId:a==null?void 0:a.matchUpId,matchUps:c,matchUp:a});const u=i[s](o);if(u!=null&&u.error)return l&&jT(l),VT(Yp({},u),{rolledBack:!!l});const d=(u==null?void 0:u.success)&&(o==null?void 0:o.delayNotify)!==!0&&(o==null?void 0:o.doNotNotify)!==!0;return d&&vi(),(d||!(u!=null&&u.success)||o!=null&&o.doNotNotify)&&ii(),u}})();var hae=Object.defineProperty,LT=Object.getOwnPropertySymbols,_ae=Object.prototype.hasOwnProperty,Iae=Object.prototype.propertyIsEnumerable,BT=(t,e,r)=>e in t?hae(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Pae=(t,e)=>{for(var r in e||(e={}))_ae.call(e,r)&&BT(t,r,e[r]);if(LT)for(var r of LT(e))Iae.call(e,r)&&BT(t,r,e[r]);return t};function lg(t={}){return t.tournamentId||Object.assign(t,{tournamentId:ke()}),t.startDate&&!si(t.startDate)&&!xl.test(t.startDate)?{error:ar}:t.endDate&&!si(t.endDate)&&!xl.test(t.endDate)?{error:ar}:(t.extensions&&(t.extensions=t.extensions.filter(on)),Pae({},t))}var yae=Object.defineProperty,Oae=Object.defineProperties,Sae=Object.getOwnPropertyDescriptors,xT=Object.getOwnPropertySymbols,bae=Object.prototype.hasOwnProperty,Tae=Object.prototype.propertyIsEnumerable,GT=(t,e,r)=>e in t?yae(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,kT=(t,e)=>{for(var r in e||(e={}))bae.call(e,r)&&GT(t,r,e[r]);if(xT)for(var r of xT(e))Tae.call(e,r)&&GT(t,r,e[r]);return t},WT=(t,e)=>Oae(t,Sae(e));function Kp(t,e){var r;if(typeof t!="object")return{error:Xn};const n=((r=t.unifiedTournamentId)==null?void 0:r.tournamentId)||t.tournamentId;if(!n)return{error:so};const o=e!==!1?de(t):t;return yc({[n]:o}),Qa(n),o}function Eae({convertExtensions:t,removeExtensions:e,tournamentId:r}={}){if(typeof r!="string")return{};const n=za(r);return{tournamentRecord:de(n,t,!1,e)}}function wae(t,e,r){var n;if(e){const o=e.drawId||((n=e.matchUp)==null?void 0:n.drawId);if(o){const{event:i,drawDefinition:s}=Ft({tournamentRecord:t,drawId:o});if(e=WT(kT({},e),{event:i,drawDefinition:s}),r){const a=zt({drawDefinition:s}),{matchUps:c}=wt({includeByeMatchUps:!0,inContext:!0,drawDefinition:s,matchUpsMap:a});e.matchUpsMap=a,e.inContextDrawMatchUps=c}}if(e.eventId&&!e.event){const{event:i}=Ft({eventId:e.eventId,tournamentRecord:t});i&&(e=WT(kT({},e),{event:i}))}}return e}function Nae(t){return t.tournamentRecord?ZD(t):{error:ee}}function $ae({tournamentRecord:t,participantId:e}){if(!t)return{error:ee};if(!e)return{error:It};const r=[e].concat((t.participants||[]).filter(o=>{var i;return(o==null?void 0:o.participantType)&&[Ye,we].includes(o.participantType)&&((i=o.individualParticipantIds)==null?void 0:i.includes(e))}).map(o=>o.participantId));return{eventDetails:(t.events||[]).filter(o=>{const i=((o==null?void 0:o.entries)||[]).map(s=>s.participantId);return Gt(i,r)}).map(o=>({eventName:o.eventName,eventId:o.eventId}))}}function Aae({tournamentRecord:t,participantId:e}){if(!t)return{error:ee};if(!e)return{error:It};const{tournamentParticipants:r}=Kt({participantFilters:{participantTypes:[Ye,we,dr]},tournamentRecord:t});return(r||[]).filter(o=>{var i;return(i=o.individualParticipantIds)==null?void 0:i.includes(e)}).reduce((o,i)=>{const{participantType:s}=i;return o[s]||(o[s]=[]),o[s].push(i),o},{})}var Uae=Object.defineProperty,qT=Object.getOwnPropertySymbols,Cae=Object.prototype.hasOwnProperty,Mae=Object.prototype.propertyIsEnumerable,HT=(t,e,r)=>e in t?Uae(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Dae=(t,e)=>{for(var r in e||(e={}))Cae.call(e,r)&&HT(t,r,e[r]);if(qT)for(var r of qT(e))Mae.call(e,r)&&HT(t,r,e[r]);return t};function jae({participantFilters:t={},tournamentRecord:e}){if(!e)return{error:ee};if(typeof t!="object")return{error:Xn,context:{participantFilters:t}};const r={eventIds:t.eventIds},n=Vt({tournamentRecord:e,contextFilters:r}).matchUps,o=Object.assign({},...n.map(l=>({[l.matchUpId]:l}))),i=n.filter(({schedule:l})=>l&&Object.keys(l).length),{sourceMatchUpIds:s}=qr({tournamentRecord:e,matchUps:n}),a={};for(const l of i){const{sides:u}=l;let d;const p=(u==null?void 0:u.map(({participant:f})=>{if(f)return[f].concat(...f.individualParticipants||[]);s[l.matchUpId]&&!d&&(d=(s[l.matchUpId]||[]).map(m=>o[m]).filter(({winningSide:m,bye:g})=>!m&&!g))}).filter(Boolean).flat())||[];for(const f of p){const{participantId:m}=f;a[m]||(a[m]={potentialMatchUps:[],participant:f,matchUps:[]}),a[m].matchUps.push(l)}const v=(d==null?void 0:d.map(({sides:f})=>f).flat().map(({participant:f})=>f&&[f].concat(...f.individualParticipants||[])).filter(Boolean).flat())||[];for(const f of v){const{participantId:m}=f;a[m]||(a[m]={potentialMatchUps:[],participant:f,matchUps:[]}),a[m].potentialMatchUps.push(l)}}const c=Object.values(a).filter(({participant:l})=>!(t.participantIds&&!t.participantIds.includes(l.participantId)||t.participantTypes&&!t.participantTypes.includes(l.participantType)));return Dae({participantSchedules:c},B)}function Rae({tournamentRecord:t,drawDefinition:e,byeAdvancements:r=!1}){if(!t)return{error:ee};const n=t.participants;return e2({tournamentParticipants:n,byeAdvancements:r,drawDefinition:e})}var Fae=Object.defineProperty,Vae=Object.defineProperties,Lae=Object.getOwnPropertyDescriptors,YT=Object.getOwnPropertySymbols,Bae=Object.prototype.hasOwnProperty,xae=Object.prototype.propertyIsEnumerable,KT=(t,e,r)=>e in t?Fae(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Gae=(t,e)=>{for(var r in e||(e={}))Bae.call(e,r)&&KT(t,r,e[r]);if(YT)for(var r of YT(e))xae.call(e,r)&&KT(t,r,e[r]);return t},kae=(t,e)=>Vae(t,Lae(e));function Wae({participantRole:t=xt,tournamentRecord:e,persons:r}){var n;if(!e)return{error:ee};if(!Array.isArray(r))return{error:Z};if(!Object.keys(XC).includes(t))return{error:NR};const o=(e.participants||[]).map(({person:m})=>m==null?void 0:m.personId).filter(Boolean),i=[],s=r.filter(m=>m&&(!m.personId||!o.includes(m.personId))).map(m=>(m.personId||(m.personId=ke()),i.push(m.personId),m)),a=(m,g)=>Object.assign({},...Object.keys(m).filter(h=>!g.includes(h)).map(h=>({[h]:m[h]}))),c=s.map(m=>_e({extensions:m.participantExtensions,timeItems:m.participantTimeItems,participantType:Ce,participantRole:t,person:a(m,["participantExtensions","participantTimeItems","pairedPersons"])}));let l=0,u=0,d=Zn({participants:c,tournamentRecord:e});if(d.error)return d;u=d.addedCount||0;const p=[],v=((n=Kt({participantFilters:{participantTypes:[Ce]},tournamentRecord:e}))==null?void 0:n.tournamentParticipants)||[];if(t===xt&&r.filter(({pairedPersons:m})=>m).forEach(({personId:m,pairedPersons:g})=>{Array.isArray(g)&&g.forEach(h=>{const _=[m,h.personId].map(I=>uo({tournamentParticipants:v,personId:I})).filter(Boolean);if(_.length===2){const I=_.map(Ze);p.push(_e({extensions:h.participantExtensions,timeItems:h.timeItems,participantRole:xt,individualParticipantIds:I,participantType:we}))}})}),p.length){if(d=Zn({participants:p,tournamentRecord:e}),d.error)return d;l=d.addedCount||0}const f=u+l;return kae(Gae({},B),{addedCount:f,newPersonIds:i})}var qae=Object.defineProperty,zT=Object.getOwnPropertySymbols,Hae=Object.prototype.hasOwnProperty,Yae=Object.prototype.propertyIsEnumerable,QT=(t,e,r)=>e in t?qae(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Kae=(t,e)=>{for(var r in e||(e={}))Hae.call(e,r)&&QT(t,r,e[r]);if(zT)for(var r of zT(e))Yae.call(e,r)&&QT(t,r,e[r]);return t};function zae({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:r}){var n,o;const i=(r.events||[]).filter(a=>{var c;return(a==null?void 0:a.eventType)===yt&&((c=a==null?void 0:a.entries)==null?void 0:c.some(l=>l.participantId===e))}),s=a=>!t.includes(a.participantId);for(const a of i){a.entries=(a.entries||[]).filter(s);const{flightProfile:c}=ht({event:a});(n=c==null?void 0:c.flights)==null||n.forEach(l=>{l.drawEntries=(l.drawEntries||[]).filter(s)}),(o=a==null?void 0:a.drawDefinitions)==null||o.forEach(l=>{l.entries=(l.entries||[]).filter(s)})}return Kae({},B)}var Qae=Object.defineProperty,JT=Object.getOwnPropertySymbols,Jae=Object.prototype.hasOwnProperty,Zae=Object.prototype.propertyIsEnumerable,ZT=(t,e,r)=>e in t?Qae(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Xae=(t,e)=>{for(var r in e||(e={}))Jae.call(e,r)&&ZT(t,r,e[r]);if(JT)for(var r of JT(e))Zae.call(e,r)&&ZT(t,r,e[r]);return t};function ug({individualParticipantIds:t,groupingParticipantId:e,removeFromOtherTeams:r,tournamentRecord:n}){const o="addIndividualParticipantIds";if(!n)return k({result:{error:ee},stack:o});if(!e||!t)return k({result:{error:Se},stack:o});const i=n.participants||[],s=i.find(d=>d.participantId===e);if(!s)return k({result:{error:Tt},stack:o});if(s!=null&&s.participantType&&![Ye,dr].includes(s.participantType))return k({result:{error:bn},context:{participantType:s.participantType},stack:o});const a=t.filter(d=>{const p=i.find(v=>v.participantId===d);return(p==null?void 0:p.participantType)!==Ce});if(a.length)return k({result:{error:Jr,invalidParticipantIds:a},stack:o});s.individualParticipantIds||(s.individualParticipantIds=[]);const c=s.individualParticipantIds,l=t.filter(d=>!c.includes(d));l.length&&(r&&ig({individualParticipantIds:l,tournamentRecord:n}),s.individualParticipantIds=s.individualParticipantIds.concat(...l));const{topics:u}=Mn();if(u.includes(kt)){const d=i.find(({participantId:p})=>p===e);Le({topic:kt,payload:{participants:[d]}})}return zae({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:n}),Xae({groupingParticipant:de(s,!1,!0),added:l.length},B)}var ece=Object.defineProperty,XT=Object.getOwnPropertySymbols,tce=Object.prototype.hasOwnProperty,rce=Object.prototype.propertyIsEnumerable,eE=(t,e,r)=>e in t?ece(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,tE=(t,e)=>{for(var r in e||(e={}))tce.call(e,r)&&eE(t,r,e[r]);if(XT)for(var r of XT(e))rce.call(e,r)&&eE(t,r,e[r]);return t};function nce({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:r}){const n="modifyIndividualParticipantIds";if(!r)return k({result:{error:ee},stack:n});if(!e||!t)return k({result:{error:Se},stack:n});const o=r.participants||[],i=o.find(v=>v.participantId===e);if(!i)return k({result:{error:Tt},stack:n});if(![Ye,dr].includes(i.participantType))return k({result:{error:bn},context:{participantType:i.participantType},stack:n});const s=t.filter(v=>{const f=o.find(m=>m.participantId===v);return(f==null?void 0:f.participantType)!==Ce});if(s.length)return k({result:{error:Jr,invalidParticipantIds:s},stack:n});const a=i.individualParticipantIds||[],c=t.filter(v=>!a.includes(v)),l=a.filter(v=>!t.includes(v)),u=ug({individualParticipantIds:c,groupingParticipantId:e,tournamentRecord:r});if(u.error)return k({result:u,stack:n});const d=DD({individualParticipantIds:l,groupingParticipantId:e,tournamentRecord:r});if(d.error)return k({result:d,stack:n});const{topics:p}=Mn();if(p.includes(kt)){const v=o.find(({participantId:f})=>f===e);Le({topic:kt,payload:{tournamentId:r.tournamentId,participants:[v]}})}return tE(tE({},u),d)}var oce=Object.defineProperty,ice=Object.defineProperties,sce=Object.getOwnPropertyDescriptors,rE=Object.getOwnPropertySymbols,ace=Object.prototype.hasOwnProperty,cce=Object.prototype.propertyIsEnumerable,nE=(t,e,r)=>e in t?oce(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,oE=(t,e)=>{for(var r in e||(e={}))ace.call(e,r)&&nE(t,r,e[r]);if(rE)for(var r of rE(e))cce.call(e,r)&&nE(t,r,e[r]);return t},iE=(t,e)=>ice(t,sce(e));function h2({addParticipants:t=!0,participantAttribute:e,tournamentRecord:r,personAttribute:n,teamNames:o,accessor:i,uuids:s}){var a;if(!r)return{error:ee};const c={},l=(r.participants||[]).filter(({participantType:m,participantRole:g})=>m===Ce&&g===xt);let u=0;for(const m of l){const h=i&&((a=Ud({element:m,accessor:i}))==null?void 0:a.value)||(n?m.person[n]:m[e]);if(h){if(!Object.keys(c).includes(h)){c[h]={participantName:(o==null?void 0:o[u])||h,participantId:(s==null?void 0:s.pop())||ke(),individualParticipantIds:[],participantRole:xt,participantType:Ye};const _={name:df,value:n||e};et({element:c[h],extension:_}),u+=1}c[h].individualParticipantIds.push(m.participantId)}}const d=Object.keys(c),p=(r.participants||[]).map(m=>{if(m.participantType!==Ye||m.participantRole!==xt)return;const{extension:g}=_r({name:df,element:m}),h=g==null?void 0:g.value;if(d.includes(h))return m.participantId}).filter(Boolean);let v=0;const f=[];return Object.keys(c).forEach(m=>{const g=c[m],{participantId:h}=g;p.includes(h)||(t&&r.participants.push(g),f.push(g),v++)}),t&&v?(Le({payload:{tournamentId:r.tournamentId,participants:f},topic:ci}),iE(oE({},B),{participantsAdded:v})):f.length?iE(oE({},B),{newParticipants:f}):{error:ER}}var lce=Object.defineProperty,sE=Object.getOwnPropertySymbols,uce=Object.prototype.hasOwnProperty,dce=Object.prototype.propertyIsEnumerable,aE=(t,e,r)=>e in t?lce(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,pce=(t,e)=>{for(var r in e||(e={}))uce.call(e,r)&&aE(t,r,e[r]);if(sE)for(var r of sE(e))dce.call(e,r)&&aE(t,r,e[r]);return t};function fce({tournamentRecord:t,participantIds:e,signInState:r}){if(!t)return{error:ee};if(!Array.isArray(e))return{error:Se};if(![nc,Ox].includes(r))return{error:Z,signInState:r};const o=t.participants||[];if(!o.length)return{error:Ic};const i=o.map(Ze),s=e.filter(u=>!i.includes(u));if(s.length)return{error:Z,context:{invalidParticipantIds:s}};const a=[],c=new Date().toISOString();for(const u of o){const{participantId:d}=u;if(e.includes(d)){const v=pC({tournamentRecord:t,duplicateValues:!1,participantId:d,timeItem:{itemType:$c,itemValue:r,createdAt:c}});if(v.error)return v;a.push(u)}}const{topics:l}=Mn();return a.length&&l.includes(kt)&&Le({topic:kt,payload:{tournamentId:t.tournamentId,participants:a}}),pce({},B)}var vce=Object.defineProperty,mce=Object.defineProperties,gce=Object.getOwnPropertyDescriptors,cE=Object.getOwnPropertySymbols,hce=Object.prototype.hasOwnProperty,_ce=Object.prototype.propertyIsEnumerable,lE=(t,e,r)=>e in t?vce(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ice=(t,e)=>{for(var r in e||(e={}))hce.call(e,r)&&lE(t,r,e[r]);if(cE)for(var r of cE(e))_ce.call(e,r)&&lE(t,r,e[r]);return t},Pce=(t,e)=>mce(t,gce(e));function yce({clearExistingAssignments:t=!0,individualParticipantIds:e,reverseAssignmentOrder:r,initialTeamIndex:n=0,scaledParticipants:o=[],teamParticipantIds:i,tournamentRecord:s,scaleAttributes:a,teamNameBase:c,teamsCount:l,eventId:u,event:d}){var p,v;if(!s)return{error:ee};if(!Array.isArray(i)&&!lt(l)&&!u||!lt(n)||o&&!Array.isArray(o)||a&&(typeof a!="object"||!Object.keys(a).length))return{error:Z};if(!a&&!o.length||!o&&!(e&&a))return{error:Se,info:"Missing scaling details"};if(u&&!i){if((d==null?void 0:d.eventType)!==gn)return{error:ni};i=d.entries.filter(({entryStatus:I})=>I===Cr).map(Ze)}if(!(i!=null&&i.length)&&!l)return{info:"Missing teamParticipantIds or teamsCount",error:Se};let f=e||o.map(({participantId:I})=>I);r&&(i.reverse(),n+=1),n>(i==null?void 0:i.length)-1&&(n=0);const m=(i==null?void 0:i.slice(n).concat(...i.slice(0,n)))||[],g=[];for(const I of s.participants||[]){const{participantId:P,participantType:S}=I;if(m.includes(P)){if(S!==hn)return{error:bn,participant:I};g.push(I)}}if(l&&g.length<l){const I=l-((g==null?void 0:g.length)||0),P=c||"Team";let S=le(0,I).map(E=>({participantName:`${P} ${E+1}`,participantType:hn,participantRole:xt}));const{participants:y=[]}=Zn({participants:S,returnParticipants:!0,tournamentRecord:s}),O=y.map(Ze),b=s.participants.filter(({participantId:E})=>O.includes(E));g.push(...b)}if(!g.length)return{error:wA};if(t)for(const I of g)I.individualParticipantIds=[];else{const I=g.map(P=>P).flat();e!=null&&e.length?f=f.filter(P=>!I.includes(P)):o=o==null?void 0:o.filter(({participantId:P})=>!I.includes(P))}if(!(e!=null&&e.length)&&!(o!=null&&o.length))return{error:nv,info:"Nothing to be done"};if(!o.length){for(const I of s.participants||[]){const{participantId:P,participantType:S}=I;if(!f.includes(P))continue;if(S!==Ce)return{error:bn,participant:I};const y=(p=kn({scaleAttributes:a,participant:I}))==null?void 0:p.scaleItem,O=a!=null&&a.accessor?(v=y==null?void 0:y.scaleValue)==null?void 0:v[a==null?void 0:a.accessor]:y==null?void 0:y.scaleValue,b={participantId:P,scaleValue:O};o.push(b)}if(!o.length)return{error:Tt}}o.sort((I,P)=>a!=null&&a.sortOrder?((P==null?void 0:P.scaleValue)||0)-((I==null?void 0:I.scaleValue)||0):((I==null?void 0:I.scaleValue)||1/0)-((P==null?void 0:P.scaleValue)||1/0));for(const I of o)if(!I.participantId)return{error:Z,scaledParticipant:I};let h=0;for(;h<o.length;){for(const I of g){if(h+1>o.length)break;const P=o[h];I.individualParticipantIds.push(P.participantId),h++}g.reverse()}const _=g.map(Ze);for(const I of s.events||[]){if(I.eventType!==gn)continue;const P=(I.entries||[]).filter(S=>_.includes(S.participantId));for(const S of P){const y=S.participantId,O=g.find(T=>T.participantId===y),b=O==null?void 0:O.individualParticipantIds;I.entries=(I.entries||[]).filter(T=>!b.includes(T.participantId)),(I.drawDefinitions||[]).forEach(T=>{T.entries=(T.entries||[]).filter(N=>!b.includes(N.participantId))});const{flightProfile:E}=ht({event:I});((E==null?void 0:E.flights)||[]).forEach(T=>{T.drawEntries=(T.drawEntries||[]).filter(N=>!b.includes(N.participantId))})}}return Pce(Ice({},B),{scaledParticipants:o})}var Oce=Object.defineProperty,Sce=Object.defineProperties,bce=Object.getOwnPropertyDescriptors,uE=Object.getOwnPropertySymbols,Tce=Object.prototype.hasOwnProperty,Ece=Object.prototype.propertyIsEnumerable,dE=(t,e,r)=>e in t?Oce(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,wce=(t,e)=>{for(var r in e||(e={}))Tce.call(e,r)&&dE(t,r,e[r]);if(uE)for(var r of uE(e))Ece.call(e,r)&&dE(t,r,e[r]);return t},Nce=(t,e)=>Sce(t,bce(e));function $ce({individualParticipantIds:t=[],participantRoleResponsibilities:e,participantRole:r=ZC,tournamentRecord:n,participantId:o,groupName:i}){if(!n)return{error:ee};if(!i)return{error:Se,info:"Missing groupName"};if(!Array.isArray(t))return{info:"Invalid individualParticipantIds",error:Z};const{tournamentParticipants:s}=Kt({participantFilters:{participantTypes:[Ce]},tournamentRecord:n}),a=s.map(d=>d.participantId);for(const d of t)if(!a.includes(d))return{error:bn,participantId:d};const c=_e({participantId:o||ke(),participantRoleResponsibilities:e,participantName:i,individualParticipantIds:t,participantType:dr,participantRole:r}),l=An({participant:c,tournamentRecord:n});if(l.error)return l;const{topics:u}=Mn();return u.includes(ci)&&Le({topic:ci,payload:{tournamentId:n.tournamentId,participants:[c]}}),Nce(wce({},B),{participant:de(c)})}var Ace=Object.defineProperty,pE=Object.getOwnPropertySymbols,Uce=Object.prototype.hasOwnProperty,Cce=Object.prototype.propertyIsEnumerable,fE=(t,e,r)=>e in t?Ace(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Mce=(t,e)=>{for(var r in e||(e={}))Uce.call(e,r)&&fE(t,r,e[r]);if(pE)for(var r of pE(e))Cce.call(e,r)&&fE(t,r,e[r]);return t};function Dce({tournamentRecord:t,participantId:e,participantOtherName:r}){if(!t)return{error:ee};if(!e)return{error:It};const{participant:n}=qo({tournamentRecord:t,participantId:e});if(!n)return{error:Tt};n.participantOtherName=r;const{topics:o}=Mn();return o.includes(kt)&&Le({topic:kt,payload:{tournamentId:t.tournamentId,participants:[n]}}),Mce({},B)}var jce=Object.defineProperty,Rce=Object.defineProperties,Fce=Object.getOwnPropertyDescriptors,vE=Object.getOwnPropertySymbols,Vce=Object.prototype.hasOwnProperty,Lce=Object.prototype.propertyIsEnumerable,mE=(t,e,r)=>e in t?jce(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Bce=(t,e)=>{for(var r in e||(e={}))Vce.call(e,r)&&mE(t,r,e[r]);if(vE)for(var r of vE(e))Lce.call(e,r)&&mE(t,r,e[r]);return t},xce=(t,e)=>Rce(t,Fce(e));function Gce({tournamentRecord:t,participantFilters:e}){if(!t)return{error:ee};let r=t.participants||[];e&&(r=Cd({participants:r,participantFilters:e,tournamentRecord:t}));const n={},o=i=>{if(i.person){const{personId:s}=i.person;n[s]?n[s].participantIds.push(i.participantId):n[s]=xce(Bce({},i.person),{participantIds:[i.participantId]})}};return r.forEach(i=>{i.person&&o(i),i.individualParticipants&&i.individualParticipants.forEach(o)}),{tournamentPersons:Object.values(n)}}var kce=Object.defineProperty,gE=Object.getOwnPropertySymbols,Wce=Object.prototype.hasOwnProperty,qce=Object.prototype.propertyIsEnumerable,hE=(t,e,r)=>e in t?kce(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Hce=(t,e)=>{for(var r in e||(e={}))Wce.call(e,r)&&hE(t,r,e[r]);if(gE)for(var r of gE(e))qce.call(e,r)&&hE(t,r,e[r]);return t};function Yce({tournamentRecord:t,participantName:e,participantId:r}){if(!t)return{error:ee};if(!r)return{error:It};if(!e)return{error:Se,info:"Missing participantName"};const{participant:n}=qo({tournamentRecord:t,participantId:r});if(!n)return{error:Tt};n.participantName=e;const{topics:o}=Mn();return o.includes(kt)&&Le({topic:kt,payload:{tournamentId:t.tournamentId,participants:[n]}}),Hce({},B)}var Kce=Object.defineProperty,_E=Object.getOwnPropertySymbols,zce=Object.prototype.hasOwnProperty,Qce=Object.prototype.propertyIsEnumerable,IE=(t,e,r)=>e in t?Kce(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Jce=(t,e)=>{for(var r in e||(e={}))zce.call(e,r)&&IE(t,r,e[r]);if(_E)for(var r of _E(e))Qce.call(e,r)&&IE(t,r,e[r]);return t};function Zce({tournamentRecord:t,participants:e=[],arraysToMerge:r}){if(!t)return{error:ee};t.participants||(t.participants=[]);const n=Object.assign(...e.filter(pd).map(c=>({[c.participantId]:c}))),o=[];t.participants=t.participants.map(c=>{if(n[c.participantId]){const l=Im(c,n[c.participantId],r);return o.push(l),l}else return c});const i=t.participants.map(Ze),s=e.filter(({participantId:c})=>!i.includes(c)),{topics:a}=Mn();if(s.length&&(t.participants=t.participants.concat(...s),a.includes(ci)&&Le({topic:ci,payload:{participants:s}})),o.length&&a.includes(kt)&&Le({topic:kt,payload:{tournamentId:t.tournamentId,participants:o}}),s.length||o.length)return Jce({},B)}var Xce=Object.defineProperty,PE=Object.getOwnPropertySymbols,ele=Object.prototype.hasOwnProperty,tle=Object.prototype.propertyIsEnumerable,yE=(t,e,r)=>e in t?Xce(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,rle=(t,e)=>{for(var r in e||(e={}))ele.call(e,r)&&yE(t,r,e[r]);if(PE)for(var r of PE(e))tle.call(e,r)&&yE(t,r,e[r]);return t};function dg({updateParticipantName:t=!0,groupingParticipantId:e,removeFromOtherTeams:r,tournamentRecord:n,pairOverride:o,participant:i}){if(!n)return{error:ee};if(!i)return{error:Vs};if(!i.participantId)return An({tournamentRecord:n,participant:i});const{participant:s}=qo({participantId:i.participantId,tournamentRecord:n});if(!s)return An({tournamentRecord:n,participant:i});const{participantRoleResponsibilties:a,individualParticipantIds:c,participantOtherName:l,participantName:u,participantRole:d,participantType:p,onlineResources:v,contacts:f,person:m}=i;if(p&&s.participantType!==p)return{error:wR};const g={};if(f&&(g.contacts=f),v&&(g.onlineResources=v),u&&typeof u=="string"&&(g.participantName=u),l&&typeof l=="string"&&(g.participantOtherName=l),Array.isArray(c)){const{tournamentParticipants:h}=Kt({participantFilters:{participantTypes:[ja.INDIVIDUAL]},tournamentRecord:n}),_=h==null?void 0:h.map(Ze);if(_){const I=c.filter(P=>typeof P=="string"&&_.includes(P));([dr,We].includes(p||s.participantType)||p===we&&(I.length===2||o))&&(g.individualParticipantIds=I),s.participantType===ja.PAIR&&t&&(g.participantName=nle({individualParticipants:h,newValues:g}))}}return Object.keys(XC).includes(d)&&(g.participantRole=d),Object.keys(ja).includes(p)&&(g.participantType=p),Array.isArray(a)&&(g.participantRoleResponsibilties=a),s.participantType===ja.INDIVIDUAL&&m&&ole({updateParticipantName:t,existingParticipant:s,newValues:g,person:m}),Object.assign(s,_e(g)),e&&ug({individualParticipantIds:[s.participantId],groupingParticipantId:e,removeFromOtherTeams:r,tournamentRecord:n}),Le({topic:kt,payload:{tournamentId:n.tournamentId,participants:[s]}}),rle({participant:de(s)},B)}function nle({individualParticipants:t,newValues:e}){const r=e.individualParticipantIds;let n=t.filter(({participantId:o})=>r.includes(o)).map(({person:o})=>o==null?void 0:o.standardFamilyName).filter(Boolean).sort().join("/");return r.length===1&&(n+="/Unknown"),n}function ole({updateParticipantName:t,existingParticipant:e,newValues:r,person:n}){const o={},{standardFamilyName:i,standardGivenName:s,nationalityCode:a,personId:c,sex:l}=n;l&&Object.keys(ZU).includes(l)&&(o.sex=l);let u;if(c&&typeof c=="string"&&(o.personId=c),a&&typeof a=="string"&&(ile(a)||a==="")&&(o.nationalityCode=a),i&&typeof i=="string"&&i.length>1&&(o.standardFamilyName=i,u=!0),s&&typeof s=="string"&&s.length>1&&(o.standardGivenName=s,u=!0),u&&t){const d=`${o.standardGivenName} ${o.standardFamilyName}`;r.participantName=d}Object.assign(e.person,o)}function ile(t){return Ao.flatMap(({iso:e,ioc:r})=>[e,r]).filter(Boolean).includes(t)}var sle=Object.defineProperty,OE=Object.getOwnPropertySymbols,ale=Object.prototype.hasOwnProperty,cle=Object.prototype.propertyIsEnumerable,SE=(t,e,r)=>e in t?sle(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,lle=(t,e)=>{for(var r in e||(e={}))ale.call(e,r)&&SE(t,r,e[r]);if(OE)for(var r of OE(e))cle.call(e,r)&&SE(t,r,e[r]);return t};function _2({drawDefinition:t,timeItem:e}){if(!t)return{error:Cn};if(!e)return{error:TA};const r=e&&Object.keys(e),n=["itemType","itemValue"];if(!(n.filter(s=>r.includes(s)).length===n.length))return{error:bA};t.timeItems||(t.timeItems=[]);const i=new Date().toISOString();return Object.assign(e,{createdAt:i}),t.timeItems.push(e),xc({drawDefinition:t}),lle({},B)}var ule=Object.defineProperty,dle=Object.defineProperties,ple=Object.getOwnPropertyDescriptors,Uu=Object.getOwnPropertySymbols,I2=Object.prototype.hasOwnProperty,P2=Object.prototype.propertyIsEnumerable,bE=(t,e,r)=>e in t?ule(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Cu=(t,e)=>{for(var r in e||(e={}))I2.call(e,r)&&bE(t,r,e[r]);if(Uu)for(var r of Uu(e))P2.call(e,r)&&bE(t,r,e[r]);return t},Mu=(t,e)=>dle(t,ple(e)),fle=(t,e)=>{var r={};for(var n in t)I2.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&Uu)for(var n of Uu(t))e.indexOf(n)<0&&P2.call(t,n)&&(r[n]=t[n]);return r};function vc({removePriorValues:t,tournamentRecord:e,participantId:r,scaleItem:n}){let o,i;if(!y2({scaleItem:n}))return{error:Hu};if(r&&Array.isArray(e.participants)&&(i=e.participants.find(s=>s.participantId===r),i)){const s=O2({removePriorValues:t,participant:i,scaleItem:n});if(s.error)return s;o=!s.valueChanged;const{topics:a}=Mn();a.includes(kt)&&Le({topic:kt,payload:{tournamentId:e.tournamentId,participants:[i]}})}return o&&Mu(Cu({},B),{info:NA,existingValue:n.scaleValue})||i&&Mu(Cu({},B),{newValue:n.scaleValue})||{error:Tt}}function vle({scaleItemsWithParticipantIds:t=[],removePriorValues:e,tournamentRecord:r,auditData:n,context:o}){var i;if(!r)return{error:ee};if(!r.participants)return{error:Ic};let s=0;const a={},c=[];for(const d of t){const p=d==null?void 0:d.participantId;Array.isArray(d==null?void 0:d.scaleItems)&&d.scaleItems.forEach(v=>{if(y2({scaleItem:v}))Array.isArray(a[p])||(a[p]=[]),a[p].push(v);else return{error:Hu}})}r.participants.forEach(d=>{const{participantId:p}=d||{};Array.isArray(a[p])&&a[p].forEach(v=>{O2({participant:d,scaleItem:v,removePriorValues:e}),c.push(d),s++})});const l=s?void 0:Pc,{topics:u}=Mn();if(u.includes(kt)&&s&&Le({topic:kt,payload:{tournamentId:r.tournamentId,participants:c}}),o){const d=o,{eventId:p,drawId:v}=d,f=fle(d,["eventId","drawId"]),m=((i=f.scaleAttributes)==null?void 0:i.scaleType)&&[f.scaleAttributes.scaleType];if(Object.keys(f).length){const g={itemType:mU,itemValue:f};if(m&&(g.itemSubTypes=m),v||p){const{drawDefinition:h,event:_}=Ft({tournamentRecord:r,eventId:p,drawId:v});v&&_2({drawDefinition:h,timeItem:g}),p&&zo({event:_,timeItem:g})}else Oo({tournamentRecord:r,timeItem:g})}}return n&&u.includes(tc)&&Le({topic:tc,payload:n}),_e(Mu(Cu({},B),{modificationsApplied:s,info:l}))}function y2({scaleItem:t}){const e=t&&Object.keys(t),r=["scaleType","eventType","scaleName"];return!!(r.filter(o=>e==null?void 0:e.includes(o)).length===r.length)}function O2({removePriorValues:t,participant:e,scaleItem:r}){if(!e)return{error:Vs};const n=r&&Object.keys(r),o=["scaleType","eventType","scaleName"];if(!(o.filter(u=>n.includes(u)&&r[u]).length===o.length))return{error:Hu};const s=new Date().toISOString();e.timeItems||(e.timeItems=[]);const{scaleItem:a}=kn({scaleAttributes:r,participant:e}),c=u=>[void 0,null,""].includes(u),l=!(c(a==null?void 0:a.scaleValue)&&c(r.scaleValue))&&JSON.stringify(a==null?void 0:a.scaleValue)!==JSON.stringify(r.scaleValue);if(l){const{scaleType:u,eventType:d,scaleName:p}=r,v=[es,u,d,p].join("."),f=_e({itemValue:r.scaleValue,itemDate:r.scaleDate,createdAt:s,itemType:v});r.scaleId&&(f.itemSubTypes=[r.scaleId]),t&&(e.timeItems=e.timeItems.filter(m=>m.itemType!==v)),e.timeItems.push(f)}return Mu(Cu({},B),{valueChanged:l,newValue:r.scaleValue})}const mle={getTournamentPenalties:mM,modifyPenalty:gM,removePenalty:vM,addPenalty:fM,createGroupParticipant:$ce,scaledTeamAssignment:yce,deleteParticipants:Na,addParticipants:Zn,addParticipant:An,addPersons:Wae,addIndividualParticipantIds:ug,removeIndividualParticipantIds:DD,modifyIndividualParticipantIds:nce,removeParticipantIdsFromAllTeams:ig,getParticipantMembership:Aae,generateTeamsFromParticipantAttribute:h2,getParticipantIdFinishingPositions:Rae,modifyParticipant:dg,modifyParticipantName:Yce,modifyParticipantOtherName:Dce,mergeParticipants:Zce,getPairedParticipant:$n,filterParticipants:Cd,setParticipantScaleItem:vc,setParticipantScaleItems:vle,modifyParticipantsSignInStatus:fce,getParticipantEventDetails:$ae,getEligibleVoluntaryConsolationParticipants:Nae,findParticipant:PL,getTournamentParticipants:Kt,getParticipantSchedules:jae,getTournamentPersons:Gce,getParticipants:Os};var gle=Object.defineProperty,TE=Object.getOwnPropertySymbols,hle=Object.prototype.hasOwnProperty,_le=Object.prototype.propertyIsEnumerable,EE=(t,e,r)=>e in t?gle(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,As=(t,e)=>{for(var r in e||(e={}))hle.call(e,r)&&EE(t,r,e[r]);if(TE)for(var r of TE(e))_le.call(e,r)&&EE(t,r,e[r]);return t};function Ile({removePriorValues:t=!0,stageSeedingScaleNames:e,seedingScaleNames:r,tournamentRecord:n,status:o=Nn,drawIds:i=[],event:s}){var a,c,l,u;if(!n)return{error:ee};if(!s)return{error:Re};const d=`${$r}.${Ar}`,{timeItem:p}=yo({itemType:d,event:s}),v=(p==null?void 0:p.itemValue)||{[o]:{}},f=(((a=v[o].seeding)==null?void 0:a.seedingScaleNames)||r)&&As(As({},(c=v[o].seeding)==null?void 0:c.seedingScaleNames),r),m=(((l=v[o].seeding)==null?void 0:l.stageSeedingScaleNames)||e)&&As(As({},(u=v[o].seeding)==null?void 0:u.stageSeedingScaleNames),e);return v[o].seeding=_e({stageSeedingScaleNames:m,seedingScaleNames:f,published:!0,drawIds:i}),zo({event:s,timeItem:{itemValue:v,itemType:d},removePriorValues:t}),Le({topic:OB,payload:{tournamentId:n.tournamentId,eventId:s.eventId,drawIds:i}}),As({},B)}function Ple({removePriorValues:t=!0,seedingScaleNames:e,tournamentRecord:r,status:n=Nn,stages:o,event:i}){var s,a;if(!r)return{error:ee};if(!i)return{error:Re};const c=`${$r}.${Ar}`,{timeItem:l}=yo({itemType:c,event:i}),u=(l==null?void 0:l.itemValue)||{[n]:{}};if(u[n]){if(Array.isArray(o)&&((s=u[n].seeding)!=null&&s.stageSeedingScaleNames))for(const p of o)u[n].seeding.stageSeedingScaleNames[p]&&delete u[n].seeding.stageSeedingScaleNames[p];Array.isArray(e)&&((a=u[n].seeding)!=null&&a.seedingScaleNames)&&(u[n].seeding.seedingScaleNames=u[n].seeding.seedingScaleNames.filter(p=>!e.includes(p))),!o&&!e&&delete u[n].seeding}return zo({event:i,timeItem:{itemValue:u,itemType:c},removePriorValues:t}),Le({topic:EU,payload:{tournamentId:r.tournamentId,eventId:i.eventId}}),As({},B)}function yle({tournamentRecord:t,policyDefinitions:e}){if(!t)return{error:ee};const r=t.events||[],n=(t==null?void 0:t.participants)||[],{tournamentInfo:o}=tl({tournamentRecord:t}),{venues:i}=wv({tournamentRecord:t}),s=r.map(c=>{const{eventId:l}=c,u=(({eventId:f,eventName:m,eventType:g,eventLevel:h,surfaceCategory:_,matchUpFormat:I,category:P,gender:S,startDate:y,endDate:O,ballType:b,discipline:E})=>({eventId:f,eventName:m,eventType:g,eventLevel:h,surfaceCategory:_,matchUpFormat:I,category:P,gender:S,startDate:y,endDate:O,ballType:b,discipline:E}))(c),d=bc({tournamentRecord:t,event:c}).scheduleTiming,p=(c.drawDefinitions||[]).map(f=>{const m=(({drawId:P,drawName:S,matchUpFormat:y,updatedAt:O})=>({drawId:P,drawName:S,matchUpFormat:y,updatedAt:O}))(f),{pendingMatchUps:g,completedMatchUps:h,upcomingMatchUps:_,abandonedMatchUps:I}=gs({includeByeMatchUps:!1,requireParticipants:!0,tournamentParticipants:n,context:{eventId:l},policyDefinitions:e,tournamentRecord:t,inContext:!0,drawDefinition:f,scheduleTiming:d,event:c});return{drawInfo:m,matchUps:{abandonedMatchUps:I,completedMatchUps:h,upcomingMatchUps:_,pendingMatchUps:g}}}),{timeItem:v}=yo({itemType:`${$r}.${Ar}`,event:c});return Object.assign(u,{publish:v==null?void 0:v.itemValue,drawsData:p}),u});return{allEventData:{tournamentInfo:o,venuesData:i,eventsData:s}}}function Ole({removePriorValues:t=!0,tournamentRecord:e,status:r=Nn,event:n}){if(!e)return{error:ee};if(!n)return{error:Re};const o=`${$r}.${Ar}`,{timeItem:i}=yo({itemType:o,event:n}),s=(i==null?void 0:i.itemValue)||{[r]:{}};return delete s[r].drawIds,delete s[r].structureIds,zo({event:n,timeItem:{itemValue:s,itemType:o},removePriorValues:t}),Le({topic:TU,payload:{tournamentId:e.tournamentId,eventId:n.eventId}}),Object.assign({eventId:n.eventId},B)}function S2({drawDefinition:t}){const e=t.links||[],r={},n={};let o=e.map(v=>{const f=v.source.structureId,m=v.target.structureId;return n[m]=n[m]||v.target.feedProfile===zr,r[m]=Ve([...r[m]||[],f]).filter(Boolean),[v.source.structureId,v.target.structureId]});const i=o.length;le(0,Math.ceil(i/2)).forEach(()=>{o=le(0,i).map(v=>{const f=o[v],m=o.reduce((g,h)=>Gt(f,h)?g.concat(...h):g,[])||[];return Ve(f.concat(...m))})});const s=o[0],a=(v,f)=>Dt(v,f).length===v.length,c=o.slice(1).reduce((v,f)=>v&&a(f,s),!0),l=[s].filter(Boolean),u=[s].filter(Boolean);return(t.structures||[]).forEach(v=>{const{structureId:f,stage:m}=v;l.find(h=>h.includes(f))||(l.push([f]),m!==Nt&&u.push(f))}),{allStructuresLinked:c&&u.length===1,sourceStructureIds:r,hasDrawFeedProfile:n,structureGroups:l}}var Sle=Object.defineProperty,ble=Object.defineProperties,Tle=Object.getOwnPropertyDescriptors,wE=Object.getOwnPropertySymbols,Ele=Object.prototype.hasOwnProperty,wle=Object.prototype.propertyIsEnumerable,NE=(t,e,r)=>e in t?Sle(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,zp=(t,e)=>{for(var r in e||(e={}))Ele.call(e,r)&&NE(t,r,e[r]);if(wE)for(var r of wE(e))wle.call(e,r)&&NE(t,r,e[r]);return t},Nle=(t,e)=>ble(t,Tle(e));function b2({tournamentParticipants:t=[],includePositionAssignments:e,policyDefinitions:r,tournamentRecord:n,inContext:o=!0,drawDefinition:i,noDeepCopy:s,sortConfig:a,context:c,event:l}){if(!i)return{error:pe};const u=(({matchUpFormat:S,updatedAt:y,drawType:O,drawName:b,drawId:E})=>({matchUpFormat:S,updatedAt:y,drawName:b,drawType:O,drawId:E}))(i);let d,p;const{allStructuresLinked:v,sourceStructureIds:f,hasDrawFeedProfile:m,structureGroups:g}=S2({drawDefinition:i});if(!v)return{error:{error:dR}};let h=!1,_=!1;const P=g.map(S=>{const y={},O=S.map(b=>{const{structure:E}=Te({drawDefinition:i,structureId:b}),{seedAssignments:T}=cn({drawDefinition:i,structure:E,event:l});return E.stage===ue&&E.stageSequence===1&&(d=T),E.stage===Ie&&E.stageSequence===1&&(p=T),E}).sort((b,E)=>yi(b,E,a)).map(b=>{var E;const{structureId:T}=b;let N=[];[ue,Et,it].includes(b.stage)&&(N=d),b.stage===Ie&&(N=p);const{matchUps:w,roundMatchUps:$,roundProfile:U}=Ke({seedAssignments:(E=b==null?void 0:b.seedAssignments)!=null&&E.length?void 0:N,context:zp({drawId:u.drawId},c),tournamentParticipants:t,policyDefinitions:r,tournamentRecord:n,drawDefinition:i,structure:b,inContext:o,event:l}),{positionAssignments:A}=Xe({structure:b}),C=A.filter(pd).map(V=>{_=!0;const{drawPosition:R,participantId:W}=V,{extension:x}=Lt({element:V,name:Do});return x&&{drawPosition:R,participantId:W,participantResult:x.value}}).filter(V=>V==null?void 0:V.participantResult),M=(({stageSequence:V,structureName:R,structureType:W,matchUpFormat:x,stage:K})=>({stageSequence:V,structureName:R,structureType:W,matchUpFormat:x,stage:K}))(b);M.sourceStructureIds=f[T],M.hasDrawFeedProfile=m[T],M.positionAssignments=A,M.structureActive=w.reduce((V,R)=>{var W;const x=[_t,_o,Be,Xt,Ge,dn,Ot,gt].includes(R.matchUpStatus);return V||x||!!R.winningSide||!!((W=R.score)!=null&&W.scoreStringSide1)},!1);const D=w.reduce((V,R)=>V&&[qe,_t,Xt,Ge,Be,gr].includes(R.matchUpStatus),!!w.length);return M.structureCompleted=D,y[T]=D,M.structureActive&&(h=!0),Nle(zp({},M),{participantResults:C,seedAssignments:N,roundMatchUps:$,roundProfile:U,structureId:T})});return O.forEach(b=>{var E;e||delete b.positionAssignments,b.sourceStructuresComplete=(E=b.sourceStructureIds)==null?void 0:E.every(T=>y[T])}),O}).flat();return u.drawActive=h,u.participantPlacements=_,u.drawGenerated=P==null?void 0:P.reduce((S,y)=>S||!!(y!=null&&y.roundMatchUps),!1),u.drawCompleted=P==null?void 0:P.reduce((S,y)=>S&&y.structureCompleted,!0),zp({structures:s?P:de(P,!1,!0),drawInfo:s?u:de(u,!1,!0)},B)}var $le=Object.defineProperty,Ale=Object.defineProperties,Ule=Object.getOwnPropertyDescriptors,Du=Object.getOwnPropertySymbols,T2=Object.prototype.hasOwnProperty,E2=Object.prototype.propertyIsEnumerable,$E=(t,e,r)=>e in t?$le(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ca=(t,e)=>{for(var r in e||(e={}))T2.call(e,r)&&$E(t,r,e[r]);if(Du)for(var r of Du(e))E2.call(e,r)&&$E(t,r,e[r]);return t},bl=(t,e)=>Ale(t,Ule(e)),Cle=(t,e)=>{var r={};for(var n in t)T2.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&Du)for(var n of Du(t))e.indexOf(n)<0&&E2.call(t,n)&&(r[n]=t[n]);return r};function w2({includePositionAssignments:t,tournamentRecord:e,participantsProfile:r,policyDefinitions:n,usePublishState:o,status:i=Nn,sortConfig:s,event:a}){var c;const l=de(e,!1,!0),u=de(a,!1,!0);if(!l)return{error:ee};if(!u)return{error:Re};const{eventId:d}=u,{tournamentId:p,endDate:v}=l,{timeItem:f}=yo({itemType:`${$r}.${Ar}`,event:u}),m=(c=f==null?void 0:f.itemValue)==null?void 0:c[i],{tournamentParticipants:g}=Kt(bl(Ca({withGroupings:!0,withEvents:!1,withDraws:!1},r),{tournamentRecord:l})),h=({structureId:T})=>{var N;return!o||!((N=m==null?void 0:m.structureIds)!=null&&N.length)||m.structureIds.includes(T)},_=({drawId:T})=>{var N;return!o||!((N=m==null?void 0:m.drawIds)!=null&&N.length)||m.drawIds.includes(T)},P=(u.drawDefinitions||[]).filter(_).map(T=>(({drawInfo:N,structures:w})=>bl(Ca({},N),{structures:w}))(b2({context:{eventId:d,tournamentId:p,endDate:v},includePositionAssignments:t,tournamentParticipants:g,noDeepCopy:!0,policyDefinitions:n,tournamentRecord:l,drawDefinition:T,sortConfig:s,event:u}))).map(T=>{var N=T,{structures:w}=N,$=Cle(N,["structures"]);return bl(Ca({},$),{structures:w==null?void 0:w.filter(h)})}).filter(T=>{var N;return(N=T.structures)==null?void 0:N.length}),{tournamentInfo:S}=tl({tournamentRecord:l}),O=(l.venues||[]).map(T=>(({venueData:N})=>Ca({},N))(Zl({tournamentRecord:l,venueId:T.venueId}))),b=(({eventId:T,eventName:N,eventType:w,eventLevel:$,surfaceCategory:U,matchUpFormat:A,category:C,gender:M,startDate:D,endDate:V,ballType:R,discipline:W})=>({eventId:T,eventName:N,eventType:w,eventLevel:$,surfaceCategory:U,matchUpFormat:A,category:C,gender:M,startDate:D,endDate:V,ballType:R,discipline:W}))(u),E={tournamentInfo:S,venuesData:O,eventInfo:b,drawsData:P};return E.eventInfo.publish={createdAt:f==null?void 0:f.createdAt,state:f==null?void 0:f.itemValue},bl(Ca({},B),{eventData:E})}var Mle=Object.defineProperty,Dle=Object.defineProperties,jle=Object.getOwnPropertyDescriptors,AE=Object.getOwnPropertySymbols,Rle=Object.prototype.hasOwnProperty,Fle=Object.prototype.propertyIsEnumerable,UE=(t,e,r)=>e in t?Mle(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Vle=(t,e)=>{for(var r in e||(e={}))Rle.call(e,r)&&UE(t,r,e[r]);if(AE)for(var r of AE(e))Fle.call(e,r)&&UE(t,r,e[r]);return t},Lle=(t,e)=>Dle(t,jle(e));function sl({policyDefinitions:t,removePriorValues:e,tournamentRecord:r,status:n=Nn,event:o,drawIdsToRemove:i,drawIdsToAdd:s,drawIds:a,includePositionAssignments:c,structureIdsToRemove:l,structureIdsToAdd:u,structureIds:d}){var p,v,f,m,g,h,_;if(!r)return{error:ee};if(!o)return{error:Re};if(!t){const{appliedPolicies:E}=ct({tournamentRecord:r,event:o});t=E}const I=`${$r}.${Ar}`,P=((p=o.drawDefinitions)==null?void 0:p.map(({drawId:E})=>E))||[],{timeItem:S}=yo({itemType:I,event:o});!a&&!s&&!i?a=P:!a&&(s!=null&&s.length||i!=null&&i.length)&&(a=((f=(v=S==null?void 0:S.itemValue)==null?void 0:v.PUBLIC)==null?void 0:f.drawIds)||[]),a=(a||[]).filter(E=>!(i!=null&&i.length)||!i.includes(E)),s!=null&&s.length&&(a=Ve(a.concat(...s.filter(E=>P.includes(E))))),!d&&(u!=null&&u.length||l!=null&&l.length)&&(d=((g=(m=S==null?void 0:S.itemValue)==null?void 0:m.PUBLIC)==null?void 0:g.drawIds)||[]),d=(d||[]).filter(E=>!(l!=null&&l.length)||!l.includes(E)),u!=null&&u.length&&(d=Ve(d.push(...u)));const y={itemValue:{[n]:{drawIds:a,structureIds:d}},itemType:I};zo({event:o,timeItem:y,removePriorValues:e});const{eventData:O}=w2({includePositionAssignments:c,usePublishState:!0,policyDefinitions:t,tournamentRecord:r,event:o}),b=(_=(h=O==null?void 0:O.eventInfo)==null?void 0:h.publish)==null?void 0:_.state;return O.drawsData=O.drawsData.filter(({drawId:E})=>{var T;return(T=b==null?void 0:b.PUBLIC)==null?void 0:T.drawIds.includes(E)}),Le({payload:{eventData:O,tournamentId:r.tournamentId},topic:yB}),Lle(Vle({},B),{eventData:O})}const Ble={getTournamentInfo:tl,getVenueData:Zl,getCourtInfo:AU,getAllEventData:yle,getEventData:w2,getDrawData:b2,unPublishEventSeeding:Ple,publishEventSeeding:Ile,unPublishEvent:Ole,publishEvent:sl,unPublishOrderOfPlay:_M,publishOrderOfPlay:IM};var xle=Object.defineProperty,Gle=Object.defineProperties,kle=Object.getOwnPropertyDescriptors,CE=Object.getOwnPropertySymbols,Wle=Object.prototype.hasOwnProperty,qle=Object.prototype.propertyIsEnumerable,ME=(t,e,r)=>e in t?xle(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Hle=(t,e)=>{for(var r in e||(e={}))Wle.call(e,r)&&ME(t,r,e[r]);if(CE)for(var r of CE(e))qle.call(e,r)&&ME(t,r,e[r]);return t},Yle=(t,e)=>Gle(t,kle(e));function Kle({tournament:t}){if(!t)return{error:ee};const{providerTournamentID:e,hostCountryCode:r,tournamentLevel:n,totalPrizeMoney:o,tournamentName:i,extensions:s,startDate:a,endDate:c}=t,l=lg({hostCountryCode:r,tournamentLevel:n,totalPrizeMoney:o,tournamentName:i,tournamentId:e,extensions:s,startDate:a,endDate:c});l.events=[];for(const u of t.events||[]){const{extensions:d,ageCategory:p,discipline:v,eventType:f,eventId:m,gender:g,stages:h}=u,_={drawDefinitions:zle(h),category:{ageCategory:p},gender:["M",at].includes(g)&&at||["F",vt].includes(g)&&vt||void 0,eventType:["D",mr].includes(f)&&mr||["T",yt].includes(f)?yt:Yn,extensions:d,discipline:v,eventId:m};l.events.push(_)}return Yle(Hle({},B),{tournamentRecord:l})}function zle(t){const e=[];for(const r of t||[]){const{stageType:n}=r,o=["M",ue].includes(n)&&ue||["Q",Ie].includes(n)&&Ie||["C",Et].includes(n)&&Et||["P",it].includes(n)&&it||void 0;for(const i of r.draws||[]){const{drawId:s,drawSize:a,matchUps:c}=i,l={stage:o,drawId:s,drawSize:a};e.push(l),console.log(c.map(({roundNumber:u,roundPosition:d})=>({roundNumber:u,roundPosition:d})),{draw:i,drawDefinition:l})}}return e}const Qle="ABANDONED",Jle="ACTIVE",Zle="CANCELLED",Xle="COMPLETED",eue="IN_PROGRESS",tue={ABANDONED:Qle,ACTIVE:Jle,CANCELLED:Zle,COMPLETED:Xle,IN_PROGRESS:eue};var rue=Object.defineProperty,DE=Object.getOwnPropertySymbols,nue=Object.prototype.hasOwnProperty,oue=Object.prototype.propertyIsEnumerable,jE=(t,e,r)=>e in t?rue(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,iue=(t,e)=>{for(var r in e||(e={}))nue.call(e,r)&&jE(t,r,e[r]);if(DE)for(var r of DE(e))oue.call(e,r)&&jE(t,r,e[r]);return t};function sue({tournamentRecord:t,status:e}){return t?e&&!Object.keys(tue).includes(e)?{error:Z,info:"Unknown status"}:(t.tournamentStatus=e,iue({},B)):{error:ee}}var aue=Object.defineProperty,cue=Object.defineProperties,lue=Object.getOwnPropertyDescriptors,RE=Object.getOwnPropertySymbols,uue=Object.prototype.hasOwnProperty,due=Object.prototype.propertyIsEnumerable,FE=(t,e,r)=>e in t?aue(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,pue=(t,e)=>{for(var r in e||(e={}))uue.call(e,r)&&FE(t,r,e[r]);if(RE)for(var r of RE(e))due.call(e,r)&&FE(t,r,e[r]);return t},fue=(t,e)=>cue(t,lue(e));function pg({tournamentRecord:t}){var e;if(!t)return{error:ee};const r={positionsNoOutcomes:[],canBePruned:[],matchPlay:[],inactive:[],drawAnalysis:{}};return((e=t.events)==null?void 0:e.map(o=>o==null?void 0:o.drawDefinitions).flat().filter(Boolean)).forEach(o=>{let i=0,s=0,a=0;const{allStructuresLinked:c}=S2({drawDefinition:o}),u=((o==null?void 0:o.structures)||[]).map(I=>{const{stage:P,stageSequence:S,structureId:y}=I,O=rs[P],{inContextStructureMatchUps:b}=Yc({drawDefinition:o,structure:I}),E=b==null?void 0:b.filter(({winningSide:x})=>x),T=E.filter(Boolean).length||0;s+=T,a+=b.length-s;const N=Math.max(E.filter(({roundNumber:x})=>x===1).map(({roundPosition:x})=>x)),{positionAssignments:w}=Xe({structure:I}),$=w==null?void 0:w.filter(({participantId:x})=>x);i+=$.length;const U=((w==null?void 0:w.length)||0)-(($==null?void 0:$.length)||0),{roundMatchUps:A,roundProfile:C,roundNumbers:M,maxMatchUpsCount:D}=lr({matchUps:b}),V=Object.keys(C).filter(x=>!C[x].inactiveRound).map(x=>parseInt(x)),R=Object.keys(C).filter(x=>C[x].inactiveRound).map(x=>parseInt(x)),W=Object.values(C).every(x=>x.inactiveRound);return{positionsAssignedCount:($==null?void 0:$.length)||0,maxWinningSideFirstRoundPosition:N,unassignedPositionsCount:U,inactiveStructure:W,maxMatchUpsCount:D,inactiveRounds:R,roundMatchUps:A,activeRounds:V,roundNumbers:M,roundProfile:C,structureId:y,stageSequence:S,orderNumber:O,stage:P}}),d=u.find(I=>I.orderNumber===2&&I.stageSequence===1),p=u.filter(({inactiveStructure:I})=>!I).length,{links:v}=Gc({drawDefinition:o,structureId:d.structureId}),f=parseInt(d.activeRounds[0])===1&&d.activeRounds.length===1&&p===1,m=u==null?void 0:u.every(({inactiveStructure:I})=>I),g=!v.length&&d.activeRounds.length&&(d.roundProfile[1].inactiveCount||d.inactiveRounds.length),h=o.drawId;i&&!s&&r.positionsNoOutcomes.push(h),m&&r.inactive.push(h),f&&r.matchPlay.push(h),g&&r.canBePruned.push(h);const _={matchUpsWithWinningSideCount:s,matchUpsNoOutcomeCount:a,positionsAssignedCount:i,allStructuresLinked:c,structuresData:u,inactiveDraw:m,isMatchPlay:f,drawId:h};r.drawAnalysis[h]=_}),fue(pue({},B),{drawsAnalysis:r})}function vue(t){var e,r,n,o,i;const s=(e=t.participants)==null?void 0:e.filter(({participantType:p})=>p===Ye),a=(s==null?void 0:s.length)===2,c=((r=t.events)==null?void 0:r.length)===1&&t.events[0],l=((n=c==null?void 0:c.drawDefinitions)==null?void 0:n.length)===1&&c.drawDefinitions[0],u=((o=l==null?void 0:l.structures)==null?void 0:o.length)===1&&l.structures[0],d=((i=u==null?void 0:u.positionAssignments)==null?void 0:i.length)===2;return!!(c.tieFormat&&a&&d)}var mue=Object.defineProperty,gue=Object.defineProperties,hue=Object.getOwnPropertyDescriptors,VE=Object.getOwnPropertySymbols,_ue=Object.prototype.hasOwnProperty,Iue=Object.prototype.propertyIsEnumerable,LE=(t,e,r)=>e in t?mue(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Pue=(t,e)=>{for(var r in e||(e={}))_ue.call(e,r)&&LE(t,r,e[r]);if(VE)for(var r of VE(e))Iue.call(e,r)&&LE(t,r,e[r]);return t},yue=(t,e)=>gue(t,hue(e));function Oue({tournamentRecord:t}){if(!t)return{error:ee};const{drawsAnalysis:e}=pg({tournamentRecord:t}),r={isDual:vue(t),drawsAnalysis:e};return yue(Pue({},B),{analysis:r})}var Sue=Object.defineProperty,BE=Object.getOwnPropertySymbols,bue=Object.prototype.hasOwnProperty,Tue=Object.prototype.propertyIsEnumerable,xE=(t,e,r)=>e in t?Sue(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,N2=(t,e)=>{for(var r in e||(e={}))bue.call(e,r)&&xE(t,r,e[r]);if(BE)for(var r of BE(e))Tue.call(e,r)&&xE(t,r,e[r]);return t};function Eue({tournamentRecord:t,promotionalName:e,tournamentName:r,formalName:n}){return t?(r&&(t.tournamentName=r),e&&(t.promotionalName=e),n&&(t.formalName=n),t.promotionalName===t.tournamentName&&delete t.promotionalName,t.formalName===t.tournamentName&&delete t.formalName,N2({},B)):{error:ee}}function wue({tournamentRecord:t,notes:e}){return t?Gv({element:t,notes:e}):{error:ee}}function Nue({tournamentRecord:t,categories:e}){return t?(e=(e||[]).filter(r=>r.categoryName&&r.type),t.tournamentCategories=e,N2({},B)):{error:ee}}var $ue=Object.defineProperty,GE=Object.getOwnPropertySymbols,Aue=Object.prototype.hasOwnProperty,Uue=Object.prototype.propertyIsEnumerable,kE=(t,e,r)=>e in t?$ue(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Cue=(t,e)=>{for(var r in e||(e={}))Aue.call(e,r)&&kE(t,r,e[r]);if(GE)for(var r of GE(e))Uue.call(e,r)&&kE(t,r,e[r]);return t};function Mue({tournamentRecord:t}){var e;if(!t)return{error:ee};const{startDate:r,endDate:n}=t,o=av(r,n),i=[];for(const s of t.venues||[])(e=s==null?void 0:s.courts)!=null&&e.length&&i.push(...s.courts);for(const s of i){const{startTime:a,endTime:c}=(s.dateAvailability||[]).reduce((u,d)=>{const p=je(u.startTime),v=je(u.endTime);return d.startTime&&je(d.startTime)<p&&(u.startTime=d.startTime),d.endTime&&je(d.endTime)>v&&(u.endTime=d.endTime),u},{startTime:"08:00",endTime:"18:00"}),l=o.map(u=>s.dateAvailability.find(p=>p.date===u)||{date:u,startTime:a,endTime:c});s.dateAvailability=l}return Cue({},B)}var Due=Object.defineProperty,jue=Object.defineProperties,Rue=Object.getOwnPropertyDescriptors,WE=Object.getOwnPropertySymbols,Fue=Object.prototype.hasOwnProperty,Vue=Object.prototype.propertyIsEnumerable,qE=(t,e,r)=>e in t?Due(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Lue=(t,e)=>{for(var r in e||(e={}))Fue.call(e,r)&&qE(t,r,e[r]);if(WE)for(var r of WE(e))Vue.call(e,r)&&qE(t,r,e[r]);return t},Bue=(t,e)=>jue(t,Rue(e));function fg({tournamentRecord:t,startDate:e,endDate:r}){var n;if(!t)return{error:ee};if(e&&!Tn.test(e)||r&&!Tn.test(r))return{error:ar};if(!e&&!r)return{error:vA};if(r&&e&&new Date(r)<new Date(e))return{error:Z};let o;(e&&t.startDate&&new Date(e)>new Date(t.startDate)||r&&t.endDate&&new Date(r)<new Date(t.endDate))&&(o=!0),e&&(t.startDate=e),r&&(t.endDate=r),e&&t.endDate&&new Date(e)>new Date(t.endDate)&&(t.endDate=e),r&&t.startDate&&new Date(r)<new Date(t.startDate)&&(t.startDate=r);const i=o&&((n=kue({tournamentRecord:t}))==null?void 0:n.unscheduledMatchUpIds);return Mue({tournamentRecord:t}),Le({topic:PB,payload:{startDate:e,endDate:r}}),Bue(Lue({},B),{unscheduledMatchUpIds:i})}function xue({tournamentRecord:t,startDate:e}){return fg({tournamentRecord:t,startDate:e})}function Gue({tournamentRecord:t,endDate:e}){return fg({tournamentRecord:t,endDate:e})}function kue({tournamentRecord:t}){const{matchUps:e}=Vt({tournamentRecord:t}),r=t.startDate&&new Date(t.startDate),n=t.endDate&&new Date(t.endDate),o=[],i=[];for(const s of e){const{schedule:a,matchUpId:c}=s;if(a&&a.scheduledDate){const l=new Date(a.scheduledDate);(r&&l<r||n&&l>n)&&(i.push(c),o.includes(a.scheduledDate)||o.push(a.scheduledDate))}}return o.length&&!Am({scheduledDates:o,tournamentRecord:t}).clearedScheduleCount?{error:Xj}:{unscheduledMatchUpIds:i}}const Wue={addNotes:Gv,removeNotes:fG,analyzeDraws:pg,analyzeTournament:Oue,getRounds:FM,getProfileRounds:Dm,setTournamentName:Eue,setTournamentNotes:wue,setTournamentDates:fg,setTournamentEndDate:Gue,setTournamentStartDate:xue,setTournamentCategories:Nue,addTimeItem:Hc,addEventTimeItem:zo,addTournamentTimeItem:Oo,addParticipantTimeItem:pC,addExtension:et,addEventExtension:eo,removeEventExtension:ed,addTournamentExtension:_i,removeTournamentExtension:Ov,addParticipantExtension:zL,removeParticipantExtension:JL,addDrawDefinitionExtension:yv,removeDrawDefinitionExtension:QL,setTournamentStatus:sue,convertPointEight:Kle};function que({tournamentRecord:t}){if(!t)return{error:ee};const e=[],{extension:r}=hr({tournamentRecord:t,name:wn});r&&e.push({method:"addTournamentExtension",params:{extension:r}});const n=t.events||[];for(const o of n){const{eventId:i}=o,{extension:s}=Po({event:o,name:wn});s&&e.push({method:"addEventExtension",params:{eventId:i,extension:s}})}return{methods:e}}function Hue({drawDefinition:t,courtDayDate:e,matchUpId:r}){return RM({drawDefinition:t,courtDayDate:e,matchUpId:r})}function Yue({tournamentRecord:t}){if(!t)return{error:ee};const e=[],{extension:r}=hr({name:Zi,tournamentRecord:t});r&&e.push({method:"addTournamentExtension",params:{extension:r}});const n=t.events||[];for(const o of n){const{eventId:i}=o,{extension:s}=Po({name:Zi,event:o});s&&e.push({params:{eventId:i,extension:s},method:"addEventExtension"})}return{methods:e}}var Kue=Object.defineProperty,HE=Object.getOwnPropertySymbols,zue=Object.prototype.hasOwnProperty,Que=Object.prototype.propertyIsEnumerable,YE=(t,e,r)=>e in t?Kue(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Jue=(t,e)=>{for(var r in e||(e={}))zue.call(e,r)&&YE(t,r,e[r]);if(HE)for(var r of HE(e))Que.call(e,r)&&YE(t,r,e[r]);return t};function Zue({scheduleAttributes:t=[jo,ts,Ec,wc,Nc,mn,Ro,io,$o],tournamentRecord:e,drawDefinition:r,matchUpId:n}){var o,i;const s="clearMatchUpSchedule",a=r?(o=Er({matchUpFilters:{matchUpIds:[n]},inContext:!1,drawDefinition:r}).matchUps)==null?void 0:o[0]:(i=Vt({matchUpFilters:{matchUpIds:[n]},tournamentRecord:e,inContext:!1}).matchUps)==null?void 0:i[0];if(!a)return{error:kr};const c=(a.timeItems||[]).filter(l=>!t.includes(l==null?void 0:l.itemType));return a.timeItems=c,ze({tournamentId:e.tournamentId,context:s,drawDefinition:r,matchUp:a}),Jue({},B)}const Xue={allocateTeamMatchUpCourts:Od,addMatchUpCourtOrder:nm,assignMatchUpCourt:Ps,assignMatchUpVenue:Oa,clearMatchUpSchedule:Zue,addMatchUpScheduleItems:eM,addMatchUpScheduledDate:hm,addMatchUpScheduledTime:_m,addMatchUpStartTime:tM,addMatchUpEndTime:rM,addMatchUpStopTime:nM,addMatchUpResumeTime:oM,addMatchUpOfficial:iM,getMatchUpFormatTiming:_v,modifyMatchUpFormatTiming:gm,getModifiedMatchUpFormatTiming:kC,getEventMatchUpFormatTiming:yM,modifyEventMatchUpFormatTiming:WC,removeEventMatchUpFormatTiming:DM,getMatchUpFormatTimingUpdate:que,getMatchUpDependencies:qr,getMatchUpDailyLimits:CM,setMatchUpDailyLimits:aM,getMatchUpDailyLimitsUpdate:Yue,validateSchedulingProfile:jd,setSchedulingProfile:DQ,getSchedulingProfile:Ld,removeMatchUpCourtAssignment:Hue,clearScheduledMatchUps:Am,bulkScheduleMatchUps:vC,bulkRescheduleMatchUps:sM};function ede({tournamentRecord:t,categoryName:e,categoryType:r}){if(!t)return{error:ee};const{appliedPolicies:n}=ct({tournamentRecord:t}),o=n==null?void 0:n[va];return((o==null?void 0:o.matchUpFormats)||[]).filter(({categoryNames:s,categoryTypes:a})=>!e&&!a||e&&(s==null?void 0:s.includes(e))||r&&(a==null?void 0:a.includes(r)))}function $2({tournamentRecord:t,categoryName:e,categoryType:r}){if(!t)return{error:ee};const{appliedPolicies:n}=ct({tournamentRecord:t}),o=n==null?void 0:n[LV];return((o==null?void 0:o.allowedDrawTypes)||[]).filter(({categoryNames:s,categoryTypes:a})=>!e&&!a||e&&(s==null?void 0:s.includes(e))||r&&(a==null?void 0:a.includes(r)))}function A2({policyDefinitions:t,drawDefinition:e,drawSize:r,drawId:n,event:o,stage:i}){if(!o)return{error:Re};const{entries:s,stageEntries:a}=RD({drawDefinition:e,drawId:n,stage:i,event:o}),c=a.length,{drawSize:l}=rg({participantCount:c}),u=ng({drawSize:r||l,policyDefinitions:t,participantCount:c});if(u.error)return k({result:u,stack:"getEntriesAndSeedsCount"});const{seedsCount:d}=u;return{entries:s,seedsCount:d,stageEntries:a}}const tde={attachPolicies:jm,attachEventPolicies:VM,removeEventPolicy:o9,findPolicy:us,getSeedsCount:ng,getEntriesAndSeedsCount:A2,getAllowedDrawTypes:$2,getAllowedMatchUpFormats:ede,getAppliedPolicies:ct};function ju({participant:t,eventType:e}){var r,n,o,i,s,a;const c=(r=t==null?void 0:t.person)==null?void 0:r.personId,l=(o=(n=t==null?void 0:t.person)==null?void 0:n.personOtherIds)==null?void 0:o[0],u=(i=t==null?void 0:t.person)==null?void 0:i.tennisId,d=(a=(s=t==null?void 0:t.ratings)==null?void 0:s[e])==null?void 0:a.find(({scaleName:m})=>m===C1),p=d==null?void 0:d.scaleValue,{wtnRating:v,confidence:f}=p||{};return{timeStamp:d==null?void 0:d.scaleDate,personOtherId:l,confidence:f,wtnRating:v,personId:c,tennisId:u}}var rde=Object.defineProperty,nde=Object.defineProperties,ode=Object.getOwnPropertyDescriptors,KE=Object.getOwnPropertySymbols,ide=Object.prototype.hasOwnProperty,sde=Object.prototype.propertyIsEnumerable,zE=(t,e,r)=>e in t?rde(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,QE=(t,e)=>{for(var r in e||(e={}))ide.call(e,r)&&zE(t,r,e[r]);if(KE)for(var r of KE(e))sde.call(e,r)&&zE(t,r,e[r]);return t},ade=(t,e)=>nde(t,ode(e));function cde({tournamentRecord:t}){if(!t)return{error:ee};const e=t.tournamentId,{participantMap:r}=Os({withScaleValues:!0,withEvents:!0,withSeeding:!0,tournamentRecord:t,withDraws:!0}),o=Vt({matchUpFilters:{matchUpTypes:[ri,Kr]},tournamentRecord:t}).matchUps.flatMap(({sides:f,matchUpType:m})=>f.flatMap(({participant:g,participantId:h})=>m===Kr?g==null?void 0:g.individualParticipantIds:(g==null?void 0:g.participantId)||h).filter(Boolean)).filter(Boolean),i=[],s={},a={},c={};let l=0;const u=({id:f,entry:m,eventId:g,eventType:h})=>{var _;const{qualifyingSeeding:I,mainSeeding:P,entryStatus:S,entryStage:y,drawId:O}=m;s[f]||(s[f]=[]);const{participant:b,events:E}=r[f],T=ju({participant:b,eventType:h}),N=(_=E==null?void 0:E[g])==null?void 0:_.ranking;S===Z1&&i.push(f),s[f].push(ade(QE({participantType:b==null?void 0:b.participantType,participantId:f,tournamentId:e,eventType:h,eventId:g,drawId:O,entryStatus:S,entryStage:y},T),{ranking:N,mainSeeding:P,qualifyingSeeding:I}))};for(const f of t.events||[]){const m={},g=E=>{m[E]||(m[E]={count:0}),m[E].count+=1},{drawDefinitions:h=[],eventType:_,eventId:I}=f,P=h.flatMap(({drawId:E,entries:T,structures:N=[]})=>{l+=1;const w=({stage:C,stageSequence:M})=>C===ue&&M===1||C===Ie,$=N.filter(w).flatMap(({positionAssignments:C})=>C).map(({participantId:C})=>C).filter(Boolean),U=({participantId:C})=>$.includes(C),A=({participantId:C,entryStatus:M,entryStage:D})=>{var V,R,W,x,K,j,L,F;g(M);const q=(x=(W=(R=(V=r[C])==null?void 0:V.draws)==null?void 0:R[E])==null?void 0:W.seedAssignments)==null?void 0:x[ue];return{qualifyingSeeding:(F=(L=(j=(K=r[C])==null?void 0:K.draws)==null?void 0:j[E])==null?void 0:L.seedAssignments)==null?void 0:F[Ie],participantId:C,mainSeeding:q,entryStatus:M,entryStage:D,drawId:E}};return T.filter(U).map(A)}),S=E=>{const T=E.participantId,N=r[T].participant.individualParticipantIds.filter(w=>o.includes(w));return T&&{[T]:{individualParticipantIds:N}}};_===rc?(()=>{const E=Object.assign({},...P.map(S).filter(Boolean)),T=N=>{E[N.participantId].individualParticipantIds.forEach(w=>{u({id:w,eventType:_,eventId:I,entry:N})})};P.forEach(T)})():P.forEach(E=>{u({id:E.participantId,entry:E,eventId:I,eventType:_})});const O=Object.values(m).reduce((E,T)=>E+T.count,0);Object.keys(m).forEach(E=>{m[E].pct=m[E].count/O*100}),c[I]={tournamentId:e,eventId:I,entries:P,entryStatuses:m};const b=Object.assign({},...Ko.flatMap(E=>{var T,N;return[{[E+"_count"]:(T=m[E])==null?void 0:T.count},{[E+"_pct"]:(N=m[E])==null?void 0:N.pct}]}));a[I]=QE({tournamentId:e,eventId:I},b)}const d=Object.values(r).filter(({participant:{participantType:f,participantRole:m}})=>f===Ce&&m===xt),v={nonParticipatingEntriesCount:d.filter(({participant:f})=>!o.includes(f.participantId)).map(({participant:f})=>f.participantId).length,individualParticipantsCount:d.length,eventsCount:Object.values(c).length,drawDefinitionsCount:l,tournamentId:e};return{entryStatusReports:Object.values(a).flat(),participantEntryReports:Object.values(s).flat(),eventReports:Object.values(c).flat(),withDrawnParticipantIds:i,tournamentEntryReport:v}}function lde({matchUps:t,drawId:e,eventId:r,eventType:n}){const o={},i=({matchUpFormat:f})=>{f&&(o[f]||(o[f]=0),o[f]+=1)},s=t.filter(f=>r?f.eventId===r:f.drawId===e).reduce((f,m)=>(i(m),(m.sides||[]).flatMap(g=>{var h;return(((h=g==null?void 0:g.participant)==null?void 0:h.individualParticipants)||[g==null?void 0:g.participant]).filter(Boolean)}).forEach(g=>f[g.participantId]=g),f),{}),a=Object.values(s),c=a.map(f=>ju({participant:f,eventType:n})).filter(({wtnRating:f})=>f),l=(a.length-c.length)/a.length*100,u=c.reduce((f,m)=>{const{wtnRating:g,confidence:h}=m;return f.totalWTN+=g,f.totalConfidence+=h,f},{totalWTN:0,totalConfidence:0}),d=c!=null&&c.length?u.totalWTN/c.length:0,p=c!=null&&c.length?u.totalConfidence/c.length:0,v=Object.values(o).reduce((f,m)=>f+=m||0,0);return{avgWTN:d,avgConfidence:p,matchUpFormats:o,matchUpsCount:v,pctNoRating:l}}var ude=Object.defineProperty,dde=Object.defineProperties,pde=Object.getOwnPropertyDescriptors,JE=Object.getOwnPropertySymbols,fde=Object.prototype.hasOwnProperty,vde=Object.prototype.propertyIsEnumerable,ZE=(t,e,r)=>e in t?ude(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,mde=(t,e)=>{for(var r in e||(e={}))fde.call(e,r)&&ZE(t,r,e[r]);if(JE)for(var r of JE(e))vde.call(e,r)&&ZE(t,r,e[r]);return t},gde=(t,e)=>dde(t,pde(e));function hde({firstFlightOnly:t=!0,extensionProfiles:e,tournamentRecord:r}){var n;if(!r)return{error:so};const o={},i=Object.assign({},...(e||[]).map(({name:d,label:p,accessor:v})=>{var f,m,g;const h=(m=(f=hr({tournamentRecord:r,name:d}))==null?void 0:f.extension)==null?void 0:m.value,_=v?(g=Ud({element:h,accessor:v}))==null?void 0:g.value:h;return{[p||d]:_}})),s=r==null?void 0:r.tournamentId,c=Vt({participantsProfile:{withScaleValues:!0},tournamentRecord:r}).matchUps||[],l=d=>{var p,v;const f=(p=pn({itemType:mU,itemSubTypes:[Xr],element:{timeItems:d}}))==null?void 0:p.timeItem;return(v=f==null?void 0:f.itemValue)==null?void 0:v.scaleBasis},u=(n=r==null?void 0:r.events)==null?void 0:n.flatMap(({timeItems:d,drawDefinitions:p=[],extensions:v,eventType:f,eventId:m,category:g})=>{var h,_,I,P;const S=v==null?void 0:v.find(N=>N.name===nn),y=(_=(h=S==null?void 0:S.value)==null?void 0:h.flights)==null?void 0:_.map(N=>({[N.drawId]:N.flightNumber})),O=y&&Object.assign({},...y),b=((P=(I=v==null?void 0:v.find(N=>N.name===zl))==null?void 0:I.value)==null?void 0:P.length)||0,E=O&&Math.min(...Object.values(O)),T=l(d);return o[m]={totalPositionManipulations:0,maxPositionManipulations:0,generatedDrawsCount:0,drawDeletionsCount:b,seedingBasis:T?JSON.stringify(T):void 0,tournamentId:s,eventId:m},p.filter(N=>!t||!y||O[N.drawId]===E).flatMap(({matchUpFormat:N,tieFormat:w,timeItems:$,extensions:U,structures:A,drawType:C,drawId:M})=>{const{avgConfidence:D,matchUpFormats:V,matchUpsCount:R,pctNoRating:W,avgWTN:x}=lde({eventType:f,matchUps:c,drawId:M}),K=l($)||T,j=_de({extensions:U}),L=(j==null?void 0:j.length)||0;return o[m].totalPositionManipulations+=L,o[m].generatedDrawsCount+=1,L>o[m].maxPositionManipulations&&(o[m].maxPositionManipulations=L),A==null?void 0:A.filter(F=>F.stageSequence===1&&[Ie,ue,Et,it].includes(F.stage)).map(F=>{var q,G,H;const Q=[ue,it].includes(F.stage)&&c.find(rt=>rt.structureId===F.structureId&&rt.finishingRound===1&&rt.winningSide),z=(G=(q=Q==null?void 0:Q.sides)==null?void 0:q.find(rt=>rt.sideNumber===Q.winningSide))==null?void 0:G.participant,Y=(z==null?void 0:z.participantType)===hn&&z.participantId,{individualParticipants:J}=(z==null?void 0:z.participantType)===we&&z||{},te=ju({participant:(J==null?void 0:J[0])||z,eventType:f}),{personId:ne,personOtherId:oe,tennisId:se,confidence:ve,wtnRating:X}=te||{},ie=ju({participant:J==null?void 0:J[1],eventType:f}),{personId:fe,personOtherId:Ee,tennisId:re,confidence:ae,wtnRating:me}=ie||{},{ageCategoryCode:Oe,categoryName:ce,subType:Pe}=g||{},$e=F.matchUpFormat||N,Ae=(V[$e]||0)/R*100,{tieFormatName:be,tieFormatDesc:ge}=iu(w),{tieFormatName:Ne,tieFormatDesc:Ue}=iu(F.tieFormat),he=ge===Ue,xe=!he&&Ne,De=F.tieFormat&&!he&&Ue,Je=((H=j==null?void 0:j.filter(rt=>rt.structureId===F.structureId))==null?void 0:H.length)||0;return gde(mde({},i),{tournamentId:s,eventId:m,structureId:F.structureId,drawId:M,eventType:f,category:Pe,categoryName:ce,ageCategoryCode:Oe,flightNumber:O[M],drawType:C,stage:F.stage,seedingBasis:K?JSON.stringify(K):void 0,winningPersonId:ne,winningPersonOtherId:oe,winningPersonTennisId:se,winningPersonWTNrating:X,winningPersonWTNconfidence:ve,winningPerson2Id:fe,winningPerson2OtherId:Ee,winningPerson2TennisId:re,winningPerson2WTNrating:me,winningPerson2WTNconfidence:ae,winningTeamId:Y,positionManipulations:Je,pctNoRating:W,matchUpFormat:$e,pctInitialMatchUpFormat:Ae,matchUpsCount:R,drawTieFormatName:be,drawTieFormatDesc:ge,tieFormatName:xe,tieFormatDesc:De,avgConfidence:D,avgWTN:x})})})});return{eventStructureReports:Object.values(o),structureReports:u}}function _de({extensions:t}){var e,r;return(r=(e=t==null?void 0:t.find(({name:n})=>n===Kl))==null?void 0:e.value)==null?void 0:r.slice(1)}const Ide={getStructureReports:hde,getEntryStatusReports:cde};function Pde({representativeParticipantIds:t,drawDefinition:e}){if(!e)return{error:Cn};if(!Array.isArray(t))return{error:Z};const r=Jn((e==null?void 0:e.entries)||[]);return t.length&&Dt(t,r).length<t.length?{error:Z}:yv({drawDefinition:e,extension:{name:mv,value:t}})}function yde({drawDefinition:t}){var e;const r=Zu({drawDefinition:t,name:"participantRepresentatives"});return r.error?r:{representativeParticipantIds:((e=r.extension)==null?void 0:e.value)||[]}}var Ode=Object.defineProperty,Sde=Object.defineProperties,bde=Object.getOwnPropertyDescriptors,XE=Object.getOwnPropertySymbols,Tde=Object.prototype.hasOwnProperty,Ede=Object.prototype.propertyIsEnumerable,ew=(t,e,r)=>e in t?Ode(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,tw=(t,e)=>{for(var r in e||(e={}))Tde.call(e,r)&&ew(t,r,e[r]);if(XE)for(var r of XE(e))Ede.call(e,r)&&ew(t,r,e[r]);return t},rw=(t,e)=>Sde(t,bde(e));function wde({tournamentRecord:t,drawDefinition:e,participantId:r,sideNumber:n,matchUpId:o,event:i}){var s;if(r&&typeof r!="string")return{error:ao};if(!e)return{error:pe};if(!o)return{error:Ut};const a=n===void 0;if(a&&(n=1),![1,2].includes(n))return{error:Z,sideNumber:n};const{matchUp:c,structure:l}=nt({drawDefinition:e,matchUpId:o,event:i});if(!(!(l!=null&&l.structures)&&!(e.drawType&&e.drawType!==sn)&&!(l!=null&&l.matchUps.find(({roundPosition:d})=>!!d))))return{error:iA};if(!r&&((s=c.score)!=null&&s.scoreStringSide1||Rt.includes(c.matchUpstatus)||[gt,Ot].includes(c.matchUpStatus)))return{error:Xf,info:"matchUp has completed status or score"};if(c.sides=[1,2].map(d=>{var p;const v=((p=c.sides)==null?void 0:p.find(f=>f.sideNumber===d))||{sideNumber:d};return n===d?rw(tw({},v),{participantId:r}):v}),a)for(const d of c.sides)d.sideNumber=3-d.sideNumber;return ze({tournamentId:t==null?void 0:t.tournamentId,context:"assignSideParticipant",drawDefinition:e,matchUp:c}),rw(tw({},B),{sidesSwapped:a})}function U2({lineUp:t,tieFormat:e}){let r=[];if(!Array.isArray(t))return r.push(Yt("lineUp")),{valid:!1,errors:r,error:Z};const n=t.every(s=>{if(typeof s!="object")return r.push("lineUp entries must be objects"),!1;const{participantId:a,collectionAssignments:c}=s;return a?typeof a!="string"?(r.push("participantIds must be strings"),!1):Array.isArray(c)?c.every(l=>{if(typeof l!="object")return r.push("collectionAssignments must be objects"),!1;const{collectionPosition:u}=l;return typeof u!="number"?(r.push("collectionPosition must be a number"),!1):!0}):(r.push(Yt("collectionAssignments")),!1):(r.push("Missing participantId"),!1)}),o=Ve(t.map(Ze)).length===t.length;return o||r.push("Duplicated participantId(s)"),{valid:n&&o,errors:r,error:r.length?Z:void 0}}var Nde=Object.defineProperty,nw=Object.getOwnPropertySymbols,$de=Object.prototype.hasOwnProperty,Ade=Object.prototype.propertyIsEnumerable,ow=(t,e,r)=>e in t?Nde(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ude=(t,e)=>{for(var r in e||(e={}))$de.call(e,r)&&ow(t,r,e[r]);if(nw)for(var r of nw(e))Ade.call(e,r)&&ow(t,r,e[r]);return t};function Qd({drawDefinition:t,participantId:e,tieFormat:r,lineUp:n}){if(typeof t!="object")return{error:pe};if(typeof e!="string")return{error:It};const o=U2({lineUp:n,tieFormat:r});if(!o.valid)return o;const{extension:i}=_r({element:t,name:En}),s=(i==null?void 0:i.value)||{};return s[e]=pm({lineUp:n}),et({element:t,extension:{name:En,value:s}}),xc({drawDefinition:t}),Ude({},B)}var Cde=Object.defineProperty,iw=Object.getOwnPropertySymbols,Mde=Object.prototype.hasOwnProperty,Dde=Object.prototype.propertyIsEnumerable,sw=(t,e,r)=>e in t?Cde(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,jde=(t,e)=>{for(var r in e||(e={}))Mde.call(e,r)&&sw(t,r,e[r]);if(iw)for(var r of iw(e))Dde.call(e,r)&&sw(t,r,e[r]);return t};function vg({tournamentRecord:t,drawDefinition:e,tieMatchUpId:r,event:n}){var o;if(!t)return{error:ee};if(!e)return{error:Mr};if(!n)return{error:Pr};const i=zt({drawDefinition:e}),{matchUp:s}=nt({matchUpId:r,drawDefinition:e,matchUpsMap:i});if(!s)return{error:kr};const{matchUp:a,structure:c}=nt({tournamentParticipants:t.participants,matchUpId:r,inContext:!0,drawDefinition:e,matchUpsMap:i,event:n}),{collectionPosition:l,drawPositions:u,collectionId:d,matchUpTieId:p,matchUpType:v}=a;if(![ut,ot].includes(v))return{error:Gr};const{positionAssignments:f}=Xe({structure:c}),m=f==null?void 0:f.filter(S=>u==null?void 0:u.includes(S.drawPosition)),g=Jn(m),{tournamentParticipants:h}=Kt({tournamentRecord:t,participantFilters:{participantTypes:[Ye],participantIds:g}}),{matchUp:_}=nt({matchUpId:p,drawDefinition:e,matchUpsMap:i}),{matchUp:I}=nt({matchUpId:p,inContext:!0,drawDefinition:e,matchUpsMap:i}),P=(o=Zt({matchUp:_,drawDefinition:e,structure:c,event:n}))==null?void 0:o.tieFormat;return jde({inContextDualMatchUp:I,inContextTieMatchUp:a,relevantAssignments:m,collectionPosition:l,teamParticipants:h,collectionId:d,matchUpType:v,dualMatchUp:_,tieMatchUp:s,tieFormat:P,structure:c},B)}var Rde=Object.defineProperty,Fde=Object.defineProperties,Vde=Object.getOwnPropertyDescriptors,aw=Object.getOwnPropertySymbols,Lde=Object.prototype.hasOwnProperty,Bde=Object.prototype.propertyIsEnumerable,cw=(t,e,r)=>e in t?Rde(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Tl=(t,e)=>{for(var r in e||(e={}))Lde.call(e,r)&&cw(t,r,e[r]);if(aw)for(var r of aw(e))Bde.call(e,r)&&cw(t,r,e[r]);return t},Qp=(t,e)=>Fde(t,Vde(e));function C2(t){var e,r,n,o,i,s,a,c,l;const u=vg(t);if(u.error)return u;const d="replaceTieMatchUpParticipantid",{existingParticipantId:p,tournamentRecord:v,newParticipantId:f,drawDefinition:m,substitution:g,event:h}=t;if(!p||!f)return k({result:{error:It},stack:d});if(p===f)return Tl({},B);const{inContextDualMatchUp:_,inContextTieMatchUp:I,collectionPosition:P,collectionId:S,dualMatchUp:y,tieMatchUp:O,tieFormat:b}=u,{matchUpType:E}=I,T=(e=I.sides)==null?void 0:e.find(H=>{var Q,z,Y;return((Q=H.participant)==null?void 0:Q.participantId)===p||((Y=(z=H.participant)==null?void 0:z.individualParticipantIds)==null?void 0:Y.includes(p))});if(!T)return{error:Tt};const{tournamentParticipants:N}=Kt({tournamentRecord:v,participantFilters:{participantIds:[p,f]}});if(N.length!==2)return k({result:{error:It},stack:d});if(N[0].participantType!==N[1].participantType)return k({result:{error:bn},stack:d});const{appliedPolicies:w}=ct({tournamentRecord:v,drawDefinition:m,event:h}),$=(w==null?void 0:w[zi])||Rm[zi],U=(r=$==null?void 0:$.processCodes)==null?void 0:r.substitution,{extension:A}=Lt({element:m,name:En}),C=(A==null?void 0:A.value)||{};if(!((n=y.sides)!=null&&n.length)){const H=({displaySideNumber:Q,drawPosition:z,sideNumber:Y})=>({drawPosition:z,sideNumber:Y,displaySideNumber:Q});y.sides=_.sides.map(Q=>{const z=Q.participantId;return Qp(Tl({},H(Q)),{lineUp:z&&C[z]||[]})})}const M=y.sides.find(({sideNumber:H})=>H===T.sideNumber);if(!M)return k({result:{sideNumber:T.sideNumber,existingParticipantId:p,error:Ht},stack:d});if(((o=I.sides)==null?void 0:o.flatMap(({participant:H})=>(H==null?void 0:H.individualParticipantIds)||(H==null?void 0:H.participantId)||[])).includes(f))return k({result:{error:tv},stack:d});const V=(s=(i=_.sides)==null?void 0:i.find(({sideNumber:H})=>H===T.sideNumber))==null?void 0:s.participantId,R=M.lineUp,W=R==null?void 0:R.find(({participantId:H})=>f===H),x=R==null?void 0:R.reduce((H,Q)=>Q.substitutionOrder>H?Q.substitutionOrder:H,0),K=(R==null?void 0:R.map(H=>{var Q;const z=de(H,!1,!0);if(![p,f].includes(z.participantId))return z;if(!g&&[p,f].includes(z.participantId)&&(z.collectionAssignments=(Q=z.collectionAssignments)==null?void 0:Q.filter(Y=>!(Y.collectionPosition===P&&Y.collectionId===S))),g&&p===z.participantId&&(z.collectionAssignments=z.collectionAssignments.map(Y=>Y.collectionPosition===P&&Y.collectionId===S&&Y.substitutionOrder===void 0?Qp(Tl({},Y),{substitutionOrder:x}):Y)),z.participantId===f){z.collectionAssignments||(z.collectionAssignments=[]);const Y={collectionId:S,collectionPosition:P};g&&(Y.previousParticipantId=p,Y.substitutionOrder=x+1),z.collectionAssignments.push(Y)}return z}))||[];if(!W){const H={collectionId:S,collectionPosition:P};g&&(H.substitutionOrder=x+1,H.previousParticipantId=p);const Q={collectionAssignments:[H],participantId:f};K.push(Q)}const j=E===ot,{assignedParticipantIds:L}=Xl({lineUp:R,collectionPosition:P,collectionId:S}),{assignedParticipantIds:F}=Xl({lineUp:K,collectionPosition:P,collectionId:S});if(M.lineUp=K,V){const H=Qd({participantId:V,lineUp:K,drawDefinition:m,tieFormat:b});if(H.error)return k({result:H,stack:d})}else console.log("team participantId not found");let q,G;if(j){const{tournamentRecord:H}=t;let Q=$n({participantIds:F,tournamentRecord:H});if(!Q.participant){const J=An({returnParticipant:!0,pairOverride:!0,tournamentRecord:H,participant:{participantRole:xt,individualParticipantIds:F,participantType:we}});if(J.error)return k({result:J,stack:d});q=(a=J.participant)==null?void 0:a.participantId}Q=$n({participantIds:L,tournamentRecord:H});const z=(c=Q.participant)==null?void 0:c.participantId;z&&Na({participantIds:[z],tournamentRecord:H}).success&&(G=z)}if(g||((l=T.substitutions)==null?void 0:l.length)===1){if(g){const H=O.processCodes||[];U&&H.push(...U),O.processCodes=H}else for(const H of U||[]){const Q=O.processCodes.lastIndexOf(H);O.processCodes.splice(Q,1)}ze({tournamentId:v==null?void 0:v.tournamentId,matchUp:O,context:d,drawDefinition:m})}return ze({tournamentId:v==null?void 0:v.tournamentId,matchUp:y,context:d,drawDefinition:m}),Qp(Tl({},B),{modifiedLineUp:K,participantRemoved:G,participantAdded:q})}function Bf({tournamentRecord:t,drawDefinition:e,structureId:r,structure:n}){return t?!n&&!e?{error:pe}:!n&&!r?{error:ur}:Xe({drawDefinition:e,structureId:r,structure:n}):{error:ee}}var xde=Object.defineProperty,Gde=Object.defineProperties,kde=Object.getOwnPropertyDescriptors,lw=Object.getOwnPropertySymbols,Wde=Object.prototype.hasOwnProperty,qde=Object.prototype.propertyIsEnumerable,uw=(t,e,r)=>e in t?xde(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Fl=(t,e)=>{for(var r in e||(e={}))Wde.call(e,r)&&uw(t,r,e[r]);if(lw)for(var r of lw(e))qde.call(e,r)&&uw(t,r,e[r]);return t},Hde=(t,e)=>Gde(t,kde(e));function mg({autoPublish:t=!0,policyDefinitions:e,tournamentRecord:r,drawIds:n=[],auditData:o,eventId:i,event:s}){var a,c,l;if(!r)return{error:ee};const u="deleteDrawDefinitions";if(!e){const{appliedPolicies:O}=ct({tournamentRecord:r,event:s});e=O}const d=Array.isArray(n)&&n[0];if(!s){const O=Ft({tournamentRecord:r,eventId:i,drawId:d});if(O.error)return O;s=O.event}const p=[],v=[],f=[];if(!s.drawDefinitions)return k({result:Fl({},B),info:"event has no drawDefinition",stack:u});const m=s.drawDefinitions.map(({drawId:O})=>O);if(n.length||(n=m),n=n.filter(O=>m.includes(O)),!n.length)return k({result:Fl({},B),info:"nothing to do; no matching drawIds in event.",stack:u});const g=de(ht({event:s}).flightProfile,!1,!0),h=({participantId:O,drawPosition:b,qualifier:E,bye:T})=>({bye:T,qualifier:E,drawPosition:b,participantId:O}),_=s.drawDefinitions.filter(O=>{var b,E,T,N,w,$;if(n.includes(O.drawId)){const{drawId:U,drawType:A,drawName:C}=O,M=(b=g==null?void 0:g.flights)==null?void 0:b.find(j=>j.drawId===O.drawId);M&&(M.drawEntries=(E=M.drawEntries)==null?void 0:E.filter(j=>YU.includes(j.entryStatus)));const D=(N=(T=Ur({stageSequence:1,drawDefinition:O,stage:ue}))==null?void 0:T.structures)==null?void 0:N[0],V=D&&((w=Bf({structureId:D.structureId,tournamentRecord:r,drawDefinition:O}))==null?void 0:w.positionAssignments.map(h)),R=($=Ur({stage:Ie,drawDefinition:O}))==null?void 0:$.structures,W=R!=null&&R.length?R.map(j=>{var L;const F=j.stageSequence;return{positionAssignments:(L=Bf({structureId:j.structureId,tournamentRecord:r,drawDefinition:O}))==null?void 0:L.positionAssignments.map(h),stageSequence:F}}):void 0,x={action:pz,payload:{drawDefinitions:[O],eventId:s.eventId,auditData:o}};p.push(x),f.push(_e({tournamentId:r.tournamentId,qualifyingPositionAssignments:W,eventId:s.eventId,positionAssignments:V,auditData:o,drawType:A,drawName:C,drawId:U}));const{matchUps:K}=Er({event:s,drawDefinition:O});K.forEach(({matchUpId:j})=>v.push(j))}return!n.includes(O.drawId)});s.drawDefinitions=_,g&&eo({event:s,extension:{name:nn,value:g}}),Bd({tournamentRecord:r});const I=`${$r}.${Ar}`,{timeItem:P}=pn({element:s,itemType:I}),S=(a=P==null?void 0:P.itemValue)==null?void 0:a[Nn];let y;for(const O of n)if((c=S==null?void 0:S.drawIds)==null?void 0:c.includes(O)){y=!0;const E=((l=S.drawIds)==null?void 0:l.filter(w=>w!==O))||[],T={itemType:`${$r}.${Ar}`,itemValue:{[Nn]:{drawIds:E}}},N=zo({event:s,timeItem:T});if(N.error)return{error:N.error}}if(p.length&&Le({topic:tc,payload:p}),v.length&&Oi({tournamentId:r==null?void 0:r.tournamentId,matchUpIds:v}),n.forEach(O=>{mG({drawId:O})}),Yde({event:s,deletedDrawsDetail:f,auditData:o}),t&&y){const O=sl({tournamentRecord:r,event:s,policyDefinitions:e});O.error&&console.log("publish error",O)}return Fl({},B)}function Yde({event:t,deletedDrawsDetail:e,auditData:r}){const{extension:n}=_r({name:zl,element:t}),o=Hde(Fl({},r),{deletedDrawsDetail:e}),i={name:zl,value:Array.isArray(n==null?void 0:n.value)?n.value.concat(o):[o]};et({element:t,extension:i})}var Kde=Object.defineProperty,dw=Object.getOwnPropertySymbols,zde=Object.prototype.hasOwnProperty,Qde=Object.prototype.propertyIsEnumerable,pw=(t,e,r)=>e in t?Kde(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Jde=(t,e)=>{for(var r in e||(e={}))zde.call(e,r)&&pw(t,r,e[r]);if(dw)for(var r of dw(e))Qde.call(e,r)&&pw(t,r,e[r]);return t};function M2({collectionPosition:t,teamParticipantId:e,dualMatchUpSide:r,drawDefinition:n,participantIds:o,collectionId:i}){var s;if(!i||!t||!Array.isArray(o))return{modifiedLineUp:(r==null?void 0:r.lineUp)||[],error:Z};const a=(r==null?void 0:r.lineUp)||((s=Ac({participantId:e,drawDefinition:n}))==null?void 0:s.lineUp),c=[],l=[];return{modifiedLineUp:(a==null?void 0:a.map(d=>{var p;if(!o.includes(d.participantId))return d;const v=(p=d.collectionAssignments)==null?void 0:p.filter(f=>{const m=f.collectionId===i&&f.collectionPosition===t;return m&&(f.previousParticipantId&&c.push(f.previousParticipantId),l.push(Jde({participantId:d.participantId},f))),!m});return{participantId:d.participantId,collectionAssignments:v}}).filter(Boolean))||[],assignmentsRemoved:l,previousParticipantIds:c}}var Zde=Object.defineProperty,Xde=Object.defineProperties,epe=Object.getOwnPropertyDescriptors,fw=Object.getOwnPropertySymbols,tpe=Object.prototype.hasOwnProperty,rpe=Object.prototype.propertyIsEnumerable,vw=(t,e,r)=>e in t?Zde(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,El=(t,e)=>{for(var r in e||(e={}))tpe.call(e,r)&&vw(t,r,e[r]);if(fw)for(var r of fw(e))rpe.call(e,r)&&vw(t,r,e[r]);return t},Jp=(t,e)=>Xde(t,epe(e));function xf(t){var e,r,n,o,i,s,a;const c=vg(t);if(c.error)return c;const l="assignTieMatchUpParticipantId";let u=t.teamParticipantId;const{tournamentRecord:d,drawDefinition:p,participantId:v}=t;if(!v)return k({result:{error:It},stack:l});if(t.sideNumber&&![1,2].includes(t.sideNumber))return k({result:{error:fA},stack:l});const{inContextDualMatchUp:f,inContextTieMatchUp:m,relevantAssignments:g,collectionPosition:h,teamParticipants:_,collectionId:I,matchUpType:P,dualMatchUp:S,tieFormat:y}=c;if(((e=m.sides)==null?void 0:e.flatMap(({participant:G})=>(G==null?void 0:G.individualParticipantIds)||(G==null?void 0:G.participantId)||[])).includes(v))return k({result:El({},B),stack:l});u=u||t.sideNumber&&((r=f.sides.find(G=>G.sideNumber===t.sideNumber))==null?void 0:r.participantId);const{tournamentParticipants:[b]}=Kt({tournamentRecord:d,participantFilters:{participantIds:[v]}});if(!b)return k({result:{error:Tt},stack:l});if([at,vt].includes(m.gender)&&m.gender!==((n=b.person)==null?void 0:n.sex))return{error:ev,info:"Gender mismatch"};const{individualParticipantIds:E,participantType:T}=b;if(P===ut&&T!==Ce)return{error:bn};const N=T===Ce?[v]:E,w=u&&_.find(({participantId:G})=>G===u)||_.find(({individualParticipantIds:G})=>Gt(N,G));if(!w)return{error:wA};if(u||(u=w.participantId),!u)return{error:Tt};const $=g==null?void 0:g.find(G=>G.participantId===(w==null?void 0:w.participantId)),U=$==null?void 0:$.drawPosition,A=(o=m.sides)==null?void 0:o.find(({drawPosition:G})=>G===U),C=t.sideNumber||(A==null?void 0:A.sideNumber);if(!y)return{error:Gu};if(!((i=y.collectionDefinitions)==null?void 0:i.find(G=>G.collectionId===I)))return{error:hR};if(!((s=S.sides)!=null&&s.length)){const{extension:G}=Lt({element:p,name:En}),H=de((G==null?void 0:G.value)||{},!1,!0),Q=({displaySideNumber:z,drawPosition:Y,sideNumber:J})=>({drawPosition:Y,sideNumber:J,displaySideNumber:z});S.sides=f.sides.map(z=>{const Y=z.participantId;return Jp(El({},Q(z)),{lineUp:Y&&H[Y]||[]})})}const D=S.sides.find(G=>G.sideNumber===C),V=m.sides.find(G=>G.sideNumber===C),R=(D==null?void 0:D.lineUp)||((a=Ac({participantId:u,drawDefinition:p}))==null?void 0:a.lineUp),W=R==null?void 0:R.filter(G=>{var H;return(H=G.collectionAssignments)==null?void 0:H.find(Q=>Q.collectionPosition===h&&Q.collectionId===I&&!Q.previousParticipantId)}),x=W==null?void 0:W.map(G=>G==null?void 0:G.participantId),K=(x==null?void 0:x.length)>1&&x||(T===we?b.individualParticipantIds:[v]),j=M2({collectionPosition:h,teamParticipantId:u,dualMatchUpSide:D,participantType:T,drawDefinition:p,participantIds:K,collectionId:I,matchUpType:P});if(j.error)return k({result:j,stack:l});const{modifiedLineUp:L}=j;let F;if(P===ot){if(T!==we){let G=Zp({collectionPosition:h,teamParticipantId:u,drawDefinition:p,modifiedLineUp:L,participantId:v,collectionId:I,tieFormat:y});if(G!=null&&G.error)return k({result:G,stack:l});if(G=q({side:V}),G.error)return G;F=G.deleteParticipantId,D.lineUp=L,ze({tournamentId:d==null?void 0:d.tournamentId,matchUp:S,context:l,drawDefinition:p})}else if(T===we)for(const G of K)Zp({collectionPosition:h,teamParticipantId:u,drawDefinition:p,modifiedLineUp:L,participantId:G,collectionId:I,tieFormat:y})}else{const G=Zp({collectionPosition:h,teamParticipantId:u,drawDefinition:p,modifiedLineUp:L,participantId:v,collectionId:I,tieFormat:y});if(G!=null&&G.error)return G}if(D.lineUp=L,ze({tournamentId:d==null?void 0:d.tournamentId,matchUp:S,context:l,drawDefinition:p}),F){const{error:G}=Na({participantIds:[F],tournamentRecord:d});G&&console.log("cleanup")}return Jp(El({},B),{modifiedLineUp:L});function q({side:G}){let H;if(G.participant){const Q=G.participant.individualParticipantIds||[];if(Q.filter(Boolean).length===1){const{participant:Y}=$n({participantIds:Q,tournamentRecord:d});Q.push(v);const{participant:J}=$n({participantIds:Q,tournamentRecord:d});if(J)H=Y.participantId;else{Y.individualParticipantIds=Q;const te=dg({individualParticipantIds:Q,pairOverride:!0,tournamentRecord:d,participant:Y});if(te.error)return te}}}else{const z=An({participant:{individualParticipantIds:[v],participantRole:xt,participantType:we},pairOverride:!0,tournamentRecord:d});if(z.error)return z}return Jp(El({},B),{deleteParticipantId:H})}}function Zp({collectionPosition:t,teamParticipantId:e,drawDefinition:r,modifiedLineUp:n,participantId:o,collectionId:i,tieFormat:s}){var a,c;const l=(a=Ac({participantId:e,drawDefinition:r}))==null?void 0:a.lineUp,u=(c=n||l)==null?void 0:c.find(p=>(p==null?void 0:p.participantId)===o),d={collectionId:i,collectionPosition:t};if(u)u.collectionAssignments.push(d);else{const p={collectionAssignments:[d],participantId:o};n.push(p)}return Qd({participantId:e,lineUp:n,drawDefinition:r,tieFormat:s})}var npe=Object.defineProperty,ope=Object.defineProperties,ipe=Object.getOwnPropertyDescriptors,mw=Object.getOwnPropertySymbols,spe=Object.prototype.hasOwnProperty,ape=Object.prototype.propertyIsEnumerable,gw=(t,e,r)=>e in t?npe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,hw=(t,e)=>{for(var r in e||(e={}))spe.call(e,r)&&gw(t,r,e[r]);if(mw)for(var r of mw(e))ape.call(e,r)&&gw(t,r,e[r]);return t},_w=(t,e)=>ope(t,ipe(e));function cpe(t){var e,r,n,o,i,s,a,c,l,u,d,p,v;const{tournamentRecord:f,drawDefinition:m,participantId:g,event:h}=t,_="removeTieMatchUpParticiapantId";if(!g)return k({result:{error:It},stack:_});const I=vg(t);if(I.error)return I;const{appliedPolicies:P}=ct({tournamentRecord:f,drawDefinition:m,event:h}),S=(P==null?void 0:P[zi])||Rm[zi],y=(e=S==null?void 0:S.processCodes)==null?void 0:e.substitution,{inContextDualMatchUp:O,inContextTieMatchUp:b,relevantAssignments:E,collectionPosition:T,teamParticipants:N,collectionId:w,matchUpType:$,dualMatchUp:U,tieMatchUp:A,tieFormat:C}=I,M=(r=b.sides)==null?void 0:r.find(j=>{var L,F,q;return((L=j.participant)==null?void 0:L.participantId)===g||((q=(F=j.participant)==null?void 0:F.individualParticipantIds)==null?void 0:q.includes(g))});if(!M)return{error:Tt};if(!((n=M.substitutions)!=null&&n.length)&&(At({score:b.score})||b.winningSide))return{error:rF};const D=(i=(o=O.sides)==null?void 0:o.find(({sideNumber:j})=>j===M.sideNumber))==null?void 0:i.participantId;if(!D)return{error:Tt};const{tournamentParticipants:[V]}=Kt({tournamentRecord:f,participantFilters:{participantIds:[g]}});if(!V)return{error:Tt};if($===ut&&V.participantType===we)return{error:ev};const R=V.participantType===Ce?[g]:V.individualParticipantIds;if(!((s=U.sides)!=null&&s.length)){const{extension:j}=Lt({element:m,name:En}),L=(j==null?void 0:j.value)||{},F=({displaySideNumber:q,drawPosition:G,sideNumber:H})=>({drawPosition:G,sideNumber:H,displaySideNumber:q});U.sides=O.sides.map(q=>{const G=q.participantId;return _w(hw({},F(q)),{lineUp:G&&L[G]||[]})})}let W=(a=U.sides)==null?void 0:a.find(({sideNumber:j})=>j===M.sideNumber);if(!W&&(((c=U.sides)==null?void 0:c.filter(({lineUp:j})=>!j).length)||0)<2){const j=N.map(({participantId:L})=>{var F;return{drawPosition:(F=E.find(q=>q.participantId===L))==null?void 0:F.drawPosition,teamParticipantId:L}});W=(l=U.sides)==null?void 0:l.find(L=>{var F;return((F=j.find(({drawPosition:q})=>q===L.drawPosition))==null?void 0:F.teamParticipantId)===D})}if(!W)return console.log({teamParticipantId:D,teamParticipants:N}),{error:Tt,participantId:g};const{modifiedLineUp:x,previousParticipantIds:K}=M2({collectionPosition:T,teamParticipantId:D,dualMatchUpSide:W,participantIds:R,drawDefinition:m,collectionId:w});if(W.lineUp=x,D&&Qd({participantId:D,lineUp:x,drawDefinition:m,tieFormat:C}),$===ot&&V.participantType===Ce){const j=(u=b.sides)==null?void 0:u.find(q=>q.sideNumber===W.sideNumber),{participantId:L}=j||{},{tournamentParticipants:[F]}=Kt({tournamentRecord:f,participantFilters:{participantIds:[L]},withEvents:!0});if(F){const q=F==null?void 0:F.individualParticipantIds.filter(G=>G!==g);if(q.push(...K),q.length>2)return{error:Jr};if(F.draws.length){if(q.length===1){const{participant:G}=$n({participantIds:q,tournamentRecord:f});if(!G){const Q=An({participant:{participantRole:xt,individualParticipantIds:q,participantType:we},pairOverride:!0,tournamentRecord:f});if(Q.error)return Q}}}else if(q.length){F.individualParticipantIds=q;const G=dg({participant:F,pairOverride:!0,tournamentRecord:f});if(G.error)return G}else{const G=Na({participantIds:[L],tournamentRecord:f});G.error&&console.log("cleanup",{result:G})}}else return{error:Tt}}if(((d=M.substitutions)==null?void 0:d.length)===1){const j=b.sides.find(L=>L.sideNumber!==M.sideNumber);if(!((p=j==null?void 0:j.substitutions)!=null&&p.length)&&((v=A.processCodes)!=null&&v.length)){for(const L of y||[]){const F=A.processCodes.lastIndexOf(L);A.processCodes.splice(F,1)}ze({tournamentId:f==null?void 0:f.tournamentId,matchUp:A,context:_,drawDefinition:m})}}return ze({tournamentId:f==null?void 0:f.tournamentId,matchUp:U,context:_,drawDefinition:m}),_w(hw({},B),{modifiedLineUp:x})}var lpe=Object.defineProperty,Iw=Object.getOwnPropertySymbols,upe=Object.prototype.hasOwnProperty,dpe=Object.prototype.propertyIsEnumerable,Pw=(t,e,r)=>e in t?lpe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ppe=(t,e)=>{for(var r in e||(e={}))upe.call(e,r)&&Pw(t,r,e[r]);if(Iw)for(var r of Iw(e))dpe.call(e,r)&&Pw(t,r,e[r]);return t};function fpe({tournamentRecord:t,drawDefinition:e,participantId:r,drawPosition:n,structureId:o,qualifier:i,event:s,bye:a}){if(!e)return{error:pe};if(!n)return{error:hc};if(!o)return{error:ur};if(a){const c=Dr({tournamentRecord:t,drawDefinition:e,drawPosition:n,structureId:o,event:s});if(c.error)return c}else{if(i)return{error:$A};{const c=un({tournamentRecord:t,drawDefinition:e,participantId:r,drawPosition:n,structureId:o,event:s});if(c.error)return c}}return ppe({},B)}var vpe=Object.defineProperty,mpe=Object.defineProperties,gpe=Object.getOwnPropertyDescriptors,yw=Object.getOwnPropertySymbols,hpe=Object.prototype.hasOwnProperty,_pe=Object.prototype.propertyIsEnumerable,Ow=(t,e,r)=>e in t?vpe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ipe=(t,e)=>{for(var r in e||(e={}))hpe.call(e,r)&&Ow(t,r,e[r]);if(yw)for(var r of yw(e))_pe.call(e,r)&&Ow(t,r,e[r]);return t},Ppe=(t,e)=>mpe(t,gpe(e));function ype({allowDuplicateParticipantIdPairs:t,entryStatus:e=rn,participantIdPairs:r=[],entryStage:n=ue,tournamentRecord:o,drawDefinition:i,event:s,uuids:a}){if(!o)return{error:ee};if(!s)return{error:Re};if(s.eventType!==ot)return{error:ni};const c=o.participants||[],l=c.filter(P=>P.participantType===Ce).map(P=>P.participantId),u=l.filter(P=>!l.includes(P));if(u.length)return{error:Jr,invalidParticipantIds:u};const d=r.filter(P=>P.length!==2);if(d.length)return{error:Jr,invalidParticipantIdPairs:d};const p=c.filter(P=>P.participantType===we).map(P=>P.individualParticipantIds),v=r.map(P=>({participantId:(a==null?void 0:a.pop())||ke(),participantType:we,participantRole:xt,individualParticipantIds:P})),f=t?v:v.filter(P=>!p.find(S=>Dt(S,P.individualParticipantIds).length===2));let m,g=[];if(f){const P=Zn({allowDuplicateParticipantIdPairs:t,participants:f,returnParticipants:!0,tournamentRecord:o});if(P.error)return P;g=P.participants||[],m=P.info}const h=r.map(P=>{const S=g.find(O=>Dt(O.individualParticipantIds,P).length===2);if(S)return S;const{participant:y}=$n({tournamentRecord:o,participantIds:P});return y}).map(P=>P.participantId),_=Uo({participantIds:h,tournamentRecord:o,drawDefinition:i,entryStatus:e,entryStage:n,event:s});f.length&&Le({topic:ci,participants:f});const I=f.map(Ze);return Ppe(Ipe({},_),{info:m,newParticipantIds:I})}var Ope=Object.defineProperty,Sw=Object.getOwnPropertySymbols,Spe=Object.prototype.hasOwnProperty,bpe=Object.prototype.propertyIsEnumerable,bw=(t,e,r)=>e in t?Ope(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Tpe=(t,e)=>{for(var r in e||(e={}))Spe.call(e,r)&&bw(t,r,e[r]);if(Sw)for(var r of Sw(e))bpe.call(e,r)&&bw(t,r,e[r]);return t};function D2({event:t,participants:e,ignoreGender:r}){if(!e)return{error:Ic};if(!Array.isArray(e))return{error:Z};if(!t)return{error:Re};const{eventType:n,gender:o}=t,i=n===gn&&Ye||n===rc&&we||Ce,s=Object.assign({},...(t.entries||[]).map(u=>({[u.participantId]:u.entryStatus}))),a=Object.keys(s),l=e.filter(u=>a.includes(u.participantId)).filter(u=>{const d=s[u.participantId],p=[rc,gn].includes(n)&&u.participantType===Ce&&(Zo(d)||d===Vo),v=u.participantType!==i&&!p,f=!r&&n===Ce&&[at,vt].includes(o)&&u.sex!==o;return v||f});if(l.length){const u=l.map(d=>d.participantId);return{error:vR,invalidParticipantIds:u}}return Tpe({},B)}var Epe=Object.defineProperty,wpe=Object.defineProperties,Npe=Object.getOwnPropertyDescriptors,Tw=Object.getOwnPropertySymbols,$pe=Object.prototype.hasOwnProperty,Ape=Object.prototype.propertyIsEnumerable,Ew=(t,e,r)=>e in t?Epe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ww=(t,e)=>{for(var r in e||(e={}))$pe.call(e,r)&&Ew(t,r,e[r]);if(Tw)for(var r of Tw(e))Ape.call(e,r)&&Ew(t,r,e[r]);return t},Nw=(t,e)=>wpe(t,Npe(e));function Upe(t){const{provisionalPositioning:e,useExistingSeedLimit:r,tournamentRecord:n,drawDefinition:o,seedingProfile:i,structureId:s,assignments:a,drawId:c,event:l}=t;let u=0;if(!(a!=null&&a.length))return{error:aA};if(!n)return{error:ee};if(!c)return{error:Mr};const d=cn({provisionalPositioning:e,drawDefinition:o,structureId:s,event:l});if(d.error)return d;const{seedAssignments:p,seedLimit:v}=d,f=Object.assign({},...p.filter(h=>h.seedNumber).map(h=>({[h.seedNumber]:h})));a.forEach(h=>{const{seedNumber:_}=h;_<=v&&(!r||f[_])&&(f[_]=h)});const m=Object.values(f),g=m.map(h=>h==null?void 0:h.participantId).filter(Boolean);if(g.length!==tA(g).length)return{error:rR};for(const h of m){const _=ss(Nw(ww({},h),{provisionalPositioning:e,tournamentRecord:n,drawDefinition:o,seedingProfile:i,structureId:s,event:l}));if(_!=null&&_.error)return _;_!=null&&_.success&&u++}return u?Nw(ww({},B),{modifications:u}):{error:Pc}}var Cpe=Object.defineProperty,$w=Object.getOwnPropertySymbols,Mpe=Object.prototype.hasOwnProperty,Dpe=Object.prototype.propertyIsEnumerable,Aw=(t,e,r)=>e in t?Cpe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,jpe=(t,e)=>{for(var r in e||(e={}))Mpe.call(e,r)&&Aw(t,r,e[r]);if($w)for(var r of $w(e))Dpe.call(e,r)&&Aw(t,r,e[r]);return t};function Rpe({removePairParticipants:t,tournamentRecord:e,eventIds:r}){if(!e)return{error:ee};if(!e.events)return{error:Pr};if(!Array.isArray(r))return{error:Se,info:Yt("drawIds")};const n=[],o=[],i=[],s=[];if(e.events=(e.events||[]).filter(a=>{if(r.includes(a.eventId)){const u={action:Gy,payload:{events:[a]}};n.push(u),o.push({tournamentId:e.tournamentId,eventName:a.eventName,eventType:a.eventType,category:a.category,eventId:a.eventId,gender:a.gender})}const c=a.eventType===mr?(a.entries||[]).map(({entryStatus:u,participantId:d})=>u!==Wr&&d).filter(Boolean):[],l=r.includes(a.eventId);return l?s.push(...c):i.push(...c),!l}),t){const a=s.filter(c=>!i.includes(c));e.participants=e.participants.filter(({participantId:c})=>!a.includes(c))}return Bd({tournamentRecord:e}),n.length&&(Le({topic:tc,payload:n}),Oo({tournamentRecord:e,timeItem:{itemType:Gy,itemValue:o}})),jpe({},B)}const Fpe="COLLEGE_DEFAULT",Vpe="COLLEGE_JUCO",Lpe="COLLEGE_D3",Bpe="DOMINANT_DUO",xpe="DOMINANT_DUO_MIXED",Gpe="LAVER_CUP",kpe="TEAM_DOUBLES_3_AGGREGATION",Wpe="USTA_BREWER_CUP",qpe="USTA_OZAKI_CUP",Hpe="USTA_COLLEGE",Ype="USTA_GOLD_TEAM_CHALLENGE",Kpe="USTA_LEVEL_1",zpe="USTA_INTERSECTIONAL",Qpe="USTA_SECTION_BATTLE",Jpe="USTA_SOUTHERN_LEVEL_5",Zpe="USTA_TOC",Xpe="USTA_WTT_ITT",efe="USTA_ZONAL";var tfe=Object.defineProperty,Uw=Object.getOwnPropertySymbols,rfe=Object.prototype.hasOwnProperty,nfe=Object.prototype.propertyIsEnumerable,Cw=(t,e,r)=>e in t?tfe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Mw=(t,e)=>{for(var r in e||(e={}))rfe.call(e,r)&&Cw(t,r,e[r]);if(Uw)for(var r of Uw(e))nfe.call(e,r)&&Cw(t,r,e[r]);return t};const Fa="SET3-S:6/TB7",Dw={STANDARD:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},[Lpe]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1,matchUpFormat:"SET1-S:8/TB7@7"},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:Fa},tieFormatName:"COLLEGE_D3",valueGoal:5},[Fpe]:{hydrate:!0,doubles:{matchUpCount:3,collectionValue:1,matchUpFormat:Fa},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:Fa},tieFormatName:"COLLEGE_DEFAULT",valueGoal:4},[Vpe]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1,matchUpFormat:"SET1-S:8/TB7"},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:Fa},tieFormatName:"COLLEGE_JUCO",valueGoal:5},[Gpe]:j1,[Bpe]:M1,[xpe]:D1,[kpe]:R1,[Wpe]:F1,[qpe]:V1,[Hpe]:L1,[Ype]:B1,[zpe]:x1,[Kpe]:G1,[Qpe]:k1,[Jpe]:W1,[Xpe]:H1,[Zpe]:q1,[efe]:Y1},as=({hydrateCollections:t,namedFormat:e,event:r={},uuids:n=[]}={})=>{Object.keys(Dw).includes(e)||(e="STANDARD"),Array.isArray(n)||(n=[]);let o;const{category:i,gender:s}=r,a=de(Dw[e],!1,!0);return a.hydrate?(o={winCriteria:{valueGoal:a.valueGoal},collectionDefinitions:[Mw({collectionId:(n==null?void 0:n.pop())||ke(),matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"Doubles",matchUpType:ot},a.doubles),Mw({collectionId:(n==null?void 0:n.pop())||ke(),matchUpFormat:Fa,collectionName:"Singles",matchUpType:ut},a.singles)]},a.tieFormatName&&(o.tieFormatName=a.tieFormatName)):(a.collectionDefinitions.forEach(c=>c.collectionId=ke()),o=a),t&&o.collectionDefinitions.forEach(c=>{i&&!c.category&&(c.category=i),s&&!c.gender&&(c.gender=s)}),o};var ofe=Object.defineProperty,ife=Object.defineProperties,sfe=Object.getOwnPropertyDescriptors,jw=Object.getOwnPropertySymbols,afe=Object.prototype.hasOwnProperty,cfe=Object.prototype.propertyIsEnumerable,Rw=(t,e,r)=>e in t?ofe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,lfe=(t,e)=>{for(var r in e||(e={}))afe.call(e,r)&&Rw(t,r,e[r]);if(jw)for(var r of jw(e))cfe.call(e,r)&&Rw(t,r,e[r]);return t},ufe=(t,e)=>ife(t,sfe(e));function Jd({suppressNotifications:t,tournamentRecord:e,internalUse:r,event:n}){var o,i,s,a;if(!e)return{error:ee};if(e.events||(e.events=[]),!n)return{error:Re};const{startDate:c,endDate:l}=e;if(!r&&((o=n.entries)!=null&&o.length||(i=n.drawDefinitions)!=null&&i.length)){const p=_e({drawDefinitions:!!((s=n.drawDefinitions)!=null&&s.length),entries:!!((a=n.entries)!=null&&a.length)});return{info:"entries/drawDefinitions cannot exist",error:Z,context:p}}const u=Object.assign({},{drawDefinitions:[],eventType:Yn,entries:[],startDate:c,endDate:l},n);if(n.eventType===yt){if(n.tieFormat){const p=cr({tieFormat:n.tieFormat});if(p.error)return p}else if(n.tieFormatName){if(!K1[n.tieFormatName])return{context:{tieFormatName:n.tieFormatName},error:Z};const p=as({namedFormat:n.tieFormatName});u.tieFormat=p}}if(u.eventId||(u.eventId=ke()),e.events.reduce((p,v)=>p||v.eventId===u.eventId,void 0))return{error:pR};if(e.events.push(u),!t){const{topics:p}=Mn();if(p.includes(Tv)){const{matchUps:v}=Si({event:n});pi({tournamentId:e==null?void 0:e.tournamentId,eventId:n.eventId,matchUps:v})}for(const v of n.drawDefinitions||[])xc({drawDefinition:v})}return ufe(lfe({},B),{event:u})}var dfe=Object.defineProperty,Fw=Object.getOwnPropertySymbols,pfe=Object.prototype.hasOwnProperty,ffe=Object.prototype.propertyIsEnumerable,Vw=(t,e,r)=>e in t?dfe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,j2=(t,e)=>{for(var r in e||(e={}))pfe.call(e,r)&&Vw(t,r,e[r]);if(Fw)for(var r of Fw(e))ffe.call(e,r)&&Vw(t,r,e[r]);return t};function vfe({tournamentRecord:t,participantId:e,matchUpId:r,matchUp:n,drawId:o}){n&&!o&&({drawId:o}=n),n&&!r&&({matchUpId:r}=n);const{event:i,drawDefinition:s}=Ft({tournamentRecord:t,drawId:o});if(i){const a=t.participants,c=Cm({tournamentParticipants:a,drawDefinition:s,participantId:e,matchUpId:r});if(c.error&&c.error!==_A)return c}else return{error:Pr};return j2({},B)}function mfe({tournamentRecord:t,participantId:e,matchUpId:r,matchUp:n,drawId:o}){n&&!o&&({drawId:o}=n),n&&!r&&({matchUpId:r}=n);const{event:i,drawDefinition:s}=Ft({tournamentRecord:t,drawId:o});if(i){const a=t.participants,c=Mm({drawDefinition:s,tournamentParticipants:a,matchUpId:r,participantId:e});if(c.error)return c}else return{error:Pr};return j2({},B)}var gfe=Object.defineProperty,hfe=Object.defineProperties,_fe=Object.getOwnPropertyDescriptors,Lw=Object.getOwnPropertySymbols,Ife=Object.prototype.hasOwnProperty,Pfe=Object.prototype.propertyIsEnumerable,Bw=(t,e,r)=>e in t?gfe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ru=(t,e)=>{for(var r in e||(e={}))Ife.call(e,r)&&Bw(t,r,e[r]);if(Lw)for(var r of Lw(e))Pfe.call(e,r)&&Bw(t,r,e[r]);return t},yfe=(t,e)=>hfe(t,_fe(e));function Ofe(t){const{participantId:e}=t;return e&&typeof e!="string"?{error:Z,participantId:e}:R2(yfe(Ru({},t),{participantIds:[e].filter(Boolean)}))}function R2({tournamentRecord:t,drawDefinition:e,participantIds:r,stageSequence:n,stage:o=ue,eventId:i,event:s}){if(!t)return{error:ee};if(!Array.isArray(r))return{error:Z,participantIds:r};if(!s)return{error:Re};const a="promoteAlternates";if(s){const c=xw({element:s,participantIds:r,stageSequence:n,stage:o});if(c.error)return c}if(e){const c=xw({element:e,participantIds:r,stageSequence:n,stage:o});if(c.error)return i?k({context:{drawPromotionError:c.error,drawId:e.drawId},result:Ru({},B),stack:a}):c}return Ru({},B)}function xw({participantIds:t,stageSequence:e,element:r,stage:n}){const o=(r.entries||[]).filter(d=>d.entryStatus===rn),i=(r.entries||[]).filter(d=>t.includes(d.participantId)),s=o.reduce((d,p)=>{const{entryPosition:v}=p;return isNaN(v)&&d||(!d||v<d.entryPosition)&&p||d},void 0),a=i.length?i:[s].filter(Boolean);if(!(a!=null&&a.length))return{error:PA};const c=a.filter(({entryStatus:d})=>d!==rn);if(c.length)return{error:lf,invalidEntryStatus:c};const l=a.filter(({entryStage:d})=>d&&d!==n);if(l.length)return{error:jR,invalidStage:l};const u=e&&a.filter(d=>d.stageSequence!==e);if(u!=null&&u.length)return{error:RR,invalidStageSequence:u};for(const d of a){d.entryStatus=Cr;const p=d==null?void 0:d.entryPosition;isNaN(p)||r.entries.forEach(f=>{f.entryStatus===rn&&f.entryPosition>p&&(f.entryPosition=f.entryPosition-1)});let v=Math.max(...r.entries.filter(f=>f.entryStatus===Cr&&!isNaN(f.entryPosition)).map(({entryPosition:f})=>parseInt(f||0)),0);d.entryPosition=v||0}return Ru({},B)}function Sfe(t){return Object.assign(t,{entryStatus:Vo}),Eu(t)}function bfe({luckyLoserParticipantId:t,tournamentRecord:e,drawDefinition:r,drawPosition:n,structureId:o}){return og({positionActionName:"luckyLoserDrawPositionAssignment",participantId:t,tournamentRecord:e,drawDefinition:r,drawPosition:n,structureId:o})}function Tfe(t){return bfe(t)}function Efe({qualifyingParticipantId:t,tournamentRecord:e,drawDefinition:r,drawPosition:n,structureId:o}){return og({positionActionName:"qualifierDrawPositionAssignment",participantId:t,isQualifierPosition:!0,tournamentRecord:e,drawDefinition:r,drawPosition:n,structureId:o})}function wfe(t){return Efe(t)}function Nfe(t){return ND(t)}function $fe(t){return xD(t)}function Gw(t){return dc(t)}function Afe(t){return $D(t)}function Ufe({tournamentRecord:t,drawDefinition:e,seedBlockInfo:r,drawPosition:n,structureId:o,event:i}){return Dr({tournamentRecord:t,drawDefinition:e,seedBlockInfo:r,drawPosition:n,structureId:o,event:i})}var Cfe=Object.defineProperty,Mfe=Object.defineProperties,Dfe=Object.getOwnPropertyDescriptors,kw=Object.getOwnPropertySymbols,jfe=Object.prototype.hasOwnProperty,Rfe=Object.prototype.propertyIsEnumerable,Ww=(t,e,r)=>e in t?Cfe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ci=(t,e)=>{for(var r in e||(e={}))jfe.call(e,r)&&Ww(t,r,e[r]);if(kw)for(var r of kw(e))Rfe.call(e,r)&&Ww(t,r,e[r]);return t},Mi=(t,e)=>Mfe(t,Dfe(e));function Ffe({replacementIndividualParticipantId:t,existingIndividualParticipantId:e,tournamentRecord:r,drawDefinition:n,participantId:o,event:i,uuids:s}){var a,c;if(!i)return{error:Re};if((i==null?void 0:i.eventType)!==mr)return{error:ni};if(s&&!Array.isArray(s))return{error:Z};if(!r)return{error:ee};if(![t,e,o].every(h=>typeof h=="string"))return{error:It};if(!(((a=i==null?void 0:i.entries)==null?void 0:a.filter(({entryStatus:h})=>[Wr,fs].includes(h)).map(({participantId:h})=>h))||[]).includes(t))return{error:ao};const u=(r.participants||[]).find(h=>h.participantId===o);if((u==null?void 0:u.participantType)!==we)return{error:ev,participant:u};const d=u.individualParticipantIds,p=[t,...d.filter(h=>h!==e)],{participant:v}=$n({participantIds:[p],tournamentRecord:r});let f;if(v)f=v.participantId;else{const h={participantId:s==null?void 0:s.pop(),participantRole:xt,individualParticipantIds:p,participantType:we},_=An({participant:h,returnParticipant:!0,tournamentRecord:r});if(_.error)return _;f=_.participant.participantId}const{flightProfile:m}=ht({event:i});if(n){const h=(c=m==null?void 0:m.flights)==null?void 0:c.find(({drawId:_})=>_===n.drawId);h&&(h.drawEntries=h.drawEntries.map(_=>_.participantId===o?Mi(Ci({},_),{participantId:f}):_)),n.entries=n.entries.map(_=>_.participantId===o?Mi(Ci({},_),{participantId:f}):_);for(const _ of n.structures||[])if(_.positionAssignments)_.positionAssignments=_.positionAssignments.map(I=>I.participantId===o?Mi(Ci({},I),{participantId:f}):I);else if(_.structures)for(const I of _.structures)I.positionAssignments=I.positionAssignments.map(P=>P.participantId===o?Mi(Ci({},P),{participantId:f}):P)}i.entries=i.entries.map(h=>h.participantId===o&&Mi(Ci({},h),{participantId:f})||h.participantId===t&&Mi(Ci({},h),{participantId:e})||h);const g=r.events.some(({entries:h,eventId:_,drawDefinitions:I})=>i.eventId===_?I.some(({drawId:P,entries:S})=>P===(n==null?void 0:n.drawId)?!1:S==null?void 0:S.find(y=>y.participantId===o)):h==null?void 0:h.find(P=>P.participantId===o));if(!g){const h=Na({addIndividualParticipantsToEvents:!1,participantIds:[o],tournamentRecord:r});if(h.error)return h}return Mi(Ci({},B),{participantOtherEntries:g,newPairParticipantId:f})}var Vfe=Object.defineProperty,qw=Object.getOwnPropertySymbols,Lfe=Object.prototype.hasOwnProperty,Bfe=Object.prototype.propertyIsEnumerable,Hw=(t,e,r)=>e in t?Vfe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,xfe=(t,e)=>{for(var r in e||(e={}))Lfe.call(e,r)&&Hw(t,r,e[r]);if(qw)for(var r of qw(e))Bfe.call(e,r)&&Hw(t,r,e[r]);return t};function Gfe({autoEntryPositions:t=!0,participantIds:e,drawDefinition:r,drawId:n,stages:o,event:i}){var s;if(!i)return{error:Re};if(!n)return{error:Mr};if(!(e!=null&&e.length))return{error:co};const a=Yd({drawDefinition:r,stages:o});if(Gt(a,e))return{error:la};const l=p=>{const v=p.participantId;return!e.includes(v)},{flightProfile:u}=ht({event:i}),d=(s=u==null?void 0:u.flights)==null?void 0:s.find(p=>p.drawId===n);return d!=null&&d.drawEntries&&(d.drawEntries=d.drawEntries.filter(l),t&&(d.drawEntries=Vr({entries:d.drawEntries}))),r!=null&&r.entries&&(r.entries=r.entries.filter(l),t&&(r.entries=Vr({entries:r.entries}))),xfe({},B)}function kfe(t){const e=t.tournamentRecord;if(!e)return{error:ee};const r=Hd(t);if(r.error)return r;const{playoffStructureNameBase:n,playoffPositions:o,roundNumbers:i,structureId:s}=t,c={itemType:"addPlayoffStructures",itemValue:_e({playoffStructureNameBase:n,playoffPositions:o,roundNumbers:i,structureId:s})};return Oo({tournamentRecord:e,timeItem:c}),r}function Wfe({tournamentRecord:t,drawDefinition:e,participantId:r,structureId:n,seedValue:o,event:i}){return t?(t.participants||[]).find(a=>a.participantId===r)?r2({tournamentRecord:t,drawDefinition:e,participantId:r,structureId:n,seedValue:o,event:i}):{error:ao}:{error:ee}}var qfe=Object.defineProperty,Hfe=Object.defineProperties,Yfe=Object.getOwnPropertyDescriptors,Yw=Object.getOwnPropertySymbols,Kfe=Object.prototype.hasOwnProperty,zfe=Object.prototype.propertyIsEnumerable,Kw=(t,e,r)=>e in t?qfe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,zw=(t,e)=>{for(var r in e||(e={}))Kfe.call(e,r)&&Kw(t,r,e[r]);if(Yw)for(var r of Yw(e))zfe.call(e,r)&&Kw(t,r,e[r]);return t},Qw=(t,e)=>Hfe(t,Yfe(e));function Qfe({tournamentRecord:t,drawDefinition:e,scheduledDates:r,stageSequences:n,matchUpFormat:o,structureIds:i,structureId:s,eventType:a,matchUpId:c,eventIds:l,eventId:u,drawIds:d,stages:p,drawId:v,event:f,force:m}){const g="setMatchUpFormat";if(!t)return{error:ee};if(!o)return{error:Qf};if(o&&!Br(o))return k({result:{error:xu,matchUpFormat:o},stack:g});if(r&&!Array.isArray(r))return k({result:{error:Z,scheduledDates:r},stack:g});if(a&&![Yn,mr].includes(a))return k({result:{error:ni},stack:g});let h=0;if((s||i)&&!e)return k({result:{error:pe},stack:g});if(v&&c){const I=Ad({tournamentRecord:t,drawDefinition:e,matchUpFormat:o,structureIds:i,structureId:s,matchUpId:c,force:m});if(I.error)return I;h+=1}const _=I=>{const P=[];for(const S of I.structures||[]){if(Array.isArray(p)&&!p.includes(S.stage)||Array.isArray(n)&&!n.includes(S.stageSequence)||i.length&&!i.includes(S.structureId))continue;i.length&&S.matchUpFormat!==o&&(S.matchUpFormat=o,P.push(S.structureId),h+=1);const y=(m||r)&&Ke({matchUpFilters:{matchUpStatuses:[pt]},structure:S}),O=r&&Ke({matchUpFilters:{matchUpStatuses:[pt]},contextFilters:{scheduledDates:r},afterRecoveryTimes:!1,inContext:!0,structure:S});if(y!=null&&y.length){const b=O?O.map($t):y.map($t);for(const E of y)b.includes(E.matchUpId)&&(E.matchUpFormat=r!=null&&r.length?o:void 0,ze({tournamentId:t==null?void 0:t.tournamentId,eventId:f==null?void 0:f.eventId,context:g,drawDefinition:I,matchUp:E}))}}return!P.length&&I.matchUpFormat!==o&&(I.matchUpFormat=o,h+=1),P};i=i||[s].filter(Boolean),l=l||[u].filter(Boolean),d=d||[v].filter(Boolean);for(const I of t.events||[])if(!(l!=null&&l.length&&!l.includes(I.eventId)||a&&a!==I.eventType||a===yt))if(Array.isArray(n)||Array.isArray(p)||i.length||d.length)for(const P of I.drawDefinitions||[]){if(Array.isArray(d)&&!d.includes(P.drawId))continue;const S=_(P);Qe({structureIds:S,drawDefinition:P})}else I.matchUpFormat!==o&&(I.matchUpFormat=o,h+=1);return h?Qw(zw({},B),{modificationsCount:h}):Qw(zw({},B),{info:Pc})}var Jfe=Object.defineProperty,Jw=Object.getOwnPropertySymbols,Zfe=Object.prototype.hasOwnProperty,Xfe=Object.prototype.propertyIsEnumerable,Zw=(t,e,r)=>e in t?Jfe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,F2=(t,e)=>{for(var r in e||(e={}))Zfe.call(e,r)&&Zw(t,r,e[r]);if(Jw)for(var r of Jw(e))Xfe.call(e,r)&&Zw(t,r,e[r]);return t};function V2({tournamentRecord:t,drawDefinition:e,participantId:r,entryPosition:n,skipRefresh:o,event:i}){const s="setEntryPositions";return t?r?n!==void 0&&!Number.isSafeInteger(n)?{error:Z,entryPosition:n}:(((i==null?void 0:i.entries)||[]).forEach(a=>{a.participantId===r&&(a.entryPosition=n)}),((e==null?void 0:e.entries)||[]).forEach(a=>{a.participantId===r&&(a.entryPosition=n)}),o||(i!=null&&i.entries&&(i.entries=Vr({entries:i.entries})),e!=null&&e.entries&&(e.entries=Vr({entries:e.entries}))),F2({},B)):k({result:{error:It},stack:s}):{error:ee}}function eve({tournamentRecord:t,entryPositions:e,drawDefinition:r,event:n}){if(!t)return{error:ee};if(!Array.isArray(e))return{error:Z};for(const o of e){const{participantId:i,entryPosition:s}=o,a=V2({skipRefresh:!0,tournamentRecord:t,drawDefinition:r,participantId:i,entryPosition:s,event:n});if(a.error)return a}return n!=null&&n.entries&&(n.entries=Vr({entries:n.entries})),r!=null&&r.entries&&(r.entries=Vr({entries:r.entries})),F2({},B)}function tve(t){return WD(t)}function L2({scaleAttributes:t,scaledEntries:e,stageEntries:r,seedsCount:n,scaleName:o}){if(!t)return{error:Se,info:"missing scaleAttributes"};const i=Object.assign({},...(e||[]).slice(0,n).map(({participantId:c},l)=>({[c]:l+1})));o=o||t.scaleName;const s=new Date().toISOString();return{scaleItemsWithParticipantIds:r.map(({participantId:c})=>{const l={scaleValue:i[c],eventType:t.eventType,scaleType:Xr,scaleName:o,scaleDate:s};return{participantId:c,scaleItems:[l]}})}}function rve(t){return HD(t)}var nve=Object.defineProperty,Xw=Object.getOwnPropertySymbols,ove=Object.prototype.hasOwnProperty,ive=Object.prototype.propertyIsEnumerable,eN=(t,e,r)=>e in t?nve(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,sve=(t,e)=>{for(var r in e||(e={}))ove.call(e,r)&&eN(t,r,e[r]);if(Xw)for(var r of Xw(e))ive.call(e,r)&&eN(t,r,e[r]);return t};function ave({tournamentRecord:t,scaleAttributes:e,participantIds:r}){var n;if(!t)return{error:ee};if(!r)return{error:co};if(!e)return{error:Se,info:"scaleAttributes required"};const{scaleType:o,eventType:i,scaleName:s}=e,a=[ax,o,i,s].join(".");return(n=t.participants)==null||n.forEach(c=>{r.includes(c.participantId)&&c.timeItems&&(c.timeItems=c.timeItems.filter(l=>l&&(l==null?void 0:l.itemType)!==a))}),sve({},B)}function B2({tournamentRecord:t,scaleAttributes:e,drawDefinition:r,entryStatuses:n,drawId:o,event:i,stage:s}){var a;if(!i)return{error:Re};if(n&&!Array.isArray(n))return k({result:{error:Z},info:Yt("entryStatus"),stack:"removeScaleValues"});let c=i.entries;if(o){const{flightProfile:d}=ht({event:i}),p=(a=d==null?void 0:d.flights)==null?void 0:a.find(v=>v.drawId===o);p?c=p.drawEntries:c=r==null?void 0:r.entries}const u=(c||[]).filter(d=>(!s||!d.entryStage||d.entryStage===s)&&(!n||n.includes(d.entryStatus))).map(Ze);return ave({tournamentRecord:t,scaleAttributes:e,participantIds:u})}function Fu({tournamentRecord:t,scaleAttributes:e,participantId:r}){if(!t)return{error:ee};if(!r)return{error:It};const{participant:n}=qo({tournamentRecord:t,participantId:r});return n?kn({participant:n,scaleAttributes:e}):{error:Tt}}var cve=Object.defineProperty,tN=Object.getOwnPropertySymbols,lve=Object.prototype.hasOwnProperty,uve=Object.prototype.propertyIsEnumerable,rN=(t,e,r)=>e in t?cve(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,nN=(t,e)=>{for(var r in e||(e={}))lve.call(e,r)&&rN(t,r,e[r]);if(tN)for(var r of tN(e))uve.call(e,r)&&rN(t,r,e[r]);return t};function mc({sortDescending:t=!1,tournamentRecord:e,scaleAttributes:r,scaleSortMethod:n,stageSequence:o,entries:i,event:s,stage:a}){if(!e)return{error:ee};return i=i||(s==null?void 0:s.entries)||[],{scaledEntries:i.filter(p=>(!a||!p.entryStage||p.entryStage===a)&&(!o||!p.entryStageSequence||p.entryStageSequence===o)&&Ko.includes(p.entryStatus)).map(p=>{const{participantId:v}=p,{scaleItem:f}=Fu({tournamentRecord:e,scaleAttributes:r,participantId:v});return nN(nN({},p),f)}).filter(p=>{const v=p.scaleValue;return!n&&(isNaN(v)||!parseFloat(v))?!1:v}).sort(n||u)};function u(p,v){return t?d(v)-d(p):d(p)-d(v)}function d(p){return parseFloat(p.scaleValue||(t?-1:1e5))}}function dve({tournamentRecord:t,drawDefinition:e,entryStatuses:r,scaleName:n,drawId:o,event:i,stage:s}){var a,c;if(!t)return{error:ee};if(!i)return{error:Re};n=n||((a=i.category)==null?void 0:a.categoryName)||((c=i.category)==null?void 0:c.ageCategoryCode);const l={eventType:i.eventType,scaleType:Xr,scaleName:n};return B2({tournamentRecord:t,scaleAttributes:l,drawDefinition:e,entryStatuses:r,drawId:o,event:i,stage:s})}function pve({tournamentRecord:t,drawDefinition:e,policyDefinitions:r,scaleAttributes:n,scaleName:o,drawSize:i,drawId:s,event:a,stage:c,sortDescending:l,scaleSortMethod:u}){const d=A2({policyDefinitions:r,drawDefinition:e,drawSize:i,drawId:s,event:a,stage:c});if(d.error)return d;const{entries:p,seedsCount:v,stageEntries:f}=d,{scaledEntries:m}=mc({tournamentRecord:t,scaleAttributes:n,scaleSortMethod:u,sortDescending:l,entries:p,stage:c}),{scaleItemsWithParticipantIds:g}=L2({scaleAttributes:n,scaledEntries:m,stageEntries:f,seedsCount:v,scaleName:o});return{scaleItemsWithParticipantIds:g}}var fve=Object.defineProperty,oN=Object.getOwnPropertySymbols,vve=Object.prototype.hasOwnProperty,mve=Object.prototype.propertyIsEnumerable,iN=(t,e,r)=>e in t?fve(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,gve=(t,e)=>{for(var r in e||(e={}))vve.call(e,r)&&iN(t,r,e[r]);if(oN)for(var r of oN(e))mve.call(e,r)&&iN(t,r,e[r]);return t};function hve({tournamentRecord:t,drawDefinition:e,resetEntries:r,event:n}){var o,i;if(!e)return{error:pe};const s=(o=e.structures)==null?void 0:o.find(c=>c.stage===Nt);if(!s)return{error:xr};const a=((i=s.matchUps)==null?void 0:i.map(({matchUpId:c})=>c))||[];return s.positionAssignments=[],s.seedAssignments=[],s.matchUps=[],Oi({tournamentId:t==null?void 0:t.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:a,drawDefinition:e}),r&&(e.entries=e.entries.filter(c=>c.entryStage!==Nt)),Qe({tournamentId:t==null?void 0:t.tournamentId,eventId:n==null?void 0:n.eventId,drawDefinition:e,structureIds:[s.structureId]}),gve({},B)}var _ve=Object.defineProperty,sN=Object.getOwnPropertySymbols,Ive=Object.prototype.hasOwnProperty,Pve=Object.prototype.propertyIsEnumerable,aN=(t,e,r)=>e in t?_ve(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,yve=(t,e)=>{for(var r in e||(e={}))Ive.call(e,r)&&aN(t,r,e[r]);if(sN)for(var r of sN(e))Pve.call(e,r)&&aN(t,r,e[r]);return t};function Ove({autoPublish:t=!0,tournamentRecord:e,auditData:r,event:n}){var o;if(!e)return{error:ee};if(!n)return{error:Re};const{flightProfile:i}=ht({event:n});if(i){const s=(o=i.flights)==null?void 0:o.map(({drawId:c})=>c).filter(Boolean),a=mg({eventId:n.eventId,tournamentRecord:e,autoPublish:t,auditData:r,drawIds:s,event:n});return a.error?a:ed({event:n,name:nn})}return yve({},B)}var Sve=Object.defineProperty,cN=Object.getOwnPropertySymbols,bve=Object.prototype.hasOwnProperty,Tve=Object.prototype.propertyIsEnumerable,lN=(t,e,r)=>e in t?Sve(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Eve=(t,e)=>{for(var r in e||(e={}))bve.call(e,r)&&lN(t,r,e[r]);if(cN)for(var r of cN(e))Tve.call(e,r)&&lN(t,r,e[r]);return t};function x2({event:t,orderedDrawIdsMap:e}){var r,n;if(typeof t!="object")return{error:Re};if(!e)return{error:Se,info:"Missing drawIdsOrderMap"};if(typeof e!="object")return{error:Z,info:"orderedDrawIdsMap must be an object"};const o=Object.values(e);if(!o.every(a=>!isNaN(a)))return{error:Z,info:"drawOrder must be numeric"};if(Ve(o).length!==o.length)return{error:Z,info:"drawOrder values must be unique"};if((r=t.drawDefinitions)!=null&&r.length){const a=(t.drawDefinitions||[]).map(({drawId:l})=>l),c=Object.keys(e);if(c!=null&&c.length&&Dt(a,c).length!==a.length)return{error:Z,info:"Missing drawIds"};t.drawDefinitions.forEach(l=>{l.drawOrder=e[l.drawId]})}const{flightProfile:s}=ht({event:t});return(n=s==null?void 0:s.flights)==null||n.forEach(a=>{a.flightNumber=e[a.drawId]}),Eve({},B)}var wve=Object.defineProperty,uN=Object.getOwnPropertySymbols,Nve=Object.prototype.hasOwnProperty,$ve=Object.prototype.propertyIsEnumerable,dN=(t,e,r)=>e in t?wve(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ave=(t,e)=>{for(var r in e||(e={}))Nve.call(e,r)&&dN(t,r,e[r]);if(uN)for(var r of uN(e))$ve.call(e,r)&&dN(t,r,e[r]);return t};function G2({tournamentRecord:t,event:e}){var r;if(!t)return{error:ee};if(!e)return{error:Re};const{flightProfile:n}=ht({event:e}),o=(n==null?void 0:n.flights)&&Object.assign({},...n.flights.sort((i,s)=>i.flightNumber-s.flightNumber).map((i,s)=>({[i.drawId]:s+1})))||((r=e.drawDefinitions)==null?void 0:r.length)&&Object.assign({},...e.drawDefinitions.sort((i,s)=>i.drawOrder-s.drawOrder).map((i,s)=>({[i.drawId]:s+1})))||void 0;return o?x2({event:e,orderedDrawIdsMap:o}):Ave({},B)}var Uve=Object.defineProperty,Cve=Object.defineProperties,Mve=Object.getOwnPropertyDescriptors,pN=Object.getOwnPropertySymbols,Dve=Object.prototype.hasOwnProperty,jve=Object.prototype.propertyIsEnumerable,fN=(t,e,r)=>e in t?Uve(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Rve=(t,e)=>{for(var r in e||(e={}))Dve.call(e,r)&&fN(t,r,e[r]);if(pN)for(var r of pN(e))jve.call(e,r)&&fN(t,r,e[r]);return t},Fve=(t,e)=>Cve(t,Mve(e));function Vve({autoPublish:t=!0,tournamentRecord:e,auditData:r,drawId:n,event:o}){var i,s;if(!e)return{error:ee};if(!n)return{error:Mr};if(!o)return{error:Re};const{flightProfile:a}=ht({event:o});if(a&&((i=a.flights)==null?void 0:i.find(u=>u.drawId===n))){const u=a.flights.filter(p=>p.drawId!==n),d={name:nn,value:Fve(Rve({},a),{flights:u})};eo({event:o,extension:d})}if((s=o.drawDefinitions)==null?void 0:s.find(l=>l.drawId===n)){const l=mg({drawIds:[n],eventId:o.eventId,tournamentRecord:e,autoPublish:t,auditData:r,event:o});if(l.error)return l}return G2({tournamentRecord:e,event:o})}function Lve(t){return eg(t)}function Bve(t){return tg(t)}var xve=Object.defineProperty,vN=Object.getOwnPropertySymbols,Gve=Object.prototype.hasOwnProperty,kve=Object.prototype.propertyIsEnumerable,mN=(t,e,r)=>e in t?xve(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Wve=(t,e)=>{for(var r in e||(e={}))Gve.call(e,r)&&mN(t,r,e[r]);if(vN)for(var r of vN(e))kve.call(e,r)&&mN(t,r,e[r]);return t};function gg({deleteExisting:t,event:e,flightProfile:r}){var n;const o="attachFlightProfile";if(!r)return k({result:{error:Se},stack:o});if(!e)return k({result:{error:Re},stack:o});const{flightProfile:i}=ht({event:e});return i&&gg&&!t?k({result:{error:AA},stack:o}):(n=e.drawDefinitions)!=null&&n.length?k({result:{error:Zj},stack:o}):(eo({event:e,extension:{name:nn,value:r}}),Wve({flightProfile:de(r,!1,!0)},B))}const qve="splitWaterfall",Hve="splitShuttle";var Yve=Object.defineProperty,gN=Object.getOwnPropertySymbols,Kve=Object.prototype.hasOwnProperty,zve=Object.prototype.propertyIsEnumerable,hN=(t,e,r)=>e in t?Yve(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,_N=(t,e)=>{for(var r in e||(e={}))Kve.call(e,r)&&hN(t,r,e[r]);if(gN)for(var r of gN(e))zve.call(e,r)&&hN(t,r,e[r]);return t};function Qve({drawNameRoot:t="Flight",attachFlightProfile:e,tournamentRecord:r,scaleAttributes:n,scaleSortMethod:o,deleteExisting:i,sortDescending:s,drawNames:a=[],scaledEntries:c,flightsCount:l,flightValues:u,splitMethod:d,uuids:p=[],event:v,stage:f}){if(!v)return{error:Re};const m=v.entries||[],{flightProfile:g}=ht({event:v});if(g&&e&&!i)return{error:AA};c||({scaledEntries:c}=mc({tournamentRecord:r,scaleAttributes:n,scaleSortMethod:o,sortDescending:s,event:v,stage:f}));const h=c.map(Ze),_=m.filter(({participantId:T})=>!h.includes(T)).filter(T=>(!f||!T.entryStage||T.entryStage===f)&&vs.includes(T.entryStatus)),I=c.concat(..._),P=I.length,S=Math.ceil(P/l);let y=jt(I,S);d===qve?y=Gg(I,l):d===Hve&&(y=Gg(I,l,!0));function O(T){return(T||[]).map(({participantId:N,scaleValue:w})=>{const $=m.find(U=>U.participantId===N);return w&&($.scaleValue=w),$}).sort((N,w)=>N.scaleValue-w.scaleValue).map((N,w)=>(N.scaleValue&&(N.seedNumber=w+1),N))}const b=le(0,l).map(T=>{var N;const w=T+1,$={flightNumber:w,drawId:(p==null?void 0:p.pop())||ke(),drawEntries:O(y[T]),drawName:(a==null?void 0:a.length)&&a[T]||`${t} ${w}`},U=(N=u==null?void 0:u.find(A=>A.flightNumber===w))==null?void 0:N.matchUpValue;return U&&($.matchUpValue=U),$}),E={scaleAttributes:n,splitMethod:d,flights:b};if(e){const T=gg({flightProfile:E,deleteExisting:i,event:v});return _N({splitEntries:Ct()&&y||void 0},T)}else return _N({flightProfile:E},B)}var Jve=Object.defineProperty,IN=Object.getOwnPropertySymbols,Zve=Object.prototype.hasOwnProperty,Xve=Object.prototype.propertyIsEnumerable,PN=(t,e,r)=>e in t?Jve(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,eme=(t,e)=>{for(var r in e||(e={}))Zve.call(e,r)&&PN(t,r,e[r]);if(IN)for(var r of IN(e))Xve.call(e,r)&&PN(t,r,e[r]);return t};function tme(t){const{tournamentRecord:e}=t;if(!e)return{error:ee};const r=e.participants;return hD(eme({participants:r},t))}function rme(t){return gD(t)}function nme({substituteParticipantId:t,existingParticipantId:e,tournamentRecord:r,drawDefinition:n,sideNumber:o,matchUpId:i,event:s}){const a="substituteParticipant";if(!n)return{error:pe};if(!i)return{error:Ut};if(!e||!t)return k({result:{error:It},stack:a});const{matchUp:c}=nt({drawDefinition:n,matchUpId:i,event:s});if(!c)return{error:kr};if(!c.collectionId)return k({result:{error:Gr},stack:a});const l=zt({drawDefinition:n}),{matchUps:u}=wt({tournamentParticipants:r==null?void 0:r.participants,includeByeMatchUps:!0,inContext:!0,drawDefinition:n,matchUpsMap:l}),d=u.find(m=>m.matchUpId===i),v=u.find(m=>m.matchUpId===d.matchUpTieId).sides.find(m=>m.participant.individualParticipants.some(({participantId:g})=>g===e));return!v||o&&v.sideNumber!==o?{error:ao}:v.participant.individualParticipants.map(Ze).filter(m=>m!==e).includes(t)?C2({newParticipantId:t,tieMatchUpId:i,existingParticipantId:e,substitution:!0,tournamentRecord:r,drawDefinition:n,event:s}):k({result:{error:ao},stack:a})}function ome(t){return nme(t)}function ime(t){return SD(t)}var sme=Object.defineProperty,yN=Object.getOwnPropertySymbols,ame=Object.prototype.hasOwnProperty,cme=Object.prototype.propertyIsEnumerable,ON=(t,e,r)=>e in t?sme(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,lme=(t,e)=>{for(var r in e||(e={}))ame.call(e,r)&&ON(t,r,e[r]);if(yN)for(var r of yN(e))cme.call(e,r)&&ON(t,r,e[r]);return t};function ume({tournamentRecord:t,removeScheduling:e,drawDefinition:r}){var n;if(!r)return{error:pe};const o=zt({drawDefinition:r}),i=a=>{var c;return(c=o==null?void 0:o.drawMatchUps)==null?void 0:c.find(l=>l.matchUpId===a)};for(const a of r.structures||[]){const{positionAssignments:c,stage:l,stageSequence:u}=a;c&&(u!==1||![Ie,ue].includes(l))&&(a.positionAssignments=c.map(p=>(delete p.participantId,p)),a.seedAssignments=[]);const{matchUps:d}=Ke({afterRecoveryTimes:!1,inContext:!0,matchUpsMap:o,structure:a});for(const p of d){const{matchUpId:v,roundNumber:f,sides:m}=p,g=i(v);if(delete g.extensions,delete g.notes,g.matchUpStatus!==qe&&Object.assign(g,fd),f&&f>1&&g.drawPositions){const h=m==null?void 0:m.map(({drawPosition:_,participantFed:I})=>!I&&_).filter(Boolean);g.drawPositions=g.drawPositions.map(_=>h.includes(_)?void 0:_)}e?delete g.timeItems:(n=g.timeItems)!=null&&n.length&&(g.timeItems=g.timeItems.filter(h=>![jo,ts,Ec,tx,wc,Nc].includes(h.itemType))),ze({tournamentId:t==null?void 0:t.tournamentId,context:"resetDrawDefiniton",drawDefinition:r,matchUp:g})}}const s=(r.structures||[]).map(({structureId:a})=>a);return Qe({drawDefinition:r,structureIds:s}),lme({},B)}var dme=Object.defineProperty,pme=Object.defineProperties,fme=Object.getOwnPropertyDescriptors,SN=Object.getOwnPropertySymbols,vme=Object.prototype.hasOwnProperty,mme=Object.prototype.propertyIsEnumerable,bN=(t,e,r)=>e in t?dme(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,gme=(t,e)=>{for(var r in e||(e={}))vme.call(e,r)&&bN(t,r,e[r]);if(SN)for(var r of SN(e))mme.call(e,r)&&bN(t,r,e[r]);return t},hme=(t,e)=>pme(t,fme(e));function _me({matchPlayDrawPositions:t=!0,tournamentRecord:e,drawDefinition:r,drawId:n}){if(!e)return{error:ee};if(!r)return{error:pe};let o=[];const{drawsAnalysis:i}=pg({tournamentRecord:e});if(i.canBePruned.includes(n)){const s=i.matchPlay.includes(n),a=i.drawAnalysis[n],{structures:[c]}=Ur({stageSequence:1,drawDefinition:r,stage:ue}),l=a.structuresData.find(({structureId:v})=>c.structureId===v),u=c.matchUps||[];o=u.sort((v,f)=>v.roundPosition-f.roundPosition).filter(({roundNumber:v})=>!l.inactiveRounds.includes(v));const d=o.map($t),p=u.map($t).filter(v=>!d.includes(v));if(s){const v=o.sort((I,P)=>I.roundPosition-P.roundPosition).filter(({roundNumber:I})=>!l.inactiveRounds.includes(I)).filter(({winningSide:I})=>I),f=v.map($t),m=d.filter(I=>!f.includes(I));p.push(...m);const h=v.map(({drawPositions:I})=>I).flat(),_=Object.assign({},...h.map((I,P)=>({[I]:P+1})));if(v.forEach(I=>{t?I.drawPositions=I.drawPositions.map(P=>_[P]):delete I.drawPositions}),t){const I=c.positionAssignments.filter(P=>h.includes(P.drawPosition)).map(P=>(P.drawPosition=_[P.drawPosition],P));c.positionAssignments=I}else c.positionAssignments=[];c.matchUps=v,o=v}Oi({tournamentId:e==null?void 0:e.tournamentId,matchUpIds:p,drawDefinition:r}),Qe({drawDefinition:r})}return hme(gme({},B),{matchUps:o})}function Ime(t){return zD(t)}const Pme="ASC",TN="DESC";var yme=Object.defineProperty,Ome=Object.defineProperties,Sme=Object.getOwnPropertyDescriptors,EN=Object.getOwnPropertySymbols,bme=Object.prototype.hasOwnProperty,Tme=Object.prototype.propertyIsEnumerable,wN=(t,e,r)=>e in t?yme(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Eme=(t,e)=>{for(var r in e||(e={}))bme.call(e,r)&&wN(t,r,e[r]);if(EN)for(var r of EN(e))Tme.call(e,r)&&wN(t,r,e[r]);return t},wme=(t,e)=>Ome(t,Sme(e));function k2({useDefaultEventRanking:t,tournamentRecord:e,drawDefinition:r,scaleAccessor:n,singlesOnly:o,tieFormat:i,attach:s,event:a}){var c,l,u;if((a==null?void 0:a.eventType)!==gn)return{error:ni};if(!e)return{error:ee};if(!i&&!r)return{error:Cn};if(i=i||((c=Zt({drawDefinition:r,event:a}))==null?void 0:c.tieFormat),cr({tieFormat:i}).error)return{error:Xo};if(typeof n!="object"&&!t)return{error:Z,context:{scaleAccessor:n}};const d={},v=((r==null?void 0:r.entries)||a.entries).filter(U=>(U==null?void 0:U.entryStatus)===Cr).map(Ze),{participants:f=[]}=Os({withIndividualParticipants:!0,withScaleValues:!0,tournamentRecord:e}),m=f.filter(({participantId:U})=>v.includes(U)),g=U=>U===ai?"rankings":"ratings",h=((l=a==null?void 0:a.category)==null?void 0:l.categoryName)||((u=a==null?void 0:a.category)==null?void 0:u.ageCategoryCode),{scaleName:_=h,scaleType:I=ai,sortOrder:P,accessor:S}=n||{},y=g(I),O=(U,A)=>{var C,M,D;let V=(C=U[y])==null?void 0:C[A];if(!V&&t&&(V=(M=U[y])==null?void 0:M[ri]),Array.isArray(V)){const R=(D=V.find(W=>W.scaleName===_))==null?void 0:D.scaleValue;if(Pt(R))return R;if(S&&typeof R=="object")return R[S]}return 0},b=(U,A,C)=>{const M=P===TN?A:U,D=P===TN?U:A;return O(M,C)-O(D,C)},E=(U,A)=>b(U,A,ri),T=(U,A)=>b(U,A,Kr),N=[],w=i.collectionDefinitions||[];for(const U of m){const A=U.individualParticipants.sort(E),C=o?A:U.individualParticipants.sort(T),M={};for(const V of w){const R=[],{collectionId:W,matchUpCount:x,matchUpType:K,gender:j}=V,L=K===ri;le(0,x).forEach(F=>{const q=L?A:C,G=F+1,H=[];le(0,L?1:2).forEach(Q=>{const z=q.find(Y=>{const J=[at,vt].includes(j)&&j||j===go&&[at,vt][Q];return(!J||J===Y.person.sex)&&!R.includes(Y.participantId)}).participantId;z&&(H.push(z),R.push(z),M[z]||(M[z]=[]),M[z].push({collectionPosition:G,collectionId:W}))}),L||N.push(H)})}const D=Object.keys(M).map(V=>({collectionAssignments:M[V],participantId:V}));d[U.participantId]=D}const $=[];for(const U of N){const{participant:A}=$n({tournamentParticipants:f,participantIds:U});if(!A){const C={individualParticipantIds:U,participantRole:xt,participantType:we};$.push(C)}}if(s){for(;$.length;)An({participant:$.pop(),tournamentRecord:e});et({element:r,extension:{name:En,value:d}})}return wme(Eme({},B),{lineUps:d,participantsToAdd:$})}var Nme=Object.defineProperty,$me=Object.defineProperties,Ame=Object.getOwnPropertyDescriptors,NN=Object.getOwnPropertySymbols,Ume=Object.prototype.hasOwnProperty,Cme=Object.prototype.propertyIsEnumerable,$N=(t,e,r)=>e in t?Nme(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,AN=(t,e)=>{for(var r in e||(e={}))Ume.call(e,r)&&$N(t,r,e[r]);if(NN)for(var r of NN(e))Cme.call(e,r)&&$N(t,r,e[r]);return t},Mme=(t,e)=>$me(t,Ame(e));function Dme({event:t,drawId:e,drawDefinition:r,drawName:n}){var o;if(!n||typeof n!="string")return{error:Z,drawName:n};const{flightProfile:i}=ht({event:t}),s=(o=i==null?void 0:i.flights)==null?void 0:o.find(a=>a.drawId===e);if(s){s.drawName=n;const a={name:nn,value:Mme(AN({},i),{flights:i.flights})};eo({event:t,extension:a})}return r&&(r.drawName=n,Qe({drawDefinition:r})),!s&&!r?{error:pe}:AN({},B)}var jme=Object.defineProperty,UN=Object.getOwnPropertySymbols,Rme=Object.prototype.hasOwnProperty,Fme=Object.prototype.propertyIsEnumerable,CN=(t,e,r)=>e in t?jme(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Vme=(t,e)=>{for(var r in e||(e={}))Rme.call(e,r)&&CN(t,r,e[r]);if(UN)for(var r of UN(e))Fme.call(e,r)&&CN(t,r,e[r]);return t};function Lme({event:t,tournamentRecord:e,entryStage:r=ue,participantIdPairs:n=[],unpairedParticipantIds:o=[],entryStatus:i=Cr}){if(!e)return{error:ee};if(!t)return{error:Re};const s=e.participants||[],a=s.filter(h=>h.participantType===Ce).map(h=>h.participantId),l=o.concat(...n).flat(1/0).filter(h=>!a.includes(h));if(l.length)return{error:Jr,invalidParticipantIds:l};const u=n.filter(h=>h.length!==2);if(u.length)return{error:Jr,invalidParticipantIdPairs:u};const d=s.filter(h=>h.participantType===we).map(h=>h.individualParticipantIds),v=n.filter(h=>!d.find(_=>Dt(_,h).length===2)).map(h=>({participantType:we,participantRole:xt,individualParticipantIds:h})),f=Zn({tournamentRecord:e,participants:v});if(f.error)return f;const m=n.map(h=>{const{participant:_}=$n({tournamentRecord:e,participantIds:h});return _}).map(h=>({participantId:h,entryStatus:i,entryStage:r})),g=o.map(h=>({entryStatus:Wr,participantId:h,entryStage:r}));return t.entries=(t.entries||[]).filter(h=>h.entryStage===r),t.entries=t.entries.concat(...m,...g),Vme({},B)}function hg(t){var e;const r=(e=t.tournamentRecord)==null?void 0:e.participants;return Object.assign(t,{tournamentParticipants:r}),qD(t)}var Bme=Object.defineProperty,xme=Object.defineProperties,Gme=Object.getOwnPropertyDescriptors,MN=Object.getOwnPropertySymbols,kme=Object.prototype.hasOwnProperty,Wme=Object.prototype.propertyIsEnumerable,DN=(t,e,r)=>e in t?Bme(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,qme=(t,e)=>{for(var r in e||(e={}))kme.call(e,r)&&DN(t,r,e[r]);if(MN)for(var r of MN(e))Wme.call(e,r)&&DN(t,r,e[r]);return t},Hme=(t,e)=>xme(t,Gme(e));function _g({qualifyingPositions:t,drawEntries:e=[],drawName:r,drawId:n,event:o,stage:i}){var s,a,c;const l="addFlight";if(!o)return k({result:{error:Re},stack:l});if(!r)return k({result:{error:Se},stack:l});if(e!=null&&e.length){const _=Jn(o.entries||[]),I=Jn(e);if(Dt(I,_).length!==I.length)return k({result:{error:Z},stack:l})}const u=(s=ht({event:o}))==null?void 0:s.flightProfile,d=((c=(a=u==null?void 0:u.flights)==null?void 0:a.map(({flightNumber:_})=>!isNaN(_)&&parseInt(_)))==null?void 0:c.filter(Boolean))||[],p=Math.max(0,...d)+1,f={drawId:n||ke(),flightNumber:p,drawEntries:e,drawName:r};if(i&&(f.stage=i),t&&(f.qualifyingPositions=t),((u==null?void 0:u.flights)||[]).find(({drawId:_})=>_===f.drawId))return k({result:{error:tF},stack:l});const g=((u==null?void 0:u.flights)||[]).concat(f),h={name:nn,value:Hme(qme({},u||{}),{flights:g})};return eo({event:o,extension:h})}var Yme=Object.defineProperty,Kme=Object.defineProperties,zme=Object.getOwnPropertyDescriptors,jN=Object.getOwnPropertySymbols,Qme=Object.prototype.hasOwnProperty,Jme=Object.prototype.propertyIsEnumerable,RN=(t,e,r)=>e in t?Yme(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,W2=(t,e)=>{for(var r in e||(e={}))Qme.call(e,r)&&RN(t,r,e[r]);if(jN)for(var r of jN(e))Jme.call(e,r)&&RN(t,r,e[r]);return t},q2=(t,e)=>Kme(t,zme(e));function Zme(t){return Ig(q2(W2({},t),{itemType:"attachConsolationStructures"}))}function Xme(t){return Ig(q2(W2({},t),{itemType:"attachPlayoffStructures"}))}function Ig({itemType:t="attachStructures",matchUpModifications:e,tournamentRecord:r,drawDefinition:n,structures:o,links:i}){if(!r)return{error:ee};if(!n)return{error:pe};const s=OD({matchUpModifications:e,tournamentRecord:r,drawDefinition:n,structures:o,links:i});if(s.error)return s;const l={itemValue:{structureIds:o==null?void 0:o.map(({structureId:u})=>u),drawId:n.drawId},itemType:t};return Oo({tournamentRecord:r,timeItem:l}),s}var ege=Object.defineProperty,FN=Object.getOwnPropertySymbols,tge=Object.prototype.hasOwnProperty,rge=Object.prototype.propertyIsEnumerable,VN=(t,e,r)=>e in t?ege(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Pg=(t,e)=>{for(var r in e||(e={}))tge.call(e,r)&&VN(t,r,e[r]);if(FN)for(var r of FN(e))rge.call(e,r)&&VN(t,r,e[r]);return t};function H2({tournamentRecord:t,event:e,startDate:r}){if(!t)return{error:ee};if(!e)return{error:Re};if(!Tn.test(r))return{error:ar};const n=K2(t);if(n.error)return n;const{tournamentStartDate:o,tournamentEndDate:i}=n,s=new Date(Me(r));if(s<o||s>i)return{error:ar};const a=e.endDate&&new Date(Me(e.endDate));return a&&s>a&&(e.endDate=r),e.startDate=r,Pg({},B)}function Y2({tournamentRecord:t,event:e,endDate:r}){if(!t)return{error:ee};if(!e)return{error:Re};if(!Tn.test(r))return{error:ar};const n=K2(t);if(n.error)return n;const{tournamentStartDate:o,tournamentEndDate:i}=n,s=new Date(Me(r));if(s<o||s>i)return{error:ar};const a=e.startDate&&new Date(Me(e.startDate));return a&&s<a&&(e.startDate=r),e.endDate=r,Pg({},B)}function nge({tournamentRecord:t,event:e,startDate:r,endDate:n}){if(!t)return{error:ee};if(!e)return{error:Re};if(!r&&!n)return{error:Se,info:"missing date"};if(r&&!Tn.test(r))return{error:ar};if(n&&!Tn.test(n))return{error:ar};if(r&&n){const o=new Date(Me(r)),i=new Date(Me(n));if(o>i)return{error:Z}}if(r){const o=H2({tournamentRecord:t,event:e,startDate:r});if(o.error)return o}if(n){const o=Y2({tournamentRecord:t,event:e,endDate:n});if(o.error)return o}return Pg({},B)}function K2(t){const{startDate:e,endDate:r}=t;return!Tn.test(e)||!Tn.test(r)?k({result:{error:bR},context:{startDate:e,endDate:r}}):{tournamentStartDate:new Date(Me(e)),tournamentEndDate:new Date(Me(r))}}var oge=Object.defineProperty,LN=Object.getOwnPropertySymbols,ige=Object.prototype.hasOwnProperty,sge=Object.prototype.propertyIsEnumerable,BN=(t,e,r)=>e in t?oge(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,age=(t,e)=>{for(var r in e||(e={}))ige.call(e,r)&&BN(t,r,e[r]);if(LN)for(var r of LN(e))sge.call(e,r)&&BN(t,r,e[r]);return t};function cge({tournamentRecord:t,drawDefinition:e,drawPosition:r}){return t?e?lt(r)?age({},B):{error:sa}:{error:pe}:{error:ee}}var lge=Object.defineProperty,xN=Object.getOwnPropertySymbols,uge=Object.prototype.hasOwnProperty,dge=Object.prototype.propertyIsEnumerable,GN=(t,e,r)=>e in t?lge(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,pge=(t,e)=>{for(var r in e||(e={}))uge.call(e,r)&&GN(t,r,e[r]);if(xN)for(var r of xN(e))dge.call(e,r)&&GN(t,r,e[r]);return t};function fge({tournamentRecord:t,drawDefinition:e,matchUpId:r,lineUps:n,event:o}){var i,s,a,c;if(!t)return{error:ee};if(!e)return{error:Cn};if(typeof r!="string")return{error:Gr};if(!Array.isArray(n))return{error:Z,lineUps:n};const l="applyLineUps",u=t.participants||[];let d=nt({tournamentParticipants:u,inContext:!0,drawDefinition:e,matchUpId:r});if(d.error)return d;const{matchUp:p,structure:v}=d,{drawPositions:f,matchUpType:m}=p;if(m!==We)return{error:Gr};if(!(f!=null&&f.length))return{error:Kf};const g=(i=Zt({matchUp:p,drawDefinition:e,structure:v,event:o}))==null?void 0:i.tieFormat,h={};for(const I of n){if(!Array.isArray(I))return{error:Z,lineUp:I};const P={},S=[];for(const b of I){if(typeof b!="object")return{error:Z,lineUpAssignment:b};const{participantId:E,collectionAssignments:T=[]}=b;if(!Array.isArray(T))return{error:Z,collectionAssignments:T};const N=u.find($=>$.participantId===E);if(!N)return{error:Tt};if(N.participantType!==Ce)return{error:bn};const w=(a=(s=p.sides)==null?void 0:s.find($=>{var U,A;return(A=(U=$.participant)==null?void 0:U.individualParticipantIds)==null?void 0:A.includes(E)}))==null?void 0:a.sideNumber;w&&S.push(w);for(const $ of T){if(typeof $!="object")return{error:Z,collectionAssignment:$};const{collectionId:U,collectionPosition:A}=$,C=(c=g==null?void 0:g.collectionDefinitions)==null?void 0:c.find(V=>V.collectionId===U);if(!C)return{error:Z,collectionId:U};const M=`${U}-${A}`;P[M]||(P[M]=[]);const D=P[M].length;if(C.matchUpType===ut&&D||C.matchUpType===ot&&D>1)return{info:"Excessive collectionPosition assignments",error:Z};P[M].push(E)}}for(const b of Object.values(P))if(b.length===2){const{pairedParticipant:E}=$n({tournamentParticipants:u,participantIds:b});if(!E){const N=An({participant:{participantType:we,participantRole:xt,individualParticipantIds:b},pairOverride:!0,tournamentRecord:t});if(N.error)return N}}const y=fr(S),O=(y[1]||0)>(y[2]||0)&&1||(y[2]||0)>(y[1]||0)&&2||void 0;O&&!Object.keys(h).includes(O)&&(h[O]=I)}if(!Object.keys(h).length)return{error:NA};if(d=nt({drawDefinition:e,matchUpId:r}),d.error)return d;const{matchUp:_}=d;_.sides||(_.sides=[]);for(const I of[1,2]){const P=_.sides.find(y=>y.sideNumber===I),S=h[I];if(S)P?P.lineUp=S:_.sides.push({lineUp:S,sideNumber:I});else continue}return ze({tournamentId:t==null?void 0:t.tournamentId,context:l,drawDefinition:e,matchUp:_}),pge({},B)}function vge(t){return JD(t)}function mge(t){return Qm(t)}function gge(t){return Km(t)}var hge=Object.defineProperty,kN=Object.getOwnPropertySymbols,_ge=Object.prototype.hasOwnProperty,Ige=Object.prototype.propertyIsEnumerable,WN=(t,e,r)=>e in t?hge(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Pge=(t,e)=>{for(var r in e||(e={}))_ge.call(e,r)&&WN(t,r,e[r]);if(kN)for(var r of kN(e))Ige.call(e,r)&&WN(t,r,e[r]);return t};function yge(t){const{tournamentRecord:e}=t;if(!e)return{error:ee};const r=e.participants;return Zm(Pge({participants:r},t))}function Oge({tournamentRecord:t,drawDefinition:e,structure:r,link:n}){if(!t)return{error:ee};if(!e)return{error:pe};const o=Xm({tournamentRecord:t,drawDefinition:e,structure:r,link:n});if(o.error)return o;const s={itemType:"attachQualifyingStructures",itemValue:{structureId:r.structureId,drawId:e.drawId}};return Oo({tournamentRecord:t,timeItem:s}),o}function Sge(t){const e=t.tournamentRecord;if(!e)return{error:ee};const r=_D(t);if(r.error)return r;const{qualifyingRoundNumber:n,qualifyingPositions:o,targetStructureId:i,drawDefinition:s,structureName:a,matchUpType:c,drawSize:l,drawType:u}=t,p={itemType:"addQualifyingStructures",itemValue:_e({drawId:s.drawId,structureName:a,targetStructureId:i,qualifyingPositions:o,qualifyingRoundNumber:n,matchUpType:c,drawSize:l,drawType:u})};return Oo({tournamentRecord:e,timeItem:p}),r}var bge=Object.defineProperty,qN=Object.getOwnPropertySymbols,Tge=Object.prototype.hasOwnProperty,Ege=Object.prototype.propertyIsEnumerable,HN=(t,e,r)=>e in t?bge(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,wge=(t,e)=>{for(var r in e||(e={}))Tge.call(e,r)&&HN(t,r,e[r]);if(qN)for(var r of qN(e))Ege.call(e,r)&&HN(t,r,e[r]);return t};function Nge(t){const{tournamentRecord:e}=t;if(!e)return{error:ee};const r=e.participants;return Wm(wge({participants:r},t))}function YN({preparedStructureIds:t=[],provisionalPositioning:e,inContextDrawMatchUps:r,tournamentRecord:n,appliedPolicies:o,qualifyingOnly:i,drawDefinition:s,seedingProfile:a,participants:c,matchUpsMap:l,automated:u,placeByes:d,drawType:p,drawSize:v,entries:f,event:m,enforcePolicyLimits:g=!0,seedAssignmentProfile:h,seedByRanking:_=!0,seededParticipants:I,assignSeedsCount:P,seedingScaleName:S,seedsCount:y,stageSequence:O=1,roundTarget:b,stage:E}){const T=m==null?void 0:m.eventType,N=f.filter(x=>{var K,j;const L=(j=(K=Lt({name:Dn,element:x}))==null?void 0:K.extension)==null?void 0:j.value;return(!x.entryStage||x.entryStage===E)&&(!O||!x.entryStageSequence||x.entryStageSequence===O)&&(!b||!L||L===b)&&vs.includes(x.entryStatus)});I&&(y=I.length),y>v&&(y=v),y>N.length&&(y=N.length);const{structures:w}=Ur({drawDefinition:s,stageSequence:O,roundTarget:b,stage:E}),$=w.length>1,U=w.find(({structureId:x})=>!t.includes(x)),{structureId:A}=U||{},C=ys({provisionalPositioning:e,appliedPolicies:o,drawDefinition:s,structure:U,event:m}),{seedLimit:M}=wD({participantCount:N.length,enforcePolicyLimits:g,appliedPolicies:o,drawDefinition:s,seedingProfile:a,structureId:A,seedsCount:y});M&&M<y&&(y=M);const D=f.map(Ze);if(I)I.filter(({participantId:x})=>D.includes(x)).filter(x=>!x.seedNumber||x.seedNumber<=I.length).sort((x,K)=>x.seedNumber<K.seedNumber?-1:x.seedNumber<K.seedNumber?1:0).forEach(x=>{const{participantId:K,seedNumber:j,seedValue:L}=x;ss({provisionalPositioning:e,tournamentRecord:n,drawDefinition:s,seedingProfile:a,participantId:K,seedBlockInfo:C,structureId:A,seedNumber:j,seedValue:L,event:m})});else if(m||S){const{categoryName:x,ageCategoryCode:K}=(m==null?void 0:m.category)||{},j={scaleType:Xr,scaleName:S||x||K||m.eventId,eventType:T};let{scaledEntries:L}=mc({scaleAttributes:j,tournamentRecord:n,stageSequence:O,entries:f,stage:E});!(L!=null&&L.length)&&_&&({scaledEntries:L}=mc({scaleAttributes:{scaleType:ai,scaleName:x||K,eventType:T},tournamentRecord:n,stageSequence:O,entries:f,stage:E}));const F=(L==null?void 0:L.length)||0;F<y&&(y=F),L==null||L.filter(({participantId:q})=>D.includes(q)).slice(0,P||y).forEach((q,G)=>{const H=G+1,{participantId:Q,scaleValue:z}=q,Y=(h==null?void 0:h[H])||z||H;ss({provisionalPositioning:e,tournamentRecord:n,drawDefinition:s,seedingProfile:a,participantId:Q,structureId:A,seedNumber:H,seedValue:Y,event:m})})}let V,R,W=[];if(u!==!1&&p!==sn&&!(i&&E!==Ie)){const x=typeof u=="object"&&u.seedsOnly,K=il({inContextDrawMatchUps:r,multipleStructures:$,tournamentRecord:n,appliedPolicies:o,drawDefinition:s,seedingProfile:a,participants:c,structureId:A,matchUpsMap:l,placeByes:d,seedLimit:M,seedsOnly:x,drawType:p,event:m});if(W=K==null?void 0:K.conflicts,V=K==null?void 0:K.positionAssignments,R=K==null?void 0:K.positioningReport,K.error)return k({result:K,stack:"prepareStage"})}return{positionAssignments:V,positioningReport:R,stageEntries:N,structureId:A,seedsCount:y,conflicts:W}}var $ge=Object.defineProperty,Age=Object.defineProperties,Uge=Object.getOwnPropertyDescriptors,KN=Object.getOwnPropertySymbols,Cge=Object.prototype.hasOwnProperty,Mge=Object.prototype.propertyIsEnumerable,zN=(t,e,r)=>e in t?$ge(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,bo=(t,e)=>{for(var r in e||(e={}))Cge.call(e,r)&&zN(t,r,e[r]);if(KN)for(var r of KN(e))Mge.call(e,r)&&zN(t,r,e[r]);return t},Di=(t,e)=>Age(t,Uge(e));function yg(t){var e,r,n,o,i,s,a,c,l,u,d,p,v,f;const m="generateDrawDefinition",{drawType:g=Qn,considerEventEntries:h=!0,ignoreAllowedDrawTypes:_,voluntaryConsolation:I,hydrateCollections:P,policyDefinitions:S,ignoreStageSpace:y,tournamentRecord:O,qualifyingOnly:b,tieFormatName:E,drawEntries:T,addToEvent:N,placeByes:w,event:$}=t,{tournamentParticipants:U}=Kt({tournamentRecord:O,inContext:!0}),A=$&&U&&D2({event:$,participants:U});if(A!=null&&A.error)return k({result:A,stack:m});const C=!_&&O&&$2({tournamentRecord:O,categoryType:$==null?void 0:$.categoryType,categoryName:$==null?void 0:$.categoryName});if(C!=null&&C.length&&!C.includes(g))return k({result:{error:iA},stack:m});const M=((e=$==null?void 0:$.entries)==null?void 0:e.filter(X=>[...YU,cd].includes(X.entryStatus)))||[],D=(b&&[]||T||(h?M:[])).filter(({entryStage:X})=>!X||X===ue);let R=!t.drawSize&&D.length&&![sn,Mc,_a,an,vo].includes(g)&&ia(D.length)||lt(t.drawSize)&&parseInt(t.drawSize);if(isNaN(R)&&g!==sn)return k({result:{error:Bu},stack:m});let W=typeof t.seedsCount!="number"?parseInt(t.seedsCount||0):t.seedsCount||0;const x=$==null?void 0:$.eventType,K=t.matchUpType||x,j=t.drawId&&((r=$==null?void 0:$.drawDefinitions)==null?void 0:r.find(X=>X.drawId===t.drawId));let{tieFormat:L,matchUpFormat:F}=t;if(L){const X=cr({tieFormat:L});if(X.error)return k({result:X,stack:m})}if(K===We&&x===We){const X=(o=(n=j==null?void 0:j.structures)==null?void 0:n.find(({stage:ie})=>ie===ue))==null?void 0:o.tieFormat;L=L||X||E&&((i=$==null?void 0:$.tieFormat)==null?void 0:i.tieFormatName)===E&&$.tieFormat||E&&as({namedFormat:E,hydrateCollections:P,event:$})||($==null?void 0:$.tieFormat)||as({event:$,hydrateCollections:P}),F=void 0}else F||(L=void 0,$!=null&&$.matchUpFormat||(F="SET3-S:6/TB7"));if(t.drawId&&typeof t.drawId!="string")return k({result:{error:Z},stack:m});j&&g!==j.drawType&&(j.drawType=g);let G=j||n2({drawType:g,drawId:t.drawId});if((F||L)&&!(F&&($==null?void 0:$.matchUpFormat)===F||($==null?void 0:$.tieFormat)&&L&&JSON.stringify($.tieFormat)===JSON.stringify(L))){if(L){const ie=lV(L);if(ie.error)return k({result:ie,stack:m});G.tieFormat=ie.tieFormat||L}else{let ie=Ad({tournamentRecord:O,drawDefinition:G,matchUpFormat:F,tieFormat:L,event:$});if(ie.error)return{error:ie.error,info:"matchUpFormat or tieFormat error"}}K&&(G.matchUpType=K)}const{appliedPolicies:H}=ct({tournamentRecord:O,event:$});if(S){if(typeof S!="object")return k({result:{info:"policyDefinitions must be an object",error:Z}});{const X={};for(const ie of Object.keys(S))JSON.stringify(H[ie])!==JSON.stringify(S[ie])&&(X[ie]=S[ie]);Object.keys(X).length&&(Rf({drawDefinition:G,policyDefinitions:X}),Object.assign(H,X))}}H[fa]||(Rf({drawDefinition:G,policyDefinitions:Pf}),Object.assign(H,Pf));let Q=(a=(s=j==null?void 0:j.structures)==null?void 0:s.find(X=>X.stage===ue&&X.stageSequence===1))==null?void 0:a.structureId;const z=T||M,Y=[];let J,te=[];const ne=t.qualifyingPlaceholder&&!((c=t.qualifyingProfiles)!=null&&c.length)&&!j,oe=j==null?void 0:j.structures.filter(X=>X.stage===Ie),se=(oe==null?void 0:oe.length)===1&&!((l=oe[0].matchUps)!=null&&l.length)&&oe[0].structureId;if(se){const X=t.qualifyingProfiles,ie=(X==null?void 0:X.length)&&tD({idPrefix:t.idPrefix,isMock:t.isMock,uuids:t.uuids,qualifyingProfiles:X,appliedPolicies:H,matchUpType:K});if(ie!=null&&ie.error)return ie;G.structures=G.structures.filter(({structureId:Pe})=>Pe!==se),G.links=G.links.filter(({source:Pe})=>Pe.structureId!==se);const{qualifiersCount:fe,qualifyingDrawPositionsCount:Ee,qualifyingDetails:re}=ie;Ee&&(ie!=null&&ie.structures&&G.structures.push(...ie.structures),ie!=null&&ie.links&&G.links.push(...ie.links));const ae=G.structures.find(({stage:Pe,stageSequence:$e})=>Pe===ue&&$e===1),{qualifiersCount:me}=Ti({stageSequence:1,drawDefinition:G,structureId:Q,stage:ue}),Oe=Math.max(fe||0,me||0);let ce=zm({qualifiersCount:Oe,drawDefinition:G,stage:ue});if(ce.error||(ce=fc({drawSize:Ee,stage:Ie,drawDefinition:G}),ce.error))return ce;for(const Pe of(T||[]).filter(({entryStage:$e})=>$e===Ie)){const $e=Di(bo({},Pe),{entryStage:Pe.entryStage||ue,drawDefinition:G});Df($e)}for(const Pe of re||[]){const{finalQualifyingRoundNumber:$e,finalQualifyingStructureId:ye,roundTarget:Ae,finishingPositions:be,linkType:ge}=Pe,Ne=ae&&((u=ra({targetStructureId:ae.structureId,sourceStructureId:ye,sourceRoundNumber:$e,finishingPositions:be,targetEntryRound:Ae,linkType:ge}))==null?void 0:u.link);if(Ne!=null&&Ne.error)return Ne;Ne&&G.links.push(Ne)}J={drawDefinition:G}}else{if(J=Qm(Di(bo({},t),{modifyOriginal:!1,tournamentRecord:O,appliedPolicies:H,drawDefinition:G,matchUpFormat:F,matchUpType:K,tieFormat:L,drawSize:R})),J.error)return k({result:J,stack:m});G=J.drawDefinition;for(const ie of z){if(T&&ie.entryStage&&ie.entryStage!==ue)continue;const fe=Di(bo({},ie),{entryStage:ie.entryStage||ue,ignoreStageSpace:y,drawDefinition:G}),Ee=Df(fe);if(T&&Ee.error)return k({result:Ee,stack:m})}g===Pi&&(W=0);const X=YN(Di(bo(bo({},J),t),{qualifyingOnly:!R||b,appliedPolicies:H,drawDefinition:G,participants:U,stage:ue,seedsCount:W,placeByes:w,drawSize:R,entries:z}));if(X.error&&!X.conflicts)return X;(d=X.positioningReport)!=null&&d.length&&Y.push({[ue]:X.positioningReport}),Q=X.structureId,te=X.conflicts}const ve=[];if(t.qualifyingProfiles){const X=(re,ae)=>re.stageSequence-ae.stageSequence,ie=(re,ae)=>re.roundTarget-ae.roundTarget,fe=[];let Ee=1;for(const re of t.qualifyingProfiles.sort(ie)){if(!Array.isArray(re.structureProfiles))return k({result:{error:Se},info:Yt("structureProfiles")});Ee=re.roundTarget||Ee;const ae=((p=re.structureProfiles)==null?void 0:p.sort(X))||[];let me=1;for(const Oe of ae){const{qualifyingRoundNumber:ce,qualifyingPositions:Pe,seededParticipants:$e,seedingScaleName:ye,seedsCount:Ae=0,seedingProfile:be,seedByRanking:ge,placeByes:Ne,drawSize:Ue}=Oe,he=YN(Di(bo(bo({},J),t),{stageSequence:me,qualifyingRoundNumber:ce,preparedStructureIds:fe,qualifyingPositions:Pe,seededParticipants:$e,stage:Ie,seedingScaleName:ye,appliedPolicies:H,drawDefinition:G,qualifyingOnly:b,seedingProfile:be,seedByRanking:ge,participants:U,roundTarget:Ee,seedsCount:Ae,placeByes:Ne,drawSize:Ue,entries:z}));if(he.error)return he;he.structureId&&fe.push(he.structureId),me+=1,(v=he.conflicts)!=null&&v.length&&ve.push(...he.conflicts),(f=he.positioningReport)!=null&&f.length&&Y.push({[Ie]:he.positioningReport})}Ee+=1}}else if(ne){const X=Mt({structureName:Ie,stage:Ie}),{link:ie}=ra({sourceStructureId:X.structureId,targetStructureId:Q,sourceRoundNumber:0,linkType:po});G.structures.push(X),G.links.push(ie)}return G.drawName=t.drawName||g,typeof I=="object"&&Nge(Di(bo({},I),{tournamentRecord:O,appliedPolicies:H,drawDefinition:G,matchUpType:K})),N&&Xc({tournamentRecord:O,drawDefinition:G,event:$}),Di(bo({existingDrawDefinition:!!j,qualifyingConflicts:ve,positioningReports:Y,drawDefinition:G,structureId:Q},B),{conflicts:te})}function Dge(t){return bD(t)}function jge(t){return t.tournamentRecord?to(t):{error:ee}}function Rge(t){return t.tournamentRecord?YD(t):{error:ee}}function Fge(t){return t.tournamentRecord?KD(t):{error:ee}}const Vge={generateQualifyingStructure:yge,attachQualifyingStructure:Oge,attachPlayoffStructures:Xme,attachStructures:Ig,addQualifyingStructure:Sge,renameStructures:Dge,disableTieAutoCalc:Rge,enableTieAutoCalc:Fge,modifyCollectionDefinition:ag,orderCollectionDefinitions:o2,removeCollectionDefinition:sg,addCollectionDefinition:cg,removeCollectionGroup:p2,addCollectionGroup:f2,modifyTieFormat:v2,resetScorecard:vge,resetTieFormat:QD,addEvent:Jd,deleteEvents:Rpe,setEventDates:nge,setEventStartDate:H2,setEventEndDate:Y2,removeSeededParticipant:cge,removeScaleValues:B2,checkValidEntries:D2,addDrawEntries:MD,removeSeeding:dve,autoSeeding:pve,getAvailablePlayoffRounds:Gw,getAvailablePlayoffProfiles:Gw,deleteDrawDefinitions:mg,addPlayoffStructures:kfe,addDrawDefinition:Xc,removeStructure:TD,modifyDrawName:Dme,generateAndPopulatePlayoffStructures:Jm,generateSeedingScaleItems:L2,setSubOrder:kD,addEventEntries:Uo,promoteAlternate:Ofe,promoteAlternates:R2,destroyPairEntry:BD,destroyPairEntries:Lne,setEntryPosition:V2,setEntryPositions:eve,addEventEntryPairs:ype,removeEventEntries:Kd,removeDrawEntries:Gfe,modifyEventEntries:Lme,modifyEntriesStatus:Mf,modifySeedAssignment:Wfe,modifyPairAssignment:Ffe,resetVoluntaryConsolationStructure:hve,deleteFlightProfileAndFlightDraws:Ove,deleteFlightAndFlightDraw:Vve,generateFlightProfile:Qve,refreshEventDrawOrder:G2,attachFlightProfile:gg,resetDrawDefinition:ume,pruneDrawDefinition:_me,updateDrawIdsOrder:x2,getFlightProfile:ht,getScaledEntries:mc,generateLineUps:k2,addFlight:_g,generateAdHocMatchUps:Lve,deleteAdHocMatchUps:ime,addAdHocMatchUps:Bve,drawMatic:hg,setOrderOfFinish:Ime,setDelegatedOutcome:rve,removeDelegatedOutcome:tve,addVoluntaryConsolationStructure:Wm,addVoluntaryConsolationStage:rme,generateVoluntaryConsolation:tme,attachConsolationStructures:Zme,bulkMatchUpStatusUpdate:BC,updateTieMatchUpScore:jge,setMatchUpStatus:Zc,setMatchUpFormat:Qfe,assignDrawPosition:fpe,assignSeedPositions:Upe,assignDrawPositionBye:Ufe,substituteParticipant:ome,swapDrawPositionAssignments:$fe,assignMatchUpSideParticipant:wde,removeDrawPositionAssignment:Eu,alternateDrawPositionAssignment:Nfe,withdrawParticipantAtDrawPosition:Sfe,setDrawParticipantRepresentativeIds:Pde,getDrawParticipantRepresentativeIds:yde,luckyLoserDrawPositionAssignment:Tfe,qualifierDrawPositionAssignment:wfe,setPositionAssignments:Afe,automatedPositioning:dte,automatedPlayoffPositioning:qd,checkInParticipant:vfe,checkOutParticipant:mfe,toggleParticipantCheckInState:jM,addDrawDefinitionTimeItem:_2,generateDrawDefinition:yg,generateDrawStructuresAndLinks:gge,generateDrawTypeAndModifyDrawDefinition:mge,applyLineUps:fge,assignTieMatchUpParticipantId:xf,removeTieMatchUpParticipantId:cpe,replaceTieMatchUpParticipantId:C2,updateTeamLineUp:Qd,validateLineUp:U2,getTeamLineUp:Ac};function Lge({entries:t=[],entryStatus:e,stage:r}){return Math.max(...t.filter(n=>(!r||r===n.entryStage)&&(!e||n.entryStatus===e)&&!isNaN(n.entryPosition)).map(({entryPosition:n})=>parseInt(n||0)),0)}var Bge=Object.defineProperty,xge=Object.defineProperties,Gge=Object.getOwnPropertyDescriptors,QN=Object.getOwnPropertySymbols,kge=Object.prototype.hasOwnProperty,Wge=Object.prototype.propertyIsEnumerable,JN=(t,e,r)=>e in t?Bge(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,qge=(t,e)=>{for(var r in e||(e={}))kge.call(e,r)&&JN(t,r,e[r]);if(QN)for(var r of QN(e))Wge.call(e,r)&&JN(t,r,e[r]);return t},Hge=(t,e)=>xge(t,Gge(e));function Yge({tournamentRecord:t,ascending:e=!0,drawDefinition:r,excludeMargin:n,exclusionRule:o,valueAccessor:i,zoneDoubling:s,matchUpType:a,zoneMargin:c,scaleName:l,matchUps:u,eventId:d,drawId:p,event:v}){var f,m,g,h;if(!t&&!u)return{error:ee};if(a&&![ut,ot].includes(a))return{error:Z,info:{matchUpType:a}};if(!Array.isArray(u)&&u)return{error:Z,context:{matchUps:u}};const _={withScaleValues:!0,withCompetitiveness:!0},I={matchUpTypes:a?[a]:[ut,ot]},P=t==null?void 0:t.participants;(f=u==null?void 0:u[0])!=null&&f.hasContext?p?u=u.filter($=>$.drawId===p):d&&(u=u.filter($=>$.eventId===d)):u===void 0&&(u=p&&!r&&[]||!p&&d&&!v&&[]||p&&((m=Er({inContext:!0,drawDefinition:r,contextFilters:I,contextProfile:_,participants:P}))==null?void 0:m.matchUps)||!p&&d&&((g=Si({inContext:!0,contextFilters:I,contextProfile:_,participants:P,event:v}))==null?void 0:g.matchUps)||((h=Vt({tournamentRecord:t,contextFilters:I,contextProfile:_}))==null?void 0:h.matchUps)||[]),a&&(u=u.filter($=>$.matchUpType===a));const S=u.filter(({winningSide:$,score:U,sides:A,matchUpStatus:C})=>![Xt,Be,Ge,pa,gr].includes(C)&&At({score:U})&&(A==null?void 0:A.length)===2&&$),y=zge({matchUps:S,excludeMargin:n,exclusionRule:o,valueAccessor:i,ascending:e,scaleName:l}),O=!s||a===ut?c:c*2,b=c&&S.map(({competitiveness:$,matchUpType:U,score:A,sides:C})=>{const M=z2({valueAccessor:i,matchUpType:U,scaleName:l,score:A,sides:C}),D=Math.abs(M[0].value-M[1].value);return{competitiveness:$,score:A,valuesGap:D}}).filter(({valuesGap:$})=>$<=O),E=(b==null?void 0:b.length)&&Kge({zoneData:b}),T=E&&[].concat(Object.values(E)).flat().length,N=T&&Object.assign({},...Object.keys(E).map($=>({[$]:Math.round(1e4*E[$].length/T)/100}))),w=S.length-((b==null?void 0:b.length)||0);return Hge(qge({},B),{relevantMatchUps:S,zoneDistribution:N,zoneData:b,accuracy:y,nonZone:w})}function Kge({zoneData:t}){const e={[gv]:[],[Za]:[],[Xa]:[]};for(const r of t){const{competitiveness:n,score:o,valuesGap:i}=r;e[n]&&e[n].push({score:o,valuesGap:i})}return e}function z2({exclusionRule:t,valueAccessor:e,matchUpType:r,scaleName:n,sides:o}){const i=t==null?void 0:t.range.sort(),s=a=>{const c=a==null?void 0:a[t==null?void 0:t.valueAccessor];return{exclude:t&&c>=i[0]&&c<=i[1],exclusionValue:c}};return o.sort((a,c)=>a.sideNumber-c.sideNumber).map(({participant:a})=>{const c=[],l=a==null?void 0:a.individualParticipants;if(l!=null&&l.length){let u=[],d=0;for(const p of l){const{scaleValue:v,value:f}=ZN({valueAccessor:e,participant:p,matchUpType:r,scaleName:n}),{exclude:m,exclusionValue:g}=s(v);m&&c.push(g),u.push(v),f&&!isNaN(d)?d+=f:d=void 0}return{participantName:a.participantName,exclusionValues:c,scaleValues:u,value:d}}else if(a){const{scaleValue:u,value:d}=ZN({valueAccessor:e,matchUpType:r,participant:a,scaleName:n}),{exclude:p,exclusionValue:v}=s(u);return p&&c.push(v),{participantName:a.participantName,exclusionValues:c,scaleValue:u,value:d}}else return{}})}function ZN({participant:t,valueAccessor:e,matchUpType:r,scaleName:n}){var o,i,s,a,c;const l=(i=(o=t==null?void 0:t.rankings)==null?void 0:o[r])==null?void 0:i.find(v=>v.scaleName===n),d=(c=((a=(s=t==null?void 0:t.ratings)==null?void 0:s[r])==null?void 0:a.find(v=>v.scaleName===n))||l)==null?void 0:c.scaleValue,p=e?d==null?void 0:d[e]:d;return{scaleValue:d,value:p}}function zge({excludeMargin:t,exclusionRule:e,valueAccessor:r,ascending:n,scaleName:o,matchUps:i}){const s={affirmative:[],negative:[],excluded:[]};for(const l of i){const{matchUpType:u,sides:d,score:p,winningSide:v}=l;if(!v)continue;if(e&&(!e.valueAccessor||!e.range))return{info:"exclusionRule requires valueAccessor and range",error:Se};const f=v-1,m=z2({exclusionRule:e,valueAccessor:r,matchUpType:u,scaleName:o,score:p,sides:d});if(e){const S=m.map(({exclusionValues:y})=>y).flat();if(S.length){s.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,exclusionValues:S,winningSide:v,sideValues:m});continue}}if(m.filter(S=>![void 0,"",null].includes(S.value)).length<2){s.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,missingValues:!0,winningSide:v,sideValues:m});continue}const g=m[f].value-m[1-f].value,h=parseFloat(t),_=h&&Math.abs(g)<h;if(_){s.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,excludeMargin:t,winningSide:v,excludeGap:_,sideValues:m,valuesGap:g});continue}const I=n?g*-1:g,P=v===1?p==null?void 0:p.scoreStringSide1:p==null?void 0:p.scoreStringSide2;I>0?s.affirmative.push({winningScoreString:P,winningSide:v,sideValues:m,valuesGap:g,score:p}):s.negative.push({winningScoreString:P,winningSide:v,sideValues:m,valuesGap:g,score:p})}const a=s.affirmative.length+s.negative.length,c=a&&s.affirmative.length/a*100;return s.percent=c?Math.round(100*c)/100:0,s}function Qge({tournamentRecord:t,drawDefinition:e,structureId:r,matchUpId:n,drawId:o,event:i}){var s;if(!t)return{error:ee};if(!o&&!i&&!r&&!n)return k({result:{error:Se},stack:"getMatchUpFormat"});const a=ol({tournamentRecord:t,drawDefinition:e,matchUpId:n,drawId:o,event:i});if(n&&(a!=null&&a.error))return a;!e&&(a!=null&&a.drawDefinition)&&(e=a==null?void 0:a.drawDefinition);let c=a==null?void 0:a.structure;if(!c&&r&&!n){if(!e)return{error:Mr};const v=Te({drawDefinition:e,structureId:r});if(v.error)return v;c=v.structure}const l=c==null?void 0:c.matchUpFormat,u=e==null?void 0:e.matchUpFormat,d=i==null?void 0:i.matchUpFormat,p=((s=a==null?void 0:a.matchUp)==null?void 0:s.matchUpFormat)||l||u||d;return{structureDefaultMatchUpFormat:l,eventDefaultMatchUpFormat:d,drawDefaultMatchUpFormat:u,matchUpFormat:p}}var Jge=Object.defineProperty,XN=Object.getOwnPropertySymbols,Zge=Object.prototype.hasOwnProperty,Xge=Object.prototype.propertyIsEnumerable,e$=(t,e,r)=>e in t?Jge(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ehe=(t,e)=>{for(var r in e||(e={}))Zge.call(e,r)&&e$(t,r,e[r]);if(XN)for(var r of XN(e))Xge.call(e,r)&&e$(t,r,e[r]);return t};function the({competitiveProfile:t,tournamentRecord:e,matchUps:r}){if(!Array.isArray(r))return{error:ko};const n=!t&&us({policyType:No,tournamentRecord:e}).policy,o=t||(n==null?void 0:n.competitiveProfile)||hv[No].competitiveProfile,i=r.filter(({winningSide:p})=>p),s=i.map(nU),a=(p,v)=>{const f=rU(v,o);return p[f]+=1,p},c=oU(s).reduce((p,v)=>a(p,v),{[gv]:0,[Za]:0,[Xa]:0,[eU]:0}),l=Object.keys(c).reduce((p,v)=>(c[v]||0)+p,0),u=Object.keys(c).map(p=>({[p]:(c[p]/l).toFixed(4)*100})),d=i.filter(({matchUpStatus:p})=>p===mh);return u.push({[mh]:(d/l).toFixed(4)*100}),ehe({competitiveBands:Object.assign({},...u)},B)}function rhe({tournamentRecord:t,outcomes:e}){var r;if(!t)return{error:ee};if(!(e!=null&&e.length))return{error:Se,info:"Missing outcomes"};const n=e.reduce((a,c)=>{const{drawId:l,eventId:u}=c;return u&&l&&(a[u]?a[u].includes(l)||a[u].push(l):a[u]=[l]),a},{}),o=Object.keys(n);return{publishedEventIds:((r=t.events)==null?void 0:r.filter(a=>o.includes(a.eventId))).filter(a=>{const{timeItem:c}=yo({itemType:`${$r}.${Ar}`,event:a}),l=c==null?void 0:c.itemValue,{eventId:u}=a;return n[u].filter(p=>{var v,f;return(f=(v=l==null?void 0:l[Nn])==null?void 0:v.drawIds)==null?void 0:f.includes(p)}).length}).map(a=>a.eventId),eventIdPublishedDrawIdsMap:n}}function nhe({tournamentRecord:t,participantId:e}){if(!t)return{error:ee};if(!e)return{error:It};const{participant:r}=qo({tournamentRecord:t,participantId:e});if(!r)return{error:Tt};const{timeItem:n}=pn({itemType:$c,element:r});return n&&n.itemValue===nc&&nc}function ohe({tournamentRecord:t,event:e}){var r,n;if(!t)return{error:ee};if(!e)return{error:Re};const o=e.entries||[],i=t.participants||[],s=((r=e.category)==null?void 0:r.categoryName)||((n=e.category)==null?void 0:n.ageCategoryCode),{eventType:a}=e,c=o.map(f=>f.participantId),l=i.filter(f=>c.includes(f.participantId));let u,d,p;return{entryScaleAttributes:l.map(f=>{var m,g,h,_,I,P;const{participantId:S,participantName:y,name:O}=f;let b={scaleType:MU,eventType:a,scaleName:s};const E=(g=(m=kn({participant:f,scaleAttributes:b}))==null?void 0:m.scaleItem)==null?void 0:g.scaleValue;b={scaleType:lx,eventType:a,scaleName:s};const T=(_=(h=kn({participant:f,scaleAttributes:b}))==null?void 0:h.scaleItem)==null?void 0:_.scaleValue;b={scaleType:cx,eventType:a,scaleName:s};const N=(P=(I=kn({participant:f,scaleAttributes:b}))==null?void 0:I.scaleItem)==null?void 0:P.scaleValue;return u=!!(u||E),d=!!(d||T),p=!!(p||N),{participantId:S,participantName:y||O,seed:E,ranking:T,rating:N}}),hasSeededParticipants:u,hasRankedParticipants:d,hasRatedParticipants:p}}function ihe(t){return lr(t)}var she=Object.defineProperty,t$=Object.getOwnPropertySymbols,ahe=Object.prototype.hasOwnProperty,che=Object.prototype.propertyIsEnumerable,r$=(t,e,r)=>e in t?she(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,lhe=(t,e)=>{for(var r in e||(e={}))ahe.call(e,r)&&r$(t,r,e[r]);if(t$)for(var r of t$(e))che.call(e,r)&&r$(t,r,e[r]);return t};function uhe(t){const{tournamentRecord:e}=t;if(!e)return{error:ee};const{tournamentParticipants:r}=Kt({tournamentRecord:e,inContext:!0});return t2(lhe({tournamentParticipants:r},t))}function dhe({tournamentRecord:t,drawDefinition:e}){return t?{drawDefinition:de(e)}:{error:ee}}const phe={allTournamentMatchUps:Vt,tournamentMatchUps:Qv,allEventMatchUps:Si,getRoundMatchUps:ihe,allDrawMatchUps:Er,eventMatchUps:oC,drawMatchUps:b4,credits:Vd,getTournamentStructures:bH,getEventStructures:$C,getEvents:VL,getEvent:FL,findDrawDefinitionExtension:Zu,findParticipantExtension:yL,findTournamentExtension:hr,findEventExtension:Po,findExtension:_r,getTieFormat:c2,getMatchUpFormat:Qge,getDrawDefinition:dhe,getEventProperties:ohe,getPositionAssignments:Bf,isValidMatchUpFormat:Br,getMaxEntryPosition:Lge,getMatchUpCompetitiveness:iU,findVenue:Yo,getCourts:GB,getVenuesAndCourts:wv,findCourt:xB,getEventTimeItem:yo,getTournamentTimeItem:gd,getParticipantTimeItem:n4,getDrawDefinitionTimeItem:r4,bulkUpdatePublishedEventIds:rhe,matchUpActions:GM,positionActions:uhe,findMatchUp:zz,participantScheduledMatchUps:QC,getPredictiveAccuracy:Yge,getMatchUpsStats:the,participantScaleItem:kn,getParticipantScaleItem:Fu,getParticipantSignInStatus:nhe,getPolicyDefinitions:ls,getMatchUpScheduleDetails:$v},fhe={addVenue:Tc,deleteVenue:Lm,deleteVenues:CQ,modifyVenue:eD,enableCourts:qM,enableVenues:HM,disableCourts:kM,disableVenues:WM,addCourt:Gm,addCourts:km,deleteCourt:zM,modifyCourt:xm,modifyCourtAvailability:ZM,findVenue:jB};var vhe=Object.defineProperty,mhe=Object.defineProperties,ghe=Object.getOwnPropertyDescriptors,n$=Object.getOwnPropertySymbols,hhe=Object.prototype.hasOwnProperty,_he=Object.prototype.propertyIsEnumerable,o$=(t,e,r)=>e in t?vhe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Xp=(t,e)=>{for(var r in e||(e={}))hhe.call(e,r)&&o$(t,r,e[r]);if(n$)for(var r of n$(e))_he.call(e,r)&&o$(t,r,e[r]);return t},ef=(t,e)=>mhe(t,ghe(e));const nPe=function(){const t={getState:({convertExtensions:s,removeExtensions:a}={})=>Eae({convertExtensions:s,removeExtensions:a,tournamentId:vn()}),newTournamentRecord:(s={})=>{const a=lg(s);return a.error?a:(DA(a),Qa(a.tournamentId),Object.assign({tournamentId:a.tournamentId},B))},setTournamentId:s=>Qa(s)};t.version=()=>oo(),t.reset=()=>{const s=iv(vn());return e(s)},t.setState=(s,a,c)=>{Yi(a,c);const l=Kp(s,a);return e(l)},t.devContext=s=>(Ls(s),t),t.getDevContext=s=>Ct(s),t.executionQueue=(s,a)=>i(s,a);function e(s){return s!=null&&s.error?(t.error=s.error,t.success=!1):(t.error=void 0,t.success=!0),t}return o([phe,Vge,fhe,tde,Ide,Xue,Ble,Wue,mle]),t;function r(s,a,c,l){var u,d;delete t.success,delete t.error;const p=Date.now(),v=wae(s,c),f=a(ef(Xp({},v),{tournamentRecord:s})),m=Date.now()-p,g=Ct(),h={method:l},_=typeof g.result=="object"&&g.result.error;return![void 0,!1].includes(g.perf)&&(isNaN(g.perf)||m>g.perf)&&(h.elapsed=m),(_||g.params&&!Array.isArray(g.params)||Array.isArray(g.params)&&((u=g.params)!=null&&u.includes(l)))&&(h.params=c),(_||!_&&g.result&&!Array.isArray(g.result)||Array.isArray(g.result)&&((d=g.result)!=null&&d.includes(l)))&&(h.result=f),Object.keys(h).length>1&&console.log("te:",h),g.makeDeepCopy&&(f.deepCopyIterations=MF()),f}function n(s,a,c){const l=vn(),u=(a==null?void 0:a.sandBoxRecord)||(a==null?void 0:a.sandboxRecord)||(a==null?void 0:a.sandboxTournament)||za(l),d=(a==null?void 0:a.rollbackOnError)&&de(u,!1,!0),p=r(u,s,a,c);p!=null&&p.error&&d&&Kp(d);const v=(p==null?void 0:p.success)&&(a==null?void 0:a.delayNotify)!==!0&&(a==null?void 0:a.doNotNotify)!==!0,f=Ka(),m=Date.now();return f&&(cu({tournamentRecord:u,value:{version:oo(),timeStamp:m}}),p.modificationsApplied=!0),v&&vi({directives:[{method:s,params:a}],mutationStatus:f,tournamentId:l,timeStamp:m}),(v||!(p!=null&&p.success)||a!=null&&a.doNotNotify)&&ii(),p}function o(s){s.forEach(a=>{Object.keys(a).forEach(c=>{t[c]=l=>{if(Ct())return n(a[c],l,c);try{return n(a[c],l,c)}catch(u){const d=vn(),p=u.toString();console.log("ERROR",{params:JSON.stringify(l),tournamentId:d,methodName:c,error:p})}}})})}function i(s,a){var c;if(!Array.isArray(s))return{error:Z};const l=vn(),u=za(l),d=a&&de(u,!1,!0),p=[];for(const g of s){if(typeof g!="object")return{error:Z};const{method:h,params:_}=g;if(!t[h]){const P={error:UA,methodName:h},S=Ct();return(S.result&&!Array.isArray(S.result)||Array.isArray(S.result)&&((c=S.result)!=null&&c.includes(h)))&&console.log("te:",P),P}const I=r(u,t[h],_,h);if(I!=null&&I.error)return d&&Kp(d),ef(Xp({},I),{rolledBack:!!d});p.push(ef(Xp({},I),{methodName:h}))}const v=Ka(),f=Date.now();return v&&cu({tournamentRecord:u,value:{version:oo(),timeStamp:f}}),vi({directives:s,mutationStatus:v,timeStamp:f,tournamentId:l}),ii(),{success:p.every(g=>g.success),results:p}}}();var Ihe=Object.defineProperty,i$=Object.getOwnPropertySymbols,Phe=Object.prototype.hasOwnProperty,yhe=Object.prototype.propertyIsEnumerable,s$=(t,e,r)=>e in t?Ihe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ohe=(t,e)=>{for(var r in e||(e={}))Phe.call(e,r)&&s$(t,r,e[r]);if(i$)for(var r of i$(e))yhe.call(e,r)&&s$(t,r,e[r]);return t};function a$(t,e){var r;if(typeof t!="object")return{error:Xn};const n=((r=t.unifiedTournamentId)==null?void 0:r.tournamentId)||t.tournamentId;if(!n)return{error:so};const o=e!==!1?de(t):t;return yc({[n]:o}),Qa(n),o}function She({convertExtensions:t,removeExtensions:e,tournamentId:r}={}){if(typeof r!="string")return{};const n=za(r);return{tournamentRecord:de(n,t,!1,e)}}function bhe(t,e){return e!=null&&e.someParam&&(e=Ohe({},e)),e}function Q2(t,e){return t&&e&&Array.isArray(e)&&e[t-1]||typeof e=="object"&&e[t]}function The({participation:t={},awardProfiles:e,startDate:r,eventType:n,drawSize:o,drawType:i,category:s,endDate:a,level:c}){const{participationOrder:l,flightNumber:u,rankingStage:d}=t,p=f=>!r&&!a||!f.dateRanges?!0:f.dateRanges.some(m=>{const g=!r||!m.startDate||new Date(r)>new Date(m.startDate),h=!a||!m.endDate||new Date(a)<=new Date(m.endDate);return g&&h});return{awardProfile:e.find(f=>{var m,g,h,_,I,P,S,y,O,b;return p(f)&&(!f.maxFlightNumber||u<=f.maxFlightNumber)&&(!((m=f.drawTypes)!=null&&m.length)||((g=f.drawTypes)==null?void 0:g.includes(i)))&&(!((h=f.drawSizes)!=null&&h.length)||f.drawSizes.includes(o))&&(!((_=f.stages)!=null&&_.length)||f.stages.includes(d))&&(!((I=f.levels)!=null&&I.length)||f.levels.includes(c))&&(!f.maxDrawSize||o<=f.maxDrawSize)&&(!f.drawSize||f.drawSize===o)&&(!f.maxLevel||c<=f.maxLevel)&&(!u||!((S=(P=f.flights)==null?void 0:P.flightNumbers)!=null&&S.length)||f.flights.flightNumbers.includes(u))&&(!f.participationOrder||f.participationOrder===l)&&(!((y=f.category)!=null&&y.ageCategoryCodes)||f.category.ageCategoryCodes.includes(s==null?void 0:s.ageCategoryCode))&&(!((O=f.eventTypes)!=null&&O.length)||((b=f.eventTypes)==null?void 0:b.includes(n)))})}}function c$({participantWon:t,flightNumber:e,valueObj:r,drawSize:n,flights:o,level:i}){var s,a;const c=(g,h)=>{if(g){if(Array.isArray(h)){const _=h.find(I=>I.flight===g||I.f===g);return _.value||_.v}if(typeof h=="object"){const _=h.flights||h.f;if(Array.isArray(_))return _[g-1]}}},l=(g,h)=>{const _=(g==null?void 0:g.value)||(g==null?void 0:g.v)||(lt(g)?g:0),I=Q2(i,g==null?void 0:g.level);return{value:c(h,I)||lt(I)&&I||_}};let u=0,d,p,v,f;const m=t&&"won"||t===!1&&"lost"||void 0;if(Array.isArray(r)){let g=r.find(I=>{var P;return I.drawSize===n||((P=I.drawSizes)==null?void 0:P.includes(n))}),h=r.find(I=>I.drawSize&&I.threshold&&n>I.drawSize),_=r.find(I=>{var P;return!I.drawSize&&!((P=I.drawSizes)!=null&&P.length)});m!==void 0&&(g=g==null?void 0:g[m],h=h==null?void 0:h[m],_=_==null?void 0:_[m]),p=l(g,e).value,v=l(h,e).value,f=l(_,e).value,u=p||v||f,d=p&&g.requireWin||v&&h.requireWin||(_==null?void 0:_.requireWin)}else if(typeof r=="object"){let g=(s=r==null?void 0:r.drawSizes)==null?void 0:s[n],h=r;m!==void 0&&(g=g==null?void 0:g[m],h=h==null?void 0:h[m]),p=l(g,e).value,f=l(h,e).value,u=p||f,d=p?g.requireWin:h==null?void 0:h.requireWin}else lt(r)&&m===void 0&&(u=r);return(a=o==null?void 0:o.pct)!=null&&a[e]&&(u=Math.round(u*o.pct[e])),{awardPoints:u,requireWin:d}}var Ehe=Object.defineProperty,l$=Object.getOwnPropertySymbols,whe=Object.prototype.hasOwnProperty,Nhe=Object.prototype.propertyIsEnumerable,u$=(t,e,r)=>e in t?Ehe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,$he=(t,e)=>{for(var r in e||(e={}))whe.call(e,r)&&u$(t,r,e[r]);if(l$)for(var r of l$(e))Nhe.call(e,r)&&u$(t,r,e[r]);return t};function Ahe({participantFilters:t,policyDefinitions:e,tournamentRecord:r,saveRankings:n,level:o}){var i;if(!r)return{error:ee};const{policyDefinitions:s}=ls({policyTypes:[ap],tournamentRecord:r}),a=(e==null?void 0:e[ap])||(s==null?void 0:s[ap]);if(!a)return{error:ku};const c=a.awardProfiles;let l=a.requireWinFirstRound,u=a.requireWinForPoints;const{participants:d,derivedEventInfo:p,derivedDrawInfo:v,mappedMatchUps:f}=Os({withRankingProfile:!0,participantFilters:t,tournamentRecord:r}),m=d.filter(I=>{var P;return(P=I.draws)==null?void 0:P.length}),g={},h={},_={};for(const I of m){const{participantType:P,participantId:S,person:y,draws:O}=I;for(const b of O){const{drawId:E,structureParticipation:T,eventId:N}=b,w=p[N],$=v[E],U=$==null?void 0:$.drawType,{category:A,eventType:C}=w||{},M=b.startDate||w.startDate||r.startDate,D=b.endDate||w.endDate||r.endDate;if(C===gn&&S!==hn)continue;let V;if(c){let R=u,W=0,x=0,K=0,j;for(const L of T){const{finishingPositionRange:F,participationOrder:q,participantWon:G,flightNumber:H,rankingStage:Q,winCount:z}=L;W+=z||0;const Y=$==null?void 0:$.drawSize,{awardProfile:J}=The({awardProfiles:c,participation:L,eventType:C,startDate:M,category:A,drawSize:Y,drawType:U,endDate:D,level:o});if(J){if(!Y)continue;const te=Array.isArray(F)&&Math.max(...F),ne=Ve(F||[]).join("-"),oe=te&&Q!==Ie&&(F==null?void 0:F.includes(Y));J.requireWinForPoints!==void 0&&(R=J.requireWinForPoints),J.requireWinFirstRound!==void 0&&(l=J.requireWinFirstRound);const{finishingPositionPoints:se={},finishingPositionRanges:ve,finishingRound:X,pointsPerWin:ie,flights:fe}=J,Ee=Array.isArray(J.perWinPoints)?(i=J.perWinPoints)==null?void 0:i.find(ce=>{var Pe;return(Pe=ce.participationOrders)==null?void 0:Pe.includes(q)}):J.perWinPoints,re=se.participationOrders;let ae=0,me;if((!re||re.includes(q))&&ve){const ce=ve[te];ce&&({awardPoints:ae,requireWin:me}=c$({flightNumber:H,valueObj:ce,drawSize:Y,flights:fe,level:o}))}if(!ae&&X&&q===1){const ce=X[te];ce&&({awardPoints:ae,requireWin:me}=c$({participantWon:G,flightNumber:H,valueObj:ce,drawSize:Y,flights:fe,level:o}))}if(oe&&l!==void 0&&(R=l),me!==void 0&&(R=me),ae>x&&(!R||z)&&(x=ae,j=te),!ae&&ie&&z&&(K+=z*ie,j=ne),!ae&&z&&Ee){const ce=Q2(o,Ee==null?void 0:Ee.level);ce?K+=z*ce:Ee.value&&(K+=z*Ee.value)}}if(V=x+K,P===hn){const te=(I.matchUps||[]).filter(({structureId:ne})=>ne===L.structureId);for(const{matchUpId:ne}of te){const oe=f[ne],se=oe.sides.find(ve=>ve.participantId===S).sideNumber;if(oe.winningSice===se)for(const ve of oe.tieMatchUps)ve.winningSide}}}if(K||x){const L={winCount:W,positionPoints:x,rangeAccessor:j,perWinPoints:K,eventType:C,drawId:E,points:V},F=y==null?void 0:y.personId;F?(g[F]||(g[F]=[]),g[F].push(L)):P===we?(_[S]||(_[S]=[]),_[S].push(L)):P===hn&&(h[S]||(h[S]=[]),h[S].push(L))}}}}return n&&et({element:r,extension:{name:ZA,value:{personPoints:g,teamPoints:h,pairPoints:_}}}),$he({participantsWithOutcomes:m,personPoints:g,pairPoints:_,teamPoints:h},B)}const Uhe={getTournamentPoints:Ahe},Che=t=>250/Math.pow(t+5,.4),Mhe=()=>1;function Dhe(t=3,e=2){let r=t/e;return isNaN(r)?Us.kDefault():r}const Us={nSpread:400,diffThreshold:.125,kCalc:Che,kMultiplier:Dhe,kDefault:Mhe};function J2({ratings:t=Bn,winnerCountables:e=1,loserCountables:r=0,ratingType:n=Fi,maxCountables:o,winnerRating:i,loserRating:s,ratingRange:a,countables:c}={}){const l=t==null?void 0:t[n];if(!l)return{error:Se};a=l.range||a,i=i||l.defaultInitialization,s=s||l.defaultInitialization;const u=a[0]>a[1],d=l.decimalsCount||0,p=u?a.slice().reverse():a,v=(C,M)=>parseFloat(M)>=Math.min(...C)&&parseFloat(M)<=Math.max(...C);(!v(a,i)||!v(a,s))&&(v(a,i)||(i=l.defaultInitialization),v(a,s)||(s=l.defaultInitialization));const f=({value:C,sourceRange:M,targetRange:D})=>(C-M[0])*(D[1]-D[0])/(M[1]-M[0])+D[0],m=f({targetRange:Bn[Fi].range,sourceRange:p,value:u?a[0]-i:i}),g=f({targetRange:Bn[Fi].range,sourceRange:p,value:u?a[0]-s:s}),h=(C,M)=>1/(1+Math.pow(10,(M-C)/Us.nSpread));let _=h(m,g),I=h(g,m),P=Us.kCalc(e),S=Us.kCalc(r),y=Us.kMultiplier(o,c),O=m+y*P*(1-_),b=g+y*S*(0-I),E=f({sourceRange:Bn[Fi].range,value:O,targetRange:p}),T=f({sourceRange:Bn[Fi].range,value:b,targetRange:p});const N=u?a[0]-E:E;let w=parseFloat(N).toFixed(d);const $=u?a[0]-T:T;let U=parseFloat($).toFixed(d);const A=Math.max(...a)?Math.abs(i-s)/Math.max(...a):0;return(E>T&&A>Us.diffThreshold||w<0||U<0)&&(w=i,U=s),{newWinnerRating:w,newLoserRating:U}}const jhe=t=>(t==null?void 0:t.reduce((e,r)=>(r.winningSide&&(e[r.winningSide-1]+=1),e),[0,0]))||[0,0];var Rhe=Object.defineProperty,Fhe=Object.defineProperties,Vhe=Object.getOwnPropertyDescriptors,d$=Object.getOwnPropertySymbols,Lhe=Object.prototype.hasOwnProperty,Bhe=Object.prototype.propertyIsEnumerable,p$=(t,e,r)=>e in t?Rhe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ma=(t,e)=>{for(var r in e||(e={}))Lhe.call(e,r)&&p$(t,r,e[r]);if(d$)for(var r of d$(e))Bhe.call(e,r)&&p$(t,r,e[r]);return t},Da=(t,e)=>Fhe(t,Vhe(e));function xhe({tournamentRecord:t,ratingType:e=Fi,considerGames:r,matchUpIds:n,asDynamic:o}){var i,s;if(!t)return{error:ee};if(!Array.isArray(n))return{error:ko};if(typeof e!="string")return{error:Z,ratingType:e};if(!Bn[e])return{error:Z};const a=Bn[e],{accessor:c}=a,l={},{matchUps:u}=Vt({matchUpFilters:{matchUpIds:n,matchUpStatuses:Rt},tournamentRecord:t,inContext:!0});for(const p of u.sort(_s)){const{endDate:v,matchUpFormat:f,matchUpType:m,score:g,sides:h,winningSide:_}=p,I={scaleType:xi,eventType:m,scaleName:e},P=`${e}.DYNAMIC`,S={scaleType:xi,eventType:m,scaleName:P},y=Object.assign({},...h.map(({sideNumber:C,participant:M})=>({[C]:[M==null?void 0:M.participantId,...(M==null?void 0:M.individualParticipantIds)||[]].filter(Boolean).flat()}))),O=o?P:e,b=Object.assign({},...Object.values(y).flat().map(C=>{const{scaleItem:M}=Fu({scaleAttributes:S,tournamentRecord:t,participantId:C}),{scaleItem:D}=Fu({tournamentRecord:t,scaleAttributes:I,participantId:C}),V=c?{[c]:void 0}:void 0;return{[C]:M||D||{scaleName:O,scaleType:xi,eventType:m,scaleDate:v,scaleValue:V}}})),E=Ir(f)||{},T=(E==null?void 0:E.bestOf)||1,N=(E==null?void 0:E.setsTo)||1,w=r?T&N:T,$=(g==null?void 0:g.sets)&&jhe(g.sets)||_===1&&[1,0]||[0,1],U=y[_],A=y[3-_];for(const C of U){const M=(i=b[C])==null?void 0:i.scaleValue,D=typeof M=="object"?M[c]:M;for(const V of A){const R=(s=b[V])==null?void 0:s.scaleValue,W=typeof R=="object"?R[c]:R,x=$[_],K=$[3-_],{newWinnerRating:j,newLoserRating:L}=J2({winnerCountables:x,loserCountables:K,maxCountables:w,winnerRating:D,loserRating:W,ratingType:e}),F=c?Da(Ma({},M),{[c]:j}):j,q=c?Da(Ma({},R),{[c]:L}):L;b[C].scaleValue=F,b[V].scaleValue=q;let G=vc({scaleItem:Da(Ma({},b[C]),{scaleName:O}),participantId:C,tournamentRecord:t});if(G.error||(G=vc({scaleItem:Da(Ma({},b[V]),{scaleName:O}),participantId:V,tournamentRecord:t}),G.error))return G}}Object.assign(l,b)}const d=u.map(({matchUpId:p})=>p);return Da(Ma({},B),{modifiedScaleValues:l,processedMatchUpIds:d})}const Ghe={calculateNewRatings:J2,processMatchUps:xhe};var khe=Object.defineProperty,Whe=Object.defineProperties,qhe=Object.getOwnPropertyDescriptors,f$=Object.getOwnPropertySymbols,Hhe=Object.prototype.hasOwnProperty,Yhe=Object.prototype.propertyIsEnumerable,v$=(t,e,r)=>e in t?khe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Khe=(t,e)=>{for(var r in e||(e={}))Hhe.call(e,r)&&v$(t,r,e[r]);if(f$)for(var r of f$(e))Yhe.call(e,r)&&v$(t,r,e[r]);return t},zhe=(t,e)=>Whe(t,qhe(e));(function(){const t={getState:({convertExtensions:i,removeExtensions:s}={})=>She({convertExtensions:i,removeExtensions:s,tournamentId:vn()}),setTournamentId:i=>Qa(i)};t.version=()=>oo(),t.reset=()=>{const i=iv(vn());return e(i)},t.setState=(i,s,a)=>{Yi(s,a);const c=a$(i,s);return e(c)};function e(i){return i!=null&&i.error?(t.error=i.error,t.success=!1):(t.error=void 0,t.success=!0),t}return o([Uhe,Ghe]),t;function r(i,s,a){delete t.success,delete t.error;const c=bhe(i,a);return s(zhe(Khe({},c),{tournamentRecord:i}))}function n(i,s){const a=(s==null?void 0:s.sandBoxRecord)||(s==null?void 0:s.sandboxRecord)||(s==null?void 0:s.sandboxTournament)||za(vn()),c=(s==null?void 0:s.rollbackOnError)&&de(a,!1,!0),l=r(a,i,s);l!=null&&l.error&&c&&a$(c);const u=(l==null?void 0:l.success)&&(s==null?void 0:s.delayNotify)!==!0&&(s==null?void 0:s.doNotNotify)!==!0;return u&&vi(),(u||!(l!=null&&l.success)||s!=null&&s.doNotNotify)&&ii(),l}function o(i){i.forEach(s=>{Object.keys(s).forEach(a=>{t[a]=c=>{if(Ct())return n(s[a],c);try{return n(s[a],c)}catch(l){const u=l.toString();console.log("ERROR",{error:u,method:a,params:JSON.stringify(c)})}}})})}})();var Qhe=["Abbey","Ahern","Ampleforth","Austen","Banks","Batty","Bauers","Beals","Beer","Bennett","Berry","Bonaparte","Brockovich","Bukowski","Cassidy","Catton","Calvino","Carson","Constant","Crane","Crowne","Cummings","Curie","Dallas","Diamond","Deckard","Earhart","Eisenstein","Eldritch","Elliot","Eyre","Faulkner","Frank","Godel","Goldstein","Greer","Holmgren","Humperdinck","Huxley","Illich","Jeffers","Jensen","Jevons","Johnson","Jovovich","Kingsnorth","Langer","Fernwright","Fuller","Le Guin","Lem","Lovelace","Midgely","Mond","Montoya","Murry","Nagle","Nearing","Ogden","Ophuls","Parks","Paz","Peet","Perfect","Pendejo","Pevensie","Postman","Ripley","Rodda","Rumfoord","Runciter","Rugen","Sale","Schumacher","Shaftoe","Shelley","Shepard","Smith","Stratton","Stewart","Swift","Tillich","Turing","Tyrell","Twain","Yeats","Veblen","Yates","Vonnegut","Waterhouse","Watson","Wirt","Wormwood"],Jhe=["Ada","Amelia","Amelie","America","Anne","Antoina","Aravis","Astrid","Beatrice","Brienne","Buttercup","Cimorene","Cordelia","Desdemona","Ellen","Elizabeth","Emily","Emmie","Erin","Eva","Evelyn","Hermia","Hypatia","Imogen","Jane","Jasmine","Juliana","Juliet","Heather","Helen","Katniss","Leeloo","Lenina","Lilith","Linda","Lizzie","Louise","Lucy","Marie","Mary","Martha","Matilda","Milla","Miranda","Meg","Melba","Nicole","Ola","Portia","Pris","Rachael","Rachel","Rebecca","River","Rosa","Rosalind","Scout","Sharn","Susanne","Titania","Uhura","Ursula","Valentina","Viola","Virginia","Xena","Zoe"],Zhe=["Alan","Aldous","August","Axel","Barda","Bill","Charles","Darwin","David","Derrick","Edward","Emmanuel","Ernst","Estlin","Fezzik","Filby","Frito","George","Glen","Helmholtz","Inigo","Italo","Ivan","James","Jared","Joe","John Michael","Jonathan","Korben","Kirkpatrick","Kurt","Lief","Malachi","Mark","Michael","Mustapha","Neil","Octavio","Palmer","Paul","Pierre","Robinson","Rick","Rincewind","Roy","Stafford","Stanislaw","Stanley","Syme","Thorstein","Tyrone","Vizzini","Walton","Walker","Warren","Wendell","Westley","William","Winston"],Xhe={lastNames:Qhe,firstFemale:Jhe,firstMale:Zhe};function tf({count:t=100,sex:e}={}){if(!t||e&&![at,vt].includes(e))return{personData:[],error:Z};const r=Math.ceil(t*1.3),{lastNames:n,firstFemale:o,firstMale:i}=Xhe,s=Ao.map(({iso:m})=>m).filter(Boolean),a=Math.ceil(r/n.length),c=Math.ceil(r/o.length),l=Math.ceil(r/i.length),u=le(0,a).flatMap(()=>{const m=de(n,!1,!0);return le(0,n.length).map(()=>rr(m))}),d=le(0,c).flatMap(()=>{const m=de(o,!1,!0);return le(0,o.length).map(()=>rr(m))}),p=le(0,l).flatMap(()=>{const m=de(i,!1,!0);return le(0,i.length).map(()=>rr(m))}),v={};for(let m=0;m<r;m++){const g=u.pop(),h=e||pr([at,vt]),_=h===at?p.pop():d.pop(),I=pr(s);v[`${_}${g}`]={nationalityCode:I,sex:h,firstName:_,lastName:g}}return{personData:Object.values(v).slice(0,t)}}function Z2({personExtensions:t,consideredDate:e,isMock:r=!0,gendersCount:n,personData:o,count:i=1,category:s,sex:a}={}){if(isNaN(i))return{error:Z};const c=(n==null?void 0:n[at])||a===at&&i||0,l=(n==null?void 0:n[vt])||a===vt&&i||0;i=Math.max(i,c+l);const u=i-(c+l),d=c&&tf({count:c,sex:at}).personData||[],p=l&&tf({count:l,sex:vt}).personData||[],v=[...d,...p,...u&&tf({count:u}).personData||[]];let f=v.filter(O=>!a||c&&l||O.sex===a),m=[];if(Array.isArray(o)){const O=o.filter(b=>typeof b.firstName!="string"||typeof b.lastName!="string"||![at,vt].includes(b.sex)||b.nationalityCode&&(typeof b.nationalityCode!="string"||b.nationalityCode.length>3||!Ao.find(({iso:E,ioc:T})=>[E,T].includes(b.nationalityCode)))?!1:(b.nationalityCode&&m.push(b.nationalityCode),!0));if(O.length)f=O;else return{error:Z}}const g=tr(f);if(g.length<i){console.log("LESS",g.length,i);const{maleFirstNames:O,maleLastNames:b,femaleFirstNames:E,femaleLastNames:T,nationalityCodes:N}=v.reduce((w,$)=>{const{firstName:U,lastName:A,nationalityCode:C}=$;return $.sex===at?(w.maleFirstNames.includes(U)||w.maleFirstNames.push(U),w.maleLastNames.includes(A)||w.maleLastNames.push(A)):(w.femaleFirstNames.includes(U)||w.femaleFirstNames.push(U),w.femaleLastNames.includes(A)||w.femaleLastNames.push(A)),w.nationalityCodes.includes(C)||w.nationalityCodes.push(C),w},{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});le(0,i-g.length).forEach(()=>{const w=a||pr([at,vt]),$=pr(N),U=pr(w===at?O:E),A=pr(w===at?b:T),C={firstName:U,lastName:A,sex:w,nationalityCode:$};g.push(C)})}const{ageMinDate:h,ageMaxDate:_}=cC({consideredDate:e,category:s}),I=parseInt((h==null?void 0:h.slice(0,4))||0)||parseInt((_==null?void 0:_.slice(0,4))||0)-3,P=parseInt((_==null?void 0:_.slice(0,4))||0)||parseInt((h==null?void 0:h.slice(0,4))||0)+3,S=(h||_)&&[I,P],y=g.slice(0,i).map((O,b)=>{const E=S&&rr(le(...S)),T=rr(le(0,365)),N=E&&JF(E,T);return Object.assign(_e({extensions:t||[{name:"regionCode",value:b+1}],birthDate:N,isMock:r}),O)});return{persons:y.length&&y||g[0],nationalityCodes:m}}function X2(t){const{cities:e,states:r,postalCodes:n,nationalityCode:o,participantIndex:i}=t;return{postalCode:n==null?void 0:n[i],state:r==null?void 0:r[i],city:e==null?void 0:e[i],countryCode:o}}var e_e=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Smash Mullet","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Sparkle Soul Tribe","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Upside Downers","Vertically Challenged","Visual Spectacle"];function Gf({nameRoot:t="TEAM",count:e=1}={}){const n=tr(e_e).slice(0,e);return n.length<e&&le(0,e-n.length).forEach(o=>n.push(`${t} ${o+1}`)),{names:n}}var t_e=[{AA:"Annexia"},{BA:"Bacteria"},{BO:"Borduria"},{BM:"Bensalem"},{BS:"Basenji"},{BI:"Balnibarbi"},{BV:"Bartovia"},{BZ:"Berzerkistan"},{CA:"Caldonia"},{CC:"Concordia"},{CH:"Chula"},{DA:"Deltora"},{DW:"Discworld"},{EA:"Eastasia"},{EP:"Ecotopia"},{ER:"Erewhon"},{FA:"Freedonia"},{FN:"Florin"},{FG:"Fogg"},{FK:"Fourecks"},{GA:"Genovia"},{GL:"Gilead"},{GD:"Gilead"},{GL:"Gondal"},{GO:"Gondor"},{GR:"Gruzinia"},{GT:"Goritania"},{GU:"Guilder"},{HA:"Heldscalla"},{HO:"Hidalgo"},{IL:"Illyria"},{KA:"Kinakuta"},{KG:"Kangan"},{KN:"Kreplachistan"},{KS:"Kallipolis"},{LH:"Lugash"},{LI:"Listenbourg"},{LT:"Lilliput"},{LU:"Luggnagg"},{LV:"Lichtenslava"},{MR:"Moher"},{NA:"Narnia"},{NV:"Novaria"},{OA:"Oceania"},{OS:"Orsinia"},{OV:"Octavia"},{PA:"Palombia"},{PG:"Penguina"},{QA:"Qasha"},{PM:"Panem"},{SA:"Solymbria"},{SD:"Syldavia"},{SG:"San Glucose"},{SL:"San Lorenzo"},{SR:"Sontar"},{SY:"Sylvania"},{TF:"Tralfamadore"},{TH:"Themyscira"},{UA:"Utopia"},{VA:"Vespugia"},{WA:"Wakanda"},{WX:"Wessex"},{ZA:"Zamunda"},{ZK:"Zubrowka"}],r_e=["Amber","Ansul","Atlantis","Braavos","Busytown","Castle Rock","Centralia","Coober Pedy","Chefchaouen","Chronopolis","Damanhur","Diaspar","Dictionopolis","Diomira","El Dorado","Elista","Ephesus","Gotham","Hadleyburg","Hallstatt","Hierusalem","Ilium","Inverness","Kowloon","Laputa","Longyearbyen","Lys","Matmata","Maycomb","Metropolis","Miyake-jima","Monowi","Nagoro","Navarre","New New York","Nimbin","Pemberley","Pseudopolis","Rivendell","Roswell","Shangri-La","Springfield","Supilinn","Thneedville","Trantor","Wobegon","Yonwood","Xanadu","Xylar","Zion"];function ej({count:t=1,participantsCount:e=32}={}){const r=tr(r_e),n=r.slice(0,t);return{cities:le(0,e).map(i=>i<Math.min(t,r.length)?n[i]:pr(n))}}function tj({count:t=1,participantsCount:e=32}={}){const r=tr(t_e),n=r.slice(0,t).map(i=>Object.keys(i)).flat();return{states:le(0,e).map(i=>i<Math.min(t,r.length)?n[i]:pr(n))}}function rj({count:t=1,participantsCount:e=32}={}){const r=le(0,t).map(()=>le(0,5).map(()=>Tr(0,9)).join(""));return{postalCodes:le(0,e).map(o=>o<t?r[o]:pr(r))}}var n_e=Object.defineProperty,o_e=Object.defineProperties,i_e=Object.getOwnPropertyDescriptors,m$=Object.getOwnPropertySymbols,s_e=Object.prototype.hasOwnProperty,a_e=Object.prototype.propertyIsEnumerable,g$=(t,e,r)=>e in t?n_e(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,h$=(t,e)=>{for(var r in e||(e={}))s_e.call(e,r)&&g$(t,r,e[r]);if(m$)for(var r of m$(e))a_e.call(e,r)&&g$(t,r,e[r]);return t},c_e=(t,e)=>o_e(t,i_e(e));function l_e({keepExtensions:t=[],anonymizeParticipantNames:e=!0,tournamentRecord:r,tournamentName:n,personIds:o=[],tournamentId:i}){var s,a,c,l,u;if(!r)return{error:ee};const d=Array.isArray(t)?ph.concat(...t):ph,p=j=>{var L;return Array.isArray(t)?(L=j==null?void 0:j.extensions)==null?void 0:L.filter(F=>d.includes(F.name)):j==null?void 0:j.extensions},v={};r.extensions=p(r);const f=i||ke();v[r.tournamentId]=f,r.tournamentId=f,r.createdAt=new Date().toISOString(),r.tournamentName=n||`Anonymized: ${yn(new Date)}`,delete r.parentOrganisation;for(const j of r.participants||[]){const L=ke();v[j.participantId]=L,j.participantId=L}for(const j of r.participants||[])Array.isArray(j.individualParticipantIds)&&(j.individualParticipantIds=j.individualParticipantIds.map(L=>v[L]));let m=0;for(const j of r.venues||[]){j.extensions=p(j),j.venueName=`Venue #${m}`,j.venueAbbreviation=`V${m}`;const L=ke();v[j.venueId]=L,m+=1}let g=1;for(const j of r.events||[]){j.extensions=p(j);const L=ke();v[j.eventId]=L,j.eventId=L;const F=((s=j.category)==null?void 0:s.categoryName)||((a=j.category)==null?void 0:a.ageCategoryCode)||((c=j.category)==null?void 0:c.ratingType)||j.gender;if(j.eventName=`Event ${g} ${F}`,Array.isArray(j.entries))for(const G of j.entries)G.participantId=v[G.participantId];for(const G of j.drawDefinitions||[]){G.extensions=p(G);const H=ke();if(v[G.drawId]=H,G.drawId=H,Array.isArray(G.entries))for(const z of G.entries)z.participantId=v[z.participantId];const Q=z=>{z.extensions=p(z);const Y=ke();v[z.structureId]=Y,z.structureId=Y;for(const J of z.positionAssignments||[])J.participantId&&(J.participantId=v[J.participantId]);for(const J of z.seedAssignments||[])J.participantId&&(J.participantId=v[J.participantId]);for(const J of z.matchUps||[])for(const te of J.sides||[])te.lineUp&&(te.lineUp=te.lineUp.map(({participantId:ne,collectionAssignments:oe})=>({participantId:v[ne],collectionAssignments:oe})))};for(const z of G.structures||[])if(Q(z),Array.isArray(z.structures))for(const Y of z.structures)Q(Y);for(const z of G.links||[])z.source.structureId=v[z.source.structureId],z.target.structureId=v[z.target.structureId]}const{extension:q}=Po({name:nn,event:j});Array.isArray((l=q==null?void 0:q.value)==null?void 0:l.flights)&&((u=q.value.flights)==null||u.forEach(G=>{if(G.drawId=v[G.drawId],Array.isArray(G.drawEntries))for(const H of G.drawEntries)H.participantId=v[H.participantId]})),g+=1}const h=r.startDate||yn(new Date),_=(r.participants||[]).filter(({participantType:j})=>j===Ce),I=_.reduce((j,L)=>{var F;const q=(F=L.person)==null?void 0:F.sex;return[at,vt].includes(q)?j[q]+=1:j[Li]+=1,j},{[at]:0,[vt]:0,[Li]:0}),P=Object.assign({},...Object.keys(I).map(j=>{var L;return{[j]:((L=Z2({category:{ageCategoryCode:"O18"},count:I[j],addressProps:{citiesCount:10},personExtensions:[],consideredDate:h,sex:j}))==null?void 0:L.persons)||[]}})),S={[at]:0,[vt]:0,[Li]:0},y=_.length,O=_.reduce((j,L)=>{var F,q;const G=((q=(F=L.person)==null?void 0:F.addresses)==null?void 0:q[0])||{},{city:H,state:Q,postalCode:z}=G;return j.cities.includes(H)||j.cities.push(H),j.states.includes(Q)||j.states.push(Q),j.postalCodes.includes(z)||j.postalCodes.push(z),j},{cities:[],postalCodes:[],states:[]}),b=O.postalCodes.length,E=O.cities.length,T=O.states.length,{cities:N}=ej({count:E||y,participantsCount:y}),{states:w}=tj({count:T||y,participantsCount:y}),{postalCodes:$}=rj({count:b||y,participantsCount:y}),U={cities:N,states:w,postalCodes:$};_.forEach((j,L)=>{var F,q;const G=j==null?void 0:j.person,H=(G==null?void 0:G.sex)||Li,Q=(F=Me(G==null?void 0:G.birthDate))==null?void 0:F.split("-")[0],z=S[H],Y=P[H][z];if(S[H]+=1,Q){const[,J,te]=((q=Y==null?void 0:Y.birthDate)==null?void 0:q.split("-"))||[],ne=[Q,J,te].join("-");Y.birthDate=ne}if(G!=null&&G.addresses){const J=X2(c_e(h$({},U),{participantIndex:L,nationalityCode:Y.nationalityCode}));Y.addresses=[J]}Y.personId=(o==null?void 0:o[L])||ke(),e?(Y.standardFamilyName=Y.lastName,Y.standardGivenName=Y.firstName,j.participantName=`${Y.standardGivenName} ${Y.standardFamilyName}`):(Y.standardFamilyName=G==null?void 0:G.standardFamilyName,Y.standardGivenName=G==null?void 0:G.standardGivenName),delete Y.firstName,delete Y.lastName,Y.extensions=p(G),j.person=Y,v[G==null?void 0:G.personId]=Y.personId}),(r.participants||[]).filter(({participantType:j})=>j===we).forEach(j=>{const{individualParticipantIds:L}=j;j.participantName=u_e({individualParticipantIds:L,individualParticipants:_})});const C=(r.participants||[]).filter(({participantType:j})=>j===Ye),M=C.length,D=Gf({count:M}).names;C.forEach((j,L)=>{j.participantName=D[L]});const V=(r.participants||[]).filter(({participantType:j})=>j===dr),R=V.length,W=Gf({count:R,nameRood:"Group"}).names;V.forEach((j,L)=>{j.participantName=W[L]});const{extension:x}=hr({name:Mo,tournamentRecord:r});Array.isArray(x==null?void 0:x.value)&&x.value.forEach(j=>{j.tournamentId=v[j.tournamentId],j.structureId=v[j.structureId],j.eventId=v[j.eventId],j.drawId=v[j.drawId]});const{extension:K}=hr({name:ma,tournamentRecord:r});return Array.isArray(K==null?void 0:K.value)&&K.value.forEach(j=>{j.personId=v[j.personId]}),h$({},B)}function u_e({individualParticipantIds:t,individualParticipants:e}){let r=e.filter(({participantId:n})=>t.includes(n)).map(({person:n})=>n==null?void 0:n.standardFamilyName).filter(Boolean).sort().join("/");return t.length===1&&(r+="/Unknown"),r}var d_e=Object.defineProperty,p_e=Object.defineProperties,f_e=Object.getOwnPropertyDescriptors,_$=Object.getOwnPropertySymbols,v_e=Object.prototype.hasOwnProperty,m_e=Object.prototype.propertyIsEnumerable,I$=(t,e,r)=>e in t?d_e(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,g_e=(t,e)=>{for(var r in e||(e={}))v_e.call(e,r)&&I$(t,r,e[r]);if(_$)for(var r of _$(e))m_e.call(e,r)&&I$(t,r,e[r]);return t},h_e=(t,e)=>p_e(t,f_e(e));function nj({matchUpFormat:t,matchUpStatus:e,winningSide:r,scoreString:n}){if(!n)return{outcome:h_e(g_e({},fd),{winningSide:r,matchUpStatus:e})};if(r&&![1,2,void 0].includes(r))return{error:Z,winningSide:r};const o=n&&su({scoreString:n}),i={},s=xn({sets:o,matchUpFormat:t}),a=xn({sets:o,reversed:!0,matchUpFormat:t});return r===2?(i.scoreStringSide1=a,i.scoreStringSide2=s):(i.scoreStringSide1=s,i.scoreStringSide2=a),i.sets=su({scoreString:i.scoreStringSide1}),_e({outcome:{matchUpStatus:e,winningSide:r,score:i}})}const __e={[Ge]:2,[gt]:1,[Ot]:1,[Xt]:1,[Be]:4};function oj({matchUpFormat:t="SET3-S:6/TB7",matchUpStatusProfile:e=__e,pointsPerMinute:r=1,sideWeight:n=4,winningSide:o,defaultWithScorePercent:i=2}){if(!Br(t))return{error:lA};if(typeof e!="object")return{error:Z};if(i>100&&(i=100),isNaN(i)||isNaN(r)||isNaN(n))return{error:Z};const s=Object.keys(e).filter(T=>Object.keys(mV).includes(T)&&T!==_t);if(Object.keys(s).reduce((T,N)=>T+e[N],0)>100)return{error:Z,matchUpStatusProfile:e};const c=s.reduce((T,N)=>(T.pointer=T.pointer+e[N],T.valueMap.push([T.pointer,N]),T),{pointer:0,valueMap:[]}),l=Tr(1,100),u=(c.valueMap.find(T=>l<=T[0])||[100,_t])[1],d={sets:[],scoreStringSide1:"",side2ScoreString:""};if([Ge,Be].includes(u)){o=o||Tr(1,2);const T={score:d,winningSide:o,matchUpStatus:u};if(!(u===Be&&Tr(1,100)>100-i))return{outcome:T}}else if([gt,Ot].includes(u))return{outcome:{score:d,matchUpStatus:u}};const p=Ir(t),{bestOf:v,setFormat:f,finalSetFormat:m}=p,g=[],h=Tr(0,1),_=o?[o-1]:[...le(0,n).map(()=>h),1-h],P=[Xt,Be,Hn,hi].includes(u)&&(rr(le(1,v))||1);let S;for(const T of le(1,v+1)){const N=T===v,{set:w,incomplete:$,winningSideNumber:U}=I_e({incomplete:P===T,matchUpStatus:u,pointsPerMinute:r,setFormat:N&&m||f,setNumber:T,weightedRange:_});if(g.push(w),$){S=U;break}if(Lf({matchUp:{score:{sets:g},matchUpFormat:t}}).calculatedWinningSide)break}const y=Lf({matchUp:{score:{sets:g},matchUpFormat:t}}),O=S?o||S:y.calculatedWinningSide,{score:b}=LC({score:{sets:g},winningSide:O,matchUpStatus:u});return{outcome:{score:b,winningSide:O,matchUpStatus:u}}}function I_e({weightedRange:t=[0,1],pointsPerMinute:e,matchUpStatus:r,incomplete:n,setFormat:o,setNumber:i}){const s={setNumber:i},{setTo:a,tiebreakFormat:c,tiebreakAt:l,tiebreakSet:u,timed:d,minutes:p}=o,v=Tr(0,t.length-1),f=t[v];let m;if(d){const g=p*e,h=Math.round(g*.2),_=g+rr([1,-1])*h,I=xj(_,2),P=[I,_-I];f&&P.reverse(),m=t[v]+1;let S=P[0]>P[1]&&1||P[1]>P[0]&&2||0;if(n){const[b,E]=P;return Object.assign(s,{side1Score:b,side2Score:E}),Rt.includes(r)?{set:s,incomplete:n,winningSideNumber:m}:{set:s,incomplete:n}}S||(P[Tr(0,1)]+=1),S=P[0]>P[1]?1:2,S!==m&&P.reverse();const[y,O]=P;return Object.assign(s,{side1Score:y,side2Score:O,winningSide:m}),{set:s}}else{if(n)return s.side1Score=Tr(0,l),s.side2Score=Tr(0,l),Rt.includes(r)&&(m=t[v]+1),{set:s,incomplete:n,winningSideNumber:m};{const g=le(1,a+1).map(O=>le(0,a+2-O).map(()=>O)).flat(),h=g[Tr(0,g.length-1)],_=a&&$1({isSide1:!0,tiebreakAt:l,lowValue:h,setTo:a}),I=!_,P=t.length===1&&t[v]+1;if(!I){P?(_[0]>_[1]?1:2)!==P&&_.reverse():f&&_.reverse();const[O,b]=_;Object.assign(s,{side1Score:O,side2Score:b})}const S=nu({matchUpScoringFormat:{setFormat:o},setObject:s});let y;if(S.hasTiebreakCondition||I){const{NoAD:O,tiebreakTo:b}=c||u||{},E=le(1,b+1).map(w=>le(0,b+2-w).map(()=>w)).flat(),T=E[Tr(0,E.length-1)];let N=Kv({isSide1:!0,tiebreakNoAd:O,tiebreakTo:b,lowValue:T});if(N)if(I){const w=N[0]>N[1]?1:2;P?w!==P&&N.reverse():f&&N.reverse(),[s.side1TiebreakScore,s.side2TiebreakScore]=N,y=N[0]>N[1]&&1||N[1]>N[0]&&2||void 0}else S.leadingSide===2?[s.side1TiebreakScore,s.side2TiebreakScore]=N:[s.side2TiebreakScore,s.side1TiebreakScore]=N}s.winningSide=S.winningSide||S.leadingSide||P||y}}return{set:s}}var P_e=Object.defineProperty,y_e=Object.defineProperties,O_e=Object.getOwnPropertyDescriptors,P$=Object.getOwnPropertySymbols,S_e=Object.prototype.hasOwnProperty,b_e=Object.prototype.propertyIsEnumerable,y$=(t,e,r)=>e in t?P_e(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,T_e=(t,e)=>{for(var r in e||(e={}))S_e.call(e,r)&&y$(t,r,e[r]);if(P$)for(var r of P$(e))b_e.call(e,r)&&y$(t,r,e[r]);return t},E_e=(t,e)=>y_e(t,O_e(e));function Vu({matchUpStatusProfile:t,completeAllMatchUps:e,randomWinningSide:r,tournamentRecord:n,drawDefinition:o,completionGoal:i,matchUpFormat:s,event:a}){var c,l,u;const d=o.structures.slice().sort(yi);let p=0,{matchUps:v,matchUpsMap:f}=wt({contextFilters:{stages:[ue,Ie]},matchUpFilters:{matchUpTypes:[We],roundNumbers:[1]},inContext:!0,drawDefinition:o});if(v.length){const h=((c=a.category)==null?void 0:c.ageCategoryCode)||((l=a.category)==null?void 0:l.categoryName);if(h)k2({singlesOnly:!0,tournamentRecord:n,drawDefinition:o,scaleAccessor:{scaleName:h,sortOrder:Pme,scaleType:ai},attach:!0,event:a});else{const _=(u=v[0])==null?void 0:u.structureId,{positionAssignments:I}=Xe({drawDefinition:o,structureId:_});if(I!=null&&I.length){let{tournamentParticipants:P}=Kt({participantFilters:{participantTypes:[We]},tournamentRecord:n});const S=y=>{const O=y.tieMatchUps.filter(({matchUpType:E})=>E===ut),b=y.tieMatchUps.filter(({matchUpType:E})=>E===ot);O.forEach((E,T)=>{const N=E.matchUpId;E.sides.forEach(w=>{const{drawPosition:$}=w,U=P.find(A=>{const{participantId:C}=A,M=I.find(D=>D.participantId===C);return(M==null?void 0:M.drawPosition)===$});if(U){const A=U.individualParticipantIds[T];xf({teamParticipantId:U.participantId,participantId:A,tournamentRecord:n,drawDefinition:o,tieMatchUpId:N,event:a})}})}),b.forEach((E,T)=>{const N=E.matchUpId;E.sides.forEach(w=>{const{drawPosition:$}=w,U=P.find(A=>{const{participantId:C}=A,M=I.find(D=>D.participantId===C);return(M==null?void 0:M.drawPosition)===$});U&&U.individualParticipantIds.slice(T*2,T*2+2).forEach(C=>{xf({teamParticipantId:U.participantId,participantId:C,tournamentRecord:n,drawDefinition:o,tieMatchUpId:N,event:a})})})})};v.forEach(S)}}}const m=typeof e=="string"&&e,g=m&&_t;for(const h of d){if(p>=i)break;const{matchUps:_}=Ke({matchUpFilters:{matchUpTypes:[ot,ut]},afterRecoveryTimes:!1,tournamentRecord:n,inContext:!0,drawDefinition:o,matchUpsMap:f,structure:h,event:a}),I=_.filter(({winningSide:P})=>!P).sort(_s).map($t);for(const P of I){if(!isNaN(i)&&p>=i)break;const{matchUps:S}=Ke({matchUpFilters:{matchUpTypes:[ot,ut]},afterRecoveryTimes:!1,tournamentRecord:n,inContext:!0,drawDefinition:o,matchUpsMap:f,structure:h,event:a}),y=S.find(b=>b.matchUpId===P),O=[gt,Ot].includes(y.matchUpStatus);if(y!=null&&y.readyToScore&&!O){const b=w_e({winningSide:!r&&1,matchUpStatusProfile:t,tournamentRecord:n,drawDefinition:o,targetMatchUp:y,matchUpFormat:s,matchUpStatus:g,scoreString:m,event:a});if(b.error)return b;p+=1}}}return E_e(T_e({},B),{completedCount:p})}function ij({matchUpStatusCodes:t,tournamentRecord:e,drawDefinition:r,targetMatchUp:n,matchUpStatus:o,matchUpFormat:i,scoreString:s,winningSide:a,event:c}){if(!n||n.matchUpStatus===qe)return;const{matchUpId:l}=n||{},{outcome:u}=nj({matchUpFormat:i,matchUpStatus:o,scoreString:s,winningSide:a});return t&&(u.matchUpStatusCodes=t),Zc({tournamentRecord:e,drawDefinition:r,matchUpFormat:i,matchUpId:l,outcome:u,event:c})}function w_e(t){const{matchUpStatusProfile:e={},tournamentRecord:r,drawDefinition:n,matchUpStatus:o,matchUpFormat:i,targetMatchUp:s,scoreString:a,winningSide:c,event:l}=t;if(a||o)return ij(t);const{matchUpId:u}=s||{},{outcome:d}=oj({matchUpStatusProfile:e,matchUpFormat:i,winningSide:c});return Zc({tournamentRecord:r,drawDefinition:n,matchUpFormat:i,matchUpId:u,outcome:d,event:l})}var N_e=Object.defineProperty,$_e=Object.defineProperties,A_e=Object.getOwnPropertyDescriptors,O$=Object.getOwnPropertySymbols,U_e=Object.prototype.hasOwnProperty,C_e=Object.prototype.propertyIsEnumerable,S$=(t,e,r)=>e in t?N_e(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,rf=(t,e)=>{for(var r in e||(e={}))U_e.call(e,r)&&S$(t,r,e[r]);if(O$)for(var r of O$(e))C_e.call(e,r)&&S$(t,r,e[r]);return t},nf=(t,e)=>$_e(t,A_e(e));function sj({matchUpStatusProfile:t,completeAllMatchUps:e,randomWinningSide:r,tournamentRecord:n,drawProfiles:o,event:i}){var s,a;const{flightProfile:c}=ht({event:i}),{eventName:l,eventType:u,category:d}=i,{startDate:p}=n,v=[],f=(d==null?void 0:d.categoryName)||(d==null?void 0:d.ageCategoryCode)||(d==null?void 0:d.ratingType),m=(s=i.drawDefinitions)==null?void 0:s.map(({drawId:g})=>g);if(Array.isArray(c==null?void 0:c.flights))for(const[g,h]of c.flights.entries()){const{drawId:_,stage:I,drawName:P,drawEntries:S}=h;v.push(h.drawId);const y=o[g],{seedsCount:O,generate:b=!0}=y||{};if(b){const E=S.filter(pd).map(Ze),T=f||l;if(n&&O&&O<=E.length&&le(1,O+1).forEach((M,D)=>{let V={scaleValue:M,scaleName:T,scaleType:Xr,eventType:u,scaleDate:p};const R=E[D];vc({tournamentRecord:n,participantId:R,scaleItem:V})}),m!=null&&m.includes(_))break;let N=yg(nf(rf({},y),{matchUpType:u,seedingScaleName:T,tournamentRecord:n,isMock:!0,drawEntries:S,drawName:P,drawId:_,event:i,stage:I}));if(N.error)return N;const{drawDefinition:w}=N,$=(a=o[g])==null?void 0:a.drawExtensions;if(Array.isArray($)&&$.filter(on).forEach(C=>et({element:w,extension:C})),N=Xc({suppressNotifications:!0,tournamentRecord:n,drawDefinition:w,event:i}),N.error)return N;if(y.drawType===sn&&y.drawMatic){const C=y.roundsCount||1;for(const M of le(1,C+1)){const D=hg({generateMatchUps:!0,tournamentRecord:n,drawDefinition:w,roundNumber:M});if(D.error)return D}}if(y!=null&&y.withPlayoffs){const C=w.structures[0].structureId,M=Hd(nf(rf({idPrefix:y.idPrefix},y.withPlayoffs),{tournamentRecord:n,drawDefinition:w,isMock:!0,structureId:C,event:i}));if(M!=null&&M.error)return M}const U=y==null?void 0:y.completionGoal;if(!((y==null?void 0:y.automated)===!1)&&(e||U)){const C=y==null?void 0:y.matchUpFormat,M=Vu({completeAllMatchUps:!U&&e,matchUpStatusProfile:t,randomWinningSide:r,tournamentRecord:n,completionGoal:U,drawDefinition:w,matchUpFormat:C,event:i});if(M.error)return M;const D=M.completedCount;if((y==null?void 0:y.drawType)===vo){const V=w.structures.find(x=>x.stage===ue);let R=qd({structureId:V.structureId,tournamentRecord:n,drawDefinition:w,event:i});if(R.error)return R;const W=U?U-D:void 0;if(R=Vu({completeAllMatchUps:!U&&e,completionGoal:U?W:void 0,matchUpStatusProfile:t,randomWinningSide:r,tournamentRecord:n,drawDefinition:w,matchUpFormat:C,event:i}),R.error)return R}}}}return nf(rf({},B),{drawIds:v})}var M_e=Object.defineProperty,D_e=Object.defineProperties,j_e=Object.getOwnPropertyDescriptors,b$=Object.getOwnPropertySymbols,R_e=Object.prototype.hasOwnProperty,F_e=Object.prototype.propertyIsEnumerable,T$=(t,e,r)=>e in t?M_e(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,V_e=(t,e)=>{for(var r in e||(e={}))R_e.call(e,r)&&T$(t,r,e[r]);if(b$)for(var r of b$(e))F_e.call(e,r)&&T$(t,r,e[r]);return t},L_e=(t,e)=>D_e(t,j_e(e));function Zd({ratingsParameters:t=Bn,valuesInstanceLimit:e,consideredDate:r,category:n,nationalityCodesCount:o,nationalityCodeType:i,nationalityCodes:s,participantsCount:a=32,participantType:c,personIds:l,idPrefix:u,uuids:d,personExtensions:p,addressProps:v,gendersCount:f,matchUpType:m,personData:g,sex:h,inContext:_,withISO2:I,withIOC:P,rankingRange:S,scaledParticipantsCount:y,scaleAllParticipants:O}){const b=c===we||m===Kr,E=c===Ye||m===Ye;S&&(!Array.isArray(S)||!S.every(X=>Pt(X))||S.length!==2)&&(S=void 0),y=O?a:y;const T=1e3,N=y&&y>T?y:T;S=S||[1,N],S[1]+=1;const w=a*(b?2:E?8:1),$=Z2({count:w,personExtensions:p,consideredDate:r,gendersCount:f,personData:g,category:n,sex:h});if($.error)return $;const{nationalityCodes:U,persons:A}=$;let C=[],M=[],D=[],V=[];if(typeof n=="object"){const{categoryName:X,ageCategoryCode:ie,ratingType:fe}=n;if((X||ie)&&!fe&&(M=tr(le(...S)).slice(0,y||Tr(20,30)),[we,Ye].includes(c)&&(C=tr(le(...S)).slice(0,y||Tr(20,30)))),fe&&t[fe]){let{ratingMax:Ee,ratingMin:re,ratingAttributes:ae}=n;const me=Object.assign({},t[fe],ae||{}),{attributes:Oe={},decimalsCount:ce,accessors:Pe,range:$e,step:ye}=me,Ae=xe=>{const De={};for(const Je of Object.keys(xe)||{}){const rt=xe[Je];if(typeof rt=="object"&&rt.generator){const{range:He}=rt,[bt,Qt]=He.slice().sort();De[Je]=Tr(bt,Qt)}else De[Je]=rt}return De},ge=$e[0]>$e[1]?2:.5,[Ne,Ue]=$e.slice().sort(),he=()=>le(0,2e3).map(()=>J$(Ne,Ue,ge,ye,ce)).filter(xe=>(!Ee||xe<=Ee)&&(!re||xe>=re)).slice(0,y||Tr(20,30)).map(xe=>Pe?Object.assign({},...Pe.map(De=>({[De]:xe})),Ae(Oe)):xe);D=he(),[we,Ye].includes(c)&&(V=he())}}const R=Ao.filter(X=>i==="IOC"&&X.ioc||X.iso);function W(X){const ie=Math.ceil(w/X);return e&&ie>e?Math.ceil(w/e):X}const{postalCodesProfile:x,postalCodesCount:K,statesProfile:j,citiesProfile:L,citiesCount:F,statesCount:q}=v||{},G=X=>Object.keys(X).map(ie=>le(0,j[ie]).map(()=>ie)).flat(),H=L&&G(L)||(v==null?void 0:v.cities)||ej({count:F||w,participantsCount:w}).cities,Q=j&&G(j)||(v==null?void 0:v.states)||tj({count:q||w,participantsCount:w}).states,z=x&&G(x)||(v==null?void 0:v.postalCodes)||rj({count:K||w,participantsCount:w}).postalCodes,Y={cities:H,states:Q,postalCodes:z},J=W(o),te=J?tr(R).slice(0,o):s?R.filter(X=>s.includes(X.key)):R,ne=tr(le(0,Math.ceil(w/(J||1))).map(()=>te).flat(1/0)),oe=Gf({count:a}).names;return{participants:le(0,a).map(X=>{const ie=b?2:E?8:1,fe=le(0,ie).map(Oe=>{const ce=X*ie+Oe;return ve(ce)}),Ee=fe.map(Oe=>Oe.participantId),re=fe.map(Oe=>Oe.person.standardFamilyName).join("/"),ae=b?we:Ye,me={participantId:E$({participantType:ae,idPrefix:u,index:X,uuids:d}),participantRole:xt,participantName:b?re:oe[X],individualParticipantIds:Ee,participantType:ae};return _&&(me.individualParticipants=fe),b||E?[me,...fe]:fe}).flat()};function ve(X){const ie=A[X],{nationalityCode:fe,participantExtensions:Ee,participantTimeItems:re,extensions:ae,firstName:me,birthDate:Oe,lastName:ce,personId:Pe,sex:$e}=ie||{},ye=me||"GivenName",Ae=ce||"FamilyName",be=`${ye} ${Ae}`,ge=ne[X],Ne=(U==null?void 0:U.length)&&fe||ge&&(i==="IOC"?ge.ioc||ge.iso:ge.iso||ge.ioc)||fe;ne!=null&&ne.length&&!Ne&&!fe&&console.log("%c Invalid Nationality Code",{participantIndex:X,country:ge});const Ue=X2(L_e(V_e({},Y),{participantIndex:X,nationalityCode:Ne})),he=_e({participantId:E$({participantType:Ce,index:X,idPrefix:u,uuids:d}),extensions:Ee,timeItems:re,participantRole:xt,participantType:Ce,participantName:be,person:{addresses:[Ue],personId:Pe||(l==null?void 0:l.length)&&l[X]||ke(),standardFamilyName:Ae,standardGivenName:ye,nationalityCode:Ne,extensions:ae,birthDate:Nr(Oe)?Oe:void 0,sex:$e}});if(P&&Ne){const xe=Ao.find(({iso:De})=>De===Ne);xe!=null&&xe.ioc&&(he.person.iocNationalityCode=xe.ioc),xe!=null&&xe.label&&(he.person.countryName=xe.label)}if(I&&Ne){const xe=Ao.find(({iso:De})=>De===Ne);xe!=null&&xe.iso2&&(he.person.iso2NationalityCode=xe.iso2),xe!=null&&xe.label&&(he.person.countryName=xe.label)}if(n){const xe=M[X],De=C[X];wl({scaleValue:xe,eventType:i_,scaleType:ai,participant:he,category:n}),wl({scaleValue:De,eventType:rc,scaleType:ai,participant:he,category:n});const Je=D[X],rt=V[X];wl({scaleValue:Je,eventType:i_,scaleType:xi,participant:he,category:n}),wl({scaleValue:rt,eventType:rc,scaleType:xi,participant:he,category:n})}return he}}function wl({scaleValue:t,participant:e,eventType:r,scaleType:n,category:o}){const i=o.categoryName||o.ratingType||o.ageCategoryCode,s=[es,n,r,i].join("."),a={itemValue:t,itemType:s};i&&t&&(e.timeItems||(e.timeItems=[]),e.timeItems.push(a))}function E$({idPrefix:t,participantType:e,index:r,uuids:n}){return t?`${t}-${e===Ce?"I":we?"P":Ye?"T":dr?"G":"X"}-${r}`:(n==null?void 0:n.pop())||ke()}function aj({alternatesCount:t=0,tieFormatName:e,tieFormat:r,drawSize:n}){var o;let i=0,s=0,a=0,c=0,l={};const u={[at]:0,[vt]:0,[go]:0,[Li]:0,[Hs]:0};r=typeof r=="object"?r:as({namedFormat:e}),(o=r==null?void 0:r.collectionDefinitions)==null||o.filter(Boolean).forEach(f=>{const{category:m,collectionId:g,matchUpType:h,matchUpCount:_,gender:I}=f;if([at,vt].includes(I)){const P=_*(h===ot?2:1);u[I]<P&&(u[I]=P)}else I===go&&(u[at]<_&&(u[at]=_),u[vt]<_&&(u[vt]=_));if(m){const P=JSON.stringify(m);l[P]=m}if(g||(f.collectionId=ke()),h===ot){const P=_;c+=_,i=Math.max(i,P)}if(h===ut){const P=_;a+=_,s=Math.max(s,P)}});const d=Object.keys(l).length?Math.max(a,c*2):Math.max(s,i*2),p=i*(n+t),v=s*(n+t);return{maxDoublesDraw:p,maxSinglesDraw:v,teamSize:d,genders:u}}var B_e=Object.defineProperty,x_e=Object.defineProperties,G_e=Object.getOwnPropertyDescriptors,w$=Object.getOwnPropertySymbols,k_e=Object.prototype.hasOwnProperty,W_e=Object.prototype.propertyIsEnumerable,N$=(t,e,r)=>e in t?B_e(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,q_e=(t,e)=>{for(var r in e||(e={}))k_e.call(e,r)&&N$(t,r,e[r]);if(w$)for(var r of w$(e))W_e.call(e,r)&&N$(t,r,e[r]);return t},H_e=(t,e)=>x_e(t,G_e(e));function Y_e({participantsProfile:t,eventProfiles:e,drawProfiles:r}){let{participantsCount:n,participantType:o=Ce}=t||{};const i=n||0,s={[vt]:0,[go]:0,[Li]:0,[at]:0,[Hs]:0};let a=0,c=0,l=0,u=0,d=0;const p=({alternatesCount:m=0,uniqueParticipants:g,tieFormatName:h,drawSize:_=0,eventType:I,tieFormat:P,category:S,gender:y,stage:O})=>{const b=I===mr,E=I===yt,T=!!(g||O===Ie||S||y);if(E){u=Math.max(u,_+m),P=typeof P=="object"?P:as({namedFormat:h});const{teamSize:N,maxDoublesDraw:w,maxSinglesDraw:$,genders:U}=aj({alternatesCount:m,tieFormatName:h,tieFormat:P,drawSize:_});l=Math.max(l,N),c=Math.max(c,$),T||(a=Math.max(a,w)),Object.keys(U).forEach(A=>s[A]+=U[A])}else if(b)if(T){const N=(_+m)*2;d+=N,y&&(s[y]+=N)}else _+m&&_+m>a&&(a=_+m);else if(T){const N=_+m;y&&(s[y]+=N),d+=N}else _&&_>c&&(c=_+m)};let v=[];if(e==null||e.forEach(m=>{const{tieFormatName:g,tieFormat:h,drawProfiles:_,eventType:I,category:P,gender:S}=m;if(_)for(const y of _){const{tieFormatName:O,tieFormat:b}=y;p(H_e(q_e({},y),{tieFormatName:O||g,tieFormat:b||h,eventType:I,category:P,gender:S}))}else P&&(v.push(P),console.log({categories:v}))}),Array.isArray(r))for(const m of r)p(m);const f=Math.max(u*l,a*2,c);return a&&(o=we),(n||i)<f&&(n=f),n&&a&&[we,yt].includes(o)&&(c&&Math.floor(c/2)>a?n=Math.floor(c/2):(!c||a*2>=c)&&(n=Math.ceil(n/2))),n===void 0&&(n=!(e!=null&&e.length)&&!(r!=null&&r.length)?32:0),n<i&&(n=i),{uniqueParticipantsCount:d,participantsCount:n,largestTeamDraw:u,largestTeamSize:l,participantType:o,gendersCount:s}}var K_e=Object.defineProperty,z_e=Object.defineProperties,Q_e=Object.getOwnPropertyDescriptors,$$=Object.getOwnPropertySymbols,J_e=Object.prototype.hasOwnProperty,Z_e=Object.prototype.propertyIsEnumerable,A$=(t,e,r)=>e in t?K_e(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,of=(t,e)=>{for(var r in e||(e={}))J_e.call(e,r)&&A$(t,r,e[r]);if($$)for(var r of $$(e))Z_e.call(e,r)&&A$(t,r,e[r]);return t},X_e=(t,e)=>z_e(t,Q_e(e));function cj({participantsProfile:t={},tournamentRecord:e,eventProfiles:r,drawProfiles:n,startDate:o,uuids:i}){const{participantsCount:s,participantType:a,largestTeamDraw:c,largestTeamSize:l,gendersCount:u}=Y_e({participantsProfile:t,eventProfiles:r,drawProfiles:n}),{teamKey:d}=t||{},{participants:p}=Zd(X_e(of({uuids:i},t),{consideredDate:o,participantsCount:s,participantType:a,gendersCount:u}));let v=0,f=Zn({tournamentRecord:e,participants:p});if(f.error)return f;if(v+=f.addedCount,d){const h=h2(of({tournamentRecord:e},d));if(h.error)return h}const m=p.filter(({participantType:h})=>h===Ce).map(Ze),g=le(0,c).map(h=>{const _=m.slice(h*l,(h+1)*l);return{participantName:`Team ${h+1}`,participantRole:xt,participantType:Ye,participantId:ke(),individualParticipantIds:_}});return f=Zn({participants:g,tournamentRecord:e}),f.error?f:(v+=f.addedCount,of({addedCount:v},B))}var eIe=Object.defineProperty,tIe=Object.defineProperties,rIe=Object.getOwnPropertyDescriptors,U$=Object.getOwnPropertySymbols,nIe=Object.prototype.hasOwnProperty,oIe=Object.prototype.propertyIsEnumerable,C$=(t,e,r)=>e in t?eIe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,iIe=(t,e)=>{for(var r in e||(e={}))nIe.call(e,r)&&C$(t,r,e[r]);if(U$)for(var r of U$(e))oIe.call(e,r)&&C$(t,r,e[r]);return t},sIe=(t,e)=>tIe(t,rIe(e));function lj({participantsProfile:t={},uniqueParticipantsCount:e,ratingsParameters:r,tournamentRecord:n,eventProfile:o,eventIndex:i,event:s,uuids:a}){const{category:c,gender:l,eventType:u}=s,d=u===Yn&&Ce||u===mr&&we||u,p=e[ue]||0,v=e[Ie]||0,f=p+v,m=[at,vt].includes(l)?l:void 0,g=t!=null&&t.idPrefix?`E-${i}-${t==null?void 0:t.idPrefix}`:void 0,{participants:h}=Zd(sIe(iIe({uuids:o.uuids||a},t),{scaledParticipantsCount:o.scaledParticipantsCount,consideredDate:n==null?void 0:n.startDate,rankingRange:o.rankingRange,participantType:d,participantsCount:f,ratingsParameters:r,idPrefix:g,category:c,sex:m}));let _=Zn({participants:h,tournamentRecord:n});if(_.error)return _;const I=h.filter(({participantType:S})=>S===d),P=h.map(Ze);return{uniqueDrawParticipants:I,uniqueParticipantIds:P}}function uj({drawProfiles:t,category:e,gender:r}){const n={},o=t==null?void 0:t.reduce((s,a)=>{const{qualifyingPositions:c=0,participantsCount:l=0,uniqueParticipants:u,stage:d=ue,drawSize:p=0}=a||{};Object.keys(s).includes(d)||(s[d]=0);const v=(l||p)-c;return u||r||e||d===Ie?(Object.keys(n).includes(d)||(n[d]=0),n[d]+=v):s[d]=Math.max(s[d],v),s},{}),i=Object.keys(n);return i.forEach(s=>o[s]+=n[s]),{stageParticipantsCount:o,uniqueParticipantsCount:n,uniqueParticipantStages:i}}function dj({allUniqueParticipantIds:t,stageParticipantsCount:e,eventParticipantType:r,targetParticipants:n}){const o=e[ue]||0,i=e[Ie]||0;return{stageParticipants:{QUALIFYING:n.filter(({participantType:a})=>a===r).filter(({participantId:a})=>!t.includes(a)).slice(0,i),MAIN:n.filter(({participantType:a})=>a===r).filter(({participantId:a})=>!t.includes(a)).slice(i,i+o)}}}var aIe=Object.defineProperty,M$=Object.getOwnPropertySymbols,cIe=Object.prototype.hasOwnProperty,lIe=Object.prototype.propertyIsEnumerable,D$=(t,e,r)=>e in t?aIe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,uIe=(t,e)=>{for(var r in e||(e={}))cIe.call(e,r)&&D$(t,r,e[r]);if(M$)for(var r of M$(e))lIe.call(e,r)&&D$(t,r,e[r]);return t};function dIe({autoEntryPositions:t,tournamentRecord:e,drawParticipants:r,drawProfile:n,event:o}){const{drawType:i=Qn,qualifyingPositions:s=0,stage:a=ue,drawSize:c=0,drawName:l,drawId:u}=n,d=c-s,p=r.slice(0,d).map(Ze);if(p.length){const m=Uo({participantIds:p,autoEntryPositions:t,tournamentRecord:e,stage:a,event:o});if(m.error)return m}const v=p.map(m=>({entryStatus:Cr,entryStage:a,participantId:m})),f=_g({drawName:l||i,qualifyingPositions:s,drawEntries:v,drawId:u,event:o,stage:a});return f.error?f:uIe({},B)}var pIe=Object.defineProperty,j$=Object.getOwnPropertySymbols,fIe=Object.prototype.hasOwnProperty,vIe=Object.prototype.propertyIsEnumerable,R$=(t,e,r)=>e in t?pIe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,mIe=(t,e)=>{for(var r in e||(e={}))fIe.call(e,r)&&R$(t,r,e[r]);if(j$)for(var r of j$(e))vIe.call(e,r)&&R$(t,r,e[r]);return t};function pj({uniqueDrawParticipants:t,autoEntryPositions:e,stageParticipants:r,tournamentRecord:n,drawProfiles:o,category:i,gender:s,event:a}){let c=0;for(const l of o){const{qualifyingPositions:u=0,uniqueParticipants:d,stage:p=ue,drawSize:v=0}=l,f=v-u,m=d||s||i||p===Ie,g=m?t.slice(c,c+f):r[p||ue]||[];m&&(c+=f);const h=dIe({autoEntryPositions:e,drawParticipants:g,tournamentRecord:n,drawProfile:l,event:a});if(h.error)return h}return mIe({},B)}var gIe=Object.defineProperty,hIe=Object.defineProperties,_Ie=Object.getOwnPropertyDescriptors,F$=Object.getOwnPropertySymbols,IIe=Object.prototype.hasOwnProperty,PIe=Object.prototype.propertyIsEnumerable,V$=(t,e,r)=>e in t?gIe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,yIe=(t,e)=>{for(var r in e||(e={}))IIe.call(e,r)&&V$(t,r,e[r]);if(F$)for(var r of F$(e))PIe.call(e,r)&&V$(t,r,e[r]);return t},OIe=(t,e)=>hIe(t,_Ie(e));function fj({allUniqueParticipantIds:t,matchUpStatusProfile:e,participantsProfile:r,completeAllMatchUps:n,autoEntryPositions:o,hydrateCollections:i,randomWinningSide:s,ratingsParameters:a,tournamentRecord:c,eventProfile:l,eventIndex:u,publish:d,uuids:p}){let v=l.gender,f=l.eventName;const{eventType:m=Yn,policyDefinitions:g,drawProfiles:h=[],eventExtensions:_,surfaceCategory:I,tieFormatName:P,discipline:S,eventLevel:y,timeItems:O,ballType:b,category:E}=l,T=l.tieFormat||(m===yt?as({namedFormat:P,event:{category:E,gender:v},hydrateCollections:i}):void 0);let N=c.participants;for(const F of h)!v&&F.gender&&(v=F==null?void 0:F.gender);const{stageParticipantsCount:w,uniqueParticipantsCount:$,uniqueParticipantStages:U}=uj({drawProfiles:h,category:E,gender:v}),A=m===Yn&&Ce||m===mr&&we||m,{uniqueDrawParticipants:C=[],uniqueParticipantIds:M=[]}=U?lj({event:{eventType:m,category:E,gender:v},uniqueParticipantsCount:$,participantsProfile:r,ratingsParameters:a,tournamentRecord:c,eventProfile:l,eventIndex:u,uuids:p}):{};let{eventAttributes:D}=l;typeof D!="object"&&(D={});const V=(E==null?void 0:E.categoryName)||(E==null?void 0:E.ageCategoryCode)||(E==null?void 0:E.ratingType),R=l.eventId||ke();f=f||V||"Generated Event";const W=OIe(yIe({},D),{surfaceCategory:I,discipline:S,eventLevel:y,eventName:f,eventType:m,tieFormat:T,ballType:b,category:E,eventId:R,gender:v});if(_!=null&&_.length&&Array.isArray(_)){const F=_.filter(on);F!=null&&F.length&&Object.assign(W,{extensions:F})}if(Array.isArray(O)&&O.forEach(F=>zo({event:K,timeItem:F})),typeof g=="object")for(const F of Object.keys(g))VM({policyDefinitions:{[F]:g[F]},event:W});W.category&&(W.category.categoryName=V);let x=Jd({suppressNotifications:!1,internalUse:!0,tournamentRecord:c,event:W});if(x.error)return x;const{event:K}=x,{stageParticipants:j}=dj({allUniqueParticipantIds:t,stageParticipantsCount:w,eventParticipantType:A,targetParticipants:N});if(x=pj({uniqueDrawParticipants:C,autoEntryPositions:o,stageParticipants:j,tournamentRecord:c,drawProfiles:h,category:E,gender:v,event:K}),x.error||(x=sj({matchUpStatusProfile:e,completeAllMatchUps:n,randomWinningSide:s,tournamentRecord:c,drawProfiles:h,event:K}),x.error))return x;const L=x.drawIds;return d&&sl({tournamentRecord:c,event:K}),{drawIds:L,eventId:R,uniqueParticipantIds:M}}var SIe=Object.defineProperty,bIe=Object.defineProperties,TIe=Object.getOwnPropertyDescriptors,L$=Object.getOwnPropertySymbols,EIe=Object.prototype.hasOwnProperty,wIe=Object.prototype.propertyIsEnumerable,B$=(t,e,r)=>e in t?SIe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Nl=(t,e)=>{for(var r in e||(e={}))EIe.call(e,r)&&B$(t,r,e[r]);if(L$)for(var r of L$(e))wIe.call(e,r)&&B$(t,r,e[r]);return t},$l=(t,e)=>bIe(t,TIe(e));function Og({allUniqueParticipantIds:t=[],participantsProfile:e={},matchUpStatusProfile:r,completeAllMatchUps:n,autoEntryPositions:o,hydrateCollections:i,randomWinningSide:s,ratingsParameters:a,tournamentRecord:c,isMock:l=!0,drawProfile:u,startDate:d,drawIndex:p,uuids:v}){var f;const m=de(u,!1,!0),{excessParticipantAlternates:g=!0,matchUpFormat:h=Ku,drawType:_=Qn,tournamentAlternates:I=0,alternatesCount:P=0,qualifyingPositions:S,qualifyingProfiles:y,generate:O=!0,eventExtensions:b,drawExtensions:E,completionGoal:T,tieFormatName:N,seedsCount:w,timeItems:$,drawName:U,category:A,idPrefix:C,publish:M,gender:D,stage:V}=m;let R=m.drawSize||(m.ignoreDefaults?void 0:32);const W=u.eventType||u.matchUpType||Yn,x=W===mr?we:Ce,K=typeof u.tieFormat=="object"&&u.tieFormat||W===Ye&&as({namedFormat:N,event:{category:A,gender:D},hydrateCollections:i})||void 0,j=(A==null?void 0:A.categoryName)||(A==null?void 0:A.ageCategoryCode)||(A==null?void 0:A.ratingType);let L=u.eventName||j||`Generated ${W}`,F=(c==null?void 0:c.participants)||[];const q=((y==null?void 0:y.map(re=>re.structureProfiles||[]).flat().reduce((re,ae)=>{const me=!ae.participantsCount||ae.participantsCount>ae.drawSize?ae.drawSize:ae.participantsCount||0;return re+me},0))||0)*(x===mr?2:1),G=(!u.participantsCount||u.participantsCount>R?R:u.participantsCount)||0,H=m.eventId||ke();let Q={eventName:L,eventType:W,tieFormat:K,category:A,eventId:H,gender:D};Array.isArray($)&&$.forEach(re=>zo({event:Q,timeItem:re}));let{eventAttributes:z}=u;if(typeof z!="object"&&(z={}),Object.assign(Q,z),b!=null&&b.length&&Array.isArray(b)){const re=b.filter(on);re!=null&&re.length&&Object.assign(Q,{extensions:re})}const Y=[];if(q||u.uniqueParticipants||!c||D||A){const re=(G||0)+P+q;let ae=re;const me={[at]:0,[vt]:0};let Oe,ce;W===Ye&&({teamSize:Oe,genders:ce}=aj({alternatesCount:P,tieFormatName:N,tieFormat:K,drawSize:R}),Object.keys(ce).forEach(Ae=>{[at,vt].includes(Ae)&&ce[Ae]&&(me[Ae]=R*ce[Ae])}),ae=Oe*((R||0)+q));const Pe=e!=null&&e.idPrefix?`D-${p}-${e==null?void 0:e.idPrefix}`:void 0,$e=Zd($l(Nl({},e),{scaledParticipantsCount:u.scaledParticipantsCount||e.scaledParticipantsCount,participantsCount:ae,consideredDate:c==null?void 0:c.startDate,sex:D||(e==null?void 0:e.sex),rankingRange:u.rankingRange,uuids:u.uuids||v,ratingsParameters:a,participantType:x,gendersCount:me,idPrefix:Pe,category:A})),{participants:ye}=$e;if(Q.category&&(Q.category.categoryName=j),c){const Ae=Zn({participants:ye,tournamentRecord:c});if(Ae.error)return Ae}if(ye.forEach(({participantId:Ae})=>Y.push(Ae)),F=ye,W===Ye){const Ae=ce[at]?ye.filter(({participantType:rt,person:He})=>rt===Ce&&He.sex===at).map(Ze):[],be=ce[vt]?ye.filter(({participantType:rt,person:He})=>rt===Ce&&He.sex===vt).map(Ze):[],ge=ye.filter(({participantType:rt})=>rt===Ce).map(Ze).filter(rt=>!Ae.includes(rt)&&!be.includes(rt)),Ne=Oe-(ce[at]+ce[vt]);let Ue=0,he=0,xe=0;const De=le(0,re).map(rt=>{const He=be.slice(Ue,Ue+ce[vt]),bt=Ae.slice(he,he+ce[at]),Qt=ge.slice(xe,xe+Ne);return Ue+=ce[vt],he+=ce[at],xe+=Ne,{individualParticipantIds:[...He,...bt,...Qt],participantOtherName:`TM${rt+1}`,participantName:`Team ${rt+1}`,participantRole:xt,participantType:Ye,participantId:ke()}}),Je=Zn({participants:De,tournamentRecord:c});if(!Je.success)return Je;F=De}}const J=re=>{const{participantType:ae}=re;return W===Yn&&ae===Ce||W===mr&&ae===we?!0:W===Ye&&ae===Ye},te=re=>{var ae,me;if(!u.gender||((ae=re.person)==null?void 0:ae.sex)===u.gender||(me=re.individualParticipantIds)!=null&&me.some(Oe=>{const ce=F.find(Pe=>Pe.participantId===Oe);return ce&&te(ce)}))return!0},ne=F.filter(J).filter(te).filter(({participantId:re})=>!t.includes(re)),oe=ne.slice(0,G).map(re=>re.participantId);if(l&&(oe!=null&&oe.length)){const re=Uo({autoEntryPositions:o,entryStage:V,tournamentRecord:c,participantIds:oe,event:Q});if(re.error)return re}const se=q?ne.slice(G,G+q).map(re=>re.participantId):0;if(l&&(se!=null&&se.length)){let re=0,ae=1;const me=(ce,Pe)=>ce.stageSequence-Pe.stageSequence,Oe=(ce,Pe)=>ce.roundTarget-Pe.roundTarget;for(const ce of y.sort(Oe)){ae=ce.roundTarget||ae;let Pe=1,$e;for(const ye of ce.structureProfiles.sort(me)){const be=(ye.drawSize||Hf(ye.participantsCount))-($e||0),ge=se.slice(re,re+be),Ne=Uo({entryStage:Ie,entryStageSequence:Pe,autoEntryPositions:o,tournamentRecord:c,participantIds:ge,roundTarget:ae,event:Q});if(Ne.error)return Ne;$e=ye.qualifyingPositions,re+=be,Pe+=1}ae+=1}}const ve=g&&((f=c==null?void 0:c.participants)==null?void 0:f.filter(({participantId:re})=>!oe.includes(re)).filter(J).filter(te).slice(0,P||R-G||I).map(re=>re.participantId));if(l&&(ve!=null&&ve.length)){const re=Uo({participantIds:ve,autoEntryPositions:!1,entryStatus:rn,tournamentRecord:c,event:Q});if(re.error)return re.error}const X=j||L;c&&w&&w<=oe.length&&le(1,w+1).forEach((ae,me)=>{let Oe={scaleName:X,scaleDate:d,scaleType:MU,scaleValue:ae,eventType:W};const ce=oe[me];vc({tournamentRecord:c,participantId:ce,scaleItem:Oe})});const ie=yg($l(Nl({},de(u,!1,!0)),{tournamentRecord:c,seedingScaleName:X,matchUpFormat:h,eventId:H,isMock:l,event:Q}));if(ie.error)return ie;const{drawDefinition:fe}=ie,Ee=fe.drawId;if(Array.isArray(E)&&E.filter(on).forEach(re=>et({element:fe,extension:re})),O){if(Xc({drawDefinition:fe,event:Q,suppressNotifications:!0}),_===sn&&u.drawMatic){const ae=u.roundsCount||1;for(const me of le(1,ae+1)){const Oe=hg({generateMatchUps:!0,tournamentRecord:c,drawDefinition:fe,roundNumber:me});if(Oe.error)return Oe}}if(u.withPlayoffs){const ae=fe.structures[0].structureId,me=Hd($l(Nl({},u.withPlayoffs),{tournamentRecord:c,drawDefinition:fe,structureId:ae,idPrefix:C,isMock:l,event:Q}));if(me!=null&&me.error)return me}const re=u.automated===!1;if(l&&!re){const ae=({completionGoal:me,completeAllMatchUps:Oe})=>{const ce=Vu({matchUpStatusProfile:r,completeAllMatchUps:Oe,qualifyingProfiles:y,randomWinningSide:s,tournamentRecord:c,completionGoal:me,drawDefinition:fe,matchUpFormat:h,event:Q});if(ce.error)return ce;const Pe=ce.completedCount;if(_===vo){const $e=fe.structures.find(be=>be.stage===ue);let ye=qd({structureId:$e.structureId,tournamentRecord:c,drawDefinition:fe,event:Q});const Ae=me?me-Pe:void 0;if(ye=Vu({completionGoal:me?Ae:void 0,matchUpStatusProfile:r,completeAllMatchUps:Oe,randomWinningSide:s,tournamentRecord:c,drawDefinition:fe,matchUpFormat:h,event:Q}),ye.error)return ye}};if(T&&ae({completionGoal:T}),u.outcomes){const{matchUps:me}=Er({inContext:!0,drawDefinition:fe,event:Q});for(const Oe of u.outcomes){const{matchUpStatus:ce=_t,matchUpStatusCodes:Pe,stageSequence:$e=1,matchUpIndex:ye=0,structureOrder:Ae,matchUpFormat:be,drawPositions:ge,roundPosition:Ne,stage:Ue=ue,roundNumber:he,winningSide:xe,scoreString:De}=Oe,Je=me.reduce((Wt,ro)=>{const{structureId:Rn,matchUpId:Qo}=ro;return Wt[Rn]?Wt[Rn].push(Qo):Wt[Rn]=[Qo],Wt},{}),rt=Object.assign({},...Object.keys(Je).map((Wt,ro)=>({[Wt]:ro+1}))),bt=me.filter(Wt=>(!Ue||Wt.stage===Ue)&&(!$e||Wt.stageSequence===$e)&&(!he||Wt.roundNumber===he)&&(!Ne||Wt.roundPosition===Ne)&&(!Ae||rt[Wt.structureId]===Ae)&&(!ge||Dt(ge,Wt.drawPositions).length===2))[ye],Qt=ij({matchUpStatusCodes:Pe,tournamentRecord:c,drawDefinition:fe,targetMatchUp:bt,matchUpFormat:be,matchUpStatus:ce,scoreString:De,winningSide:xe,drawId:Ee});if(Qt!=null&&Qt.error)return Qt}}n&&ae({completeAllMatchUps:n})}M&&sl({tournamentRecord:c,event:Q})}else{const re=_g({drawEntries:fe.entries,drawName:U||_,qualifyingPositions:S,drawId:Ee,event:Q,stage:V});if(re.error)return re}return $l(Nl({},B),{event:_e(Q),uniqueParticipantIds:Y,targetParticipants:F,drawDefinition:fe,eventId:H,drawId:Ee})}function vj({tournamentRecord:t,venueProfiles:e}){const{startDate:r,endDate:n}=t;let o=[];for(const[i,s]of e.entries()){let{venueAbbreviation:a,venueId:c=ke(),dateAvailability:l,startTime:u="07:00",endTime:d="19:00",courtTimings:p,courtsCount:v,courtNames:f,venueName:m,idPrefix:g,courtIds:h}=s;const _={venueName:m||`Venue ${i+1}`,venueAbbreviation:a,venueId:c};let I=Tc({tournamentRecord:t,venue:_});if(I.error)return I;o.push(c);const P=av(r,n),S=!Array.isArray(l)&&[{startTime:u,endTime:d}].concat(P.map(y=>({date:yn(y),startTime:u,endTime:d})));if(I=km({dateAvailability:l||S,tournamentRecord:t,courtTimings:p,courtsCount:v,courtNames:f,startTime:u,idPrefix:g,courtIds:h,endTime:d,venueId:c,dates:P}),I.error)return I}return o}var NIe=Object.defineProperty,$Ie=Object.defineProperties,AIe=Object.getOwnPropertyDescriptors,x$=Object.getOwnPropertySymbols,UIe=Object.prototype.hasOwnProperty,CIe=Object.prototype.propertyIsEnumerable,G$=(t,e,r)=>e in t?NIe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,MIe=(t,e)=>{for(var r in e||(e={}))UIe.call(e,r)&&G$(t,r,e[r]);if(x$)for(var r of x$(e))CIe.call(e,r)&&G$(t,r,e[r]);return t},DIe=(t,e)=>$Ie(t,AIe(e));function jIe({ratingsParameters:t=Bn,participantsProfile:e={},matchUpStatusProfile:r,completeAllMatchUps:n,autoEntryPositions:o,hydrateCollections:i,randomWinningSide:s,schedulingProfile:a,tournamentRecord:c,eventProfiles:l,venueProfiles:u,autoSchedule:d,drawProfiles:p,uuids:v}){var f,m,g;if(!c)return{error:ee};const h=[],_=[],I=[];l==null||l.forEach(T=>{var N;const w=(N=c.events)==null?void 0:N.find(($,U)=>T.eventIndex!==void 0&&U===T.eventIndex||T.eventName&&$.eventName===T.eventName||T.eventId&&$.eventId===T.eventId);w!=null&&w.gender&&(T.gender=w.gender)});const P=((f=c.participants)==null?void 0:f.length)||void 0;P&&(e!=null&&e.idPrefix)&&(e.idPrefix=`${e.idPrefix}-${P}`);const S=cj({startDate:c.startDate,participantsProfile:e,tournamentRecord:c,eventProfiles:l,drawProfiles:p,uuids:v});if(!S.success)return S;if(l){let T=((m=c.events)==null?void 0:m.length)||0;for(const N of l){let{ratingsParameters:w}=N;const $=(g=c.events)==null?void 0:g.find((U,A)=>N.eventIndex!==void 0&&A===N.eventIndex||N.eventName&&U.eventName===N.eventName||N.eventId&&U.eventId===N.eventId);if($){const{gender:U,category:A,eventType:C}=$,{drawProfiles:M,publish:D}=N,V=C===Yn&&Ce||C===mr&&we||C;if(M){const{stageParticipantsCount:R,uniqueParticipantsCount:W,uniqueParticipantStages:x}=uj({drawProfiles:M,category:A,gender:U}),{uniqueDrawParticipants:K=[],uniqueParticipantIds:j=[]}=x?lj({event:{eventType:C,category:A,gender:U},uniqueParticipantsCount:W,participantsProfile:e,ratingsParameters:w,tournamentRecord:c,eventProfile:N,uuids:v}):{};h.push(...j);const{stageParticipants:L}=dj({targetParticipants:c.participants||[],allUniqueParticipantIds:h,stageParticipantsCount:R,eventParticipantType:V});let F=pj({uniqueDrawParticipants:K,autoEntryPositions:o,stageParticipants:L,tournamentRecord:c,drawProfiles:M,category:A,gender:U,event:$});if(F.error||(F=sj({matchUpStatusProfile:r,completeAllMatchUps:n,randomWinningSide:s,tournamentRecord:c,drawProfiles:M,event:$}),F.error))return F;I.push(...F.drawIds)}D&&sl({tournamentRecord:c,event:$})}else{const U=fj({startDate:c.startDate,allUniqueParticipantIds:h,matchUpStatusProfile:r,participantsProfile:e,completeAllMatchUps:n,autoEntryPositions:o,randomWinningSide:s,ratingsParameters:w,tournamentRecord:c,eventProfile:N,eventIndex:T,uuids:v});if(U.error)return U;const{eventId:A,drawIds:C,uniqueParticipantIds:M}=U;C&&I.push(...C),_.push(A),M!=null&&M.length&&h.push(...M),T+=1}}}if(p){let T=(c.events||[]).map(N=>{var w;return((w=N.drawDefinitions)==null?void 0:w.map(()=>1))||[]}).flat().reduce((N,w)=>N+w,0);for(const N of p){let w=Og({startDate:c.startDate,allUniqueParticipantIds:h,matchUpStatusProfile:r,participantsProfile:e,completeAllMatchUps:n,autoEntryPositions:o,hydrateCollections:i,randomWinningSide:s,ratingsParameters:t,tournamentRecord:c,drawProfile:N,drawIndex:T,uuids:v});if(w.error)return w;const{drawId:$,eventId:U,event:A,uniqueParticipantIds:C}=w;if(w=Jd({tournamentRecord:c,event:A,internalUse:!0}),w.error)return w;$&&I.push($),_.push(U),C!=null&&C.length&&h.push(...C),T+=1}}const y=u!=null&&u.length?vj({tournamentRecord:c,venueProfiles:u}):[];let O,b={};if(a!=null&&a.length){const T={[c.tournamentId]:c},N=rl({tournamentRecords:T,schedulingProfile:a});if(N.error)return N;if(d){const{tournamentId:w}=c,$={[w]:c};b=Um({tournamentRecords:$})}}const E=c.participants.length;return DIe(MIe({totalParticipantsCount:E,scheduledRounds:O,schedulerResult:b},B),{eventIds:_,venueIds:y,drawIds:I})}const RIe={anonymizeTournamentRecord:l_e,modifyTournamentRecord:jIe};var FIe=Object.defineProperty,k$=Object.getOwnPropertySymbols,VIe=Object.prototype.hasOwnProperty,LIe=Object.prototype.propertyIsEnumerable,W$=(t,e,r)=>e in t?FIe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,BIe=(t,e)=>{for(var r in e||(e={}))VIe.call(e,r)&&W$(t,r,e[r]);if(k$)for(var r of k$(e))LIe.call(e,r)&&W$(t,r,e[r]);return t};function xIe({schedulingProfile:t,tournamentRecord:e}){if(typeof t!="object")return{error:Z};const r=Sa({tournamentRecord:e}).containedStructures,{matchUps:n}=Vt({tournamentRecord:e}),{tournamentId:o}=e,i=[];for(const s of t){const{scheduleDate:a,venues:c=[]}=s;for(const l of c){const{rounds:u,venueId:d}=l;for(const p of u){const{drawId:v,winnerFinishingPositionRange:f,roundSegment:m}=p,h=n.filter(_=>{var I;const P=(f==null?void 0:f.indexOf("-"))>0&&f.split("-").map(y=>+y),S=(I=_.finishingPositionRange)==null?void 0:I.winner;return _.drawId===v&&(!p.roundNumber||_.roundNumber===p.roundNumber)&&(!S||!P||Dt(S,P).length===2||Ve(S).length===Ve(P).length&&Dt(S,P).length===Ve(S).length)})[0];if(h){const{eventId:_,roundNumber:I,drawName:P,structureName:S,roundName:y}=h;let O=h.structureId;I&&!f&&(O=Object.keys(r).find(T=>r[T].includes(O))||O);const b={tournamentId:o,structureId:O,roundNumber:I,roundSegment:m,eventId:_,drawId:v};let E=bM({tournamentRecords:{[o]:e},round:b,scheduleDate:a,venueId:d});if(E.error)return E;i.push(BIe({structureName:S,roundName:y,drawName:P},b))}}}}return{scheduledRounds:i}}var GIe=Object.defineProperty,kIe=Object.defineProperties,WIe=Object.getOwnPropertyDescriptors,q$=Object.getOwnPropertySymbols,qIe=Object.prototype.hasOwnProperty,HIe=Object.prototype.propertyIsEnumerable,H$=(t,e,r)=>e in t?GIe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Y$=(t,e)=>{for(var r in e||(e={}))qIe.call(e,r)&&H$(t,r,e[r]);if(q$)for(var r of q$(e))HIe.call(e,r)&&H$(t,r,e[r]);return t},K$=(t,e)=>kIe(t,WIe(e));function YIe({scheduleCompletedMatchUps:t,ratingsParameters:e=Bn,tournamentName:r="Mock Tournament",tournamentExtensions:n,tournamentAttributes:o,matchUpStatusProfile:i,participantsProfile:s,completeAllMatchUps:a,autoEntryPositions:c,hydrateCollections:l,randomWinningSide:u,policyDefinitions:d,schedulingProfile:p,eventProfiles:v,venueProfiles:f,drawProfiles:m,autoSchedule:g,startDate:h,endDate:_,uuids:I}={}){if(h&&!Nr(h)||_&&!Nr(_))return{error:ar};if(v&&!Array.isArray(v))return{error:Z};if(!h){const w=new Date;h=yn(_||w),_=yn(w.setDate(w.getDate()+7))}if(!_){const w=new Date(h);_=yn(w.setDate(w.getDate()+7))}typeof o!="object"&&(o={});const P=lg(K$(Y$({},o),{tournamentName:r,startDate:h,endDate:_}));if(n!=null&&n.length&&Array.isArray(n)){const w=n.filter(on);w!=null&&w.length&&Object.assign(P,{extensions:w,isMock:!0})}if(typeof d=="object")for(const w of Object.keys(d))jm({policyDefinitions:{[w]:d[w]},tournamentRecord:P});const S=cj({participantsProfile:s,tournamentRecord:P,eventProfiles:v,drawProfiles:m,startDate:h,uuids:I});if(!S.success)return S;const y=[],O=[],b=[];if(Array.isArray(m)){let w=0;for(const $ of m){let U=Og({allUniqueParticipantIds:b,matchUpStatusProfile:i,participantsProfile:s,completeAllMatchUps:a,autoEntryPositions:c,hydrateCollections:l,randomWinningSide:u,ratingsParameters:e,tournamentRecord:P,isMock:!0,drawProfile:$,startDate:h,drawIndex:w,uuids:I});if(U.error)return U;const{drawId:A,eventId:C,event:M,uniqueParticipantIds:D}=U;if(U=Jd({suppressNotifications:!1,internalUse:!0,tournamentRecord:P,event:M}),U.error)return U;A&&y.push(A),O.push(C),D!=null&&D.length&&b.push(...D),w+=1}}if(v){let w=0;for(const $ of v){const U=fj({allUniqueParticipantIds:b,matchUpStatusProfile:i,participantsProfile:s,completeAllMatchUps:a,autoEntryPositions:c,hydrateCollections:l,randomWinningSide:u,ratingsParameters:e,tournamentRecord:P,eventProfile:$,eventIndex:w,startDate:h,uuids:I});if(U.error)return U;const{eventId:A,drawIds:C,uniqueParticipantIds:M}=U;C&&y.push(...C),O.push(A),M!=null&&M.length&&b.push(...M),w+=1}}const E=f!=null&&f.length?vj({tournamentRecord:P,venueProfiles:f,uuids:I}):[];let T,N={};if(p){const w=xIe({schedulingProfile:p,tournamentRecord:P});if(w.error)return w;if(T=w.scheduledRounds,g){const{tournamentId:$}=P,U={[$]:P};N=Um({scheduleCompletedMatchUps:t,tournamentRecords:U})}}return Ka(),_e(K$(Y$({},B),{tournamentRecord:P,scheduledRounds:T,schedulerResult:N,eventIds:O,venueIds:E,drawIds:y}))}const KIe={generateOutcomeFromScoreString:nj,generateTournamentRecord:YIe,generateEventWithDraw:Og,generateParticipants:Zd,parseScoreString:su,generateOutcome:oj,credits:Vd};var zIe=Object.defineProperty,z$=Object.getOwnPropertySymbols,QIe=Object.prototype.hasOwnProperty,JIe=Object.prototype.propertyIsEnumerable,Q$=(t,e,r)=>e in t?zIe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ZIe=(t,e)=>{for(var r in e||(e={}))QIe.call(e,r)&&Q$(t,r,e[r]);if(z$)for(var r of z$(e))JIe.call(e,r)&&Q$(t,r,e[r]);return t};let sf=!1;const oPe=function(){const t={version:()=>oo(),setDeepCopy:(n,o)=>(Yi(n,o),t),devContext:n=>(Ls(n),sf=!0,t)};return r([RIe,KIe]),t;function e(n,o){const i=n(ZIe({},o));return i!=null&&i.error||vi(),ii(),sf&&(Ls(!1),sf=!1),i}function r(n){n.forEach(o=>{Object.keys(o).forEach(i=>{t[i]=s=>{try{return e(o[i],s)}catch(a){const c=a.toString();console.log("ERROR",{error:c,method:i,params:JSON.stringify(s)})}}})})}}(),iPe={hasAttributeValues:RF,extractAttributes:FF,structureSort:yi,matchUpSort:_s,tidyScore:NW,generateScoreString:xn,calculateWinCriteria:Pa,compareTieFormats:_d,parseScoreString:su,scoreHasValue:At,getScaleValues:ga,proConflicts:iC,addExtension:et,chunkArray:jt,countValues:qj,dateRange:av,dateTime:ZF,definedAttributes:_e,dehydrateMatchUps:x4,findExtension:Lt,garman:Y4,getTimeItem:pn,generateHashCode:LF,generateRange:le,generateTimeCode:jA,instanceCount:fr,intersection:Dt,isNumeric:Pt,isConvertableInteger:lt,isPowerOf2:Lr,JSON2CSV:XF,flattenJSON:lv,makeDeepCopy:de,nearestPowerOf2:Yf,nextPowerOf2:ia,numericSort:Bt,overlap:Gt,parseAgeCategoryCode:cC,randomMember:pr,randomPop:rr,shuffleArray:tr,isAdHoc:mo,unique:Ve,UUID:ke,UUIDS:eV,validateTieFormat:cr},XIe=Dj({WebkitBoxSizing:"border-box",display:"inline-block",boxSizing:"border-box",position:"relative",marginInlineStart:1,marginInlineEnd:2,borderRadius:2,variants:{variant:{doubles:{width:".75rem"},singles:{width:"1rem"}}}});function sPe({matchUp:t,individualParticipant:e,spacer:r}){var a,c,l;const n=((a=e==null?void 0:e.person)==null?void 0:a.iso2NationalityCode)||"",o=n?(c=J3.countryToFlag(n))==null?void 0:c.slice(0,4):"",i=document.createElement("span"),s=(l=t==null?void 0:t.matchUpType)==null?void 0:l.toLowerCase();return i.className=XIe({variant:s}),i.innerHTML=r?"":o,i}export{rPe as d,J3 as f,oPe as m,sPe as r,nPe as t,iPe as u};
//# sourceMappingURL=renderFlag-e247062b.js.map
